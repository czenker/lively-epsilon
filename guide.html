<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.7">
<title>Lively Epsilon</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote::before{display:none}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{word-spacing:0;line-height:1.6}
.quoteblock.abstract blockquote::before,.quoteblock.abstract p::before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Lively Epsilon</h1>
<div class="details">
<span id="revnumber">version dev,</span>
<span id="revdate">2020-10-24
</span>
<br><span id="revremark">Work in Progress</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">Introduction</a></li>
<li><a href="#_getting_started">Getting Started</a></li>
<li><a href="#_building_blocks">Building Blocks</a>
<ul class="sectlevel2">
<li><a href="#_cron">Cron</a></li>
<li><a href="#_eventhandler">EventHandler</a></li>
<li><a href="#_translator">Translator</a></li>
</ul>
</li>
<li><a href="#_components">Components</a>
<ul class="sectlevel2">
<li><a href="#_orderqueue">OrderQueue</a></li>
<li><a href="#_comms">Comms</a></li>
<li><a href="#_tools_ensurecomms">Tools.ensureComms</a></li>
<li><a href="#_tools_storycomms">Tools.storyComms</a></li>
<li><a href="#_menu">Menu</a></li>
<li><a href="#_quick_dial">Quick Dial</a></li>
<li><a href="#_missions">Missions</a></li>
<li><a href="#_upgrade">Upgrade</a></li>
<li><a href="#playerspaceship-storage">PlayerSpaceship Storage</a></li>
<li><a href="#_crew">Crew</a></li>
<li><a href="#_ship_events">Ship Events</a></li>
<li><a href="#fleet">Fleet</a></li>
<li><a href="#tags">Tags</a></li>
<li><a href="#_products">Products</a></li>
<li><a href="#_storage">Storage</a></li>
<li><a href="#_production">Production</a></li>
<li><a href="#_merchant_comms">Merchant &amp; Comms</a></li>
<li><a href="#_traders">Traders</a></li>
<li><a href="#_miner">Miner</a></li>
<li><a href="#_chatter">Chatter</a></li>
</ul>
</li>
<li><a href="#_development">Development</a>
<ul class="sectlevel2">
<li><a href="#_logging">Logging</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This document is Work in Progress. The given information should be correct, but some things are still missing.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TODO: functional approach</p>
</div>
<div class="paragraph">
<p>If you want to use the framework you should already be familiar with writing missions
for EE.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started">Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Checkout this repo into the <code>scripts</code> folder of your EE installation or just download the zip from
Github and extract.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="comment">-- Name: Hello Lively Epsilon</span>
<span class="comment">-- Description: Testing Lively Epsilon</span>
<span class="comment">-- Type: Mission</span>
require <span class="string"><span class="delimiter">&quot;</span><span class="content">lively_epsilon/init.lua</span><span class="delimiter">&quot;</span></span>
<span class="keyword">function</span> <span class="function">init</span>()
    <span class="comment">-- add your code here</span>
<span class="keyword">end</span>

<span class="keyword">function</span> <span class="function">update</span>(delta)
    Cron.tick(delta)
<span class="keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you like, you can still put code into the <code>update</code> function, but typically you do not
need to do that, because Lively Epsilon is using <code>Cron</code> to perform checks and updates that
you would usually put there. Your code usually ends up in the <code>init</code> function.</p>
</div>
<div class="paragraph">
<p>If not indicated otherwise all example code will have to be put into the <code>init</code> function.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_building_blocks">Building Blocks</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_cron">Cron</h3>
<div class="paragraph">
<p><code>Cron</code> works as a scheduler for functions. It is capable of calling functions after a specified
time and calling functions regularly at a specified interval. This is what you typically do
in the <code>update</code> function, but you are more flexible and you can configure how often your
function should be called.</p>
</div>
<div class="sect3">
<h4 id="_regular">regular</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Basic usage</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">Cron.regular(<span class="keyword">function</span>()
    <span class="keyword">if</span> <span class="keyword">not</span> station:isValid() <span class="keyword">then</span>
        <span class="comment">-- you won</span>
        victory(<span class="string"><span class="delimiter">&quot;</span><span class="content">Human Navy</span><span class="delimiter">&quot;</span></span>)
    <span class="keyword">end</span>
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you got an operation that is expensive or does not make sense to execute too often you can
give an interval.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">A check that is done once a second</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">Cron.regular(<span class="keyword">function</span>(self)
    <span class="keyword">if</span> distance(player, station) &gt; <span class="integer">20000</span> <span class="keyword">then</span>
        player:addToShipLog(<span class="string"><span class="delimiter">&quot;</span><span class="content">You did not guard the station as you were supposed to.</span><span class="delimiter">&quot;</span></span>)
        victory(<span class="string"><span class="delimiter">&quot;</span><span class="content">Kraylor</span><span class="delimiter">&quot;</span></span>)
    <span class="keyword">end</span>
<span class="keyword">end</span>, <span class="integer">1</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is an optional third parameter that gives the initial delay. This specifies how many seconds
after creation the function is called for the first time.</p>
</div>
</div>
<div class="sect3">
<h4 id="_once">once</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Basic usage</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">Cron.once(<span class="keyword">function</span>()
    station:sendCommsMessage(player, <span class="string"><span class="delimiter">&quot;</span><span class="content">Do not forget my assignment.</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>, <span class="integer">60</span>)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_aborting_crons">aborting crons</h4>
<div class="paragraph">
<p>It is possible to abort crons from within and outside the function.</p>
</div>
<div class="paragraph">
<p>The callback function gets itself as the first parameter. It can be used to abort the currently
running cron.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">Cron.regular(<span class="keyword">function</span>(self)
    <span class="keyword">if</span> player:isDocked(station) <span class="keyword">then</span>
        Cron.abort(self)
    <span class="keyword">end</span>
<span class="keyword">end</span>, <span class="integer">60</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You could also decide to give your cron a fixed name. This way you can stop the cron from anywhere.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">Cron.once(<span class="string"><span class="delimiter">&quot;</span><span class="content">timeout</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>()
    player:addToShipLog(<span class="string"><span class="delimiter">&quot;</span><span class="content">You were not fast enough.</span><span class="delimiter">&quot;</span></span>)
    victory(<span class="string"><span class="delimiter">&quot;</span><span class="content">Kraylor</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>, <span class="integer">5</span> * <span class="integer">60</span>)
Cron.regular(<span class="keyword">function</span>(self)
    <span class="keyword">if</span> player:isDocked(station) <span class="keyword">then</span>
        Cron.abort(<span class="string"><span class="delimiter">&quot;</span><span class="content">timeout</span><span class="delimiter">&quot;</span></span>)
        Cron.abort(self)
    <span class="keyword">end</span>
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A cron will be overridden if one by the same name already exists. This is intended behavior.
So you need to make sure that your name is unique.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To prevent colliding names <code>Cron</code> returns a unique one for you if none is given. You can also
use that to stop a different cron.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">cronId</span> = Cron.once(<span class="keyword">function</span>()
    player:addToShipLog(<span class="string"><span class="delimiter">&quot;</span><span class="content">You were not fast enough.</span><span class="delimiter">&quot;</span></span>)
    victory(<span class="string"><span class="delimiter">&quot;</span><span class="content">Kraylor</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>, <span class="integer">5</span> * <span class="integer">60</span>)
Cron.regular(<span class="keyword">function</span>(self)
    <span class="keyword">if</span> player:isDocked(station) <span class="keyword">then</span>
        Cron.abort(cronId)
        Cron.abort(self)
    <span class="keyword">end</span>
<span class="keyword">end</span>)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_measuring_time">Measuring time</h4>
<div class="paragraph">
<p>Empty Epsilon does not give any guarantee on how many frames are rendered per second. You need
to keep that in mind when working with time.</p>
</div>
<div class="sect4">
<h5 id="_delta">delta</h5>
<div class="paragraph">
<p>You get a delta as the second argument or the callback function. This is always the
time that passed since the callback was called the last time or – if it is called for the first
time – since it was created.</p>
</div>
<div class="paragraph">
<p>Here is a simple way to have nanobots repair your ships hull.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Implementing nanobots</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">repairPerSecond</span> = <span class="integer">2</span>
Cron.regular(<span class="keyword">function</span>(self, delta)
    <span class="keyword">local</span> <span class="local-variable">hull</span> = player:getHull() + delta * repairPerSecond
    player:setHull(hull)
    <span class="keyword">if</span> hull &gt; player:getHullMax() <span class="keyword">then</span>
        Cron.abort(self)
    <span class="keyword">end</span>
<span class="keyword">end</span>)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_now">now</h5>
<div class="paragraph">
<p>You can get the current game time in game in seconds using <code>now()</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">print</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">It is now </span><span class="delimiter">&quot;</span></span> .. Cron.now())</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This is a rough time and will probably diverge with the time of the clock on your wall.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_manipulate_delays">manipulate delays</h5>
<div class="paragraph">
<p>You can manipulate delays to postpone their execution using <code>addDelay</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">Cron.once(<span class="string"><span class="delimiter">&quot;</span><span class="content">timeout</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>()
    player:addToShipLog(<span class="string"><span class="delimiter">&quot;</span><span class="content">You were not fast enough.</span><span class="delimiter">&quot;</span></span>)
    victory(<span class="string"><span class="delimiter">&quot;</span><span class="content">Kraylor</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>, <span class="integer">5</span> * <span class="integer">60</span>)
Cron.regular(<span class="keyword">function</span>(self)
    <span class="keyword">if</span> distance(player, <span class="integer">1000</span>, <span class="integer">2000</span>) &lt; <span class="integer">500</span> <span class="keyword">then</span>
        player:addToShipLog(<span class="string"><span class="delimiter">&quot;</span><span class="content">You reached the waypoint and got 30 bonus seconds.</span><span class="delimiter">&quot;</span></span>)
        Cron.addDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">timeout</span><span class="delimiter">&quot;</span></span>, <span class="integer">30</span>)
        Cron.abort(self)
    <span class="keyword">end</span>
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also read the time that has to pass until the function is called for the next time with <code>getDelay</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">Cron.once(<span class="string"><span class="delimiter">&quot;</span><span class="content">timeout</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>()
    player:addToShipLog(<span class="string"><span class="delimiter">&quot;</span><span class="content">You were not fast enough.</span><span class="delimiter">&quot;</span></span>)
    victory(<span class="string"><span class="delimiter">&quot;</span><span class="content">Kraylor</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>, <span class="integer">5</span> * <span class="integer">60</span>)
Cron.regular(<span class="keyword">function</span>(self)
    player:addToShipLog(string.format(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hurry up! Only %0.1f seconds left.</span><span class="delimiter">&quot;</span></span>, Cron.getDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">timeout</span><span class="delimiter">&quot;</span></span>)))
<span class="keyword">end</span>, <span class="integer">10</span>)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_eventhandler">EventHandler</h3>
<div class="paragraph">
<p>An EventHandler is a well-known concept from programming that allows to loosely couple your code.
You can have several independent functions listening to the same event, but they do not need to
know or even care about one another.</p>
</div>
<div class="paragraph">
<p>The terminology is that a function "registers" to listen for an event and is called as soon
as the event is "fired".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">eh</span> = EventHandler:new()
eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">newPlayer</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>(thePlayer)
    thePlayer:addToShipLog(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World.</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>)
eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">newPlayer</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>(thePlayer)
    <span class="keyword">local</span> <span class="local-variable">x</span>,<span class="local-variable">y</span> = thePlayer:getPosition()
    CpuShip():setFaction(<span class="string"><span class="delimiter">&quot;</span><span class="content">Kraylor</span><span class="delimiter">&quot;</span></span>):setPostion(x + <span class="integer">4000</span>, y):orderAttack(thePlayer)
<span class="keyword">end</span>)

Cron.regular(<span class="keyword">function</span>()
    <span class="keyword">if</span> <span class="keyword">not</span> player:isValid() <span class="keyword">then</span>
        player = PlayerSpaceship():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Reborn</span><span class="delimiter">&quot;</span></span>)
        eh:fire(<span class="string"><span class="delimiter">&quot;</span><span class="content">newPlayer</span><span class="delimiter">&quot;</span></span>, player)
    <span class="keyword">end</span>
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example the cron at the bottom has just one job: Recreating the player ship if it got
destroyed. All the other logic that happens afterwards is done in the event listeners.</p>
</div>
<div class="paragraph">
<p>You can see in the example that you can give a single argument to the <code>fire</code> method that will
be passed through to the event listeners.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You need to be aware that the argument is given to the event listeners <strong>by reference</strong>.
This means that all changes you do to that parameter are permanent and available in successive
event listeners.</p>
</div>
<div class="paragraph">
<p>You can use that to your advantage. But you should be aware that you alway need to check your inputs.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_config_allowedevents">config.allowedEvents</h4>
<div class="paragraph">
<p>The problem with the event names is that you could mistype some of them. This leads to confusion because
you <em>have</em> set the event listener, but it will never be called.</p>
</div>
<div class="paragraph">
<p>This is why the <code>allowedEvents</code> config exists. You can use it configure a list of event names that
are known to be correct. If you try to register or fire an event with a name that is not in that list
it will fail with an error.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">eh</span> = EventHandler:new(<span class="map"><span class="delimiter">{</span>
    <span class="key">allowedEvents</span> = <span class="map"><span class="inline-delimiter">{</span><span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>
<span class="delimiter">}</span></span>)
eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="comment"><span class="delimiter">--[[</span><span class="content"> your code goes here</span><span class="delimiter">]]</span></span> <span class="keyword">end</span>) <span class="comment">-- this works</span>

eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="comment"><span class="delimiter">--[[</span><span class="content"> your code goes here</span><span class="delimiter">]]</span></span> <span class="keyword">end</span>) <span class="comment">-- this will fail with an error</span>

eh:fire(<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>) <span class="comment">-- this works</span>
eh:fire(<span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span>) <span class="comment">-- this will fail with an error</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_config_unique">config.unique</h4>
<div class="paragraph">
<p>By default you can call events as often as you like, but if you want to use one event handler for
running your main story, the <code>unique</code> config option might come in handy.</p>
</div>
<div class="paragraph">
<p>It guarantees that every event is only called once and issues warnings if a listener is registered
after the event is called or if an event should be called a second time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">eh</span> = EventHandler:new(<span class="map"><span class="delimiter">{</span> <span class="key">unique</span> = <span class="predefined-constant">true</span> <span class="delimiter">}</span></span>)
eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="comment"><span class="delimiter">--[[</span><span class="content"> your code goes here</span><span class="delimiter">]]</span></span> <span class="keyword">end</span>)
eh:fire(<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>) <span class="comment">-- this works</span>
eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="comment"><span class="delimiter">--[[</span><span class="content"> your code goes here</span><span class="delimiter">]]</span></span> <span class="keyword">end</span>) <span class="comment">-- this will cause a warning</span>
eh:fire(<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>) <span class="comment">-- this will cause a warning</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_priorities">priorities</h4>
<div class="paragraph">
<p>By default all events are called in the order they have been registered. Typically it is
a good rule of thumb to write Event Listeners in a way that their order does not matter,
but in some cases there is no easy way around. That is why you can specify a <code>priority</code> when
registering an event. The default value is <code>0</code> and the lower the number is the earlier
the listener is called.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">eh</span> = EventHandler:new()
eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">count</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="predefined">print</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>) <span class="keyword">end</span>)
eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">count</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="predefined">print</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>) <span class="keyword">end</span>, <span class="integer">10</span>)
eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">count</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="predefined">print</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>) <span class="keyword">end</span>, <span class="integer">-10</span>)

eh:fire(<span class="string"><span class="delimiter">&quot;</span><span class="content">count</span><span class="delimiter">&quot;</span></span>) <span class="comment">-- will print &quot;123&quot;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_translator">Translator</h3>
<div class="paragraph">
<p>The Translator helps you writing your scenarios independent of the players spoken language.
You can <code>register</code> translations for labels and then <code>translate</code> them.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new()
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hi</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
translator:register(<span class="map"><span class="delimiter">{</span>
    <span class="key">say_hi_to_foo</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Foo</span><span class="delimiter">&quot;</span></span>,
    <span class="key">say_hi_to_bar</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Bar</span><span class="delimiter">&quot;</span></span>,
<span class="delimiter">}</span></span>)

translator:translate(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hi</span><span class="delimiter">&quot;</span></span>) <span class="comment">-- returns &quot;Hello World&quot;</span>
translator:translate(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hi_to_foo</span><span class="delimiter">&quot;</span></span>) <span class="comment">-- returns &quot;Hello Foo&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Translations can also be functions. They will be called with the additional parameters
that are given to the <code>translate</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new()
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>(name)
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="delimiter">&quot;</span></span> .. name
<span class="keyword">end</span>)

translator:translate(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>) <span class="comment">-- returns &quot;Hello Bob&quot;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When working with functions it is always advised to think of them as <em>atomic functions</em>.<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup> Having helper functions
extracted is of course fine. But they should not include business logic or have to anything about global state.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Missing labels or failing translation functions will not break the business logic of your
code. They will return the translation key. This is to ensure that a scenario does not fail in
one locale but not the other because a translation is faulty.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_multiple_locales">multiple locales</h4>
<div class="paragraph">
<p>So far we have only used one locale. There is a default locale that has the identifier "en" for some
mysterious reason. All translations are registered and translated from "en" unless you give a different key
as the first argument.</p>
</div>
<div class="paragraph">
<p>You can use the <code>useLocale</code> function to change the default locale when the <code>translate</code> method is called.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new()
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>(name)
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="delimiter">&quot;</span></span> .. name
<span class="keyword">end</span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>(name)
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hallo </span><span class="delimiter">&quot;</span></span> .. name
<span class="keyword">end</span>)

translator:translate(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>) <span class="comment">-- returns &quot;Hello Bob&quot;</span>

translator:useLocale(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>)
translator:translate(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>) <span class="comment">-- returns &quot;Hallo Bob&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>useLocale</code> can also use fallback locales in case there is no label in the given locale.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new()

translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">one</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">One</span><span class="delimiter">&quot;</span></span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">two</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Two</span><span class="delimiter">&quot;</span></span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">one</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Eins</span><span class="delimiter">&quot;</span></span>)

translator:useLocale(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>)
translator:translate(<span class="string"><span class="delimiter">&quot;</span><span class="content">one</span><span class="delimiter">&quot;</span></span>) <span class="comment">-- returns &quot;Eins&quot;</span>
translator:translate(<span class="string"><span class="delimiter">&quot;</span><span class="content">two</span><span class="delimiter">&quot;</span></span>) <span class="comment">-- returns &quot;Two&quot;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_components">Components</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_orderqueue">OrderQueue</h3>
<div class="paragraph">
<p>The OrderQueue Component allows to chain commands for Ships and <a href="#fleet">Fleets</a>. So instead of
giving just one order, you can issue multiple orders that are executed consecutively.</p>
</div>
<div class="paragraph">
<p>This makes it easy to issue complex commands or define patrol routes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setFaction(<span class="string"><span class="delimiter">&quot;</span><span class="content">Human Navy</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">homeBase</span> = SpaceStation():setFaction(<span class="string"><span class="delimiter">&quot;</span><span class="content">Human Navy</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">enemyBase</span> = SpaceStation():setFaction(<span class="string"><span class="delimiter">&quot;</span><span class="content">Kraylor</span><span class="delimiter">&quot;</span></span>)
Ship:withOrderQueue(ship)

ship:addOrder(Order:defend(<span class="integer">10000</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">range</span> = <span class="integer">20000</span>,
    <span class="key">minClearTime</span> = <span class="integer">30</span>,
<span class="delimiter">}</span></span>))
ship:addOrder(Order:attack(enemyBase))
ship:addOrder(Order:dock(homeBase))
ship:addOrder(Order:flyTo(<span class="integer">5000</span>, <span class="integer">0</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>As with other orders issued to Fleets, they will carry out the order even if the Fleet Leader was destroyed.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
As GM you can issue different commands to ships with an active OrderQueue. They will follow your command and take
on they reached their objective or you reset them by giving them the order to idle.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Every <code>Order</code> allows you to specify the three callbacks <code>onExecution</code>, <code>onCompletion</code> and <code>onAbort</code> as optional
configuration. They get the order as first argument and the <code>Ship</code> or <code>Fleet</code> executing the order as second
parameter.</p>
</div>
<div class="paragraph">
<p><code>onAbort</code> is called when the current order can no longer be executed. This can happen if a ship is ordered to
dock at a station, but the station is destroyed. It gets the <code>Ship</code> or <code>Fleet</code> as third parameter and a string
with the <code>reason</code> as second argument.</p>
</div>
<div class="paragraph">
<p>Every <code>Order</code> can also have an <code>delayAfter</code> configuration. It waits the specified amount of seconds before
executing the next <code>Order</code> after completing the current order.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Using the callbacks it is rather easy to let a ship patrol between two points</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withOrderQueue(ship)
ship:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)

ship:addOrder(Order:flyTo(<span class="integer">5000</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">onCompletion</span> = <span class="keyword">function</span>(self, ship) ship:addOrder(self) <span class="keyword">end</span>,
<span class="delimiter">}</span></span>))
ship:addOrder(Order:flyTo(<span class="integer">-5000</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">onCompletion</span> = <span class="keyword">function</span>(self, ship) ship:addOrder(self) <span class="keyword">end</span>,
<span class="delimiter">}</span></span>))</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_flyto">flyTo</h4>
<div class="paragraph">
<p>Makes a ship fly to a specific coordinate.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setFaction(<span class="string"><span class="delimiter">&quot;</span><span class="content">Human Navy</span><span class="delimiter">&quot;</span></span>)
Ship:withOrderQueue(ship)
ship:addOrder(Order:flyTo(<span class="integer">10000</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">minDistance</span> = <span class="integer">1000</span>
<span class="delimiter">}</span></span>))
ship:addOrder(Order:flyTo(<span class="integer">0</span>, <span class="integer">10000</span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">minDistance</span> = <span class="integer">1000</span>
<span class="delimiter">}</span></span>))
ship:addOrder(Order:flyTo(<span class="integer">-10000</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">minDistance</span> = <span class="integer">1000</span>
<span class="delimiter">}</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>As configuration you can set a <code>minDistance</code>. This sets the radius that the ship should be around the
target zone so the <code>Order</code> is considered done.</p>
</div>
<div class="paragraph">
<p>If <code>ignoreEnemies</code> is set to <code>true</code> the ship will not attack enemies on the way to the target location.</p>
</div>
<div class="paragraph">
<p>Read more on this topic in the <a href="reference.html#order-flyto">Reference</a> and the <a href="spec.html#order-flyto">Specification</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_dock">dock</h4>
<div class="paragraph">
<p>This order makes a <code>Ship</code> or <code>Fleet</code> dock to a station, refill its weapons, recharge its shields and repair any hull damage.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setFaction(<span class="string"><span class="delimiter">&quot;</span><span class="content">Human Navy</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation():setFaction(<span class="string"><span class="delimiter">&quot;</span><span class="content">Human Navy</span><span class="delimiter">&quot;</span></span>)
Ship:withOrderQueue(ship)

ship:addOrder(Order:dock(station))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Read more on this topic in the <a href="reference.html#order-dock">Reference</a> and the <a href="spec.html#order-dock">Specification</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_attack">attack</h4>
<div class="paragraph">
<p>This lets a <code>Ship</code> or <code>Fleet</code> attack a target until it is destroyed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setFaction(<span class="string"><span class="delimiter">&quot;</span><span class="content">Human Navy</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation():setFaction(<span class="string"><span class="delimiter">&quot;</span><span class="content">Kraylor</span><span class="delimiter">&quot;</span></span>)
Ship:withOrderQueue(ship)

ship:addOrder(Order:attack(station))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Read more on this topic in the <a href="reference.html#order-attack">Reference</a> and the <a href="spec.html#order-attack">Specification</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_defend">defend</h4>
<div class="paragraph">
<p>Let a <code>Ship</code> or <code>Fleet</code> defend a location, a target or the current location.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setFaction(<span class="string"><span class="delimiter">&quot;</span><span class="content">Human Navy</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation():setFaction(<span class="string"><span class="delimiter">&quot;</span><span class="content">Human Navy</span><span class="delimiter">&quot;</span></span>)
Ship:withOrderQueue(ship)

ship:addOrder(Order:defend(station))
ship:addOrder(Order:defend(<span class="integer">10000</span>, <span class="integer">0</span>))
ship:addOrder(Order:defend())</code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration can tweak the Order. The Ship will consider the task complete when there are no enemies
in <code>range</code> for the last <code>minClearTime</code> seconds.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This does not mean that the ship will attack those enemies in <code>range</code>. It is still the AI that will
take care of target selection.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The configuration option <code>minDefendTime</code> gives the time that the ship will defend the location even if there
have never been enemies anywhere around.</p>
</div>
<div class="paragraph">
<p>Read more on this topic in the <a href="reference.html#order-defend">Reference</a> and the <a href="spec.html#order-defend">Specification</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_use">use</h4>
<div class="paragraph">
<p>Make a <code>Ship</code> or <code>Fleet</code> take a WormHole. This is rather straight forward for ships, but the behavior is
more complex for <code>Fleet</code>s. The ships will jump to the target on their own, but wait on the other side
until all ships have arrived.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setFaction(<span class="string"><span class="delimiter">&quot;</span><span class="content">Human Navy</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">ship2</span> = CpuShip():setFaction(<span class="string"><span class="delimiter">&quot;</span><span class="content">Human Navy</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">ship3</span> = CpuShip():setFaction(<span class="string"><span class="delimiter">&quot;</span><span class="content">Human Navy</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">wormHole</span> = WormHole():setPosition(<span class="integer">10000</span>, <span class="integer">0</span>):setTargetPosition(<span class="integer">99999</span>, <span class="integer">0</span>)

<span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span> ship, ship2, ship3 <span class="delimiter">}</span></span>)
Fleet:withOrderQueue(fleet)

fleet:addOrder(Order:use(wormHole))
fleet:addOrder(Order:flyTo(<span class="integer">99999</span>, <span class="integer">99999</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is a point right in front of the WormHole, where the ships will break up their formation to fly into the
WormHole. The configuration callback <code>onBreakUp</code> will be called at that moment.</p>
</div>
<div class="paragraph">
<p>Read more on this topic in the <a href="reference.html#order-use">Reference</a> and the <a href="spec.html#order-use">Specification</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_comms">Comms</h3>
<div class="paragraph">
<p>The <code>Comms</code> Component allows to describe communication screens.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withComms(ship)
ship:setHailText(<span class="string"><span class="delimiter">&quot;</span><span class="content">How can we help you?</span><span class="delimiter">&quot;</span></span>)
ship:addComms(Comms:newReply(<span class="string"><span class="delimiter">&quot;</span><span class="content">Who are you?</span><span class="delimiter">&quot;</span></span>, Comms:newScreen(<span class="string"><span class="delimiter">&quot;</span><span class="content">We are a ship of the Human Navy.</span><span class="delimiter">&quot;</span></span>)))</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>setHailText</code> sets the text the ship or station "says" when the player contacts them. With <code>addComms</code> you
can add new Replies that the players can click. <code>Comms:newReply</code> takes three arguments – only the first one
is mandatory. The first argument is the Label (aka "the thing the players say"), the second a <code>Screen</code> that
will be shown when this reply is selected. If you leave the second argument out the main screen will be shown
when this reply is selected. The third argument is a function that gets the <code>Comms</code>, the hailed <code>ship</code> and the <code>player</code>
as arguments and should return <code>true</code> if this reply should be displayed.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">The first two arguments can also be functions</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Station:withComms(station)

station:setHailText(<span class="keyword">function</span>(comms_target, comms_source)
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="delimiter">&quot;</span></span> .. comms_source:getCallSign() .. <span class="string"><span class="delimiter">&quot;</span><span class="content">. This is </span><span class="delimiter">&quot;</span></span> .. comms_target:getCallSign() .. <span class="string"><span class="delimiter">&quot;</span><span class="content">. How can we help?</span><span class="delimiter">&quot;</span></span>
<span class="keyword">end</span>)

station:addComms(Comms:newReply(
    <span class="keyword">function</span>(comms_target, comms_source) <span class="comment">-- what player says</span>
        <span class="keyword">if</span> comms_target:getHull() &lt; comms_target:getHullMax() <span class="keyword">then</span>
            <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Your station took damage. What is your status?</span><span class="delimiter">&quot;</span></span>
        <span class="keyword">else</span>
            <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">What is your status?</span><span class="delimiter">&quot;</span></span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>,
    <span class="keyword">function</span>(comms_target, comms_source) <span class="comment">-- next screen</span>
        <span class="keyword">if</span> comms_target:areEnemiesInRange(<span class="integer">10000</span>) <span class="keyword">then</span>
            <span class="keyword">return</span> Comms:newScreen(<span class="string"><span class="delimiter">&quot;</span><span class="content">We are currently under attack.</span><span class="delimiter">&quot;</span></span>)
        <span class="keyword">else</span>
            <span class="keyword">return</span> Comms:newScreen(<span class="string"><span class="delimiter">&quot;</span><span class="content">There are no attackers near by.</span><span class="delimiter">&quot;</span></span>)
        <span class="keyword">end</span>

    <span class="keyword">end</span>,
    <span class="keyword">function</span>(comms_target, comms_source) <span class="comment">-- condition</span>
        <span class="keyword">return</span> comms_source:isDocked(comms_target)
    <span class="keyword">end</span>
))</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Comms:newScreen</code> function allows you to create nested communications. Here is a complex snippet
to create a "Guess a number" game in comms</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Station:withComms(station)

<span class="keyword">local</span> <span class="local-variable">solution</span> = math.random(<span class="integer">1</span>,<span class="integer">10</span>)

<span class="keyword">local</span> <span class="local-variable">correctGuessScreen</span> = <span class="keyword">function</span>()
    station:removeComms(<span class="string"><span class="delimiter">&quot;</span><span class="content">guess_game</span><span class="delimiter">&quot;</span></span>)
    <span class="keyword">return</span> Comms:newScreen(<span class="string"><span class="delimiter">&quot;</span><span class="content">Yes, that was my number. You have won.</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>

<span class="keyword">local</span> <span class="keyword">function</span> <span class="function">wrongGuessScreen</span>(number)
    <span class="keyword">return</span> <span class="keyword">function</span>()
        <span class="keyword">local</span> <span class="local-variable">screen</span> = Comms:newScreen()
        screen:addText(<span class="string"><span class="delimiter">&quot;</span><span class="content">No, </span><span class="delimiter">&quot;</span></span> .. number .. <span class="string"><span class="delimiter">&quot;</span><span class="content"> is not the number I was thinking of. Guess again.</span><span class="delimiter">&quot;</span></span>)

        <span class="keyword">for</span> i=<span class="integer">1</span>,<span class="integer">10</span> <span class="keyword">do</span>
            <span class="keyword">if</span> i == solution <span class="keyword">then</span>
                screen:addReply(Comms:newReply(string.format(<span class="string"><span class="delimiter">&quot;</span><span class="content">Is it %d?</span><span class="delimiter">&quot;</span></span>, i), correctGuessScreen))
            <span class="keyword">else</span>
                screen:addReply(Comms:newReply(string.format(<span class="string"><span class="delimiter">&quot;</span><span class="content">Is it %d?</span><span class="delimiter">&quot;</span></span>, i), wrongGuessScreen(i)))
            <span class="keyword">end</span>
        <span class="keyword">end</span>

        <span class="keyword">return</span> screen
    <span class="keyword">end</span>
<span class="keyword">end</span>

station:addComms(Comms:newReply(<span class="string"><span class="delimiter">&quot;</span><span class="content">I want to play a game</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>()
    <span class="keyword">local</span> <span class="local-variable">screen</span> = Comms:newScreen(<span class="string"><span class="delimiter">&quot;</span><span class="content">Can you guess my number?</span><span class="delimiter">&quot;</span></span>)

    <span class="keyword">for</span> i=<span class="integer">1</span>,<span class="integer">10</span> <span class="keyword">do</span>
        <span class="keyword">if</span> i == solution <span class="keyword">then</span>
            screen:addReply(Comms:newReply(string.format(<span class="string"><span class="delimiter">&quot;</span><span class="content">Is it %d?</span><span class="delimiter">&quot;</span></span>, i), correctGuessScreen))
        <span class="keyword">else</span>
            screen:addReply(Comms:newReply(string.format(<span class="string"><span class="delimiter">&quot;</span><span class="content">Is it %d?</span><span class="delimiter">&quot;</span></span>, i), wrongGuessScreen(i)))
        <span class="keyword">end</span>
    <span class="keyword">end</span>

    <span class="keyword">return</span> screen
<span class="keyword">end</span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">guess_game</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Read more on <code>Comms:newScreen</code> and <code>Comms:newReply</code> this topic in the <a href="reference.html#comms-newreply">Reference</a> and the <a href="spec.html#comms-newreply">Specification</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_tools_ensurecomms">Tools.ensureComms</h3>
<div class="paragraph">
<p>One issue when initiating comms from a script is that you never know if the players are currently
involved in a different communication. <code>Tools:ensureComms</code> make sure the players at least have
the choice to accept or decline a communication once. It does not ensure that the message is read
(use <code>Tools.storyComms</code> if you need that), but it has to be intentionally ignored.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Station:withComms(station)
station:setHailText(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()

Tools:ensureComms(station, player)

<span class="comment">-- ... or ...</span>

Tools:ensureComms(station, player, <span class="string"><span class="delimiter">&quot;</span><span class="content">We have a special delivery for I. C. Weiner.</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Read more on Tools:ensureComms` in the <a href="reference.html#tools-ensurecomms">Reference</a> and the <a href="spec.html#tools-ensurecomms">Specification</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_tools_storycomms">Tools.storyComms</h3>
<div class="paragraph">
<p>To make sure a conversation is not skipped use <code>Tools:storyComms</code>. The players are not able to
ignore the communication as it will pop up over and over again. The conversation could be rather
complex and span multiple screens. When the crew aborts the conversation they will have to start again
from the beginning. To mark the conversation as "finished", call <code>Tools:endStoryComms</code> in the final screen(s).</p>
</div>
<div class="paragraph">
<p>It is intended for story relevant conversations that should not be skipped.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Station:withComms(station)
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()

<span class="keyword">local</span> <span class="local-variable">comms</span> = Comms:newScreen(<span class="string"><span class="delimiter">&quot;</span><span class="content">Help us, almighty player! We are attacked.</span><span class="delimiter">&quot;</span></span>)
comms:addReply(Comms:newReply(<span class="string"><span class="delimiter">&quot;</span><span class="content">We are on our way</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>()
    Tools:endStoryComms()
    <span class="keyword">return</span> Comms:newScreen(<span class="string"><span class="delimiter">&quot;</span><span class="content">Thanks</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>))

Tools:storyComms(station, player, comms)</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Take into consideration that players <em>can</em> abort the conversation and start over again.
This could potentially lead to exploids if there is a screen in the conversation that gives the players something
valuable. There is no guarantee it is not called multiple times.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Read more on Tools:storyComms` in the <a href="reference.html#tools-storycomms">Reference</a> and the <a href="spec.html#tools-storycomms">Specification</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_menu">Menu</h3>
<div class="paragraph">
<p>The Menu is a powerful component to build menu-like structures using the custom buttons that
can be added through the API. It can be used to create sub-menus and paginate long lists of buttons
making it feasible to have a dynamic number of buttons.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship():setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
Player:withMenu(player)

CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Nostromo</span><span class="delimiter">&quot;</span></span>):setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)
CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Planet Express Ship</span><span class="delimiter">&quot;</span></span>):setPosition(<span class="integer">2000</span>, <span class="integer">0</span>)
CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Discovery</span><span class="delimiter">&quot;</span></span>):setPosition(<span class="integer">3000</span>, <span class="integer">0</span>)

player:addScienceMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">ships</span><span class="delimiter">&quot;</span></span>, Menu:newItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">Ships</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>()
    <span class="keyword">local</span> <span class="local-variable">submenu</span> = Menu:new()
    submenu:addItem(Menu:newItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">Ships</span><span class="delimiter">&quot;</span></span>))
    <span class="keyword">for</span> _, ship <span class="keyword">in</span> <span class="predefined">pairs</span>(player:getObjectsInRange(<span class="integer">30000</span>)) <span class="keyword">do</span>
        <span class="keyword">if</span> ship.typeName == <span class="string"><span class="delimiter">&quot;</span><span class="content">CpuShip</span><span class="delimiter">&quot;</span></span> <span class="keyword">and</span> ship:isValid() <span class="keyword">then</span>
            submenu:addItem(Menu:newItem(ship:getCallSign(), <span class="keyword">function</span>()
                <span class="keyword">return</span> ship:getDescription()
            <span class="keyword">end</span>))
        <span class="keyword">end</span>
    <span class="keyword">end</span>
    <span class="keyword">return</span> submenu
<span class="keyword">end</span>))</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The menus do not live-update. The list of close ships does not automatically update without
player interaction. They need to go back to the main menu and click the "Ships" button again to
see an updated list of ships.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_back_button">Back Button</h4>
<div class="imageblock">
<div class="content">
<img src="assets/menu_back.png" alt="menu back">
</div>
</div>
<div class="paragraph">
<p>The Menu Component will <em>always</em> add a back button (<code>|&lt;&lt;</code>) to submenus that leads to the main menu.
This is to prevent a dead-lock situation where the player is not able to return to the main menu, because
a submenu does not have a back button.</p>
</div>
<div class="paragraph">
<p>You can change the label of the back button for all menus by using the <code>backLabel</code> configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player, <span class="map"><span class="delimiter">{</span>
    <span class="key">backLabel</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span>,
<span class="delimiter">}</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sorting">Sorting</h4>
<div class="paragraph">
<p>By default the menu entries are sorted by the order they are added to the menu. But you can set
a priority on the menu items. Their default priority is <code>0</code>. Setting a lower number will move the item
to the top, a higher number will move it to the bottom.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship():setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
Player:withMenu(player)

player:addHelmsMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">world</span><span class="delimiter">&quot;</span></span>, Menu:newItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">World</span><span class="delimiter">&quot;</span></span>))
player:addHelmsMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>, Menu:newItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span>), <span class="integer">-10</span>)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_pagination">Pagination</h4>
<div class="imageblock">
<div class="content">
<img src="assets/menu_pagination.png" alt="menu pagination">
</div>
</div>
<div class="paragraph">
<p>Long menus are automatically paginated to prevent the buttons from overflowing the screen.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player)
<span class="keyword">for</span> i=<span class="integer">1</span>,<span class="integer">25</span> <span class="keyword">do</span>
    player:addWeaponsMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">option_</span><span class="delimiter">&quot;</span></span> .. i, Menu:newItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">Option </span><span class="delimiter">&quot;</span></span> .. i, i))
<span class="keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Menu Component tries to play nicely with custom buttons that have been added to the stations
without the Menu Component. They will always stay visible, but as they reduce the slots that the
menu component can utilize you should set the <code>itemsPerPage</code> configuration to a lower number. It
determines how many slots the Menu Component is allowed to fill at most per station.</p>
</div>
<div class="paragraph">
<p>You can also change the labels of the "Next" and "Previous" buttons.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player, <span class="map"><span class="delimiter">{</span>
    <span class="key">labelNext</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Next</span><span class="delimiter">&quot;</span></span>,
    <span class="key">labelPrevious</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Previous</span><span class="delimiter">&quot;</span></span>,
    <span class="key">itemsPerPage</span> = <span class="integer">6</span>,
<span class="delimiter">}</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_menus_for_gm">Menus for GM</h4>

</div>
</div>
<div class="sect2">
<h3 id="_quick_dial">Quick Dial</h3>
<div class="paragraph">
<p>Quick Dial shows the relay station a number of targets that they can open a connection to without
having to select the target on the map.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship():setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
Player:withMenu(player, <span class="map"><span class="delimiter">{</span> <span class="key">backLabel</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span> <span class="delimiter">}</span></span>)
Player:withQuickDial(player, <span class="map"><span class="delimiter">{</span> <span class="key">label</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Quick Dial</span><span class="delimiter">&quot;</span></span> <span class="delimiter">}</span></span>)

<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Nostromo</span><span class="delimiter">&quot;</span></span>):setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Outpost 42</span><span class="delimiter">&quot;</span></span>):setPosition(<span class="integer">2000</span>, <span class="integer">0</span>)
<span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>
    CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Discovery</span><span class="delimiter">&quot;</span></span>):setPosition(<span class="integer">3000</span>, <span class="integer">0</span>)
<span class="delimiter">}</span></span>)

player:addQuickDial(ship)
player:addQuickDial(station)
player:addQuickDial(fleet)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Even though invalid targets are automatically not displayed it is also possible to remove targets explicitly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">player:removeQuickDial(ship)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Read more on Quick Dial in the <a href="reference.html#player-withquickdial">Reference</a> and the <a href="spec.html#player-withquickdial">Specification</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_missions">Missions</h3>
<div class="paragraph">
<p>In its basic form a <code>Mission</code> is nothing more than a state machine that keeps track in what state
a mission is (started, failed, successful) and prevents transitions that would not make sense (a
failed mission can not become successful or be started again).</p>
</div>
<div class="paragraph">
<p>These are all possible states and their transitions:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="mission-sequence.png" alt="mission sequence" width="448" height="360">
</div>
</div>
<div class="paragraph">
<p>When creating a mission, you can add callbacks that are called when the mission changes state.
As there are no loops in the state transitions, it is guaranteed that every callback will be
called one time at most:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new(<span class="map"><span class="delimiter">{</span>
    <span class="key">onStart</span> = <span class="keyword">function</span>()
        <span class="predefined">print</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">The mission was started.</span><span class="delimiter">&quot;</span></span>)
    <span class="keyword">end</span>,
    <span class="key">onSuccess</span> = <span class="keyword">function</span>()
        player:addToShipLog(<span class="string"><span class="delimiter">&quot;</span><span class="content">Mission successful</span><span class="delimiter">&quot;</span></span>)
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The callback <code>onEnd</code> is special in the regards that it will be called as soon as the mission is
<code>successful</code> or has <code>failed</code>.</p>
</div>
<div class="paragraph">
<p>Read more on Missions in the <a href="reference.html#mission-new">Reference</a> and the <a href="spec.html#mission-new">Specification</a>.</p>
</div>
<div class="sect3">
<h4 id="_combining_missions">Combining missions</h4>
<div class="paragraph">
<p><code>Mission:chain()</code> combines multiple missions in a daisy chain: The next mission is started as soon
as the previous is successful. In case any sub mission fails the whole chain of missions fail.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">subMission1</span> = Mission:new(<span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>)
<span class="keyword">local</span> <span class="local-variable">subMission2</span> = Mission:new(<span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>)

<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:chain(subMission1, subMission2)

mission:accept()
<span class="comment">-- this starts subMission1</span>
mission:start()

<span class="comment">-- this will start subMission2</span>
subMission1:success()

<span class="comment">-- this will mark the mission as successful</span>
subMission2:success()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Read more on <code>Mission:chain()</code> in the <a href="reference.html#mission-chain">Reference</a> and the <a href="spec.html#mission-chain">Specification</a>.</p>
</div>
<div class="paragraph">
<p><code>Mission:allOf()</code> needs to finish all the sub missions. They are all started at the same time and
can be finished in any order. Should any of them fail, then the whole mission fails.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">subMission1</span> = Mission:new(<span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>)
<span class="keyword">local</span> <span class="local-variable">subMission2</span> = Mission:new(<span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>)

<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:allOf(subMission1, subMission2)

mission:accept()
<span class="comment">-- this starts subMission1 and subMission2</span>
mission:start()

<span class="comment">-- this will not yet finish the mission</span>
subMission1:success()

<span class="comment">-- this will mark the mission as successful</span>
subMission2:success()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Read more on <code>Mission:allOf()</code> in the <a href="reference.html#mission-allof">Reference</a> and the <a href="spec.html#mission-allof">Specification</a>.</p>
</div>
<div class="paragraph">
<p>Apart from that, missions created with <code>Mission:chain()</code> and <code>Mission:allOf()</code> behave the same way
as missions created with <code>Mission:new()</code>: You can add event listeners to it, traverse the states
and apply any of the mission traits.</p>
</div>
</div>
<div class="sect3">
<h4 id="_mission_traits">Mission Traits</h4>
<div class="paragraph">
<p>There are multiple traits that can modify the way a mission works.</p>
</div>
<div class="sect4">
<h5 id="_missionforplayer">Mission:forPlayer</h5>
<div class="paragraph">
<p>A mission could be bound to a player. This can be done with <code>Mission:forPlayer</code>. Such a mission
will automatically be added to the Mission Tracker of the player (if the player ship has it) and the mission
will automatically fail if the player is destroyed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new()
Mission:forPlayer(mission, player)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Read more in the <a href="reference.html#mission-forplayer">Reference</a> and the <a href="spec.html#mission-forplayer">Specification</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_missionwithbroker">Mission:withBroker</h5>
<div class="paragraph">
<p>When missions are given by someone <code>Mission:withBroker</code> comes into play. It also allows to give
the mission a humanly readable title, a description and set hints.</p>
</div>
<div class="paragraph">
<p>The mission will automatically fail if the broker is destroyed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new()
Mission:withBroker(mission, <span class="string"><span class="delimiter">&quot;</span><span class="content">Title of the mission</span><span class="delimiter">&quot;</span></span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">description</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Help </span><span class="delimiter">&quot;</span></span> .. station:getCallSign() .. <span class="string"><span class="delimiter">&quot;</span><span class="content"> solve their problems</span><span class="delimiter">&quot;</span></span>,
    <span class="key">missionBroker</span> = station
<span class="delimiter">}</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Read more in the <a href="reference.html#mission-withbroker">Reference</a> and the <a href="spec.html#mission-withbroker">Specification</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_missionwithtimelimit">Mission:withTimeLimit</h5>
<div class="paragraph">
<p>Missions can have a time limit. If it is exceeded the mission fails automatically. The timer
will start as soon as the mission is started.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new()
Mission:withTimeLimit(mission, <span class="integer">600</span>) <span class="comment">-- in seconds</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Read more in the <a href="reference.html#mission-withtimelimit">Reference</a> and the <a href="spec.html#mission-withtimelimit">Specification</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mission_tracker_display">Mission Tracker &amp; Display</h4>

</div>
<div class="sect3">
<h4 id="_predefined_missions">Predefined missions</h4>

</div>
</div>
<div class="sect2">
<h3 id="_upgrade">Upgrade</h3>
<div class="sect3">
<h4 id="_upgrade_broker_comms">Upgrade Broker &amp; Comms</h4>

</div>
<div class="sect3">
<h4 id="_upgrade_tracker_display">Upgrade Tracker &amp; Display</h4>

</div>
</div>
<div class="sect2">
<h3 id="playerspaceship-storage">PlayerSpaceship Storage</h3>
<div class="sect3">
<h4 id="_storage_tracker">Storage Tracker</h4>

</div>
</div>
<div class="sect2">
<h3 id="_crew">Crew</h3>

</div>
<div class="sect2">
<h3 id="_ship_events">Ship Events</h3>

</div>
<div class="sect2">
<h3 id="fleet">Fleet</h3>
<div class="paragraph">
<p>A Fleet allows to group ships together and let them fly in formation.</p>
</div>
<div class="paragraph">
<p>Via scripts you can issue orders to fleets. If the fleet leader is destroyed the next ship will
pick up the lead and continue executing the given order.</p>
</div>
<div class="paragraph">
<p>This works the same way when the GM gives orders to the leader ship. If the leader is destroyed
the next ship will take over the order.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
As GM you can issue different orders to the wingmen. They will execute these
until you give them the <code>orderIdle</code> and they will fly back in formation.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>ship1, ship2, ship3<span class="delimiter">}</span></span>)

fleet:orderFlyTowards(<span class="integer">1000</span>, <span class="integer">0</span>)
ship2:orderAttack(enemy) <span class="comment">-- wingman will attack the enemy</span>
ship2:orderIdle() <span class="comment">-- wingman will fly back into formation</span>

<span class="keyword">if</span> fleet:isValid() <span class="keyword">then</span>
    fleet:getLeader():destroy()
    <span class="comment">-- ship2 will take over the lead and will fly to the next waypoint</span>
<span class="keyword">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tags">Tags</h3>
<div class="paragraph">
<p>Tags are a generic concept to apply to any object. You can add and remove tags without the need of
adding multiple attributes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withTags(ship, <span class="string"><span class="delimiter">&quot;</span><span class="content">fighter</span><span class="delimiter">&quot;</span></span>)
ship:addTag(<span class="string"><span class="delimiter">&quot;</span><span class="content">blue</span><span class="delimiter">&quot;</span></span>)
ship:removeTag(<span class="string"><span class="delimiter">&quot;</span><span class="content">fighter</span><span class="delimiter">&quot;</span></span>)

<span class="keyword">local</span> <span class="local-variable">person</span> = Person:byName(<span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>)
Generic:withTags(person)
person:addTag(<span class="string"><span class="delimiter">&quot;</span><span class="content">male</span><span class="delimiter">&quot;</span></span>)

<span class="keyword">if</span> person:hasTag(<span class="string"><span class="delimiter">&quot;</span><span class="content">male</span><span class="delimiter">&quot;</span></span>) <span class="keyword">then</span>
    <span class="predefined">print</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Mr. </span><span class="delimiter">&quot;</span></span> .. person:getFormalName())
<span class="keyword">else</span>
    <span class="predefined">print</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Mrs. </span><span class="delimiter">&quot;</span></span> .. person:getFormalName())
<span class="keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It works with any object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">object</span> = <span class="map"><span class="delimiter">{</span>
    <span class="key">title</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Foobar</span><span class="delimiter">&quot;</span></span>,
    <span class="key">message</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>,
<span class="delimiter">}</span></span>
Generic:withTags(object)
object:addTag(<span class="string"><span class="delimiter">&quot;</span><span class="content">english</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_products">Products</h3>
<div class="paragraph">
<p>A product is a representation of something that can be bought, sold, produced or loaded and is used in multiple
places in Lively Epsilon.</p>
</div>
<div class="paragraph">
<p>It is fairly easy to create a new product.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ore</span> = Product:new(<span class="string"><span class="delimiter">&quot;</span><span class="content">Iron Ore</span><span class="delimiter">&quot;</span></span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">id</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">ore</span><span class="delimiter">&quot;</span></span>,
    <span class="key">size</span> = <span class="integer">4</span>,
<span class="delimiter">}</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The size is of a product is only used for tracking the storage space need in a <code>PlayerSpaceship</code>. Bigger items
should have a bigger size.</p>
</div>
<div class="paragraph">
<p>Everything apart of the name is optional to make it easy to create unique products.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mcguffin</span> = Product:new(<span class="string"><span class="delimiter">&quot;</span><span class="content">Mission Item</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Read more on Products in the <a href="reference.html#product">Reference</a> and the <a href="spec.html#product-new">Specification</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_storage">Storage</h3>
<div class="paragraph">
<p>There are two concepts for defining storage inside Lively Epsilon. This describes the one that is used for
non-player ships. You can imaging the concept as "storage rooms": For every product there is a storage room
for this product only. If the station can not store any more of product <code>A</code>, it can still store product <code>B</code>,
because there is a different storage room for it.</p>
</div>
<div class="paragraph">
<p>This concept is also used for non-player spaceships.</p>
</div>
<div class="paragraph">
<p>Using the <code>withStorageRooms</code> function lets you define the maximum storage capacity.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">products</span> = <span class="map"><span class="delimiter">{</span>
    <span class="key">power</span> = Product:new(<span class="string"><span class="delimiter">&quot;</span><span class="content">Energy Cell</span><span class="delimiter">&quot;</span></span>),
    <span class="key">o2</span> = Product:new(<span class="string"><span class="delimiter">&quot;</span><span class="content">Oxygen</span><span class="delimiter">&quot;</span></span>),
    <span class="key">ore</span> = Product:new(<span class="string"><span class="delimiter">&quot;</span><span class="content">Iron Ore</span><span class="delimiter">&quot;</span></span>),
<span class="delimiter">}</span></span>

<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Station:withStorageRooms(station, <span class="map"><span class="delimiter">{</span>
    [products.power] = <span class="integer">1000</span>,
    [products.o2] = <span class="integer">500</span>,
<span class="delimiter">}</span></span>)

<span class="keyword">local</span> <span class="keyword">function</span> <span class="function">printStorage</span>(station, product)
    <span class="keyword">if</span> station:canStoreProduct(product) <span class="keyword">then</span>
        <span class="predefined">print</span>(string.format(
            <span class="string"><span class="delimiter">&quot;</span><span class="content">Station stores %d/%d units of %s. There is space for %d more.</span><span class="delimiter">&quot;</span></span>,
            station:getProductStorage(product),
            station:getMaxProductStorage(product),
            product:getName(),
            station:getEmptyProductStorage(product)
        ))
    <span class="keyword">else</span>
        <span class="predefined">print</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Station can not store </span><span class="delimiter">&quot;</span></span> .. product:getName() .. <span class="string"><span class="delimiter">&quot;</span><span class="content">.</span><span class="delimiter">&quot;</span></span>)
    <span class="keyword">end</span>
<span class="keyword">end</span>

printStorage(station, products.power)
printStorage(station, products.ore)

station:modifyProductStorage(products.power, <span class="integer">700</span>)
printStorage(station, products.power)

<span class="comment">-- will print:</span>
<span class="comment">-- Station stores 0/1000 units of Energy Cell. There is space for 1000 more.</span>
<span class="comment">-- Station can not store Iron Ore.</span>
<span class="comment">-- Station stores 700/1000 units of Energy Cell. There is space for 300 more.</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Modifying a product storage beyond its minimum or maximum capacity does not cause any kind of error.
It will just create products out of thin vacuum or make products disappear in an invisible pocket-sized black hole.
This is to ease scripting for you and not having to take care of multiple error conditions.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Read more on Storage in the <a href="reference.html#shiptemplatebased-withstoragerooms">Reference</a> and the <a href="spec.html#shiptemplatebased-withstoragerooms">Specification</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_production">Production</h3>
<div class="paragraph">
<p>Stations with a storage can transform products into other products or even create products from nothing
(like solar energy) or convert products into nothing (like used up energy).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">products</span> = <span class="map"><span class="delimiter">{</span>
    <span class="key">power</span> = Product:new(<span class="string"><span class="delimiter">&quot;</span><span class="content">Energy Cell</span><span class="delimiter">&quot;</span></span>),
    <span class="key">o2</span> = Product:new(<span class="string"><span class="delimiter">&quot;</span><span class="content">Oxygen</span><span class="delimiter">&quot;</span></span>),
<span class="delimiter">}</span></span>

<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Station:withStorageRooms(station, <span class="map"><span class="delimiter">{</span>
    [products.power] = <span class="integer">1000</span>,
    [products.o2] = <span class="integer">500</span>,
<span class="delimiter">}</span></span>)
<span class="comment">-- give the station something to start with</span>
station:modifyProductStorage(products.power, <span class="integer">1000</span>)

Station:withProduction(station, <span class="map"><span class="delimiter">{</span>
    <span class="map"><span class="inline-delimiter">{</span>
        <span class="key">productionTime</span> = <span class="integer">30</span>,
        <span class="key">consumes</span> = <span class="map"><span class="inline-delimiter">{</span>
            <span class="map"><span class="inline-delimiter">{</span> <span class="key">product</span> = products.power, <span class="key">amount</span> = <span class="integer">10</span> <span class="inline-delimiter">}</span></span>
        <span class="inline-delimiter">}</span></span>,
        <span class="key">produces</span> = <span class="map"><span class="inline-delimiter">{</span>
            <span class="map"><span class="inline-delimiter">{</span> <span class="key">product</span> = products.o2, <span class="key">amount</span> = <span class="integer">10</span> <span class="inline-delimiter">}</span></span>,
        <span class="inline-delimiter">}</span></span>
    <span class="inline-delimiter">}</span></span>,
<span class="delimiter">}</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The station will continue producing unless there are not enough resources or the storage of the product is full.</p>
</div>
<div class="paragraph">
<p>Combining this with the Merchant can help you create a simple economy that the players can help running.</p>
</div>
<div class="paragraph">
<p>Read more on Production in the <a href="reference.html#station-withproduction">Reference</a> and the <a href="spec.html#station-withproduction">Specification</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_merchant_comms">Merchant &amp; Comms</h3>
<div class="paragraph">
<p>Having a storage is of course in itself not useful, but stations can have a merchant
that buys or sells goods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">products</span> = <span class="map"><span class="delimiter">{</span>
    <span class="key">power</span> = Product:new(<span class="string"><span class="delimiter">&quot;</span><span class="content">Energy Cell</span><span class="delimiter">&quot;</span></span>),
    <span class="key">o2</span> = Product:new(<span class="string"><span class="delimiter">&quot;</span><span class="content">Oxygen</span><span class="delimiter">&quot;</span></span>),
<span class="delimiter">}</span></span>

<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Station:withStorageRooms(station, <span class="map"><span class="delimiter">{</span>
    [products.power] = <span class="integer">1000</span>,
    [products.o2] = <span class="integer">500</span>,
<span class="delimiter">}</span></span>)

Station:withMerchant(station, <span class="map"><span class="delimiter">{</span>
    [products.power] = <span class="map"><span class="inline-delimiter">{</span> <span class="key">buyingPrice</span> = <span class="integer">1</span>, <span class="key">buyingLimit</span> = <span class="integer">420</span> <span class="inline-delimiter">}</span></span>,
    [products.o2] = <span class="map"><span class="inline-delimiter">{</span> <span class="key">sellingPrice</span> = <span class="integer">5</span>, <span class="key">sellingLimit</span> = <span class="integer">42</span> <span class="inline-delimiter">}</span></span>,
<span class="delimiter">}</span></span>)

station:modifyProductStorage(products.power, <span class="integer">100</span>)
station:modifyProductStorage(products.o2, <span class="integer">100</span>)

<span class="keyword">local</span> <span class="keyword">function</span> <span class="function">printMerchant</span>(station, product)
    <span class="keyword">if</span> station:isBuyingProduct(product) <span class="keyword">then</span>
        <span class="predefined">print</span>(string.format(
            <span class="string"><span class="delimiter">&quot;</span><span class="content">Station buys a maximum of %d units of %s at a price of %d.</span><span class="delimiter">&quot;</span></span>,
            station:getMaxProductBuying(product),
            product:getName(),
            station:getProductBuyingPrice(product)
        ))
    <span class="keyword">elseif</span> station:isSellingProduct(product) <span class="keyword">then</span>
        <span class="predefined">print</span>(string.format(
            <span class="string"><span class="delimiter">&quot;</span><span class="content">Station sells a maximum of %d units of %s at a price of %d.</span><span class="delimiter">&quot;</span></span>,
            station:getMaxProductSelling(product),
            product:getName(),
            station:getProductSellingPrice(product)
        ))
    <span class="keyword">end</span>
<span class="keyword">end</span>

printMerchant(station, products.power)
printMerchant(station, products.o2)

<span class="comment">-- will print:</span>
<span class="comment">-- Station buys a maximum of 320 units of Energy Cell at a price of 1.</span>
<span class="comment">-- Station sells a maximum of 58 units of Oxygen at a price of 5.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Configuring <code>buyingLimit</code> and <code>sellingLimit</code> is optional. If left blank the station
will sell and buy all of its stock. In any other case it will only sell if it got
more than <code>sellingLimit</code> units in store and buy if it got less than <code>buyingLimit</code> units
in store.</p>
</div>
<div class="paragraph">
<p>Configuring the merchant will allow any non-enemy ship (including the player) to
buy or sell from the station.</p>
</div>
<div class="paragraph">
<p>Read more on Merchants in the <a href="reference.html#station-withmerchant">Reference</a> and the <a href="spec.html#station-withmerchant">Specification</a>.</p>
</div>
<div class="sect3">
<h4 id="_merchant_comms_2">Merchant Comms</h4>

</div>
</div>
<div class="sect2">
<h3 id="_traders">Traders</h3>
<div class="paragraph">
<p>A trader is assigned to one station and buys one resource on behalf of the station from a different station.
So what you need is a station that sells some product, a station that buys that product and a trader assigned to
the second one.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">products</span> = <span class="map"><span class="delimiter">{</span>
    <span class="key">power</span> = Product:new(<span class="string"><span class="delimiter">&quot;</span><span class="content">Energy Cell</span><span class="delimiter">&quot;</span></span>),
<span class="delimiter">}</span></span>

<span class="keyword">local</span> <span class="local-variable">sellingStation</span> = SpaceStation():setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
Station:withStorageRooms(sellingStation, <span class="map"><span class="delimiter">{</span>
    [products.power] = <span class="integer">1000</span>
<span class="delimiter">}</span></span>)
Station:withMerchant(sellingStation, <span class="map"><span class="delimiter">{</span>
    [products.power] = <span class="map"><span class="inline-delimiter">{</span> <span class="key">sellingPrice</span> = <span class="integer">1</span> <span class="inline-delimiter">}</span></span>,
<span class="delimiter">}</span></span>)

<span class="keyword">local</span> <span class="local-variable">buyingStation</span> = SpaceStation():setPosition(<span class="integer">10000</span>, <span class="integer">0</span>)
Station:withStorageRooms(buyingStation, <span class="map"><span class="delimiter">{</span>
    [products.power] = <span class="integer">1000</span>
<span class="delimiter">}</span></span>)
Station:withMerchant(buyingStation, <span class="map"><span class="delimiter">{</span>
    [products.power] = <span class="map"><span class="inline-delimiter">{</span> <span class="key">buyingPrice</span> = <span class="integer">1</span> <span class="inline-delimiter">}</span></span>,
<span class="delimiter">}</span></span>)

<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setPosition(<span class="integer">11000</span>, <span class="integer">0</span>)
Ship:withStorageRooms(ship, <span class="map"><span class="delimiter">{</span>
    [products.power] = <span class="integer">1000</span>,
<span class="delimiter">}</span></span>)
Ship:behaveAsBuyer(ship, buyingStation, products.power)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This trader will try to find a station close to its home base <code>buyer</code> that sells power, buy it and bring
it back to its home station.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Unlike economist nowadays, traders in Lively Epsilon are not trying to maximize their profits. They
will just buy anything regardless of its price.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Read more on Traders in the <a href="reference.html#ship-behaveasbuyer">Reference</a> and the <a href="spec.html#ship-behaveasbuyer">Specification</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_miner">Miner</h3>
<div class="paragraph">
<p>A miner is a ship that will seek out Asteroids close to its home base, mine them and
unload the products at its home base.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">products</span> = <span class="map"><span class="delimiter">{</span>
    <span class="key">ore</span> = Product:new(<span class="string"><span class="delimiter">&quot;</span><span class="content">Iron Ore</span><span class="delimiter">&quot;</span></span>),
<span class="delimiter">}</span></span>

<span class="keyword">local</span> <span class="local-variable">factory</span> = SpaceStation():setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
Station:withStorageRooms(factory, <span class="map"><span class="delimiter">{</span>
    [products.ore] = <span class="integer">1000</span>
<span class="delimiter">}</span></span>)

<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)
Ship:withStorageRooms(ship, <span class="map"><span class="delimiter">{</span>
    [products.ore] = <span class="integer">1000</span>,
<span class="delimiter">}</span></span>)
Ship:behaveAsMiner(ship, factory, <span class="keyword">function</span>(asteroid, ship, station)
    <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>
        [products.ore] = math.random(<span class="integer">10</span>, <span class="integer">50</span>)
    <span class="delimiter">}</span></span>
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the callback you can determine which resources the miner finds when it has mined an asteroid. Products
the ship or its home base can not store will be silently discarded.</p>
</div>
<div class="paragraph">
<p>Read more on Miners in the <a href="reference.html#ship-behaveasminer">Reference</a> and the <a href="spec.html#ship-behaveasminer">Specification</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_chatter">Chatter</h3>
<div class="paragraph">
<p>Chatter is a component to wrap ambient noise and limit its range. You would typically not use it to relay
important information to the players but make the surrounding appear more alive. They will pop up in the log
of the <code>Relay</code> station. By default the range that Chatter is received is <code>1.5</code> times the radar range, but you
can change it with the <code>maxRange</code> option.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">chatter</span> = Chatter:new(<span class="map"><span class="delimiter">{</span>
    <span class="key">maxRange</span> = <span class="integer">50000</span>,
<span class="delimiter">}</span></span>)

<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
chatter:say(ship, <span class="string"><span class="delimiter">&quot;</span><span class="content">Carpe Diem</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You typically do not need more than one <code>Chatter</code> object in your scenario. Except when you want to relay different
conversations at different distances.</p>
</div>
<div class="paragraph">
<p>The Chatter component is also able to send conversations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">chatter</span> = Chatter:new()

<span class="keyword">local</span> <span class="local-variable">ship1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship2</span> = CpuShip()
chatter:converse(<span class="map"><span class="delimiter">{</span>
    <span class="map"><span class="inline-delimiter">{</span>ship1, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hey. What are you doing?</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>,
    <span class="map"><span class="inline-delimiter">{</span>ship2, <span class="string"><span class="delimiter">&quot;</span><span class="content">Staring at the emptiness of space.</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>,
    <span class="map"><span class="inline-delimiter">{</span>ship1, <span class="string"><span class="delimiter">&quot;</span><span class="content">Wow. This sounds pretty boring.</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>,
<span class="delimiter">}</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Every line of the conversation will be send with a slight delay depending on how long the actual line was.
It should roughly match the reading speed of an average person. If one of the partners is destroyed, the
conversation will be aborted. And if one the partners is out of range the players will just read part of the
conversation.</p>
</div>
<div class="paragraph">
<p>Read more on Chatter in the <a href="reference.html#chatter-new">Reference</a> and the <a href="spec.html#chatter-new">Specification</a>.</p>
</div>
<div class="sect3">
<h4 id="_chat_noise_chat_factory">Chat Noise &amp; Chat Factory</h4>
<div class="paragraph">
<p>Chat Noise is a concept to allow random chats around the universe that is not triggered by certain actions
but randomly occurring to keep the players engaged. You can use it to entertain the crew or hide secret
messages in it.</p>
</div>
<div class="paragraph">
<p>You can add multiple <code>ChatFactories</code> to <code>ChatNoise</code> that describe chats that the player could randomly
receive at certain intervals. Chats could only be run if there are a certain amount of <code>Stations</code> and <code>Ships</code>
close to the player.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start with a simple example by adding only one <code>ChatFactory</code> to our <code>ChatNoise</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">chatter</span> = Chatter:new()
<span class="keyword">local</span> <span class="local-variable">noise</span> = Chatter:newNoise(chatter)

noise:addChatFactory(Chatter:newFactory(<span class="integer">1</span>, <span class="keyword">function</span>(stationOrShip) <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="map"><span class="inline-delimiter">{</span> stationOrShip, <span class="string"><span class="delimiter">&quot;</span><span class="content">I'm so bored. Nothing is happening...</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>,
    <span class="delimiter">}</span></span>
<span class="keyword">end</span>))</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The first parameter (<code>1</code>) denotes that the function expects one valid station or ship.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The return value is a valid object to be used as argument for the <code>converse</code> function.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>ChatterNoise</code> selects a random <code>CpuShip</code> or <code>SpaceStation</code> in the vicinity of the player and gives
it as argument to the function.</p>
</div>
<div class="paragraph">
<p>It is also possible to have multiple participants in a conversation. This will select two distinct <code>CpuShip</code>s
or <code>SpaceStation</code>s and give it as arguments to the function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">noise:addChatFactory(Chatter:newFactory(<span class="integer">2</span>, <span class="keyword">function</span>(stationOrShip1, stationOrShip2)
    <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>
        <span class="map"><span class="inline-delimiter">{</span> stationOrShip1, <span class="string"><span class="delimiter">&quot;</span><span class="content">I'm so bored. Nothing is happening...</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>,
        <span class="map"><span class="inline-delimiter">{</span> stationOrShip2, <span class="string"><span class="delimiter">&quot;</span><span class="content">Wanna play some </span><span class="char">\&quot;</span><span class="content">I spy with my little eye</span><span class="char">\&quot;</span><span class="content">?</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>,
        <span class="map"><span class="inline-delimiter">{</span> stationOrShip1, <span class="string"><span class="delimiter">&quot;</span><span class="content">Nah. I know you would pick black as space.</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>,
    <span class="delimiter">}</span></span>
<span class="keyword">end</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>To have more control over what is selected as arguments you can use the <code>filter</code> option and have a function
that returns <code>true</code> if the given argument is a valid candidate for the <code>ChatFactory</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">noise:addChatFactory(Chatter:newFactory(<span class="integer">2</span>, <span class="keyword">function</span>(station, ship)
    <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>
        <span class="map"><span class="inline-delimiter">{</span> station, <span class="string"><span class="delimiter">&quot;</span><span class="content">Want to buy some engine oil from our station?</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>,
        <span class="map"><span class="inline-delimiter">{</span> ship, <span class="string"><span class="delimiter">&quot;</span><span class="content">No thanks, I'm fine.</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>,
    <span class="delimiter">}</span></span>
<span class="keyword">end</span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">filters</span> = <span class="map"><span class="inline-delimiter">{</span>
        <span class="keyword">function</span>(thing) <span class="keyword">return</span> isEeStation(thing) <span class="keyword">end</span>,
        <span class="keyword">function</span>(thing, station) <span class="keyword">return</span> isEeShip(thing) <span class="keyword">and</span> thing:isFriendly(station) <span class="keyword">end</span>, <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="inline-delimiter">}</span></span>,
<span class="delimiter">}</span></span>))</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>filter functions get all other selected arguments as additional arguments in inverse order.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This chat would only run if there are a <code>CpuShip</code> and a friendly <code>SpaceStation</code> close to the player.</p>
</div>
<div class="paragraph">
<p>Read more on ChatterNoise and ChatterFactory in the <a href="reference.html#chatter-newnoise">Reference</a> and the <a href="spec.html#chatter-newnoise">Specification</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_development">Development</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_logging">Logging</h3>

</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. This means they should only operate on the parameters given and not manipulate them.
</div>
</div>
<div id="footer">
<div id="footer-text">
Version dev<br>
Last updated 2021-06-12 13:28:56 UTC
</div>
</div>
</body>
</html>