<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.7">
<title>Lively Epsilon Specification</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote::before{display:none}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{word-spacing:0;line-height:1.6}
.quoteblock.abstract blockquote::before,.quoteblock.abstract p::before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Lively Epsilon Specification</h1>
<div class="details">
<span id="revnumber">version dev,</span>
<span id="revdate">2020-10-24
</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#brokerupgrade">BrokerUpgrade</a>
<ul class="sectlevel2">
<li><a href="#brokerupgrade-new">BrokerUpgrade:new()</a></li>
<li><a href="#brokerupgrade-new-canbeinstalled">BrokerUpgrade:new():canBeInstalled()</a></li>
<li><a href="#brokerupgrade-new-install">BrokerUpgrade:new():install()</a></li>
</ul>
</li>
<li><a href="#chatter">Chatter</a>
<ul class="sectlevel2">
<li><a href="#chatter-new">Chatter:new()</a></li>
<li><a href="#chatter-new-converse">Chatter:new():converse()</a></li>
<li><a href="#chatter-new-say">Chatter:new():say()</a></li>
<li><a href="#chatter-newfactory">Chatter:newFactory()</a></li>
<li><a href="#chatter-newfactory-arevalidarguments">Chatter:newFactory():areValidArguments()</a></li>
<li><a href="#chatter-newfactory-createchat">Chatter:newFactory():createChat()</a></li>
<li><a href="#chatter-newnoise">Chatter:newNoise()</a></li>
<li><a href="#chatter-newnoise-addchatfactory">Chatter:newNoise():addChatFactory()</a></li>
<li><a href="#chatter-newnoise-getchatfactories">Chatter:newNoise():getChatFactories()</a></li>
<li><a href="#chatter-newnoise-removechatfactory">Chatter:newNoise():removeChatFactory()</a></li>
</ul>
</li>
<li><a href="#comms">Comms</a>
<ul class="sectlevel2">
<li><a href="#comms-merchantfactory">Comms:merchantFactory()</a></li>
<li><a href="#comms-missionbrokerfactory">Comms:missionBrokerFactory()</a></li>
<li><a href="#comms-newreply">Comms:newReply()</a></li>
<li><a href="#comms-newscreen">Comms:newScreen()</a></li>
</ul>
</li>
<li><a href="#cron">Cron</a>
<ul class="sectlevel2">
<li><a href="#cron-adddelay">Cron:addDelay()</a></li>
<li><a href="#cron-getdelay">Cron:getDelay()</a></li>
<li><a href="#cron-now">Cron:now()</a></li>
<li><a href="#cron-once">Cron:once()</a></li>
<li><a href="#cron-regular">Cron:regular()</a></li>
<li><a href="#cron-setdelay">Cron:setDelay()</a></li>
</ul>
</li>
<li><a href="#eventhandler">EventHandler</a>
<ul class="sectlevel2">
<li><a href="#eventhandler-new">EventHandler:new()</a></li>
<li><a href="#eventhandler-new-fire">EventHandler:new():fire()</a></li>
<li><a href="#eventhandler-new-register">EventHandler:new():register()</a></li>
</ul>
</li>
<li><a href="#fleet">Fleet</a>
<ul class="sectlevel2">
<li><a href="#fleet-new">Fleet:new()</a></li>
<li><a href="#fleet-new-countships">Fleet:new():countShips()</a></li>
<li><a href="#fleet-new-getid">Fleet:new():getId()</a></li>
<li><a href="#fleet-new-getleader">Fleet:new():getLeader()</a></li>
<li><a href="#fleet-new-getships">Fleet:new():getShips()</a></li>
<li><a href="#fleet-new-isvalid">Fleet:new():isValid()</a></li>
<li><a href="#fleet-withorderqueue">Fleet:withOrderQueue()</a></li>
<li><a href="#fleet-withorderqueue-abortcurrentorder">Fleet:withOrderQueue():abortCurrentOrder()</a></li>
<li><a href="#fleet-withorderqueue-flushorders">Fleet:withOrderQueue():flushOrders()</a></li>
<li><a href="#fleet-withorderqueue-forceordernow">Fleet:withOrderQueue():forceOrderNow()</a></li>
</ul>
</li>
<li><a href="#generic">Generic</a>
<ul class="sectlevel2">
<li><a href="#generic-withtags">Generic:withTags()</a></li>
<li><a href="#generic-withtags-addtag">Generic:withTags():addTag()</a></li>
<li><a href="#generic-withtags-addtags">Generic:withTags():addTags()</a></li>
<li><a href="#generic-withtags-gettags">Generic:withTags():getTags()</a></li>
<li><a href="#generic-withtags-hastag">Generic:withTags():hasTag()</a></li>
<li><a href="#generic-withtags-removetag">Generic:withTags():removeTag()</a></li>
<li><a href="#generic-withtags-removetags">Generic:withTags():removeTags()</a></li>
</ul>
</li>
<li><a href="#menu">Menu</a>
<ul class="sectlevel2">
<li><a href="#menu-newitem">Menu:newItem()</a></li>
</ul>
</li>
<li><a href="#mission">Mission</a>
<ul class="sectlevel2">
<li><a href="#mission-allof">Mission:allOf()</a></li>
<li><a href="#mission-allof-allof">Mission:allOf():allOf()</a></li>
<li><a href="#mission-chain">Mission:chain()</a></li>
<li><a href="#mission-chain-chain">Mission:chain():chain()</a></li>
<li><a href="#mission-chain-getcurrentmission">Mission:chain():getCurrentMission()</a></li>
<li><a href="#mission-forplayer">Mission:forPlayer()</a></li>
<li><a href="#mission-forplayer-accept">Mission:forPlayer():accept()</a></li>
<li><a href="#mission-forplayer-getplayer">Mission:forPlayer():getPlayer()</a></li>
<li><a href="#mission-forplayer-setplayer">Mission:forPlayer():setPlayer()</a></li>
<li><a href="#mission-new">Mission:new()</a></li>
<li><a href="#mission-new-accept">Mission:new():accept()</a></li>
<li><a href="#mission-new-canbeaccepted">Mission:new():canBeAccepted()</a></li>
<li><a href="#mission-new-decline">Mission:new():decline()</a></li>
<li><a href="#mission-new-fail">Mission:new():fail()</a></li>
<li><a href="#mission-new-getid">Mission:new():getId()</a></li>
<li><a href="#mission-new-getstate">Mission:new():getState()</a></li>
<li><a href="#mission-new-start">Mission:new():start()</a></li>
<li><a href="#mission-new-success">Mission:new():success()</a></li>
<li><a href="#mission-registermissionacceptlistener">Mission:registerMissionAcceptListener()</a></li>
<li><a href="#mission-registermissioncreationlistener">Mission:registerMissionCreationListener()</a></li>
<li><a href="#mission-registermissiondeclinelistener">Mission:registerMissionDeclineListener()</a></li>
<li><a href="#mission-registermissionendlistener">Mission:registerMissionEndListener()</a></li>
<li><a href="#mission-registermissionfailurelistener">Mission:registerMissionFailureListener()</a></li>
<li><a href="#mission-registermissionstartlistener">Mission:registerMissionStartListener()</a></li>
<li><a href="#mission-registermissionsuccesslistener">Mission:registerMissionSuccessListener()</a></li>
<li><a href="#mission-withbroker">Mission:withBroker()</a></li>
<li><a href="#mission-withbroker-accept">Mission:withBroker():accept()</a></li>
<li><a href="#mission-withbroker-getacceptmessage">Mission:withBroker():getAcceptMessage()</a></li>
<li><a href="#mission-withbroker-getdescription">Mission:withBroker():getDescription()</a></li>
<li><a href="#mission-withbroker-gethint-sethint">Mission:withBroker():getHint(),:setHint()</a></li>
<li><a href="#mission-withbroker-getmissionbroker">Mission:withBroker():getMissionBroker()</a></li>
<li><a href="#mission-withbroker-gettitle">Mission:withBroker():getTitle()</a></li>
<li><a href="#mission-withtimelimit">Mission:withTimeLimit()</a></li>
<li><a href="#mission-withtimelimit-getremainingtime">Mission:withTimeLimit():getRemainingTime()</a></li>
<li><a href="#mission-withtimelimit-modifytimelimit">Mission:withTimeLimit():modifyTimeLimit()</a></li>
<li><a href="#mission-withtimelimit-settimelimit">Mission:withTimeLimit():setTimeLimit()</a></li>
</ul>
</li>
<li><a href="#missions">Missions</a>
<ul class="sectlevel2">
<li><a href="#missions-answer">Missions:answer()</a></li>
<li><a href="#missions-capture">Missions:capture()</a></li>
<li><a href="#missions-crewforrent">Missions:crewForRent()</a></li>
<li><a href="#missions-destroy">Missions:destroy()</a></li>
<li><a href="#missions-destroy-getvalidenemies">Missions:destroy():getValidEnemies(),</a></li>
<li><a href="#missions-destroyragingminer">Missions:destroyRagingMiner()</a></li>
<li><a href="#missions-destroyragingminer-getvalidenemies">Missions:destroyRagingMiner():getValidEnemies(),</a></li>
<li><a href="#missions-disable">Missions:disable()</a></li>
<li><a href="#missions-disable-gettarget">Missions:disable():getTarget()</a></li>
<li><a href="#missions-pickup">Missions:pickUp()</a></li>
<li><a href="#missions-scan">Missions:scan()</a></li>
<li><a href="#missions-scan-gettargets">Missions:scan():getTargets(),</a></li>
<li><a href="#missions-transportproduct">Missions:transportProduct()</a></li>
<li><a href="#missions-transporttoken">Missions:transportToken()</a></li>
<li><a href="#missions-visit">Missions:visit()</a></li>
<li><a href="#missions-waypoints">Missions:wayPoints()</a></li>
<li><a href="#missions-waypoints-addwaypoint">Missions:wayPoints():addWayPoint()</a></li>
</ul>
</li>
<li><a href="#order">Order</a>
<ul class="sectlevel2">
<li><a href="#order-attack">Order:attack()</a></li>
<li><a href="#order-defend">Order:defend()</a></li>
<li><a href="#order-dock">Order:dock()</a></li>
<li><a href="#order-flyto">Order:flyTo()</a></li>
<li><a href="#order-use">Order:use()</a></li>
</ul>
</li>
<li><a href="#person">Person</a>
<ul class="sectlevel2">
<li><a href="#person-byname">Person:byName()</a></li>
</ul>
</li>
<li><a href="#player">Player</a>
<ul class="sectlevel2">
<li><a href="#player-withmenu">Player:withMenu()</a></li>
<li><a href="#player-withmenu-addhelmsmenuitem">Player:withMenu():addHelmsMenuItem(),</a></li>
<li><a href="#player-withmenu-addmenuitem">Player:withMenu():addMenuItem()</a></li>
<li><a href="#player-withmenu-addmenuitem">Player:withMenu():addMenuItem(),</a></li>
<li><a href="#player-withmenu-drawmenu">Player:withMenu():drawMenu()</a></li>
<li><a href="#player-withmenu-removemenuitem">Player:withMenu():removeMenuItem()</a></li>
<li><a href="#player-withmissiondisplay">Player:withMissionDisplay()</a></li>
<li><a href="#player-withmissiontracker">Player:withMissionTracker()</a></li>
<li><a href="#player-withmissiontracker-addmission">Player:withMissionTracker():addMission()</a></li>
<li><a href="#player-withmissiontracker-getstartedmissions">Player:withMissionTracker():getStartedMissions()</a></li>
<li><a href="#player-withpowerpresets">Player:withPowerPresets()</a></li>
<li><a href="#player-withquickdial">Player:withQuickDial()</a></li>
<li><a href="#player-withquickdial-addquickdial">Player:withQuickDial():addQuickDial()</a></li>
<li><a href="#player-withquickdial-getquickdials">Player:withQuickDial():getQuickDials()</a></li>
<li><a href="#player-withquickdial-removequickdial">Player:withQuickDial():removeQuickDial()</a></li>
<li><a href="#player-withstorage">Player:withStorage()</a></li>
<li><a href="#player-withstorage-getproductstorage-getemptyproductstorage-getmaxproductstorage">Player:withStorage():getProductStorage(),:getEmptyProductStorage(),:getMaxProductStorage()</a></li>
<li><a href="#player-withstorage-getstoragespace">Player:withStorage():getStorageSpace(),</a></li>
<li><a href="#player-withstorage-getstoredproducts">Player:withStorage():getStoredProducts()</a></li>
<li><a href="#player-withstorage-modifyproductstorage">Player:withStorage():modifyProductStorage()</a></li>
<li><a href="#player-withstorage-setmaxstoragespace">Player:withStorage():setMaxStorageSpace()</a></li>
<li><a href="#player-withstoragedisplay">Player:withStorageDisplay()</a></li>
<li><a href="#player-withupgradedisplay">Player:withUpgradeDisplay()</a></li>
<li><a href="#player-withupgradetracker">Player:withUpgradeTracker()</a></li>
<li><a href="#player-withupgradetracker-addupgrade">Player:withUpgradeTracker():addUpgrade()</a></li>
<li><a href="#player-withupgradetracker-getupgrades">Player:withUpgradeTracker():getUpgrades()</a></li>
<li><a href="#player-withupgradetracker-hasupgrade">Player:withUpgradeTracker():hasUpgrade()</a></li>
</ul>
</li>
<li><a href="#product">Product</a>
<ul class="sectlevel2">
<li><a href="#product-new">Product:new()</a></li>
<li><a href="#product-new-toid">Product:new():toId()</a></li>
</ul>
</li>
<li><a href="#other">Other</a>
<ul class="sectlevel2">
<li><a href="#ship">Ship</a></li>
</ul>
</li>
<li><a href="#ship">Ship</a>
<ul class="sectlevel2">
<li><a href="#ship-order-tick">Ship:Order:tick()</a></li>
<li><a href="#ship-ship-withorderqueue">Ship:Ship:withOrderQueue()</a></li>
<li><a href="#ship-abortcurrentorder">Ship:abortCurrentOrder()</a></li>
<li><a href="#ship-addorder">Ship:addOrder()</a></li>
<li><a href="#ship-behaveasminer">Ship:behaveAsMiner()</a></li>
<li><a href="#ship-flushorders">Ship:flushOrders()</a></li>
<li><a href="#ship-forceordernow">Ship:forceOrderNow()</a></li>
<li><a href="#ship-withcaptain-getcaptain">Ship:withCaptain(),:getCaptain()</a></li>
<li><a href="#ship-withcrew">Ship:withCrew()</a></li>
<li><a href="#ship-withengineeringofficer">Ship:withEngineeringOfficer()</a></li>
<li><a href="#ship-withevents">Ship:withEvents()</a></li>
<li><a href="#ship-withfleet">Ship:withFleet()</a></li>
<li><a href="#ship-withfleet-getfleet">Ship:withFleet():getFleet()</a></li>
<li><a href="#ship-withfleet-getfleetleader">Ship:withFleet():getFleetLeader()</a></li>
<li><a href="#ship-withfleet-isfleetleader">Ship:withFleet():isFleetLeader()</a></li>
<li><a href="#ship-withhelmsofficer">Ship:withHelmsOfficer()</a></li>
<li><a href="#ship-withrelayofficer">Ship:withRelayOfficer()</a></li>
<li><a href="#ship-withscienceofficer">Ship:withScienceOfficer()</a></li>
<li><a href="#ship-withweaponsofficer">Ship:withWeaponsOfficer()</a></li>
</ul>
</li>
<li><a href="#shiptemplatebased">ShipTemplateBased</a>
<ul class="sectlevel2">
<li><a href="#shiptemplatebased-withcomms">ShipTemplateBased:withComms()</a></li>
<li><a href="#shiptemplatebased-withcomms-addcomms">ShipTemplateBased:withComms():addComms()</a></li>
<li><a href="#shiptemplatebased-withcomms-getcomms">ShipTemplateBased:withComms():getComms()</a></li>
<li><a href="#shiptemplatebased-withcomms-overridecomms">ShipTemplateBased:withComms():overrideComms()</a></li>
<li><a href="#shiptemplatebased-withcomms-removecomms">ShipTemplateBased:withComms():removeComms()</a></li>
<li><a href="#shiptemplatebased-withcomms-sethailtext">ShipTemplateBased:withComms():setHailText()</a></li>
<li><a href="#shiptemplatebased-withcrew">ShipTemplateBased:withCrew()</a></li>
<li><a href="#shiptemplatebased-withevents">ShipTemplateBased:withEvents()</a></li>
<li><a href="#shiptemplatebased-withmissionbroker">ShipTemplateBased:withMissionBroker()</a></li>
<li><a href="#shiptemplatebased-withmissionbroker-addmission">ShipTemplateBased:withMissionBroker():addMission()</a></li>
<li><a href="#shiptemplatebased-withmissionbroker-getmissions">ShipTemplateBased:withMissionBroker():getMissions()</a></li>
<li><a href="#shiptemplatebased-withmissionbroker-hasmissions">ShipTemplateBased:withMissionBroker():hasMissions()</a></li>
<li><a href="#shiptemplatebased-withmissionbroker-removemission">ShipTemplateBased:withMissionBroker():removeMission()</a></li>
<li><a href="#shiptemplatebased-withstoragerooms">ShipTemplateBased:withStorageRooms()</a></li>
<li><a href="#shiptemplatebased-withupgradebroker">ShipTemplateBased:withUpgradeBroker()</a></li>
<li><a href="#shiptemplatebased-withupgradebroker-addupgrade">ShipTemplateBased:withUpgradeBroker():addUpgrade()</a></li>
<li><a href="#shiptemplatebased-withupgradebroker-getupgrades">ShipTemplateBased:withUpgradeBroker():getUpgrades()</a></li>
<li><a href="#shiptemplatebased-withupgradebroker-hasupgrade">ShipTemplateBased:withUpgradeBroker():hasUpgrade()</a></li>
<li><a href="#shiptemplatebased-withupgradebroker-hasupgrades">ShipTemplateBased:withUpgradeBroker():hasUpgrades()</a></li>
<li><a href="#shiptemplatebased-withupgradebroker-removeupgrade">ShipTemplateBased:withUpgradeBroker():removeUpgrade()</a></li>
</ul>
</li>
<li><a href="#station">Station</a>
<ul class="sectlevel2">
<li><a href="#station-withmerchant">Station:withMerchant()</a></li>
<li><a href="#station-withproduction">Station:withProduction()</a></li>
</ul>
</li>
<li><a href="#tools">Tools</a>
<ul class="sectlevel2">
<li><a href="#tools-ensurecomms">Tools:ensureComms()</a></li>
<li><a href="#tools-storycomms">Tools:storyComms()</a></li>
</ul>
</li>
<li><a href="#translator">Translator</a>
<ul class="sectlevel2">
<li><a href="#translator-inspect">Translator:inspect()</a></li>
<li><a href="#translator-new">Translator:new()</a></li>
<li><a href="#translator-new-register">Translator:new():register()</a></li>
<li><a href="#translator-new-translate">Translator:new():translate()</a></li>
<li><a href="#translator-new-uselocale">Translator:new():useLocale()</a></li>
<li><a href="#translator-printinspection">Translator:printInspection()</a></li>
</ul>
</li>
<li><a href="#util">Util</a>
<ul class="sectlevel2">
<li><a href="#util-addvector">Util:addVector()</a></li>
<li><a href="#util-anglediff">Util:angleDiff()</a></li>
<li><a href="#util-anglefromvector">Util:angleFromVector()</a></li>
<li><a href="#util-appendtables">Util:appendTables()</a></li>
<li><a href="#util-deepcopy">Util:deepCopy()</a></li>
<li><a href="#util-distancetolinesegment">Util:distanceToLineSegment()</a></li>
<li><a href="#util-heading">Util:heading()</a></li>
<li><a href="#util-isnumerictable">Util:isNumericTable()</a></li>
<li><a href="#util-keys">Util:keys()</a></li>
<li><a href="#util-map">Util:map()</a></li>
<li><a href="#util-mergetables">Util:mergeTables()</a></li>
<li><a href="#util-mkstring">Util:mkString()</a></li>
<li><a href="#util-onvector">Util:onVector()</a></li>
<li><a href="#util-random">Util:random()</a></li>
<li><a href="#util-randomsort">Util:randomSort()</a></li>
<li><a href="#util-randomuuid">Util:randomUuid()</a></li>
<li><a href="#util-round">Util:round()</a></li>
<li><a href="#util-size">Util:size()</a></li>
<li><a href="#util-vectorfromangle">Util:vectorFromAngle()</a></li>
</ul>
</li>
<li><a href="#other">Other</a>
<ul class="sectlevel2">
<li><a href="#typeinspect">typeInspect()</a></li>
<li><a href="#usercallback">userCallback()</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This document shows intentional specifications of the components provided by Lively Epsilon.</p>
</div>
<div class="paragraph">
<p>The following are code examples that are run as tests. So they sometimes use mocks that you could see in the code
examples. Statements starting with <code>assert</code> are assumptions on the code that follows. Their name should be self-explanatory.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The documentation also documents internal functions. Please check if a method is supposed to be used in the <a href="reference.html">API reference</a> before using it.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="brokerupgrade">BrokerUpgrade</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="brokerupgrade-new">BrokerUpgrade:new()</h3>
<div id="brokerupgrade-new-config-description-getdescription-fails-if-no-player-is-given" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new() config.description, getDescription() fails if no player is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() upgrade:getDescription() <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-config-description-getdescription-returns-nil-if-no-description-is-set" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new() config.description, getDescription() returns nil if no description is set
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock(<span class="map"><span class="delimiter">{</span><span class="key">description</span> = <span class="predefined-constant">nil</span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_nil(upgrade:getDescription(player))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-config-description-getdescription-returns-the-description-if-it-is-a-function" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new() config.description, getDescription() returns the description if it is a function
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">description</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">This is an upate</span><span class="delimiter">&quot;</span></span>
<span class="keyword">local</span> <span class="local-variable">upgrade</span>
upgrade = upgradeMock(<span class="map"><span class="delimiter">{</span><span class="key">description</span> = <span class="keyword">function</span>(arg1, arg2)
    <span class="predefined">assert</span>.is_same(upgrade, arg1)
    <span class="predefined">assert</span>.is_same(player, arg2)
    <span class="keyword">return</span> description
<span class="keyword">end</span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(description, upgrade:getDescription(player))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-config-description-getdescription-returns-the-description-if-it-is-a-string" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new() config.description, getDescription() returns the description if it is a string
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">description</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">This is an upgrade</span><span class="delimiter">&quot;</span></span>
<span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock(<span class="map"><span class="delimiter">{</span><span class="key">description</span> = description<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(description, upgrade:getDescription(player))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-config-id-getid-allows-to-set-an-id" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new() config.id, getId() allows to set an id
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock(<span class="map"><span class="delimiter">{</span>
    <span class="key">id</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">fake_upgrade</span><span class="delimiter">&quot;</span></span>,
<span class="delimiter">}</span></span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">fake_upgrade</span><span class="delimiter">&quot;</span></span>, upgrade:getId())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-config-id-getid-fails-if-id-is-a-number" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new() config.id, getId() fails if id is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() upgradeMock(<span class="map"><span class="delimiter">{</span><span class="key">id</span> = <span class="integer">42</span><span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-config-id-getid-sets-a-unique-id" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new() config.id, getId() sets a unique id
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock(<span class="map"><span class="delimiter">{</span><span class="key">id</span> = <span class="predefined-constant">nil</span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_string(upgrade:getId())
<span class="predefined">assert</span>.not_same(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>, upgrade:getId())

<span class="keyword">local</span> <span class="local-variable">upgrade2</span> = upgradeMock(<span class="map"><span class="delimiter">{</span><span class="key">id</span> = <span class="predefined-constant">nil</span><span class="delimiter">}</span></span>)
<span class="predefined">assert</span>.not_same(upgrade:getId(), upgrade2:getId())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-config-installmessage-getinstallmessage-fails-if-no-player-is-given" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new() config.installMessage, getInstallMessage() fails if no player is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock(<span class="map"><span class="delimiter">{</span><span class="key">installMessage</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Foobar</span><span class="delimiter">&quot;</span></span> <span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() upgrade:getInstallMessage() <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-config-installmessage-getinstallmessage-returns-nil-if-no-installmessage-is-set" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new() config.installMessage, getInstallMessage() returns nil if no installMessage is set
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock(<span class="map"><span class="delimiter">{</span><span class="key">installMessage</span> = <span class="predefined-constant">nil</span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_nil(upgrade:getInstallMessage(player))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-config-installmessage-getinstallmessage-returns-the-message-if-it-is-a-function" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new() config.installMessage, getInstallMessage() returns the message if it is a function
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">message</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Thanks for buying that upgrade</span><span class="delimiter">&quot;</span></span>
<span class="keyword">local</span> <span class="local-variable">upgrade</span>
upgrade = upgradeMock(<span class="map"><span class="delimiter">{</span><span class="key">installMessage</span> = <span class="keyword">function</span>(arg1, arg2)
    <span class="predefined">assert</span>.is_same(upgrade, arg1)
    <span class="predefined">assert</span>.is_same(player, arg2)
    <span class="keyword">return</span> message
<span class="keyword">end</span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(message, upgrade:getInstallMessage(player))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-config-installmessage-getinstallmessage-returns-the-message-if-it-is-a-string" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new() config.installMessage, getInstallMessage() returns the message if it is a string
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">message</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Thanks for buying that upgrade</span><span class="delimiter">&quot;</span></span>
<span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock(<span class="map"><span class="delimiter">{</span><span class="key">installMessage</span> = message <span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(message, upgrade:getInstallMessage(player))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-config-name-getname-fails-if-name-is-a-number" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new() config.name, getName() fails if name is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() upgradeMock(<span class="map"><span class="delimiter">{</span><span class="key">name</span> = <span class="integer">42</span><span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-config-name-getname-fails-if-no-name-is-given" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new() config.name, getName() fails if no name is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() BrokerUpgrade:new(<span class="map"><span class="delimiter">{</span>
    <span class="key">onInstall</span> = <span class="keyword">function</span>() <span class="keyword">end</span>,
<span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-config-name-getname-returns-the-name-if-it-is-a-string" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new() config.name, getName() returns the name if it is a string
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">name</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>
<span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock(<span class="map"><span class="delimiter">{</span><span class="key">name</span> = name<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(name, upgrade:getName())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-config-price-getprice-deduces-the-cost-from-the-players-reputation-points-when-installed" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new() config.price, getPrice() deduces the cost from the players reputation points when installed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock(<span class="map"><span class="delimiter">{</span><span class="key">price</span> = <span class="float">42.0</span><span class="delimiter">}</span></span>)
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship():setReputationPoints(<span class="integer">100</span>)

upgrade:install(player)

<span class="predefined">assert</span>.is_same(<span class="integer">58</span>, player:getReputationPoints())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-config-price-getprice-fails-if-price-is-non-numeric" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new() config.price, getPrice() fails if price is non-numeric
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    upgradeMock(<span class="map"><span class="delimiter">{</span><span class="key">price</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-config-price-getprice-returns-0-if-config-price-is-not-set" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new() config.price, getPrice() returns 0 if config.price is not set
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock()

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, upgrade:getPrice())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-config-price-getprice-takes-the-price-that-was-set" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new() config.price, getPrice() takes the price that was set
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock(<span class="map"><span class="delimiter">{</span><span class="key">price</span> = <span class="float">42.0</span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(<span class="float">42.0</span>, upgrade:getPrice())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-config-requiredupgrade-allows-to-install-an-upgrade-if-the-required-is-installed" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new() config.requiredUpgrade allows to install an upgrade if the required is installed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">required</span> = upgradeMock(<span class="map"><span class="delimiter">{</span><span class="key">id</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
<span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock(<span class="map"><span class="delimiter">{</span><span class="key">requiredUpgrade</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withUpgradeTracker(player)
player:addUpgrade(required)

<span class="predefined">assert</span>.is_true(upgrade:canBeInstalled(player))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-config-requiredupgrade-exposes-the-required-upgrade" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new() config.requiredUpgrade exposes the required upgrade
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">required</span> = upgradeMock(<span class="map"><span class="delimiter">{</span><span class="key">id</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
<span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock(<span class="map"><span class="delimiter">{</span><span class="key">requiredUpgrade</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withUpgradeTracker(player)
player:addUpgrade(required)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span>, upgrade:getRequiredUpgradeString())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-config-requiredupgrade-prevents-the-upgrade-from-being-installed-on-a-ship-without-upgrade-tracker" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new() config.requiredUpgrade prevents the upgrade from being installed on a ship without Upgrade Tracker
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock(<span class="map"><span class="delimiter">{</span><span class="key">requiredUpgrade</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()

<span class="predefined">assert</span>.is_false(upgrade:canBeInstalled(player))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-config-requiredupgrade-prevents-the-upgrade-to-be-installed-if-the-required-is-not-installed" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new() config.requiredUpgrade prevents the upgrade to be installed if the required is not installed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock(<span class="map"><span class="delimiter">{</span><span class="key">requiredUpgrade</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withUpgradeTracker(player)
player:addUpgrade(upgradeMock())

<span class="predefined">assert</span>.is_false(upgrade:canBeInstalled(player))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-config-unique-prevents-the-upgrade-from-being-installed-more-than-once-on-a-ship" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new() config.unique prevents the upgrade from being installed more than once on a ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock(<span class="map"><span class="delimiter">{</span><span class="key">unique</span> = <span class="predefined-constant">true</span><span class="delimiter">}</span></span>)
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withUpgradeTracker(player)

<span class="predefined">assert</span>.is_true(upgrade:canBeInstalled(player))
upgrade:install(player)

<span class="predefined">assert</span>.is_false(upgrade:canBeInstalled(player))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-config-unique-prevents-the-upgrade-from-being-installed-on-a-ship-without-upgrade-tracker" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new() config.unique prevents the upgrade from being installed on a ship without Upgrade Tracker
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock(<span class="map"><span class="delimiter">{</span><span class="key">unique</span> = <span class="predefined-constant">true</span><span class="delimiter">}</span></span>)
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()

<span class="predefined">assert</span>.is_false(upgrade:canBeInstalled(player))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-fails-if-first-argument-is-a-number" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new() fails if first argument is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() BrokerUpgrade:new(<span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-fails-if-there-is-no-install-function-given" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new() fails if there is no install function given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() BrokerUpgrade:new(<span class="predefined-constant">nil</span>, <span class="keyword">function</span>() <span class="keyword">end</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-fails-if-there-is-no-name-given" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new() fails if there is no name given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() BrokerUpgrade:new(<span class="string"><span class="delimiter">&quot;</span><span class="content">Foobar</span><span class="delimiter">&quot;</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-returns-a-valid-brokerupgrade" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new() returns a valid BrokerUpgrade
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock()
<span class="predefined">assert</span>.is_true(BrokerUpgrade:isUpgrade(upgrade))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="brokerupgrade-new-canbeinstalled">BrokerUpgrade:new():canBeInstalled()</h3>
<div id="brokerupgrade-new-canbeinstalled-calls-the-callback" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new():canBeInstalled() calls the callback
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">canBeInstalledCalled = <span class="integer">0</span>

<span class="keyword">local</span> <span class="local-variable">success</span>, <span class="local-variable">msg</span> = upgrade:canBeInstalled(player)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, canBeInstalledCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-canbeinstalled-fails-if-no-player-is-given" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new():canBeInstalled() fails if no player is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">canBeInstalledCalled = <span class="integer">0</span>

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() upgrade:canBeInstalled(<span class="integer">42</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, canBeInstalledCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-canbeinstalled-interprets-as-true-when-callback-returns-nil" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new():canBeInstalled() interprets as true, when callback returns nil
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">upgrade</span>
upgrade = upgradeMock(<span class="map"><span class="delimiter">{</span><span class="key">canBeInstalled</span> = <span class="keyword">function</span>()
    <span class="keyword">return</span> <span class="predefined-constant">nil</span>
<span class="keyword">end</span><span class="delimiter">}</span></span>)

<span class="keyword">local</span> <span class="local-variable">success</span>, <span class="local-variable">msg</span> = upgrade:canBeInstalled(player)
<span class="predefined">assert</span>.is_true(success)
<span class="predefined">assert</span>.is_nil(msg)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-canbeinstalled-passes-through-a-string-on-failure" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new():canBeInstalled() passes through a string on failure
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock(<span class="map"><span class="delimiter">{</span><span class="key">canBeInstalled</span> = <span class="keyword">function</span>()
    <span class="keyword">return</span> <span class="predefined-constant">false</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>
<span class="keyword">end</span><span class="delimiter">}</span></span>)

<span class="keyword">local</span> <span class="local-variable">success</span>, <span class="local-variable">msg</span> = upgrade:canBeInstalled(player)
<span class="predefined">assert</span>.is_false(success)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>, msg)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-canbeinstalled-removes-message-if-it-is-attached-to-a-true-response" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new():canBeInstalled() removes message if it is attached to a true response
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock(<span class="map"><span class="delimiter">{</span><span class="key">canBeInstalled</span> = <span class="keyword">function</span>()
    <span class="keyword">return</span> <span class="predefined-constant">true</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>
<span class="keyword">end</span><span class="delimiter">}</span></span>)

<span class="keyword">local</span> <span class="local-variable">success</span>, <span class="local-variable">msg</span> = upgrade:canBeInstalled(player)
<span class="predefined">assert</span>.is_true(success)
<span class="predefined">assert</span>.is_nil(msg)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-canbeinstalled-removes-non-string-message-on-failure" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new():canBeInstalled() removes non-string message on failure
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock(<span class="map"><span class="delimiter">{</span><span class="key">canBeInstalled</span> = <span class="keyword">function</span>()
    <span class="keyword">return</span> <span class="predefined-constant">false</span>, <span class="integer">42</span>
<span class="keyword">end</span><span class="delimiter">}</span></span>)

<span class="keyword">local</span> <span class="local-variable">success</span>, <span class="local-variable">msg</span> = upgrade:canBeInstalled(player)
<span class="predefined">assert</span>.is_false(success)
<span class="predefined">assert</span>.is_nil(msg)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="brokerupgrade-new-install">BrokerUpgrade:new():install()</h3>
<div id="brokerupgrade-new-install-calls-the-canbeinstalled-callback-and-the-install-callback" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new():install() calls the canBeInstalled callback and the install callback
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">canBeInstalledCalled = <span class="integer">0</span>
installCalled = <span class="integer">0</span>

upgrade:install(player)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, canBeInstalledCalled)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, installCalled)

upgrade:install(player)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, canBeInstalledCalled)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, installCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-install-fails-if-no-player-is-given" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new():install() fails if no player is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">canBeInstalledCalled = <span class="integer">0</span>
installCalled = <span class="integer">0</span>

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() upgrade:install(<span class="integer">42</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, canBeInstalledCalled)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, installCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="brokerupgrade-new-install-throws-error-if-requirement-is-not-met" class="paragraph">
<p> <details><summary> 
BrokerUpgrade:new():install() throws error if requirement is not met
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock(<span class="map"><span class="delimiter">{</span><span class="key">canBeInstalled</span> = <span class="keyword">function</span>()
    <span class="keyword">return</span> <span class="predefined-constant">false</span>
<span class="keyword">end</span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() upgrade:install(player) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chatter">Chatter</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="chatter-new">Chatter:new()</h3>
<div id="chatter-new-config-maxrange-allows-to-hear-chatter-within-range" class="paragraph">
<p> <details><summary> 
Chatter:new() config.maxRange allows to hear chatter within range
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
mockPlayers(player)
<span class="keyword">local</span> <span class="local-variable">chatter</span> = Chatter:new(<span class="map"><span class="delimiter">{</span><span class="key">maxRange</span> = <span class="integer">30000</span><span class="delimiter">}</span></span>)
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span>)
player:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
ship:setPosition(<span class="integer">2000</span>, <span class="integer">0</span>)

chatter:say(ship, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe: Hello World</span><span class="delimiter">&quot;</span></span>, player.shipLogs[<span class="integer">1</span>].message)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-new-config-maxrange-can-happen-that-players-only-hear-half-of-a-conversation" class="paragraph">
<p> <details><summary> 
Chatter:new() config.maxRange can happen that players only hear half of a conversation
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
mockPlayers(player)
<span class="keyword">local</span> <span class="local-variable">chatter</span> = Chatter:new(<span class="map"><span class="delimiter">{</span><span class="key">maxRange</span> = <span class="integer">30000</span><span class="delimiter">}</span></span>)
<span class="keyword">local</span> <span class="local-variable">ship1</span> = CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Alice</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">ship2</span> = CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>)

player:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
ship1:setPosition(<span class="integer">2000</span>, <span class="integer">0</span>)
ship2:setPosition(<span class="integer">99999</span>, <span class="integer">0</span>)

chatter:converse(<span class="map"><span class="delimiter">{</span>
    <span class="map"><span class="inline-delimiter">{</span>ship1, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hey Bob. What was your password again?</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>,
    <span class="map"><span class="inline-delimiter">{</span>ship2, <span class="string"><span class="delimiter">&quot;</span><span class="content">12345</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>,
    <span class="map"><span class="inline-delimiter">{</span>ship1, <span class="string"><span class="delimiter">&quot;</span><span class="content">That's the stupidest combination I have ever heard in my life!</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>,
<span class="delimiter">}</span></span>)
<span class="keyword">for</span> i=<span class="integer">1</span>,<span class="integer">15</span> <span class="keyword">do</span> Cron.tick(i) <span class="keyword">end</span>

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Alice: Hey Bob. What was your password again?</span><span class="delimiter">&quot;</span></span>, player.shipLogs[<span class="integer">1</span>].message)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Alice: That's the stupidest combination I have ever heard in my life!</span><span class="delimiter">&quot;</span></span>, player.shipLogs[<span class="integer">2</span>].message)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-new-config-maxrange-does-not-allow-to-hear-chatter-outside-range" class="paragraph">
<p> <details><summary> 
Chatter:new() config.maxRange does not allow to hear chatter outside range
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
mockPlayers(player)
<span class="keyword">local</span> <span class="local-variable">chatter</span> = Chatter:new(<span class="map"><span class="delimiter">{</span><span class="key">maxRange</span> = <span class="integer">30000</span><span class="delimiter">}</span></span>)
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span>)
player:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
ship:setPosition(<span class="integer">99999</span>, <span class="integer">0</span>)

chatter:say(ship, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>, player.shipLogs)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-new-config-maxrange-does-not-limit-range-of-non-ships" class="paragraph">
<p> <details><summary> 
Chatter:new() config.maxRange does not limit range of non-ships
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
mockPlayers(player)
<span class="keyword">local</span> <span class="local-variable">chatter</span> = Chatter:new(<span class="map"><span class="delimiter">{</span><span class="key">maxRange</span> = <span class="integer">30000</span><span class="delimiter">}</span></span>)
player:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)

chatter:say(<span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe: Hello World</span><span class="delimiter">&quot;</span></span>, player.shipLogs[<span class="integer">1</span>].message)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-new-config-maxrange-fails-if-maxrange-is-not-a-number" class="paragraph">
<p> <details><summary> 
Chatter:new() config.maxRange fails if maxRange is not a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Chatter:new(<span class="map"><span class="delimiter">{</span><span class="key">maxRange</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Chatter:new(<span class="map"><span class="delimiter">{</span><span class="key">maxRange</span> = <span class="keyword">function</span>() <span class="keyword">end</span><span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-new-config-maxrange-works-with-multiple-players" class="paragraph">
<p> <details><summary> 
Chatter:new() config.maxRange works with multiple players
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player1</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">player2</span> = PlayerSpaceship()
mockPlayers(player1, player2)
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">chatter</span> = Chatter:new(<span class="map"><span class="delimiter">{</span><span class="key">maxRange</span> = <span class="integer">30000</span><span class="delimiter">}</span></span>)

player1:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
ship:setPosition(<span class="integer">2000</span>, <span class="integer">0</span>)
player2:setPosition(<span class="integer">99999</span>, <span class="integer">0</span>)

chatter:say(ship, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe: Hello World</span><span class="delimiter">&quot;</span></span>, player1.shipLogs[<span class="integer">1</span>].message)
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>, player2.shipLogs)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-new-creates-a-valid-chatter" class="paragraph">
<p> <details><summary> 
Chatter:new() creates a valid chatter
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">chatter</span> = Chatter:new()
<span class="predefined">assert</span>.is_true(Chatter:isChatter(chatter))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-new-fails-when-config-is-not-a-table" class="paragraph">
<p> <details><summary> 
Chatter:new() fails when config is not a table
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Chatter:new(<span class="integer">42</span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Chatter:new(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="chatter-new-converse">Chatter:new():converse()</h3>
<div id="chatter-new-converse-aborts-conversation-if-one-speaker-got-destroyed" class="paragraph">
<p> <details><summary> 
Chatter:new():converse() aborts conversation if one speaker got destroyed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
mockPlayers(player)
<span class="keyword">local</span> <span class="local-variable">chatter</span> = Chatter:new()
<span class="keyword">local</span> <span class="local-variable">ship1</span> = CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">ship2</span> = CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Jack the Ripper</span><span class="delimiter">&quot;</span></span>)

chatter:converse(<span class="map"><span class="delimiter">{</span>
    <span class="map"><span class="inline-delimiter">{</span>ship2, <span class="string"><span class="delimiter">&quot;</span><span class="content">I'm gonna destroy you</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>,
    <span class="map"><span class="inline-delimiter">{</span>ship1, <span class="string"><span class="delimiter">&quot;</span><span class="content">Oh no</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>,
    <span class="map"><span class="inline-delimiter">{</span>ship2, <span class="string"><span class="delimiter">&quot;</span><span class="content">Wait. How did you survive that?</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>,
<span class="delimiter">}</span></span>)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Jack the Ripper: I'm gonna destroy you</span><span class="delimiter">&quot;</span></span>, player.shipLogs[<span class="integer">1</span>].message)
ship1:destroy()

<span class="keyword">for</span> i=<span class="integer">1</span>,<span class="integer">10</span>,<span class="integer">1</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>

<span class="predefined">assert</span>.is_nil(player.shipLogs[<span class="integer">2</span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-new-converse-fails-if-one-of-items-in-the-table-is-not-a-table" class="paragraph">
<p> <details><summary> 
Chatter:new():converse() fails if one of items in the table is not a table
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">chatter</span> = Chatter:new()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    chatter:converse(<span class="map"><span class="delimiter">{</span>
        <span class="map"><span class="inline-delimiter">{</span><span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Ehm... this breaks</span><span class="delimiter">&quot;</span></span>,
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-new-converse-fails-if-one-of-the-messages-is-a-number" class="paragraph">
<p> <details><summary> 
Chatter:new():converse() fails if one of the messages is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">chatter</span> = Chatter:new()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    chatter:converse(<span class="map"><span class="delimiter">{</span>
        <span class="map"><span class="inline-delimiter">{</span><span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>,
        <span class="map"><span class="inline-delimiter">{</span><span class="string"><span class="delimiter">&quot;</span><span class="content">Arthur Dent</span><span class="delimiter">&quot;</span></span>, <span class="integer">42</span><span class="inline-delimiter">}</span></span>,
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-new-converse-fails-if-one-of-the-senders-is-a-number" class="paragraph">
<p> <details><summary> 
Chatter:new():converse() fails if one of the senders is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">chatter</span> = Chatter:new()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    chatter:converse(<span class="map"><span class="delimiter">{</span>
        <span class="map"><span class="inline-delimiter">{</span><span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>,
        <span class="map"><span class="inline-delimiter">{</span><span class="integer">42</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">I got the answer</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>,
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-new-converse-fails-when-messages-is-nil-or-a-string" class="paragraph">
<p> <details><summary> 
Chatter:new():converse() fails when messages is nil or a string
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">chatter</span> = Chatter:new()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    chatter:converse(<span class="predefined-constant">nil</span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    chatter:converse(<span class="string"><span class="delimiter">&quot;</span><span class="content">This breaks</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-new-converse-leaves-breaks-between-the-speakers" class="paragraph">
<p> <details><summary> 
Chatter:new():converse() leaves breaks between the speakers
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Two</span><span class="delimiter">&quot;</span></span>)
mockPlayers(player)
<span class="keyword">local</span> <span class="local-variable">chatter</span> = Chatter:new()

chatter:converse(<span class="map"><span class="delimiter">{</span>
    <span class="map"><span class="inline-delimiter">{</span><span class="string"><span class="delimiter">&quot;</span><span class="content">One</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Saying six words takes three seconds.</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>,
    <span class="map"><span class="inline-delimiter">{</span>ship, <span class="string"><span class="delimiter">&quot;</span><span class="content">Four words - two seconds.</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>
<span class="delimiter">}</span></span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">One: Saying six words takes three seconds.</span><span class="delimiter">&quot;</span></span>, player.shipLogs[<span class="integer">1</span>].message)
Cron.tick(<span class="float">1.5</span>)
<span class="predefined">assert</span>.is_nil(player.shipLogs[<span class="integer">2</span>])
Cron.tick(<span class="integer">2</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Two: Four words - two seconds.</span><span class="delimiter">&quot;</span></span>, player.shipLogs[<span class="integer">2</span>].message)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-new-converse-sends-to-all-player-ships" class="paragraph">
<p> <details><summary> 
Chatter:new():converse() sends to all player ships
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player1</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">player2</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">player3</span> = PlayerSpaceship()
mockPlayers(player1, player2, player3)

<span class="keyword">local</span> <span class="local-variable">chatter</span> = Chatter:new()
chatter:converse(<span class="map"><span class="delimiter">{</span><span class="map"><span class="inline-delimiter">{</span><span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span><span class="delimiter">}</span></span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe: Hello World</span><span class="delimiter">&quot;</span></span>, player1.shipLogs[<span class="integer">1</span>].message)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe: Hello World</span><span class="delimiter">&quot;</span></span>, player2.shipLogs[<span class="integer">1</span>].message)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe: Hello World</span><span class="delimiter">&quot;</span></span>, player3.shipLogs[<span class="integer">1</span>].message)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="chatter-new-say">Chatter:new():say()</h3>
<div id="chatter-new-say-does-not-send-the-message-if-the-ship-is-invalid" class="paragraph">
<p> <details><summary> 
Chatter:new():say() does not send the message if the ship is invalid
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span>)
ship:destroy()
mockPlayers(player)

<span class="keyword">local</span> <span class="local-variable">chatter</span> = Chatter:new()
chatter:say(ship, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>, player.shipLogs)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-new-say-fails-when-message-is-nil-or-a-number" class="paragraph">
<p> <details><summary> 
Chatter:new():say() fails when message is nil or a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">chatter</span> = Chatter:new()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    chatter:say(<span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">nil</span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    chatter:say(<span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span>, <span class="integer">42</span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-new-say-fails-when-sender-is-nil-or-a-number" class="paragraph">
<p> <details><summary> 
Chatter:new():say() fails when sender is nil or a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">chatter</span> = Chatter:new()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    chatter:say(<span class="predefined-constant">nil</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    chatter:say(<span class="integer">42</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-new-say-sends-to-all-player-ships" class="paragraph">
<p> <details><summary> 
Chatter:new():say() sends to all player ships
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player1</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">player2</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">player3</span> = PlayerSpaceship()
mockPlayers(player1, player2, player3)

<span class="keyword">local</span> <span class="local-variable">chatter</span> = Chatter:new()
chatter:say(<span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe: Hello World</span><span class="delimiter">&quot;</span></span>, player1.shipLogs[<span class="integer">1</span>].message)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe: Hello World</span><span class="delimiter">&quot;</span></span>, player2.shipLogs[<span class="integer">1</span>].message)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe: Hello World</span><span class="delimiter">&quot;</span></span>, player3.shipLogs[<span class="integer">1</span>].message)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-new-say-works-with-a-ship-as-sender" class="paragraph">
<p> <details><summary> 
Chatter:new():say() works with a ship as sender
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span>)
mockPlayers(player)

<span class="keyword">local</span> <span class="local-variable">chatter</span> = Chatter:new()
chatter:say(ship, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe: Hello World</span><span class="delimiter">&quot;</span></span>, player.shipLogs[<span class="integer">1</span>].message)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-new-say-works-with-a-string-as-sender" class="paragraph">
<p> <details><summary> 
Chatter:new():say() works with a string as sender
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
mockPlayers(player)

<span class="keyword">local</span> <span class="local-variable">chatter</span> = Chatter:new()
chatter:say(<span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe: Hello World</span><span class="delimiter">&quot;</span></span>, player.shipLogs[<span class="integer">1</span>].message)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="chatter-newfactory">Chatter:newFactory()</h3>
<div id="chatter-newfactory-fails-if-config-filters-is-not-a-numeric-table" class="paragraph">
<p> <details><summary> 
Chatter:newFactory() fails if config.filters is not a numeric table
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Chatter:newFactory(<span class="integer">1</span>, <span class="keyword">function</span>() <span class="keyword">end</span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">filters</span> = <span class="integer">1</span>,
<span class="delimiter">}</span></span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Chatter:newFactory(<span class="integer">1</span>, <span class="keyword">function</span>() <span class="keyword">end</span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">filters</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">string</span><span class="delimiter">&quot;</span></span>,
<span class="delimiter">}</span></span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Chatter:newFactory(<span class="integer">1</span>, <span class="keyword">function</span>() <span class="keyword">end</span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">filters</span> = <span class="map"><span class="inline-delimiter">{</span><span class="key">foo</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>,
<span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-newfactory-fails-if-first-parameter-is-not-a-positive-integer" class="paragraph">
<p> <details><summary> 
Chatter:newFactory() fails if first parameter is not a positive integer
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Chatter:newFactory(<span class="integer">-1</span>, <span class="keyword">function</span>() <span class="keyword">end</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Chatter:newFactory(<span class="integer">0</span>, <span class="keyword">function</span>() <span class="keyword">end</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Chatter:newFactory(<span class="predefined-constant">nil</span>, <span class="keyword">function</span>() <span class="keyword">end</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Chatter:newFactory(<span class="string"><span class="delimiter">&quot;</span><span class="content">string</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="keyword">end</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Chatter:newFactory(SpaceStation(), <span class="keyword">function</span>() <span class="keyword">end</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-newfactory-fails-if-second-parameter-is-not-a-function" class="paragraph">
<p> <details><summary> 
Chatter:newFactory() fails if second parameter is not a function
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Chatter:newFactory(<span class="integer">1</span>, <span class="integer">1</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Chatter:newFactory(<span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">string</span><span class="delimiter">&quot;</span></span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Chatter:newFactory(<span class="integer">1</span>, <span class="predefined-constant">nil</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Chatter:newFactory(<span class="integer">1</span>, SpaceStation()) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-newfactory-fails-if-third-parameter-is-not-a-table" class="paragraph">
<p> <details><summary> 
Chatter:newFactory() fails if third parameter is not a table
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Chatter:newFactory(<span class="integer">1</span>, <span class="keyword">function</span>() <span class="keyword">end</span>, <span class="integer">1</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Chatter:newFactory(<span class="integer">1</span>, <span class="keyword">function</span>() <span class="keyword">end</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">string</span><span class="delimiter">&quot;</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-newfactory-should-create-a-valid-chat" class="paragraph">
<p> <details><summary> 
Chatter:newFactory() should create a valid chat
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">chat</span> = Chatter:newFactory(<span class="integer">1</span>, <span class="keyword">function</span>(one)
    <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>
        <span class="map"><span class="inline-delimiter">{</span>one, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>
    <span class="delimiter">}</span></span>
<span class="keyword">end</span>)

<span class="predefined">assert</span>.is_true(Chatter:isChatFactory(chat))
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, chat:getCardinality())
<span class="predefined">assert</span>.is_true(chat:areValidArguments(CpuShip()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="chatter-newfactory-arevalidarguments">Chatter:newFactory():areValidArguments()</h3>
<div id="chatter-newfactory-arevalidarguments-always-returns-true-if-no-filter-is-set" class="paragraph">
<p> <details><summary> 
Chatter:newFactory():areValidArguments() always returns true if no filter is set
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">chat</span> = Chatter:newFactory(<span class="integer">1</span>, <span class="keyword">function</span>() <span class="keyword">end</span>)

<span class="predefined">assert</span>.is_true(chat:areValidArguments(SpaceStation()))
<span class="predefined">assert</span>.is_true(chat:areValidArguments(CpuShip()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-newfactory-arevalidarguments-returns-false-if-no-shiptemplatebased-is-given" class="paragraph">
<p> <details><summary> 
Chatter:newFactory():areValidArguments() returns false if no shipTemplateBased is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">chat</span> = Chatter:newFactory(<span class="integer">1</span>, <span class="keyword">function</span>() <span class="keyword">end</span>)

<span class="predefined">assert</span>.is_false(chat:areValidArguments(<span class="integer">1</span>))
<span class="predefined">assert</span>.is_false(chat:areValidArguments(Asteroid()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-newfactory-arevalidarguments-uses-filter-on-all-arguments-and-gives-other-partners-to-filter-function" class="paragraph">
<p> <details><summary> 
Chatter:newFactory():areValidArguments() uses filter on all arguments and gives other partners to filter function
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">oneCalled</span>, <span class="local-variable">twoCalled</span>, <span class="local-variable">threeCalled</span> = <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">oneArg1</span>
<span class="keyword">local</span> <span class="local-variable">twoArg1</span>, <span class="local-variable">twoArg2</span>
<span class="keyword">local</span> <span class="local-variable">threeArg1</span>, <span class="local-variable">threeArg2</span>, <span class="local-variable">threeArg3</span>

<span class="keyword">local</span> <span class="local-variable">one</span>, <span class="local-variable">two</span>, <span class="local-variable">three</span> = SpaceStation(), CpuShip(), CpuShip()

<span class="keyword">local</span> <span class="local-variable">chat</span> = Chatter:newFactory(<span class="integer">3</span>, <span class="keyword">function</span>() <span class="keyword">end</span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">filters</span> = <span class="map"><span class="inline-delimiter">{</span>
        <span class="keyword">function</span>(one)
            <span class="key">oneCalled</span> = oneCalled + <span class="integer">1</span>
            <span class="key">oneArg1</span> = one
            <span class="keyword">return</span> <span class="predefined-constant">true</span>
        <span class="keyword">end</span>,
        <span class="keyword">function</span>(two, one)
            <span class="key">twoCalled</span> = twoCalled + <span class="integer">1</span>
            <span class="key">twoArg1</span> = two
            <span class="key">twoArg2</span> = one
            <span class="keyword">return</span> <span class="predefined-constant">true</span>
        <span class="keyword">end</span>,
        <span class="keyword">function</span>(three, two, one)
            <span class="key">threeCalled</span> = threeCalled + <span class="integer">1</span>
            <span class="key">threeArg1</span> = three
            <span class="key">threeArg2</span> = two
            <span class="key">threeArg3</span> = one
            <span class="keyword">return</span> <span class="predefined-constant">true</span>
        <span class="keyword">end</span>,
    <span class="inline-delimiter">}</span></span>
<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_true(chat:areValidArguments(one, two, three))
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, oneCalled)
<span class="predefined">assert</span>.is_same(one, oneArg1)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, twoCalled)
<span class="predefined">assert</span>.is_same(two, twoArg1)
<span class="predefined">assert</span>.is_same(one, twoArg2)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, threeCalled)
<span class="predefined">assert</span>.is_same(three, threeArg1)
<span class="predefined">assert</span>.is_same(two, threeArg2)
<span class="predefined">assert</span>.is_same(one, threeArg3)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-newfactory-arevalidarguments-works-with-one-partner" class="paragraph">
<p> <details><summary> 
Chatter:newFactory():areValidArguments() works with one partner
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">chat</span> = Chatter:newFactory(<span class="integer">1</span>, <span class="keyword">function</span>() <span class="keyword">end</span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">filters</span> = <span class="map"><span class="inline-delimiter">{</span>
        <span class="keyword">function</span>(one) <span class="keyword">return</span> isEeStation(one) <span class="keyword">end</span>
    <span class="inline-delimiter">}</span></span>
<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_true(chat:areValidArguments(SpaceStation()))
<span class="predefined">assert</span>.is_false(chat:areValidArguments(CpuShip()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-newfactory-arevalidarguments-works-with-two-partners" class="paragraph">
<p> <details><summary> 
Chatter:newFactory():areValidArguments() works with two partners
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">chat</span> = Chatter:newFactory(<span class="integer">2</span>, <span class="keyword">function</span>() <span class="keyword">end</span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">filters</span> = <span class="map"><span class="inline-delimiter">{</span>
        <span class="keyword">function</span>(one) <span class="keyword">return</span> isEeStation(one) <span class="keyword">end</span>,
        <span class="keyword">function</span>(two, _) <span class="keyword">return</span> isEeShip(two) <span class="keyword">end</span>,
    <span class="inline-delimiter">}</span></span>
<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_true(chat:areValidArguments(SpaceStation()))
<span class="predefined">assert</span>.is_false(chat:areValidArguments(CpuShip()))

<span class="predefined">assert</span>.is_false(chat:areValidArguments(CpuShip(), SpaceStation()))
<span class="predefined">assert</span>.is_true(chat:areValidArguments(SpaceStation(), CpuShip()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="chatter-newfactory-createchat">Chatter:newFactory():createChat()</h3>
<div id="chatter-newfactory-createchat-gives-all-arguments-to-the-factory" class="paragraph">
<p> <details><summary> 
Chatter:newFactory():createChat() gives all arguments to the factory
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">factoryCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">factoryArg1</span>, <span class="local-variable">factoryArg2</span>
<span class="keyword">local</span> <span class="local-variable">ship1</span>, <span class="local-variable">ship2</span> = CpuShip(), CpuShip()

<span class="keyword">local</span> <span class="local-variable">chat</span> = Chatter:newFactory(<span class="integer">1</span>, <span class="keyword">function</span>(arg1, arg2)
    factoryCalled = factoryCalled + <span class="integer">1</span>
    factoryArg1, factoryArg2 = arg1, arg2

    <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>
        <span class="map"><span class="inline-delimiter">{</span>arg1, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>,
        <span class="map"><span class="inline-delimiter">{</span>arg2, <span class="string"><span class="delimiter">&quot;</span><span class="content">Foobar</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>,
    <span class="delimiter">}</span></span>
<span class="keyword">end</span>)

<span class="keyword">local</span> <span class="local-variable">result</span> = chat:createChat(ship1, ship2)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, factoryCalled)
<span class="predefined">assert</span>.is_same(ship1, factoryArg1)
<span class="predefined">assert</span>.is_same(ship2, factoryArg2)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">table</span><span class="delimiter">&quot;</span></span>, <span class="predefined">type</span>(result))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="chatter-newnoise">Chatter:newNoise()</h3>
<div id="chatter-newnoise-allows-to-remove-chat-factories" class="paragraph">
<p> <details><summary> 
Chatter:newNoise() allows to remove chat factories
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">withUniverse(<span class="keyword">function</span>()
    <span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">player</span><span class="delimiter">&quot;</span></span>):setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
    <span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">ship</span><span class="delimiter">&quot;</span></span>):setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)

    <span class="predefined">print</span>(typeInspect(player:getObjectsInRange(<span class="integer">10000</span>)))

    <span class="keyword">local</span> <span class="local-variable">chat1</span> = Chatter:newFactory(<span class="integer">1</span>, <span class="keyword">function</span>(thisShip)
        <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>
            <span class="map"><span class="inline-delimiter">{</span> thisShip, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>,
        <span class="delimiter">}</span></span>
    <span class="keyword">end</span>)
    <span class="keyword">local</span> <span class="local-variable">chat2</span> = Chatter:newFactory(<span class="integer">1</span>, <span class="keyword">function</span>(thisShip)
        <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>
            <span class="map"><span class="inline-delimiter">{</span> thisShip, <span class="string"><span class="delimiter">&quot;</span><span class="content">You should not see me</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>,
        <span class="delimiter">}</span></span>
    <span class="keyword">end</span>)

    <span class="keyword">local</span> <span class="local-variable">chatter</span> = mockChatter()
    <span class="keyword">local</span> <span class="local-variable">noise</span> = Chatter:newNoise(chatter)
    noise:addChatFactory(chat2, <span class="string"><span class="delimiter">&quot;</span><span class="content">chat2</span><span class="delimiter">&quot;</span></span>)
    noise:addChatFactory(chat1, <span class="string"><span class="delimiter">&quot;</span><span class="content">chat1</span><span class="delimiter">&quot;</span></span>)
    noise:removeChatFactory(<span class="string"><span class="delimiter">&quot;</span><span class="content">chat2</span><span class="delimiter">&quot;</span></span>)

    <span class="keyword">for</span> _=<span class="integer">1</span>,<span class="integer">90</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>

    <span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span>
        <span class="map"><span class="inline-delimiter">{</span>ship, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>,
    <span class="delimiter">}</span></span>, chatter:getLastMessages())
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-newnoise-creates-a-valid-chatnoise" class="paragraph">
<p> <details><summary> 
Chatter:newNoise() creates a valid ChatNoise
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">chatter</span> = mockChatter()
<span class="keyword">local</span> <span class="local-variable">noise</span> = Chatter:newNoise(chatter)
<span class="predefined">assert</span>.is_true(Chatter:isChatNoise(noise))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-newnoise-fails-when-chatter-is-not-a-chatter" class="paragraph">
<p> <details><summary> 
Chatter:newNoise() fails when chatter is not a chatter
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">chatter</span> = mockChatter()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Chatter:newNoise(<span class="predefined-constant">nil</span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Chatter:newNoise(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Chatter:newNoise(<span class="integer">42</span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Chatter:newNoise(<span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-newnoise-tries-to-prevent-repetition-of-chats" class="paragraph">
<p> <details><summary> 
Chatter:newNoise() tries to prevent repetition of chats
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">withUniverse(<span class="keyword">function</span>()
    <span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">player</span><span class="delimiter">&quot;</span></span>):setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
    <span class="keyword">local</span> <span class="local-variable">ship1</span> = CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">ship</span><span class="delimiter">&quot;</span></span>):setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)
    <span class="keyword">local</span> <span class="local-variable">ship2</span> = CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">ship</span><span class="delimiter">&quot;</span></span>):setPosition(<span class="integer">2000</span>, <span class="integer">0</span>)

    <span class="comment">-- mock chatter to easily track which chats we have seen</span>
    <span class="keyword">local</span> <span class="local-variable">chat1</span> = <span class="map"><span class="delimiter">{</span> <span class="map"><span class="inline-delimiter">{</span> ship1, <span class="string"><span class="delimiter">&quot;</span><span class="content">one</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span> <span class="delimiter">}</span></span>
    <span class="keyword">local</span> <span class="local-variable">chat2</span> = <span class="map"><span class="delimiter">{</span> <span class="map"><span class="inline-delimiter">{</span> ship2, <span class="string"><span class="delimiter">&quot;</span><span class="content">two</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span> <span class="delimiter">}</span></span>

    <span class="keyword">local</span> <span class="local-variable">secondToLastChat</span>
    <span class="keyword">local</span> <span class="local-variable">lastChat</span>

    <span class="keyword">local</span> <span class="local-variable">chatter</span> = mockChatter()
    chatter.converse = <span class="keyword">function</span>(_, conversation)
        <span class="keyword">local</span> <span class="local-variable">pretty</span> = require <span class="string"><span class="delimiter">'</span><span class="content">pl.pretty</span><span class="delimiter">'</span></span>

        secondToLastChat = lastChat
        <span class="keyword">if</span> conversation == chat1 <span class="keyword">then</span>
            lastChat = <span class="string"><span class="delimiter">&quot;</span><span class="content">norep_chat1</span><span class="delimiter">&quot;</span></span>
        <span class="keyword">elseif</span> conversation == chat2 <span class="keyword">then</span>
            lastChat = <span class="string"><span class="delimiter">&quot;</span><span class="content">norep_chat2</span><span class="delimiter">&quot;</span></span>
        <span class="keyword">end</span>

        conversation = lastChat
    <span class="keyword">end</span>
    <span class="predefined">assert</span>(Chatter:isChatter(chatter))

    <span class="keyword">local</span> <span class="local-variable">noise</span> = Chatter:newNoise(chatter, <span class="map"><span class="delimiter">{</span><span class="key">preventRepetition</span> = <span class="predefined-constant">true</span><span class="delimiter">}</span></span>)

    <span class="comment">-- chat for first chat</span>
    noise:addChatFactory(Chatter:newFactory(<span class="integer">1</span>, <span class="keyword">function</span>() <span class="keyword">return</span> chat1 <span class="keyword">end</span>, <span class="map"><span class="delimiter">{</span><span class="key">filters</span> = <span class="map"><span class="inline-delimiter">{</span> <span class="keyword">function</span>() <span class="keyword">return</span> <span class="predefined-constant">true</span> <span class="keyword">end</span> <span class="inline-delimiter">}</span></span><span class="delimiter">}</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">norep_chat1</span><span class="delimiter">&quot;</span></span>)
    noise:addChatFactory(Chatter:newFactory(<span class="integer">1</span>, <span class="keyword">function</span>() <span class="keyword">return</span> chat2 <span class="keyword">end</span>, <span class="map"><span class="delimiter">{</span><span class="key">filters</span> = <span class="map"><span class="inline-delimiter">{</span> <span class="keyword">function</span>() <span class="keyword">return</span> <span class="predefined-constant">true</span> <span class="keyword">end</span> <span class="inline-delimiter">}</span></span><span class="delimiter">}</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">norep_chat2</span><span class="delimiter">&quot;</span></span>)

    <span class="keyword">for</span> _=<span class="integer">1</span>,<span class="integer">120</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>
    <span class="keyword">for</span> _=<span class="integer">1</span>,<span class="integer">60</span> * <span class="integer">6</span> * <span class="integer">10</span> <span class="keyword">do</span>
        Cron.tick(<span class="integer">1</span>)
        <span class="predefined">assert</span>.not_same(secondToLastChat, lastChat)
    <span class="keyword">end</span>
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-newnoise-works-in-a-complex-scenario" class="paragraph">
<p> <details><summary> 
Chatter:newNoise() works in a complex scenario
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">withUniverse(<span class="keyword">function</span>()
    <span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">player</span><span class="delimiter">&quot;</span></span>):setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
    <span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">ship</span><span class="delimiter">&quot;</span></span>):setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)
    <span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">station</span><span class="delimiter">&quot;</span></span>):setPosition(<span class="integer">0</span>, <span class="integer">1000</span>)
    <span class="keyword">local</span> <span class="local-variable">filterStation</span> = <span class="keyword">function</span>(thing) <span class="keyword">return</span> thing == station <span class="keyword">end</span>
    <span class="keyword">local</span> <span class="local-variable">filterShip</span> = <span class="keyword">function</span>(thing) <span class="keyword">return</span> thing == ship <span class="keyword">end</span>
    <span class="keyword">local</span> <span class="local-variable">filterShipOrStation</span> = <span class="keyword">function</span>(thing) <span class="keyword">return</span> filterStation(thing) <span class="keyword">or</span> filterShip(thing) <span class="keyword">end</span>

    <span class="comment">-- mock chatter to easily track which chats we have seen</span>
    <span class="keyword">local</span> <span class="local-variable">chat1</span> = <span class="map"><span class="delimiter">{</span> <span class="map"><span class="inline-delimiter">{</span>ship, <span class="string"><span class="delimiter">&quot;</span><span class="content">one</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span> <span class="delimiter">}</span></span>
    <span class="keyword">local</span> <span class="local-variable">chat2</span> = <span class="map"><span class="delimiter">{</span> <span class="map"><span class="inline-delimiter">{</span>station, <span class="string"><span class="delimiter">&quot;</span><span class="content">two</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span> <span class="delimiter">}</span></span>
    <span class="keyword">local</span> <span class="local-variable">chat3WithShip</span> = <span class="map"><span class="delimiter">{</span> <span class="map"><span class="inline-delimiter">{</span>ship, <span class="string"><span class="delimiter">&quot;</span><span class="content">three</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span> <span class="delimiter">}</span></span>
    <span class="keyword">local</span> <span class="local-variable">chat3WithStation</span> = <span class="map"><span class="delimiter">{</span> <span class="map"><span class="inline-delimiter">{</span>station, <span class="string"><span class="delimiter">&quot;</span><span class="content">three</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span> <span class="delimiter">}</span></span>
    <span class="keyword">local</span> <span class="local-variable">chat4</span> = <span class="map"><span class="delimiter">{</span> <span class="map"><span class="inline-delimiter">{</span>station, <span class="string"><span class="delimiter">&quot;</span><span class="content">four</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>, <span class="map"><span class="inline-delimiter">{</span>ship, <span class="string"><span class="delimiter">&quot;</span><span class="content">four</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span> <span class="delimiter">}</span></span>
    <span class="keyword">local</span> <span class="local-variable">chat5</span> = <span class="map"><span class="delimiter">{</span> <span class="map"><span class="inline-delimiter">{</span>ship, <span class="string"><span class="delimiter">&quot;</span><span class="content">five</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>, <span class="map"><span class="inline-delimiter">{</span>station, <span class="string"><span class="delimiter">&quot;</span><span class="content">five</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span> <span class="delimiter">}</span></span>

    <span class="keyword">local</span> <span class="local-variable">chat1Seen</span> = <span class="integer">0</span>
    <span class="keyword">local</span> <span class="local-variable">chat2Seen</span> = <span class="integer">0</span>
    <span class="keyword">local</span> <span class="local-variable">chat3SeenWithShip</span> = <span class="integer">0</span>
    <span class="keyword">local</span> <span class="local-variable">chat3SeenWithStation</span> = <span class="integer">0</span>
    <span class="keyword">local</span> <span class="local-variable">chat4Seen</span> = <span class="integer">0</span>
    <span class="keyword">local</span> <span class="local-variable">chat5Seen</span> = <span class="integer">0</span>
    <span class="keyword">local</span> <span class="local-variable">errorsSeen</span> = <span class="integer">0</span>
    <span class="keyword">local</span> <span class="local-variable">chatter</span> = mockChatter()
    chatter.converse = <span class="keyword">function</span>(_, conversation)
        <span class="keyword">local</span> <span class="local-variable">pretty</span> = require <span class="string"><span class="delimiter">'</span><span class="content">pl.pretty</span><span class="delimiter">'</span></span>

        <span class="keyword">if</span> conversation == chat1 <span class="keyword">then</span> chat1Seen = chat1Seen + <span class="integer">1</span>
        <span class="keyword">elseif</span> conversation == chat2 <span class="keyword">then</span> chat2Seen = chat2Seen + <span class="integer">1</span>
        <span class="keyword">elseif</span> conversation == chat3WithShip <span class="keyword">then</span> chat3SeenWithShip = chat3SeenWithShip + <span class="integer">1</span>
        <span class="keyword">elseif</span> conversation == chat3WithStation <span class="keyword">then</span> chat3SeenWithStation = chat3SeenWithStation + <span class="integer">1</span>
        <span class="keyword">elseif</span> conversation == chat4 <span class="keyword">then</span> chat4Seen = chat4Seen + <span class="integer">1</span>
        <span class="keyword">elseif</span> conversation == chat5 <span class="keyword">then</span> chat5Seen = chat5Seen + <span class="integer">1</span>
        <span class="keyword">else</span>
            errorsSeen = errorsSeen + <span class="integer">1</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
    <span class="predefined">assert</span>(Chatter:isChatter(chatter))

    <span class="keyword">local</span> <span class="local-variable">noise</span> = Chatter:newNoise(chatter)

    <span class="comment">-- chat for ship only</span>
    noise:addChatFactory(Chatter:newFactory(<span class="integer">1</span>,
        <span class="keyword">function</span>(one) <span class="keyword">if</span> one == ship <span class="keyword">then</span> <span class="keyword">return</span> chat1  <span class="keyword">end</span> <span class="keyword">end</span>, <span class="map"><span class="delimiter">{</span>
        <span class="key">filters</span> = <span class="map"><span class="inline-delimiter">{</span> filterShip <span class="inline-delimiter">}</span></span>
    <span class="delimiter">}</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">chat1</span><span class="delimiter">&quot;</span></span>)

    <span class="comment">-- chat for station only</span>
    noise:addChatFactory(Chatter:newFactory(<span class="integer">1</span>,
        <span class="keyword">function</span>(one) <span class="keyword">if</span> one == station <span class="keyword">then</span> <span class="keyword">return</span> chat2 <span class="keyword">end</span> <span class="keyword">end</span>, <span class="map"><span class="delimiter">{</span>
        <span class="key">filters</span> = <span class="map"><span class="inline-delimiter">{</span> filterStation <span class="inline-delimiter">}</span></span>
    <span class="delimiter">}</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">chat2</span><span class="delimiter">&quot;</span></span>)

    <span class="comment">-- chat for station or ship</span>
    noise:addChatFactory(Chatter:newFactory(<span class="integer">1</span>,
        <span class="keyword">function</span>(thisThing)
            <span class="keyword">if</span> thisThing == ship <span class="keyword">then</span>
                <span class="keyword">return</span> chat3WithShip
            <span class="keyword">elseif</span> thisThing == station <span class="keyword">then</span>
                <span class="keyword">return</span> chat3WithStation
            <span class="keyword">end</span>
        <span class="keyword">end</span>, <span class="map"><span class="delimiter">{</span>
        <span class="key">filters</span> = <span class="map"><span class="inline-delimiter">{</span> filterShipOrStation <span class="inline-delimiter">}</span></span>
    <span class="delimiter">}</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">chat3</span><span class="delimiter">&quot;</span></span>)

    <span class="comment">-- chat for station and ship</span>
    noise:addChatFactory(Chatter:newFactory(<span class="integer">2</span>,
        <span class="keyword">function</span>(one, two) <span class="keyword">if</span> one == station <span class="keyword">and</span> two == ship <span class="keyword">then</span> <span class="keyword">return</span> chat4 <span class="keyword">end</span> <span class="keyword">end</span>, <span class="map"><span class="delimiter">{</span>
        <span class="key">filters</span> = <span class="map"><span class="inline-delimiter">{</span> filterStation, filterShip <span class="inline-delimiter">}</span></span>
    <span class="delimiter">}</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">chat4</span><span class="delimiter">&quot;</span></span>)

    <span class="comment">-- chat for ship and station</span>
    noise:addChatFactory(Chatter:newFactory(<span class="integer">2</span>,
        <span class="keyword">function</span>(one, two) <span class="keyword">if</span> one == ship <span class="keyword">and</span> two == station <span class="keyword">then</span> <span class="keyword">return</span> chat5 <span class="keyword">end</span> <span class="keyword">end</span>, <span class="map"><span class="delimiter">{</span>
        <span class="key">filters</span> = <span class="map"><span class="inline-delimiter">{</span> filterShip, filterStation <span class="inline-delimiter">}</span></span>
    <span class="delimiter">}</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">chat5</span><span class="delimiter">&quot;</span></span>)

    <span class="keyword">for</span> _=<span class="integer">1</span>,<span class="integer">60</span> * <span class="integer">6</span> * <span class="integer">10</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>

    <span class="comment">-- a naive check to see if results are random</span>
    <span class="predefined">assert</span>.is_same(<span class="integer">0</span>, errorsSeen)
    <span class="predefined">assert</span>(chat1Seen &gt;= <span class="integer">2</span> <span class="keyword">and</span> chat1Seen &lt;= <span class="integer">25</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">chat1 should occur between 1 and 25 times. Got </span><span class="delimiter">&quot;</span></span> .. chat1Seen)
    <span class="predefined">assert</span>(chat2Seen &gt;= <span class="integer">2</span> <span class="keyword">and</span> chat2Seen &lt;= <span class="integer">25</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">chat2 should occur between 1 and 25 times. Got </span><span class="delimiter">&quot;</span></span> .. chat2Seen)
    <span class="predefined">assert</span>(chat3SeenWithShip &gt;= <span class="integer">1</span> <span class="keyword">and</span> chat3SeenWithShip &lt;= <span class="integer">12</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">chat3 should occur between 1 and 12 times with ship. Got </span><span class="delimiter">&quot;</span></span> .. chat3SeenWithShip)
    <span class="predefined">assert</span>(chat3SeenWithStation &gt;= <span class="integer">1</span> <span class="keyword">and</span> chat3SeenWithStation &lt;= <span class="integer">12</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">chat3 should occur between 1 and 12 times with station. Got </span><span class="delimiter">&quot;</span></span> .. chat3SeenWithStation)
    <span class="predefined">assert</span>(chat4Seen &gt;= <span class="integer">2</span> <span class="keyword">and</span> chat4Seen &lt;= <span class="integer">25</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">chat4 should occur between 1 and 25 times. Got </span><span class="delimiter">&quot;</span></span> .. chat4Seen)
    <span class="predefined">assert</span>(chat5Seen &gt;= <span class="integer">2</span> <span class="keyword">and</span> chat5Seen &lt;= <span class="integer">25</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">chat5 should occur between 1 and 25 times. Got </span><span class="delimiter">&quot;</span></span> .. chat5Seen)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-newnoise-works-with-a-chat-with-filters" class="paragraph">
<p> <details><summary> 
Chatter:newNoise() works with a chat with filters
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">withUniverse(<span class="keyword">function</span>()
    <span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">player</span><span class="delimiter">&quot;</span></span>):setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
    <span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">ship</span><span class="delimiter">&quot;</span></span>):setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)
    <span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">station</span><span class="delimiter">&quot;</span></span>):setPosition(<span class="integer">0</span>, <span class="integer">1000</span>)

    <span class="keyword">local</span> <span class="local-variable">chat</span> = Chatter:newFactory(<span class="integer">2</span>, <span class="keyword">function</span>(thisStation, thisShip)
        <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>
            <span class="map"><span class="inline-delimiter">{</span> thisStation, <span class="string"><span class="delimiter">&quot;</span><span class="content">Who are you?</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>,
            <span class="map"><span class="inline-delimiter">{</span> thisShip, <span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>,
        <span class="delimiter">}</span></span>
    <span class="keyword">end</span>, <span class="map"><span class="delimiter">{</span>
        <span class="key">filters</span> = <span class="map"><span class="inline-delimiter">{</span>
            <span class="keyword">function</span>(thing) <span class="keyword">return</span> isEeStation(thing) <span class="keyword">end</span>,
            <span class="keyword">function</span>(thing) <span class="keyword">return</span> isEeShip(thing) <span class="keyword">end</span>,
        <span class="inline-delimiter">}</span></span>,
    <span class="delimiter">}</span></span>)

    <span class="keyword">local</span> <span class="local-variable">chatter</span> = mockChatter()
    <span class="keyword">local</span> <span class="local-variable">noise</span> = Chatter:newNoise(chatter)
    noise:addChatFactory(chat)

    <span class="keyword">for</span> _=<span class="integer">1</span>,<span class="integer">90</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>

    <span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span>
        <span class="map"><span class="inline-delimiter">{</span>station, <span class="string"><span class="delimiter">&quot;</span><span class="content">Who are you?</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>,
        <span class="map"><span class="inline-delimiter">{</span>ship, <span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span>,
    <span class="delimiter">}</span></span>, chatter:getLastMessages())
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="chatter-newnoise-addchatfactory">Chatter:newNoise():addChatFactory()</h3>
<div id="chatter-newnoise-addchatfactory-allows-to-add-a-chat-and-returns-an-id" class="paragraph">
<p> <details><summary> 
Chatter:newNoise():addChatFactory() allows to add a chat and returns an id
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">chatter</span> = mockChatter()
<span class="keyword">local</span> <span class="local-variable">noise</span> = Chatter:newNoise(chatter)
<span class="keyword">local</span> <span class="local-variable">factory</span> = mockChatFactory()

<span class="keyword">local</span> <span class="local-variable">id</span> = noise:addChatFactory(factory)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">string</span><span class="delimiter">&quot;</span></span>, <span class="predefined">type</span>(id))
<span class="predefined">assert</span>.not_same(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>, id)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-newnoise-addchatfactory-fails-if-no-chat-is-given" class="paragraph">
<p> <details><summary> 
Chatter:newNoise():addChatFactory() fails if no chat is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">chatter</span> = mockChatter()
<span class="keyword">local</span> <span class="local-variable">noise</span> = Chatter:newNoise(chatter)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() noise:addChatFactory(<span class="predefined-constant">nil</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() noise:addChatFactory(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() noise:addChatFactory(<span class="integer">42</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() noise:addChatFactory(<span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-newnoise-addchatfactory-fails-if-the-given-id-is-not-a-non-empty-string" class="paragraph">
<p> <details><summary> 
Chatter:newNoise():addChatFactory() fails if the given id is not a non-empty string
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">chatter</span> = mockChatter()
<span class="keyword">local</span> <span class="local-variable">noise</span> = Chatter:newNoise(chatter)
<span class="keyword">local</span> <span class="local-variable">factory</span> = mockChatFactory()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() noise:addChatFactory(factory, <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() noise:addChatFactory(factory, <span class="integer">42</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() noise:addChatFactory(factory, <span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-newnoise-addchatfactory-uses-an-id-if-it-given" class="paragraph">
<p> <details><summary> 
Chatter:newNoise():addChatFactory() uses an id if it given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">chatter</span> = mockChatter()
<span class="keyword">local</span> <span class="local-variable">noise</span> = Chatter:newNoise(chatter)
<span class="keyword">local</span> <span class="local-variable">factory</span> = mockChatFactory()

<span class="keyword">local</span> <span class="local-variable">id</span> = noise:addChatFactory(factory, <span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>, id)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="chatter-newnoise-getchatfactories">Chatter:newNoise():getChatFactories()</h3>
<div id="chatter-newnoise-getchatfactories-allows-to-remove-all-chatfactories" class="paragraph">
<p> <details><summary> 
Chatter:newNoise():getChatFactories() allows to remove all ChatFactories
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">chatter</span> = mockChatter()
<span class="keyword">local</span> <span class="local-variable">noise</span> = Chatter:newNoise(chatter)
<span class="keyword">local</span> <span class="local-variable">chat1</span> = mockChatFactory()
<span class="keyword">local</span> <span class="local-variable">chat2</span> = mockChatFactory()
<span class="keyword">local</span> <span class="local-variable">chat3</span> = mockChatFactory()

noise:addChatFactory(chat1, <span class="string"><span class="delimiter">&quot;</span><span class="content">one</span><span class="delimiter">&quot;</span></span>)
noise:addChatFactory(chat2, <span class="string"><span class="delimiter">&quot;</span><span class="content">two</span><span class="delimiter">&quot;</span></span>)
noise:addChatFactory(chat3, <span class="string"><span class="delimiter">&quot;</span><span class="content">three</span><span class="delimiter">&quot;</span></span>)

<span class="keyword">for</span> id, _ <span class="keyword">in</span> <span class="predefined">pairs</span>(noise:getChatFactories()) <span class="keyword">do</span>
    noise:removeChatFactory(id)
<span class="keyword">end</span>

<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>, noise:getChatFactories())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-newnoise-getchatfactories-returns-all-chatfactories" class="paragraph">
<p> <details><summary> 
Chatter:newNoise():getChatFactories() returns all ChatFactories
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">chatter</span> = mockChatter()
<span class="keyword">local</span> <span class="local-variable">noise</span> = Chatter:newNoise(chatter)
<span class="keyword">local</span> <span class="local-variable">chat1</span> = mockChatFactory()
<span class="keyword">local</span> <span class="local-variable">chat2</span> = mockChatFactory()
<span class="keyword">local</span> <span class="local-variable">chat3</span> = mockChatFactory()

noise:addChatFactory(chat1, <span class="string"><span class="delimiter">&quot;</span><span class="content">one</span><span class="delimiter">&quot;</span></span>)
noise:addChatFactory(chat2, <span class="string"><span class="delimiter">&quot;</span><span class="content">two</span><span class="delimiter">&quot;</span></span>)
noise:addChatFactory(chat3, <span class="string"><span class="delimiter">&quot;</span><span class="content">three</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span>
    <span class="key">one</span> = chat1,
    <span class="key">two</span> = chat2,
    <span class="key">three</span> = chat3,
<span class="delimiter">}</span></span>, noise:getChatFactories())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="chatter-newnoise-removechatfactory">Chatter:newNoise():removeChatFactory()</h3>
<div id="chatter-newnoise-removechatfactory-allows-to-remove-a-chat" class="paragraph">
<p> <details><summary> 
Chatter:newNoise():removeChatFactory() allows to remove a chat
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">chatter</span> = mockChatter()
<span class="keyword">local</span> <span class="local-variable">noise</span> = Chatter:newNoise(chatter)
<span class="keyword">local</span> <span class="local-variable">factory</span> = mockChatFactory()

noise:addChatFactory(factory, <span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>)
noise:removeChatFactory(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-newnoise-removechatfactory-allows-to-remove-a-chat-when-it-has-not-been-set-before" class="paragraph">
<p> <details><summary> 
Chatter:newNoise():removeChatFactory() allows to remove a chat when it has not been set before
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">chatter</span> = mockChatter()
<span class="keyword">local</span> <span class="local-variable">noise</span> = Chatter:newNoise(chatter)

noise:removeChatFactory(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="chatter-newnoise-removechatfactory-fails-if-the-given-id-is-not-a-non-empty-string" class="paragraph">
<p> <details><summary> 
Chatter:newNoise():removeChatFactory() fails if the given id is not a non-empty string
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">chatter</span> = mockChatter()
<span class="keyword">local</span> <span class="local-variable">noise</span> = Chatter:newNoise(chatter)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() noise:removeChatFactory(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() noise:removeChatFactory(<span class="integer">42</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() noise:removeChatFactory(<span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="comms">Comms</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="comms-merchantfactory">Comms:merchantFactory()</h3>
<div id="comms-merchantfactory-fails-if-any-of-the-required-configs-is-missing" class="paragraph">
<p> <details><summary> 
Comms:merchantFactory() fails if any of the required configs is missing
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">for</span> k, _ <span class="keyword">in</span> <span class="predefined">pairs</span>(requiredConfig) <span class="keyword">do</span>
    <span class="keyword">local</span> <span class="local-variable">config</span> = Util.deepCopy(requiredConfig)
    config[k] = <span class="predefined-constant">nil</span>

    <span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Comms:merchantFactory(config) <span class="keyword">end</span>)
<span class="keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="comms-merchantfactory-should-create-a-valid-comms-newreply" class="paragraph">
<p> <details><summary> 
Comms:merchantFactory() should create a valid Comms:newReply
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">merchantComms</span> = Comms:merchantFactory(requiredConfig)

<span class="predefined">assert</span>.is_true(Comms:isReply(merchantComms))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="comms-missionbrokerfactory">Comms:missionBrokerFactory()</h3>
<div id="comms-missionbrokerfactory-fails-if-any-of-the-required-configs-is-missing" class="paragraph">
<p> <details><summary> 
Comms:missionBrokerFactory() fails if any of the required configs is missing
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">for</span> k, _ <span class="keyword">in</span> <span class="predefined">pairs</span>(requiredConfig) <span class="keyword">do</span>
    <span class="keyword">local</span> <span class="local-variable">config</span> = Util.deepCopy(requiredConfig)
    config[k] = <span class="predefined-constant">nil</span>

    <span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Comms:missionBrokerFactory(config) <span class="keyword">end</span>)
<span class="keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="comms-missionbrokerfactory-should-create-a-valid-comms-newreply" class="paragraph">
<p> <details><summary> 
Comms:missionBrokerFactory() should create a valid Comms:newReply
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">missionComms</span> = Comms:missionBrokerFactory(requiredConfig)

<span class="predefined">assert</span>.is_true(Comms:isReply(missionComms))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="comms-newreply">Comms:newReply()</h3>
<div id="comms-newreply-can-create-a-reply" class="paragraph">
<p> <details><summary> 
Comms:newReply() can create a reply
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">reply</span> = Comms:newReply(<span class="string"><span class="delimiter">&quot;</span><span class="content">Foobar</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="keyword">end</span>)

<span class="predefined">assert</span>.is_true(Comms:isReply(reply))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Foobar</span><span class="delimiter">&quot;</span></span>, reply:getWhatPlayerSays(station, player))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="comms-newreply-can-create-a-reply-condition-check" class="paragraph">
<p> <details><summary> 
Comms:newReply() can create a reply condition check
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">condition</span> = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="predefined-constant">true</span> <span class="keyword">end</span>
<span class="keyword">local</span> <span class="local-variable">reply</span> = Comms:newReply(<span class="string"><span class="delimiter">&quot;</span><span class="content">Foobar</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">nil</span>, condition)

<span class="predefined">assert</span>.is_true(Comms:isReply(reply))
<span class="predefined">assert</span>.is_true(reply:checkCondition(station, player))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="comms-newreply-can-create-a-reply-with-comms-screen-as-return" class="paragraph">
<p> <details><summary> 
Comms:newReply() can create a reply with comms screen as return
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">screen</span> = Comms:newScreen(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">reply</span> = Comms:newReply(<span class="string"><span class="delimiter">&quot;</span><span class="content">Foobar</span><span class="delimiter">&quot;</span></span>, screen)

<span class="predefined">assert</span>.is_true(Comms:isReply(reply))
<span class="predefined">assert</span>.is_same(screen, reply:getNextScreen(station, player))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="comms-newreply-can-create-a-reply-with-function-for-name-instead-of-string" class="paragraph">
<p> <details><summary> 
Comms:newReply() can create a reply with function for name instead of string
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">name</span> = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Foobar</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>
<span class="keyword">local</span> <span class="local-variable">reply</span> = Comms:newReply(name, <span class="keyword">function</span>() <span class="keyword">end</span>)

<span class="predefined">assert</span>.is_true(Comms:isReply(reply))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Foobar</span><span class="delimiter">&quot;</span></span>, reply:getWhatPlayerSays(station, player))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="comms-newreply-fails-if-first-argument-is-a-number" class="paragraph">
<p> <details><summary> 
Comms:newReply() fails if first argument is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Comms:newReply(<span class="integer">42</span>, <span class="keyword">function</span>() <span class="keyword">end</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="comms-newreply-fails-if-second-argument-is-a-number" class="paragraph">
<p> <details><summary> 
Comms:newReply() fails if second argument is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Comms:newReply(<span class="string"><span class="delimiter">&quot;</span><span class="content">Foobar</span><span class="delimiter">&quot;</span></span>, <span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="comms-newreply-fails-if-third-argument-is-a-number" class="paragraph">
<p> <details><summary> 
Comms:newReply() fails if third argument is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Comms:newReply(<span class="string"><span class="delimiter">&quot;</span><span class="content">Foobar</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">nil</span>, <span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="comms-newscreen">Comms:newScreen()</h3>
<div id="comms-newscreen-allows-to-add-replies" class="paragraph">
<p> <details><summary> 
Comms:newScreen() allows to add replies
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">screen</span> = Comms:newScreen(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
:addReply(Comms:newReply(<span class="string"><span class="delimiter">&quot;</span><span class="content">One</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="keyword">end</span>))
:addReply(Comms:newReply(<span class="string"><span class="delimiter">&quot;</span><span class="content">Two</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="keyword">end</span>))

<span class="predefined">assert</span>.is_true(Comms:isScreen(screen))
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, Util.size(screen:getHowPlayerCanReact(station, player)))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="comms-newscreen-can-create-a-comms-screen-that-it-validates" class="paragraph">
<p> <details><summary> 
Comms:newScreen() can create a comms screen that it validates
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">screen</span> = Comms:newScreen(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>, <span class="map"><span class="delimiter">{</span>
    Comms:newReply(<span class="string"><span class="delimiter">&quot;</span><span class="content">One</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="keyword">end</span>),
    Comms:newReply(<span class="string"><span class="delimiter">&quot;</span><span class="content">Two</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span> () <span class="keyword">end</span>),
<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_true(Comms:isScreen(screen))
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, Util.size(screen:getHowPlayerCanReact(station, player)))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cron">Cron</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="cron-adddelay">Cron:addDelay()</h3>
<div id="cron-adddelay-allows-to-override-the-delay-of-a-regular" class="paragraph">
<p> <details><summary> 
Cron:addDelay() allows to override the delay of a regular
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">Cron.regular(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="keyword">end</span>, <span class="integer">3</span>, <span class="integer">5</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">5</span>, Cron.getDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>))
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">4</span>, Cron.getDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>))
Cron.addDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>, <span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">5</span>, Cron.getDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>))
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, Cron.getDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>))
Cron.addDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>, <span class="integer">2</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">4</span>, Cron.getDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="cron-adddelay-allows-to-set-the-delay-when-using-once" class="paragraph">
<p> <details><summary> 
Cron:addDelay() allows to set the delay when using once()
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">Cron.once(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="keyword">end</span>, <span class="integer">5</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">5</span>, Cron.getDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>))
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">4</span>, Cron.getDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>))
Cron.addDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>, <span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">5</span>, Cron.getDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>))
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">4</span>, Cron.getDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>))
Cron.tick(<span class="integer">1</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="cron-adddelay-fails-silently-when-an-unknown-cron-is-set" class="paragraph">
<p> <details><summary> 
Cron:addDelay() fails silently when an unknown Cron is set
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">Cron.addDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">doesnotexist</span><span class="delimiter">&quot;</span></span>, <span class="integer">5</span>)
<span class="predefined">assert</span>.is_nil(Cron.getDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">doesnotexist</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="cron-getdelay">Cron:getDelay()</h3>
<div id="cron-getdelay-allows-to-get-the-delay-until-the-call-of-function-when-using-once" class="paragraph">
<p> <details><summary> 
Cron:getDelay() allows to get the delay until the call of function when using once()
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">Cron.once(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="keyword">end</span>, <span class="integer">5</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">5</span>, Cron.getDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>))
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">4</span>, Cron.getDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>))
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, Cron.getDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>))
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_nil(Cron.getDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="cron-getdelay-allows-to-get-the-delay-until-the-next-call-of-function-when-using-regular" class="paragraph">
<p> <details><summary> 
Cron:getDelay() allows to get the delay until the next call of function when using regular()
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">Cron.regular(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="keyword">end</span>, <span class="integer">3</span>, <span class="integer">5</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">5</span>, Cron.getDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>))
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">4</span>, Cron.getDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>))
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, Cron.getDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>))
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, Cron.getDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>))
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, Cron.getDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="cron-getdelay-returns-nil-for-an-undefined-cron" class="paragraph">
<p> <details><summary> 
Cron:getDelay() returns nil for an undefined cron
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_nil(Cron.getDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">doesnotexist</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="cron-now">Cron:now()</h3>
<div id="cron-now-gives-the-current-time" class="paragraph">
<p> <details><summary> 
Cron:now() gives the current time
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">now</span> = Cron.now()
<span class="predefined">assert</span>.is_true(isNumber(now))

Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, Cron.now() - now)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="cron-once">Cron:once()</h3>
<div id="cron-once-allows-to-remove-a-callback-by-calling-one-callback" class="paragraph">
<p> <details><summary> 
Cron:once() allows to remove a callback by calling one callback
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ids</span> = <span class="map"><span class="delimiter">{</span>
    <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>,
<span class="delimiter">}</span></span>
<span class="keyword">for</span> _, id <span class="keyword">in</span> <span class="predefined">pairs</span>(ids) <span class="keyword">do</span>
    Cron.once(id, <span class="keyword">function</span>()
        <span class="keyword">for</span> _, id <span class="keyword">in</span> <span class="predefined">pairs</span>(ids) <span class="keyword">do</span>
            Cron.abort(id)
        <span class="keyword">end</span>
    <span class="keyword">end</span>, <span class="integer">1</span>)
<span class="keyword">end</span>
<span class="predefined">assert</span>.not_has_error(<span class="keyword">function</span>()
    Cron.tick(<span class="integer">1</span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="cron-once-allows-to-replace-a-once-with-regular-on-call" class="paragraph">
<p> <details><summary> 
Cron:once() allows to replace a once with regular on call
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span> = <span class="integer">0</span>
Cron.once(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>()
    called = called + <span class="integer">1</span>
    Cron.regular(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>()
        called = called + <span class="integer">1</span>
    <span class="keyword">end</span>, <span class="integer">1</span>)
<span class="keyword">end</span>, <span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, called)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="cron-once-allows-to-set-a-new-callback-after-removing-the-current-one" class="paragraph">
<p> <details><summary> 
Cron:once() allows to set a new callback after removing the current one
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">i</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">fun</span>
fun = <span class="keyword">function</span>()
    i = i+<span class="integer">1</span>
    <span class="keyword">if</span> i &lt; <span class="integer">10</span> <span class="keyword">then</span> Cron.once(fun, <span class="integer">1</span>) <span class="keyword">end</span>
<span class="keyword">end</span>
Cron.once(fun, <span class="integer">1</span>)
<span class="predefined">assert</span>.not_has_error(<span class="keyword">function</span>()
    <span class="keyword">for</span> i=<span class="integer">1</span>,<span class="integer">10</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="cron-once-is-possible-to-remove-a-function-with-a-generated-name" class="paragraph">
<p> <details><summary> 
Cron:once() is possible to remove a function with a generated name
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">cronId</span> = Cron.once(<span class="keyword">function</span>() called = <span class="predefined-constant">true</span> <span class="keyword">end</span>, <span class="integer">5</span>)

<span class="predefined">assert</span>.is_false(called)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(called)

Cron.abort(cronId)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="cron-once-is-possible-to-remove-a-function-with-a-name" class="paragraph">
<p> <details><summary> 
Cron:once() is possible to remove a function with a name
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span> = <span class="predefined-constant">false</span>
Cron.once(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() called = <span class="predefined-constant">true</span> <span class="keyword">end</span>, <span class="integer">5</span>)

<span class="predefined">assert</span>.is_false(called)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(called)

Cron.abort(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="cron-once-will-call-a-function-after-a-certain-time" class="paragraph">
<p> <details><summary> 
Cron:once() will call a function after a certain time
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span> = <span class="predefined-constant">false</span>
Cron.once(<span class="keyword">function</span>() called = <span class="predefined-constant">true</span> <span class="keyword">end</span>, <span class="integer">5</span>)

<span class="predefined">assert</span>.is_false(called)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(called)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_true(called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="cron-once-will-call-a-function-with-a-name" class="paragraph">
<p> <details><summary> 
Cron:once() will call a function with a name
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span> = <span class="predefined-constant">false</span>
Cron.once(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() called = <span class="predefined-constant">true</span> <span class="keyword">end</span>, <span class="integer">5</span>)

<span class="predefined">assert</span>.is_false(called)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(called)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_true(called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="cron-once-will-call-the-function-only-once" class="paragraph">
<p> <details><summary> 
Cron:once() will call the function only once
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span> = <span class="integer">0</span>
Cron.once(<span class="keyword">function</span>() called = called + <span class="integer">1</span> <span class="keyword">end</span>, <span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="cron-once-will-get-the-elapsed-time-as-argument-to-the-function" class="paragraph">
<p> <details><summary> 
Cron:once() will get the elapsed time as argument to the function
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">calledArg</span> = <span class="predefined-constant">nil</span>
Cron.once(<span class="keyword">function</span>(_, arg)
    calledArg = arg
<span class="keyword">end</span>, <span class="integer">5</span>)

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="float">1.2</span>)
<span class="predefined">assert</span>.is_near(<span class="float">5.2</span>, calledArg, <span class="float">0.0001</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="cron-regular">Cron:regular()</h3>
<div id="cron-regular-a-function-can-be-stopped-from-outside" class="paragraph">
<p> <details><summary> 
Cron:regular() a function can be stopped from outside
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">cronId</span> = Cron.regular(<span class="keyword">function</span>() called = called + <span class="integer">1</span> <span class="keyword">end</span>, <span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)
Cron.abort(cronId)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="cron-regular-a-function-can-remove-itself" class="paragraph">
<p> <details><summary> 
Cron:regular() a function can remove itself
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span> = <span class="integer">0</span>
Cron.regular(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>()
    <span class="keyword">if</span> called &gt;= <span class="integer">3</span> <span class="keyword">then</span> Cron.abort(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>) <span class="keyword">else</span> called = called + <span class="integer">1</span> <span class="keyword">end</span>
<span class="keyword">end</span>, <span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, called)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, called)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, called)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="cron-regular-allows-the-callback-function-to-return-the-interval-for-the-next-try" class="paragraph">
<p> <details><summary> 
Cron:regular() allows the callback function to return the interval for the next try
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span> = <span class="integer">0</span>

Cron.regular(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>()
    called = called + <span class="integer">1</span>
    <span class="keyword">if</span> called == <span class="integer">2</span> <span class="keyword">then</span> <span class="keyword">return</span> <span class="integer">3</span> <span class="keyword">end</span>
<span class="keyword">end</span>, <span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)

Cron.tick(<span class="float">0.5</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, called)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, called)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, called)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, called)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">4</span>, called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="cron-regular-the-function-gets-its-generated-id-as-first-parameter" class="paragraph">
<p> <details><summary> 
Cron:regular() the function gets its generated id as first parameter
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">theFirstParameter</span>
Cron.regular(<span class="keyword">function</span>(cronId)
    theFirstParameter = cronId
<span class="keyword">end</span>, <span class="integer">1</span>)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.not_nil(theFirstParameter)
<span class="predefined">assert</span>.is_string(theFirstParameter)
<span class="predefined">assert</span>.not_same(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>, theFirstParameter)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="cron-regular-the-function-gets-its-id-as-first-parameter" class="paragraph">
<p> <details><summary> 
Cron:regular() the function gets its id as first parameter
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">theFirstParameter</span>
Cron.regular(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>(cronId)
    theFirstParameter = cronId
<span class="keyword">end</span>, <span class="integer">1</span>)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>, theFirstParameter)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="cron-regular-will-call-a-function-at-a-regular-interval" class="paragraph">
<p> <details><summary> 
Cron:regular() will call a function at a regular interval
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span> = <span class="integer">0</span>
Cron.regular(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() called = called + <span class="integer">1</span> <span class="keyword">end</span>, <span class="integer">2</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, called)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, called)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, called)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="cron-regular-will-call-a-function-at-a-regular-interval-with-delay" class="paragraph">
<p> <details><summary> 
Cron:regular() will call a function at a regular interval with delay
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span> = <span class="integer">0</span>
Cron.regular(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() called = called + <span class="integer">1</span> <span class="keyword">end</span>, <span class="integer">2</span>, <span class="integer">2</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, called)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, called)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="cron-regular-will-call-a-function-at-every-tick" class="paragraph">
<p> <details><summary> 
Cron:regular() will call a function at every tick
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span> = <span class="integer">0</span>
Cron.regular(<span class="keyword">function</span>() called = called + <span class="integer">1</span> <span class="keyword">end</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)
Cron.tick(<span class="integer">10</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, called)
Cron.tick(<span class="float">0.5</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, called)
Cron.tick(<span class="float">0.1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">4</span>, called)
Cron.tick(<span class="float">0.01</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">5</span>, called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="cron-regular-will-get-the-elapsed-time-as-argument-to-the-function" class="paragraph">
<p> <details><summary> 
Cron:regular() will get the elapsed time as argument to the function
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span>, <span class="local-variable">calledArg</span> = <span class="integer">0</span>, <span class="predefined-constant">nil</span>
Cron.regular(<span class="keyword">function</span>(_, arg)
    called = called + <span class="integer">1</span>
    calledArg = arg
<span class="keyword">end</span>, <span class="integer">1</span>, <span class="integer">1</span>)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, calledArg)
Cron.tick(<span class="float">1.2</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, called)
<span class="predefined">assert</span>.is_near(<span class="float">1.2</span>, calledArg, <span class="float">0.0001</span>)
Cron.tick(<span class="float">0.7</span>)
Cron.tick(<span class="float">0.7</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, called)
<span class="predefined">assert</span>.is_near(<span class="float">1.4</span>, calledArg, <span class="float">0.0001</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="cron-setdelay">Cron:setDelay()</h3>
<div id="cron-setdelay-allows-to-override-the-delay-of-a-regular" class="paragraph">
<p> <details><summary> 
Cron:setDelay() allows to override the delay of a regular
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">Cron.regular(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="keyword">end</span>, <span class="integer">3</span>, <span class="integer">5</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">5</span>, Cron.getDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>))
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">4</span>, Cron.getDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>))
Cron.setDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>, <span class="integer">5</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">5</span>, Cron.getDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>))
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, Cron.getDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>))
Cron.setDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>, <span class="integer">5</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">4</span>, Cron.getDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="cron-setdelay-allows-to-set-the-delay-when-using-once" class="paragraph">
<p> <details><summary> 
Cron:setDelay() allows to set the delay when using once()
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">Cron.once(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="keyword">end</span>, <span class="integer">5</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">5</span>, Cron.getDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>))
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">4</span>, Cron.getDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>))
Cron.setDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>, <span class="integer">5</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">5</span>, Cron.getDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>))
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">4</span>, Cron.getDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>))
Cron.tick(<span class="integer">1</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="cron-setdelay-fails-silently-when-an-unknown-cron-is-set" class="paragraph">
<p> <details><summary> 
Cron:setDelay() fails silently when an unknown Cron is set
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">Cron.setDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">doesnotexist</span><span class="delimiter">&quot;</span></span>, <span class="integer">5</span>)
<span class="predefined">assert</span>.is_nil(Cron.getDelay(<span class="string"><span class="delimiter">&quot;</span><span class="content">doesnotexist</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="eventhandler">EventHandler</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="eventhandler-new">EventHandler:new()</h3>
<div id="eventhandler-new-config-allowedevents-allows-to-register-and-fire-events-from-the-whitelist" class="paragraph">
<p> <details><summary> 
EventHandler:new() config.allowedEvents allows to register and fire events from the whitelist
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">eh</span> = EventHandler:new(<span class="map"><span class="delimiter">{</span><span class="key">allowedEvents</span> = <span class="map"><span class="inline-delimiter">{</span><span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span><span class="delimiter">}</span></span>)
eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="keyword">end</span>)
eh:fire(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="eventhandler-new-config-allowedevents-fails-if-a-different-event-is-registered" class="paragraph">
<p> <details><summary> 
EventHandler:new() config.allowedEvents fails if a different event is registered
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">eh</span> = EventHandler:new(<span class="map"><span class="delimiter">{</span><span class="key">allowedEvents</span> = <span class="map"><span class="inline-delimiter">{</span><span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span><span class="delimiter">}</span></span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="keyword">end</span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="eventhandler-new-config-allowedevents-fails-if-the-config-does-not-contain-a-table" class="paragraph">
<p> <details><summary> 
EventHandler:new() config.allowedEvents fails if the config does not contain a table
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    EventHandler:new(<span class="map"><span class="delimiter">{</span><span class="key">allowedEvents</span> = <span class="integer">42</span><span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="eventhandler-new-config-allowedevents-fails-if-the-config-does-not-contain-strings" class="paragraph">
<p> <details><summary> 
EventHandler:new() config.allowedEvents fails if the config does not contain strings
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    EventHandler:new(<span class="map"><span class="delimiter">{</span><span class="key">allowedEvents</span> = <span class="map"><span class="inline-delimiter">{</span><span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, <span class="integer">42</span><span class="inline-delimiter">}</span></span><span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="eventhandler-new-fails-if-config-is-not-a-table" class="paragraph">
<p> <details><summary> 
EventHandler:new() fails if config is not a table
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    EventHandler:new(<span class="integer">42</span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="eventhandler-new-fire">EventHandler:new():fire()</h3>
<div id="eventhandler-new-fire-allows-subsequent-listener-to-modify-the-argument" class="paragraph">
<p> <details><summary> 
EventHandler:new():fire() allows subsequent listener to modify the argument
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">secret</span> = <span class="map"><span class="delimiter">{</span><span class="key">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>

<span class="keyword">local</span> <span class="local-variable">eh</span> = EventHandler:new()

eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>(self, argument) argument.name = argument.name .. <span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>)
eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>(self, argument) argument.name = argument.name .. <span class="string"><span class="delimiter">&quot;</span><span class="content">b</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>)
eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>(self, argument) argument.name = argument.name .. <span class="string"><span class="delimiter">&quot;</span><span class="content">c</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>)

eh:fire(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, secret)

<span class="predefined">assert</span>.is.equal(<span class="string"><span class="delimiter">&quot;</span><span class="content">abc</span><span class="delimiter">&quot;</span></span>, secret.name)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="eventhandler-new-fire-calls-all-listeners-even-if-one-raises-an-error" class="paragraph">
<p> <details><summary> 
EventHandler:new():fire() calls all listeners even if one raises an error
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">eh</span> = EventHandler:new()

eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="predefined">error</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">boom</span><span class="delimiter">&quot;</span></span>) <span class="keyword">end</span>)
eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() called = <span class="predefined-constant">true</span> <span class="keyword">end</span>)

eh:fire(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.is_true(called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="eventhandler-new-fire-calls-the-listeners-in-the-order-they-where-registered" class="paragraph">
<p> <details><summary> 
EventHandler:new():fire() calls the listeners in the order they where registered
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">result</span> = <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
<span class="keyword">local</span> <span class="local-variable">eh</span> = EventHandler:new()

eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() result = result .. <span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>)
eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() result = result .. <span class="string"><span class="delimiter">&quot;</span><span class="content">b</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>)
eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() result = result .. <span class="string"><span class="delimiter">&quot;</span><span class="content">c</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>)

eh:fire(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is.equal(<span class="string"><span class="delimiter">&quot;</span><span class="content">abc</span><span class="delimiter">&quot;</span></span>, result)

eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() result = result .. <span class="string"><span class="delimiter">&quot;</span><span class="content">d</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>)
eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() result = result .. <span class="string"><span class="delimiter">&quot;</span><span class="content">e</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>)
eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() result = result .. <span class="string"><span class="delimiter">&quot;</span><span class="content">f</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>)

result = <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
eh:fire(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is.equal(<span class="string"><span class="delimiter">&quot;</span><span class="content">abcdef</span><span class="delimiter">&quot;</span></span>, result)

eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() result = result .. <span class="string"><span class="delimiter">&quot;</span><span class="content">g</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>)
eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() result = result .. <span class="string"><span class="delimiter">&quot;</span><span class="content">h</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>)
eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() result = result .. <span class="string"><span class="delimiter">&quot;</span><span class="content">i</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>)

result = <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
eh:fire(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is.equal(<span class="string"><span class="delimiter">&quot;</span><span class="content">abcdefghi</span><span class="delimiter">&quot;</span></span>, result)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="eventhandler-new-fire-does-not-call-an-event-twice-if-unique-is-set" class="paragraph">
<p> <details><summary> 
EventHandler:new():fire() does not call an event twice if "unique" is set
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">eh</span> = EventHandler:new(<span class="map"><span class="delimiter">{</span>
    <span class="key">unique</span> = <span class="predefined-constant">true</span>,
<span class="delimiter">}</span></span>)

eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() called = called + <span class="integer">1</span> <span class="keyword">end</span>)

eh:fire(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)
eh:fire(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="eventhandler-new-fire-fails-if-eventname-is-not-a-string" class="paragraph">
<p> <details><summary> 
EventHandler:new():fire() fails if eventName is not a string
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    EventHandler:new():fire(<span class="integer">42</span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="eventhandler-new-fire-fails-if-no-eventname-is-given" class="paragraph">
<p> <details><summary> 
EventHandler:new():fire() fails if no eventName is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    EventHandler:new():fire()
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="eventhandler-new-fire-gives-an-additional-argument-to-the-listeners" class="paragraph">
<p> <details><summary> 
EventHandler:new():fire() gives an additional argument to the listeners
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">secret</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>
<span class="keyword">local</span> <span class="local-variable">gottenArgument</span>
<span class="keyword">local</span> <span class="local-variable">eh</span> = EventHandler:new()

eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>(self, argument) gottenArgument = argument <span class="keyword">end</span>)
eh:fire(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, secret)

<span class="predefined">assert</span>.is.equal(secret, gottenArgument)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="eventhandler-new-fire-passes-if-no-event-is-registered" class="paragraph">
<p> <details><summary> 
EventHandler:new():fire() passes if no event is registered
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">EventHandler:new():fire(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="eventhandler-new-register">EventHandler:new():register()</h3>
<div id="eventhandler-new-register-allow-to-register-a-listener" class="paragraph">
<p> <details><summary> 
EventHandler:new():register() allow to register a listener
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">eh</span> = EventHandler:new()
eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() called = called + <span class="integer">1</span> <span class="keyword">end</span>)

eh:fire(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is.equal(<span class="integer">1</span>, called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="eventhandler-new-register-allow-to-register-multiple-listeners-to-the-event" class="paragraph">
<p> <details><summary> 
EventHandler:new():register() allow to register multiple listeners to the event
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">eh</span> = EventHandler:new()

eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() called = called + <span class="integer">1</span> <span class="keyword">end</span>)
eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() called = called + <span class="integer">2</span> <span class="keyword">end</span>)

eh:fire(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is.equal(<span class="integer">3</span>, called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="eventhandler-new-register-allows-to-set-priority-of-events" class="paragraph">
<p> <details><summary> 
EventHandler:new():register() allows to set priority of events
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">result</span> = <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
<span class="keyword">local</span> <span class="local-variable">eh</span> = EventHandler:new()

eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() result = result .. <span class="string"><span class="delimiter">&quot;</span><span class="content">b</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>, <span class="integer">20</span>)
eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() result = result .. <span class="string"><span class="delimiter">&quot;</span><span class="content">c</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>, <span class="integer">30</span>)
eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() result = result .. <span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>, <span class="integer">10</span>)

eh:fire(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is.equal(<span class="string"><span class="delimiter">&quot;</span><span class="content">abc</span><span class="delimiter">&quot;</span></span>, result)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="eventhandler-new-register-can-handle-a-mix-of-priorities-and-registration-order" class="paragraph">
<p> <details><summary> 
EventHandler:new():register() can handle a mix of priorities and registration order
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">result</span> = <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
<span class="keyword">local</span> <span class="local-variable">eh</span> = EventHandler:new()

eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() result = result .. <span class="string"><span class="delimiter">&quot;</span><span class="content">c</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>)
eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() result = result .. <span class="string"><span class="delimiter">&quot;</span><span class="content">g</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>, <span class="integer">50</span>)
eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() result = result .. <span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>, <span class="integer">-10</span>)
eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() result = result .. <span class="string"><span class="delimiter">&quot;</span><span class="content">h</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>, <span class="integer">50</span>)
eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() result = result .. <span class="string"><span class="delimiter">&quot;</span><span class="content">d</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>)
eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() result = result .. <span class="string"><span class="delimiter">&quot;</span><span class="content">b</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>, <span class="integer">-10</span>)
eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() result = result .. <span class="string"><span class="delimiter">&quot;</span><span class="content">f</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>, <span class="integer">20</span>)
eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() result = result .. <span class="string"><span class="delimiter">&quot;</span><span class="content">e</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>)

eh:fire(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is.equal(<span class="string"><span class="delimiter">&quot;</span><span class="content">abcdefgh</span><span class="delimiter">&quot;</span></span>, result)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="eventhandler-new-register-default-priority-is-0" class="paragraph">
<p> <details><summary> 
EventHandler:new():register() default priority is 0
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">result</span> = <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
<span class="keyword">local</span> <span class="local-variable">eh</span> = EventHandler:new()

eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() result = result .. <span class="string"><span class="delimiter">&quot;</span><span class="content">b</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>)
eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() result = result .. <span class="string"><span class="delimiter">&quot;</span><span class="content">c</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>, <span class="integer">10</span>)
eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() result = result .. <span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>, <span class="integer">-10</span>)

eh:fire(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is.equal(<span class="string"><span class="delimiter">&quot;</span><span class="content">abc</span><span class="delimiter">&quot;</span></span>, result)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="eventhandler-new-register-fails-if-eventname-is-not-a-string" class="paragraph">
<p> <details><summary> 
EventHandler:new():register() fails if eventName is not a string
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">eh</span> = EventHandler:new()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    eh:register(<span class="integer">42</span>, <span class="keyword">function</span>() <span class="keyword">end</span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="eventhandler-new-register-fails-if-eventname-is-not-given" class="paragraph">
<p> <details><summary> 
EventHandler:new():register() fails if eventName is not given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">eh</span> = EventHandler:new()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    eh:register()
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="eventhandler-new-register-fails-if-handler-is-not-a-function" class="paragraph">
<p> <details><summary> 
EventHandler:new():register() fails if handler is not a function
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">eh</span> = EventHandler:new()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">invalid</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="eventhandler-new-register-fails-if-handler-is-not-given" class="paragraph">
<p> <details><summary> 
EventHandler:new():register() fails if handler is not given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">eh</span> = EventHandler:new()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="eventhandler-new-register-fails-if-priority-is-not-a-number" class="paragraph">
<p> <details><summary> 
EventHandler:new():register() fails if priority is not a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">eh</span> = EventHandler:new()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="keyword">end</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="eventhandler-new-register-issues-a-warning-if-an-event-listener-is-added-for-an-event-that-has-already-been-fired-and-config-unique-is-set" class="paragraph">
<p> <details><summary> 
EventHandler:new():register() issues a warning if an event listener is added for an event that has already been fired and config.unique is set
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">withLogCatcher(<span class="keyword">function</span>(logs)
    <span class="keyword">local</span> <span class="local-variable">eh</span> = EventHandler:new(<span class="map"><span class="delimiter">{</span>
        <span class="key">unique</span> = <span class="predefined-constant">true</span>,
    <span class="delimiter">}</span></span>)

    eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="keyword">end</span>)

    eh:fire(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>)
    <span class="predefined">assert</span>.is_nil(logs:popLastWarning())

    eh:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="keyword">end</span>)
    <span class="predefined">assert</span>.is_not_nil(logs:popLastWarning())
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fleet">Fleet</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="fleet-new">Fleet:new()</h3>
<div id="fleet-new-gm-can-issue-an-order-to-a-wingman-that-is-not-changed-if-the-leader-is-killed" class="paragraph">
<p> <details><summary> 
Fleet:new() GM can issue an order to a wingman that is not changed if the leader is killed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship3</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship4</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship5</span> = CpuShip()

Fleet:new(<span class="map"><span class="delimiter">{</span>ship1, ship2, ship3, ship4, ship5<span class="delimiter">}</span></span>)

ship5:orderDefendLocation(<span class="integer">42</span>, <span class="integer">4200</span>)

Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Defend Location</span><span class="delimiter">&quot;</span></span>, ship5:getOrder())
ship1:destroy()

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Defend Location</span><span class="delimiter">&quot;</span></span>, ship5:getOrder())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="fleet-new-gm-can-issue-new-orders-to-fleet-leader-and-are-carried-out-if-fleet-leader-is-killed" class="paragraph">
<p> <details><summary> 
Fleet:new() GM can issue new orders to fleet leader and are carried out if fleet leader is killed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship3</span> = CpuShip()

Fleet:new(<span class="map"><span class="delimiter">{</span>ship1, ship2, ship3<span class="delimiter">}</span></span>)

ship1:orderDefendLocation(<span class="integer">42</span>, <span class="integer">4200</span>)

Cron.tick(<span class="integer">1</span>)

ship1:destroy()

Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Defend Location</span><span class="delimiter">&quot;</span></span>, ship2:getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">42</span>, ship2:getOrderTargetLocationX())
<span class="predefined">assert</span>.is_same(<span class="integer">4200</span>, ship2:getOrderTargetLocationY())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship3:getOrder())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="fleet-new-gm-can-reintegrate-a-wingman-by-setting-order-to-idle-or-roaming" class="paragraph">
<p> <details><summary> 
Fleet:new() GM can reintegrate a wingman by setting order to Idle or Roaming
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship3</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship4</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship5</span> = CpuShip()

Fleet:new(<span class="map"><span class="delimiter">{</span>ship1, ship2, ship3, ship4, ship5<span class="delimiter">}</span></span>)

ship4:orderDefendLocation(<span class="integer">42</span>, <span class="integer">4200</span>)
ship5:orderDefendLocation(<span class="integer">42</span>, <span class="integer">4200</span>)

Cron.tick(<span class="integer">1</span>)

ship4:orderIdle()
ship5:orderRoaming()

Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship4:getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">-1400</span>, ship4:getOrderTargetLocationY())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, ship4:getOrderTargetLocationX())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship5:getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">1400</span>, ship5:getOrderTargetLocationY())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, ship5:getOrderTargetLocationX())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="fleet-new-allows-to-give-config" class="paragraph">
<p> <details><summary> 
Fleet:new() allows to give config
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>ship<span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span><span class="key">id</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_true(Fleet:isFleet(fleet))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="fleet-new-circle-formation-fills-gaps-when-the-leader-is-killed-and-the-highest-ranking-ship-is-left" class="paragraph">
<p> <details><summary> 
Fleet:new() circle formation fills gaps when the leader is killed and the highest ranking ship is left
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship3</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship4</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship5</span> = CpuShip()

Fleet:new(<span class="map"><span class="delimiter">{</span>ship1, ship2, ship3, ship4, ship5<span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span><span class="key">formation</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">circle</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)

ship1:destroy()

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship3:getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">354</span>, Util.round(ship3:getOrderTargetLocationY()))
<span class="predefined">assert</span>.is_same(<span class="integer">-354</span>, Util.round(ship3:getOrderTargetLocationX()))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship4:getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">-354</span>, Util.round(ship4:getOrderTargetLocationY()))
<span class="predefined">assert</span>.is_same(<span class="integer">-354</span>, Util.round(ship4:getOrderTargetLocationX()))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship5:getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">-354</span>, Util.round(ship5:getOrderTargetLocationY()))
<span class="predefined">assert</span>.is_same(<span class="integer">354</span>, Util.round(ship5:getOrderTargetLocationX()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="fleet-new-circle-formation-keep-position-when-a-wingman-is-destroyed" class="paragraph">
<p> <details><summary> 
Fleet:new() circle formation keep position when a wingman is destroyed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship3</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship4</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship5</span> = CpuShip()

Fleet:new(<span class="map"><span class="delimiter">{</span>ship1, ship2, ship3, ship4, ship5<span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span><span class="key">formation</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">circle</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)

ship3:destroy()

Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship2:getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">354</span>, Util.round(ship2:getOrderTargetLocationY()))
<span class="predefined">assert</span>.is_same(<span class="integer">354</span>, Util.round(ship2:getOrderTargetLocationX()))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship3:getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">354</span>, Util.round(ship3:getOrderTargetLocationY()))
<span class="predefined">assert</span>.is_same(<span class="integer">-354</span>, Util.round(ship3:getOrderTargetLocationX()))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship4:getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">-354</span>, Util.round(ship4:getOrderTargetLocationY()))
<span class="predefined">assert</span>.is_same(<span class="integer">-354</span>, Util.round(ship4:getOrderTargetLocationX()))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship5:getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">-354</span>, Util.round(ship5:getOrderTargetLocationY()))
<span class="predefined">assert</span>.is_same(<span class="integer">354</span>, Util.round(ship5:getOrderTargetLocationX()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="fleet-new-circle-formation-lets-them-fly-around-the-leader" class="paragraph">
<p> <details><summary> 
Fleet:new() circle formation lets them fly around the leader
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship3</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship4</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship5</span> = CpuShip()

Fleet:new(<span class="map"><span class="delimiter">{</span>ship1, ship2, ship3, ship4, ship5<span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span><span class="key">formation</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">circle</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship2:getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">354</span>, Util.round(ship2:getOrderTargetLocationY()))
<span class="predefined">assert</span>.is_same(<span class="integer">354</span>, Util.round(ship2:getOrderTargetLocationX()))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship3:getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">354</span>, Util.round(ship3:getOrderTargetLocationY()))
<span class="predefined">assert</span>.is_same(<span class="integer">-354</span>, Util.round(ship3:getOrderTargetLocationX()))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship4:getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">-354</span>, Util.round(ship4:getOrderTargetLocationY()))
<span class="predefined">assert</span>.is_same(<span class="integer">-354</span>, Util.round(ship4:getOrderTargetLocationX()))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship5:getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">-354</span>, Util.round(ship5:getOrderTargetLocationY()))
<span class="predefined">assert</span>.is_same(<span class="integer">354</span>, Util.round(ship5:getOrderTargetLocationX()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="fleet-new-creates-a-valid-fleet" class="paragraph">
<p> <details><summary> 
Fleet:new() creates a valid fleet
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>CpuShip(), CpuShip()<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_true(Fleet:isFleet(fleet))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="fleet-new-does-not-allow-to-add-ships-that-are-already-in-a-fleet" class="paragraph">
<p> <details><summary> 
Fleet:new() does not allow to add ships that are already in a fleet
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Fleet:new(<span class="map"><span class="delimiter">{</span>ship<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Fleet:new(<span class="map"><span class="delimiter">{</span>ship<span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="fleet-new-fails-if-a-station-is-given" class="paragraph">
<p> <details><summary> 
Fleet:new() fails if a station is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Fleet:new(<span class="map"><span class="delimiter">{</span>CpuShip(), SpaceStation()<span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="fleet-new-fails-if-id-is-not-a-string" class="paragraph">
<p> <details><summary> 
Fleet:new() fails if id is not a string
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Fleet:new(<span class="map"><span class="delimiter">{</span>ship<span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span><span class="key">id</span> = <span class="integer">42</span><span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="fleet-new-fails-if-the-config-is-not-a-table" class="paragraph">
<p> <details><summary> 
Fleet:new() fails if the config is not a table
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Fleet:new(<span class="map"><span class="delimiter">{</span>ship<span class="delimiter">}</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">This breaks</span><span class="delimiter">&quot;</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="fleet-new-fails-silently-when-fleet-is-invalid" class="paragraph">
<p> <details><summary> 
Fleet:new() fails silently when fleet is invalid
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship1</span> = CpuShip()

<span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>ship1<span class="delimiter">}</span></span>)

ship1:destroy()

fleet:orderRoaming()</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="fleet-new-gives-all-ships-the-fleet-trait" class="paragraph">
<p> <details><summary> 
Fleet:new() gives all ships the fleet trait
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship2</span> = CpuShip()
Fleet:new(<span class="map"><span class="delimiter">{</span>ship1, ship2<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_true(Ship:hasFleet(ship1))
<span class="predefined">assert</span>.is_true(Ship:hasFleet(ship2))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="fleet-new-issues-complex-orders-to-fleet-leader" class="paragraph">
<p> <details><summary> 
Fleet:new() issues complex orders to fleet leader
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship3</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

<span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>ship1, ship2, ship3<span class="delimiter">}</span></span>)

fleet:orderDefendTarget(station)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Defend Target</span><span class="delimiter">&quot;</span></span>, ship1:getOrder())
<span class="predefined">assert</span>.is_same(station, ship1:getOrderTarget())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship2:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship3:getOrder())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="fleet-new-issues-orders-to-fleet-leader" class="paragraph">
<p> <details><summary> 
Fleet:new() issues orders to fleet leader
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship3</span> = CpuShip()

<span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>ship1, ship2, ship3<span class="delimiter">}</span></span>)

fleet:orderRoaming()

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Roaming</span><span class="delimiter">&quot;</span></span>, ship1:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship2:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship3:getOrder())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="fleet-new-orders-all-ships-to-fly-in-formation" class="paragraph">
<p> <details><summary> 
Fleet:new() orders all ships to fly in formation
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship3</span> = CpuShip()

Fleet:new(<span class="map"><span class="delimiter">{</span>ship1, ship2, ship3<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship2:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship3:getOrder())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="fleet-new-row-formation-fills-gaps-when-a-wingman-is-killed" class="paragraph">
<p> <details><summary> 
Fleet:new() row formation fills gaps when a wingman is killed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship3</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship4</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship5</span> = CpuShip()

Fleet:new(<span class="map"><span class="delimiter">{</span>ship1, ship2, ship3, ship4, ship5<span class="delimiter">}</span></span>)

ship3:destroy()

Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship2:getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">-700</span>, ship2:getOrderTargetLocationY())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, ship2:getOrderTargetLocationX())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship4:getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">-1400</span>, ship4:getOrderTargetLocationY())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, ship4:getOrderTargetLocationX())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship5:getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">700</span>, ship5:getOrderTargetLocationY())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, ship5:getOrderTargetLocationX())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="fleet-new-row-formation-fills-gaps-when-the-leader-is-killed-and-the-highest-ranking-ship-is-left" class="paragraph">
<p> <details><summary> 
Fleet:new() row formation fills gaps when the leader is killed and the highest ranking ship is left
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship3</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship4</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship5</span> = CpuShip()

Fleet:new(<span class="map"><span class="delimiter">{</span>ship1, ship2, ship3, ship4, ship5<span class="delimiter">}</span></span>)

ship1:destroy()

Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship3:getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">700</span>, ship3:getOrderTargetLocationY())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, ship3:getOrderTargetLocationX())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship4:getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">-700</span>, ship4:getOrderTargetLocationY())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, ship4:getOrderTargetLocationX())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship5:getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">1400</span>, ship5:getOrderTargetLocationY())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, ship5:getOrderTargetLocationX())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="fleet-new-row-formation-fills-gaps-when-the-leader-is-killed-and-the-highest-ranking-ship-is-right" class="paragraph">
<p> <details><summary> 
Fleet:new() row formation fills gaps when the leader is killed and the highest ranking ship is right
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship3</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship4</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship5</span> = CpuShip()

Fleet:new(<span class="map"><span class="delimiter">{</span>ship1, ship2, ship3, ship4, ship5<span class="delimiter">}</span></span>)

ship2:destroy()
ship1:destroy()

Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship4:getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">-700</span>, ship4:getOrderTargetLocationY())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, ship4:getOrderTargetLocationX())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship5:getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">700</span>, ship5:getOrderTargetLocationY())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, ship5:getOrderTargetLocationX())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="fleet-new-row-formation-lets-them-fly-in-a-nuke-friendly-formation" class="paragraph">
<p> <details><summary> 
Fleet:new() row formation lets them fly in a nuke-friendly formation
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship3</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship4</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship5</span> = CpuShip()

Fleet:new(<span class="map"><span class="delimiter">{</span>ship1, ship2, ship3, ship4, ship5<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship2:getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">-700</span>, ship2:getOrderTargetLocationY())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, ship2:getOrderTargetLocationX())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship3:getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">700</span>, ship3:getOrderTargetLocationY())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, ship3:getOrderTargetLocationX())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship4:getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">-1400</span>, ship4:getOrderTargetLocationY())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, ship4:getOrderTargetLocationX())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship5:getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">1400</span>, ship5:getOrderTargetLocationY())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, ship5:getOrderTargetLocationX())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="fleet-new-transfers-the-order-if-the-leader-is-killed" class="paragraph">
<p> <details><summary> 
Fleet:new() transfers the order if the leader is killed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship3</span> = CpuShip()

<span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>ship1, ship2, ship3<span class="delimiter">}</span></span>)

fleet:orderRoaming()
ship1:destroy()

Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Roaming</span><span class="delimiter">&quot;</span></span>, ship2:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship3:getOrder())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="fleet-new-countships">Fleet:new():countShips()</h3>
<div id="fleet-new-countships-counts-all-valid-ships" class="paragraph">
<p> <details><summary> 
Fleet:new():countShips() counts all valid ships
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship3</span> = CpuShip()

<span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>ship1, ship2, ship3<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, fleet:countShips())

ship1:destroy()
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, fleet:countShips())
ship3:destroy()
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, fleet:countShips())
ship2:destroy()
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, fleet:countShips())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="fleet-new-getid">Fleet:new():getId()</h3>
<div id="fleet-new-getid-generates-an-id-if-none-is-given" class="paragraph">
<p> <details><summary> 
Fleet:new():getId() generates an id if none is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>ship<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_true(isString(fleet:getId()))
<span class="predefined">assert</span>.is_not_same(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>, fleet:getId())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="fleet-new-getid-returns-the-given-id" class="paragraph">
<p> <details><summary> 
Fleet:new():getId() returns the given id
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>ship<span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span><span class="key">id</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>, fleet:getId())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="fleet-new-getleader">Fleet:new():getLeader()</h3>
<div id="fleet-new-getleader-returns-the-highest-ranking-valid-ship" class="paragraph">
<p> <details><summary> 
Fleet:new():getLeader() returns the highest ranking valid ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship3</span> = CpuShip()

<span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>ship1, ship2, ship3<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(ship1, fleet:getLeader())

ship1:destroy()
<span class="predefined">assert</span>.is_same(ship2, fleet:getLeader())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="fleet-new-getships">Fleet:new():getShips()</h3>
<div id="fleet-new-getships-does-not-allow-to-manipulate-the-result" class="paragraph">
<p> <details><summary> 
Fleet:new():getShips() does not allow to manipulate the result
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>ship<span class="delimiter">}</span></span>)

<span class="keyword">local</span> <span class="local-variable">ships</span> = fleet:getShips()
table.insert(ships, CpuShip())

<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span>ship<span class="delimiter">}</span></span>, fleet:getShips())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="fleet-new-getships-returns-all-valid-ships" class="paragraph">
<p> <details><summary> 
Fleet:new():getShips() returns all valid ships
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship3</span> = CpuShip()

<span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>ship1, ship2, ship3<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.contains_value(ship1, fleet:getShips())
<span class="predefined">assert</span>.contains_value(ship2, fleet:getShips())
<span class="predefined">assert</span>.contains_value(ship3, fleet:getShips())

ship1:destroy()
<span class="predefined">assert</span>.not_contains_value(ship1, fleet:getShips())
<span class="predefined">assert</span>.contains_value(ship2, fleet:getShips())
<span class="predefined">assert</span>.contains_value(ship3, fleet:getShips())

ship2:destroy()
<span class="predefined">assert</span>.not_contains_value(ship1, fleet:getShips())
<span class="predefined">assert</span>.not_contains_value(ship2, fleet:getShips())
<span class="predefined">assert</span>.contains_value(ship3, fleet:getShips())

ship3:destroy()
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>, fleet:getShips())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="fleet-new-isvalid">Fleet:new():isValid()</h3>
<div id="fleet-new-isvalid-it-returns-true-as-long-as-there-are-valid-ships" class="paragraph">
<p> <details><summary> 
Fleet:new():isValid() it returns true as long as there are valid ships
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship3</span> = CpuShip()

<span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>ship1, ship2, ship3<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_true(fleet:isValid())
ship1:destroy()
<span class="predefined">assert</span>.is_true(fleet:isValid())
ship2:destroy()
<span class="predefined">assert</span>.is_true(fleet:isValid())
ship3:destroy()
<span class="predefined">assert</span>.is_false(fleet:isValid())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="fleet-withorderqueue">Fleet:withOrderQueue()</h3>
<div id="fleet-withorderqueue-fails-if-parameter-is-not-a-fleet" class="paragraph">
<p> <details><summary> 
Fleet:withOrderQueue() fails if parameter is not a fleet
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Fleet:withOrderQueue()
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Fleet:withOrderQueue(<span class="integer">42</span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Fleet:withOrderQueue(SpaceStation())
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Fleet:withOrderQueue(CpuShip())
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="fleet-withorderqueue-should-create-a-fleet-with-order-queue" class="paragraph">
<p> <details><summary> 
Fleet:withOrderQueue() should create a fleet with order queue
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>CpuShip(), CpuShip(), CpuShip()<span class="delimiter">}</span></span>)
Fleet:withOrderQueue(fleet)

<span class="predefined">assert</span>.is_true(Fleet:hasOrderQueue(fleet))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="fleet-withorderqueue-abortcurrentorder">Fleet:withOrderQueue():abortCurrentOrder()</h3>
<div id="fleet-withorderqueue-abortcurrentorder-fleet-idles-if-there-is-no-next-order" class="paragraph">
<p> <details><summary> 
Fleet:withOrderQueue():abortCurrentOrder() fleet idles if there is no next order
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>CpuShip(), CpuShip(), CpuShip()<span class="delimiter">}</span></span>)
Fleet:withOrderQueue(fleet)
<span class="keyword">local</span> <span class="local-variable">onAbortCalled</span>, <span class="local-variable">abortArg1</span>, <span class="local-variable">abortArg2</span>, <span class="local-variable">abortArg3</span> = <span class="integer">0</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>

<span class="keyword">local</span> <span class="local-variable">order</span> = Order:flyTo(<span class="integer">1000</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">onAbort</span> = <span class="keyword">function</span>(arg1, arg2, arg3)
        <span class="key">onAbortCalled</span> = onAbortCalled + <span class="integer">1</span>
        <span class="key">abortArg1</span> = arg1
        <span class="key">abortArg2</span> = arg2
        <span class="key">abortArg3</span> = arg3
    <span class="keyword">end</span>
<span class="delimiter">}</span></span>)

fleet:addOrder(order)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, fleet:getLeader():getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onAbortCalled)

fleet:abortCurrentOrder()
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onAbortCalled)
<span class="predefined">assert</span>.is_same(order, abortArg1)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>, abortArg2)
<span class="predefined">assert</span>.is_same(fleet, abortArg3)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Idle</span><span class="delimiter">&quot;</span></span>, fleet:getLeader():getOrder())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="fleet-withorderqueue-flushorders">Fleet:withOrderQueue():flushOrders()</h3>
<div id="fleet-withorderqueue-flushorders-fleet-does-not-carry-out-any-new-orders-after-the-one-is-completed" class="paragraph">
<p> <details><summary> 
Fleet:withOrderQueue():flushOrders() fleet does not carry out any new orders after the one is completed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>CpuShip(), CpuShip(), CpuShip()<span class="delimiter">}</span></span>)
Fleet:withOrderQueue(fleet)
fleet:getLeader():setPosition(<span class="integer">0</span>, <span class="integer">0</span>)

fleet:addOrder(Order:flyTo(<span class="integer">1000</span>, <span class="integer">0</span>))
fleet:addOrder(Order:flyTo(<span class="integer">2000</span>, <span class="integer">0</span>))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, fleet:getLeader():getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">1000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>fleet:getLeader():getOrderTargetLocation()<span class="delimiter">}</span></span>)

Cron.tick(<span class="integer">1</span>)
fleet:flushOrders()
fleet:getLeader():setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, fleet:getLeader():getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">1000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>fleet:getLeader():getOrderTargetLocation()<span class="delimiter">}</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="fleet-withorderqueue-forceordernow">Fleet:withOrderQueue():forceOrderNow()</h3>
<div id="fleet-withorderqueue-forceordernow-executes-a-fleet-order-immediately" class="paragraph">
<p> <details><summary> 
Fleet:withOrderQueue():forceOrderNow() executes a fleet order immediately
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>CpuShip(), CpuShip(), CpuShip()<span class="delimiter">}</span></span>)
Fleet:withOrderQueue(fleet)
<span class="keyword">local</span> <span class="local-variable">onAbortCalled</span>, <span class="local-variable">abortArg1</span>, <span class="local-variable">abortArg2</span>, <span class="local-variable">abortArg3</span> = <span class="integer">0</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>

<span class="keyword">local</span> <span class="local-variable">order</span> = Order:flyTo(<span class="integer">1000</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">onAbort</span> = <span class="keyword">function</span>(arg1, arg2, arg3)
        <span class="key">onAbortCalled</span> = onAbortCalled + <span class="integer">1</span>
        <span class="key">abortArg1</span> = arg1
        <span class="key">abortArg2</span> = arg2
        <span class="key">abortArg3</span> = arg3
    <span class="keyword">end</span>
<span class="delimiter">}</span></span>)

fleet:addOrder(order)
fleet:addOrder(Order:flyTo(<span class="integer">2000</span>, <span class="integer">0</span>))
fleet:addOrder(Order:flyTo(<span class="integer">3000</span>, <span class="integer">0</span>))
fleet:addOrder(Order:flyTo(<span class="integer">4000</span>, <span class="integer">0</span>))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, fleet:getLeader():getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onAbortCalled)

fleet:forceOrderNow(Order:flyTo(<span class="integer">0</span>, <span class="integer">1000</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onAbortCalled)
<span class="predefined">assert</span>.is_same(order, abortArg1)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>, abortArg2)
<span class="predefined">assert</span>.is_same(fleet, abortArg3)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, fleet:getLeader():getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">0</span>, <span class="integer">1000</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>fleet:getLeader():getOrderTargetLocation()<span class="delimiter">}</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="generic">Generic</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="generic-withtags">Generic:withTags()</h3>
<div id="generic-withtags-allows-to-set-tags-in-the-constructor" class="paragraph">
<p> <details><summary> 
Generic:withTags() allows to set tags in the constructor
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Generic:withTags(station, <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.is_true(Generic:hasTags(station))
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, Util.size(station:getTags()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="generic-withtags-creates-a-valid-tagged-object" class="paragraph">
<p> <details><summary> 
Generic:withTags() creates a valid tagged object
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Generic:withTags(station)

<span class="predefined">assert</span>.is_true(Generic:hasTags(station))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="generic-withtags-fails-if-a-tag-is-not-a-string" class="paragraph">
<p> <details><summary> 
Generic:withTags() fails if a tag is not a string
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Generic:withTags(station, <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, <span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="generic-withtags-fails-if-the-first-argument-is-a-number" class="paragraph">
<p> <details><summary> 
Generic:withTags() fails if the first argument is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Generic:withTags(<span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="generic-withtags-addtag">Generic:withTags():addTag()</h3>
<div id="generic-withtags-addtag-adds-a-tag" class="paragraph">
<p> <details><summary> 
Generic:withTags():addTag() adds a tag
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Generic:withTags(station, <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>)

station:addTag(<span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.is_true(station:hasTag(<span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.contains_value(<span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span>, station:getTags())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="generic-withtags-addtag-fails-if-a-number-is-given" class="paragraph">
<p> <details><summary> 
Generic:withTags():addTag() fails if a number is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Generic:withTags(station, <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    station:addTag(<span class="integer">42</span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="generic-withtags-addtags">Generic:withTags():addTags()</h3>
<div id="generic-withtags-addtags-allows-to-batch-add-tags" class="paragraph">
<p> <details><summary> 
Generic:withTags():addTags() allows to batch add tags
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Generic:withTags(station)

station:addTags(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.is_true(station:hasTag(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(station:hasTag(<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(station:hasTag(<span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.contains_value(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, station:getTags())
<span class="predefined">assert</span>.contains_value(<span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span>, station:getTags())
<span class="predefined">assert</span>.contains_value(<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, station:getTags())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="generic-withtags-gettags">Generic:withTags():getTags()</h3>
<div id="generic-withtags-gettags-does-not-allow-to-manipulate-the-tags" class="paragraph">
<p> <details><summary> 
Generic:withTags():getTags() does not allow to manipulate the tags
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Generic:withTags(station, <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>)

<span class="keyword">local</span> <span class="local-variable">tags</span> = station:getTags()
table.insert(tags, <span class="string"><span class="delimiter">&quot;</span><span class="content">fake</span><span class="delimiter">&quot;</span></span>)

tags = station:getTags()
<span class="predefined">assert</span>.not_contains_value(<span class="string"><span class="delimiter">&quot;</span><span class="content">fake</span><span class="delimiter">&quot;</span></span>, tags)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="generic-withtags-gettags-does-not-return-the-same-tag-twice" class="paragraph">
<p> <details><summary> 
Generic:withTags():getTags() does not return the same tag twice
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Generic:withTags(station, <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>)

<span class="keyword">local</span> <span class="local-variable">tags</span> = station:getTags()
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, Util.size(tags))
<span class="predefined">assert</span>.contains_value(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, tags)
<span class="predefined">assert</span>.contains_value(<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, tags)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="generic-withtags-gettags-returns-all-tags-set-in-the-constructor" class="paragraph">
<p> <details><summary> 
Generic:withTags():getTags() returns all tags set in the constructor
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Generic:withTags(station, <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>)

<span class="keyword">local</span> <span class="local-variable">tags</span> = station:getTags()
<span class="predefined">assert</span>.contains_value(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, tags)
<span class="predefined">assert</span>.contains_value(<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, tags)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="generic-withtags-hastag">Generic:withTags():hasTag()</h3>
<div id="generic-withtags-hastag-fails-if-a-non-string-tag-is-given" class="paragraph">
<p> <details><summary> 
Generic:withTags():hasTag() fails if a non-string tag is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Generic:withTags(station, <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    station:hasTag(<span class="integer">42</span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="generic-withtags-hastag-returns-true-if-a-tag-was-set-in-the-constructor-and-false-if-not" class="paragraph">
<p> <details><summary> 
Generic:withTags():hasTag() returns true if a tag was set in the constructor and false if not
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Generic:withTags(station, <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.is_true(station:hasTag(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(station:hasTag(<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(station:hasTag(<span class="string"><span class="delimiter">&quot;</span><span class="content">fake</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="generic-withtags-removetag">Generic:withTags():removeTag()</h3>
<div id="generic-withtags-removetag-fails-if-a-number-is-given" class="paragraph">
<p> <details><summary> 
Generic:withTags():removeTag() fails if a number is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Generic:withTags(station, <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    station:removeTag(<span class="integer">42</span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="generic-withtags-removetag-fails-silently-if-the-tag-was-not-set" class="paragraph">
<p> <details><summary> 
Generic:withTags():removeTag() fails silently if the tag was not set
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Generic:withTags(station, <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>)

station:removeTag(<span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">tags</span> = station:getTags()

<span class="predefined">assert</span>.is_false(station:hasTag(<span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.not_contains_value(<span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span>, tags)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, Util.size(tags))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="generic-withtags-removetag-removes-a-tag-if-it-was-set-before" class="paragraph">
<p> <details><summary> 
Generic:withTags():removeTag() removes a tag if it was set before
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Generic:withTags(station, <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span>)

station:removeTag(<span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">tags</span> = station:getTags()

<span class="predefined">assert</span>.is_false(station:hasTag(<span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.not_contains_value(<span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span>, tags)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, Util.size(tags))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="generic-withtags-removetags">Generic:withTags():removeTags()</h3>
<div id="generic-withtags-removetags-allows-to-batch-remove-tags" class="paragraph">
<p> <details><summary> 
Generic:withTags():removeTags() allows to batch remove tags
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Generic:withTags(station, <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span>)

station:removeTags(<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.is_true(station:hasTag(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(station:hasTag(<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(station:hasTag(<span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.contains_value(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, station:getTags())
<span class="predefined">assert</span>.not_contains_value(<span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span>, station:getTags())
<span class="predefined">assert</span>.not_contains_value(<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, station:getTags())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="menu">Menu</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="menu-newitem">Menu:newItem()</h3>
<div id="menu-newitem-allows-a-short-syntax-for-labels-with-priority" class="paragraph">
<p> <details><summary> 
Menu:newItem() allows a short syntax for labels with priority
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">item</span> = Menu:newItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">Label</span><span class="delimiter">&quot;</span></span>, <span class="integer">99</span>)

<span class="predefined">assert</span>.is_true(Menu:isMenuItem(item))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Label</span><span class="delimiter">&quot;</span></span>, item:getLabel())
<span class="predefined">assert</span>.is_same(<span class="predefined-constant">nil</span>, item.onClick)
<span class="predefined">assert</span>.is_same(<span class="integer">99</span>, item:getPriority())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="menu-newitem-only-the-label-is-mandatory" class="paragraph">
<p> <details><summary> 
Menu:newItem() only the label is mandatory
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">item</span> = Menu:newItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">Label</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.is_true(Menu:isMenuItem(item))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Label</span><span class="delimiter">&quot;</span></span>, item:getLabel())
<span class="predefined">assert</span>.is_same(<span class="predefined-constant">nil</span>, item.onClick)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, item:getPriority())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="menu-newitem-sets-a-default-priority-of-0" class="paragraph">
<p> <details><summary> 
Menu:newItem() sets a default priority of 0
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">item</span> = Menu:newItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">Label</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>)

<span class="predefined">assert</span>.is_true(Menu:isMenuItem(item))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Label</span><span class="delimiter">&quot;</span></span>, item:getLabel())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>, item:onClick())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, item:getPriority())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="menu-newitem-works-when-all-parameters-are-given" class="paragraph">
<p> <details><summary> 
Menu:newItem() works when all parameters are given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">item</span> = Menu:newItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">Label</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>, <span class="integer">100</span>)

<span class="predefined">assert</span>.is_true(Menu:isMenuItem(item))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Label</span><span class="delimiter">&quot;</span></span>, item:getLabel())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>, item:onClick())
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, item:getPriority())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="menu-newitem-wraps-onclick-in-a-function" class="paragraph">
<p> <details><summary> 
Menu:newItem() wraps onClick in a function
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">item</span> = Menu:newItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">Label</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.is_true(Menu:isMenuItem(item))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Label</span><span class="delimiter">&quot;</span></span>, item:getLabel())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>, item:onClick())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, item:getPriority())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="menu-newitem-wraps-onclick-in-a-function-with-prio" class="paragraph">
<p> <details><summary> 
Menu:newItem() wraps onClick in a function with prio
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">item</span> = Menu:newItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">Label</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>, <span class="integer">99</span>)

<span class="predefined">assert</span>.is_true(Menu:isMenuItem(item))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Label</span><span class="delimiter">&quot;</span></span>, item:getLabel())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>, item:onClick())
<span class="predefined">assert</span>.is_same(<span class="integer">99</span>, item:getPriority())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mission">Mission</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="mission-allof">Mission:allOf()</h3>
<div id="mission-allof-fails-if-any-sub-mission-fails" class="paragraph">
<p> <details><summary> 
Mission:allOf() fails if any sub mission fails
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">subMission1</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">subMission2</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">subMission3</span> = Mission:new()

<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:allOf(subMission1, subMission2, subMission3)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission2:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission3:getState())

mission:accept()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">accepted</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">accepted</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">accepted</span><span class="delimiter">&quot;</span></span>, subMission2:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">accepted</span><span class="delimiter">&quot;</span></span>, subMission3:getState())

mission:start()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, subMission2:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, subMission3:getState())

subMission1:success()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, subMission2:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, subMission3:getState())

subMission2:fail()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">failed</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">failed</span><span class="delimiter">&quot;</span></span>, subMission2:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">failed</span><span class="delimiter">&quot;</span></span>, subMission3:getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-allof-makes-all-sub-missions-fail-if-the-wrapper-mission-is-set-to-fail" class="paragraph">
<p> <details><summary> 
Mission:allOf() makes all sub missions fail if the wrapper mission is set to fail
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">subMission1</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">subMission2</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">subMission3</span> = Mission:new()

<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:allOf(subMission1, subMission2, subMission3)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission2:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission3:getState())

mission:accept()
mission:start()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, subMission2:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, subMission3:getState())

subMission2:success()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, subMission2:getState())

mission:fail()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">failed</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">failed</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, subMission2:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">failed</span><span class="delimiter">&quot;</span></span>, subMission3:getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-allof-makes-all-sub-missions-successful-if-the-wrapper-mission-is-set-to-success" class="paragraph">
<p> <details><summary> 
Mission:allOf() makes all sub missions successful if the wrapper mission is set to success
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">subMission1</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">subMission2</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">subMission3</span> = Mission:new()

<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:allOf(subMission1, subMission2, subMission3)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission2:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission3:getState())

mission:accept()
mission:start()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, subMission2:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, subMission3:getState())

subMission2:success()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, subMission2:getState())

mission:success()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, subMission2:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, subMission3:getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-allof-makes-every-sub-mission-a-playermission-if-it-is-a-playermission-itself" class="paragraph">
<p> <details><summary> 
Mission:allOf() makes every sub mission a PlayerMission if it is a PlayerMission itself
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">subMission1</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">subMission2</span> = Mission:new()
Mission:forPlayer(subMission2)
<span class="keyword">local</span> <span class="local-variable">subMission3</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()

<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:allOf(subMission1, subMission2, subMission3)
Mission:forPlayer(mission)
mission:setPlayer(player)

mission:accept()
mission:start()

<span class="predefined">assert</span>.is_true(Mission:isPlayerMission(subMission1))
<span class="predefined">assert</span>.is_same(player, subMission1:getPlayer())
<span class="comment">-- subMission2 was already a player mission, but the player should be set anyways</span>
<span class="predefined">assert</span>.is_true(Mission:isPlayerMission(subMission2))
<span class="predefined">assert</span>.is_same(player, subMission2:getPlayer())
<span class="predefined">assert</span>.is_true(Mission:isPlayerMission(subMission3))
<span class="predefined">assert</span>.is_same(player, subMission3:getPlayer())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-allof-starts-all-the-missions-and-finishes-if-all-are-completed-happy-case" class="paragraph">
<p> <details><summary> 
Mission:allOf() starts all the missions and finishes if all are completed (happy case)
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">subMission1</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">subMission2</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">subMission3</span> = Mission:new()

<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:allOf(subMission1, subMission2, subMission3)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission2:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission3:getState())

mission:accept()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">accepted</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">accepted</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">accepted</span><span class="delimiter">&quot;</span></span>, subMission2:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">accepted</span><span class="delimiter">&quot;</span></span>, subMission3:getState())

mission:start()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, subMission2:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, subMission3:getState())

subMission1:success()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, subMission2:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, subMission3:getState())

subMission3:success()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, subMission2:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, subMission3:getState())

subMission2:success()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, subMission2:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, subMission3:getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-allof-allof">Mission:allOf():allOf()</h3>
<div id="mission-allof-allof-allows-to-set-config" class="paragraph">
<p> <details><summary> 
Mission:allOf():allOf() allows to set config
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">subMission1</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">subMission2</span> = Mission:new()

<span class="keyword">local</span> <span class="local-variable">onAcceptCalled</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:allOf(subMission1, subMission2, <span class="map"><span class="delimiter">{</span><span class="key">onAccept</span> = <span class="keyword">function</span>()
    <span class="key">onAcceptCalled</span> = <span class="predefined-constant">true</span>
<span class="keyword">end</span><span class="delimiter">}</span></span>)

mission:accept()
<span class="predefined">assert</span>.is_true(onAcceptCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-allof-allof-creates-a-valid-mission-and-sets-the-parent-mission" class="paragraph">
<p> <details><summary> 
Mission:allOf():allOf() creates a valid mission and sets the parent mission
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">subMission1</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">subMission2</span> = Mission:new()

<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:allOf(subMission1, subMission2)

<span class="predefined">assert</span>.is_true(Mission:isMission(mission))
<span class="predefined">assert</span>.is_true(Mission:isSubMission(subMission1))
<span class="predefined">assert</span>.is_same(mission, subMission1:getParentMission())
<span class="predefined">assert</span>.is_true(Mission:isSubMission(subMission2))
<span class="predefined">assert</span>.is_same(mission, subMission2:getParentMission())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-allof-allof-fails-if-any-sub-mission-is-already-part-of-another-mission-container" class="paragraph">
<p> <details><summary> 
Mission:allOf():allOf() fails if any sub mission is already part of another mission container
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">subMission1</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">subMission2</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">subMission3</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">subMission4</span> = Mission:new()

Mission:allOf(subMission1, subMission4)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:allOf(subMission1, subMission2, subMission3) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-allof-allof-fails-if-any-sub-mission-is-not-new" class="paragraph">
<p> <details><summary> 
Mission:allOf():allOf() fails if any sub mission is not "new"
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">subMission1</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">subMission2</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">subMission3</span> = Mission:new()

subMission3:accept()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:allOf(subMission1, subMission2, subMission3) <span class="keyword">end</span>)

subMission3:start()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:allOf(subMission1, subMission2, subMission3) <span class="keyword">end</span>)

subMission3:success()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:allOf(subMission1, subMission2, subMission3) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-allof-allof-fails-if-no-sub-missions-are-given" class="paragraph">
<p> <details><summary> 
Mission:allOf():allOf() fails if no sub missions are given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Mission:allOf()
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-allof-allof-fails-if-no-sub-missions-are-given" class="paragraph">
<p> <details><summary> 
Mission:allOf():allOf() fails if no sub missions are given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Mission:allOf()
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-allof-allof-fails-on-invalid-parameters" class="paragraph">
<p> <details><summary> 
Mission:allOf():allOf() fails on invalid parameters
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:allOf(<span class="integer">42</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:allOf(<span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:allOf(<span class="string"><span class="delimiter">&quot;</span><span class="content">broken</span><span class="delimiter">&quot;</span></span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:allOf(CpuShip()) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-chain">Mission:chain()</h3>
<div id="mission-chain-fails-if-the-first-sub-mission-fails" class="paragraph">
<p> <details><summary> 
Mission:chain() fails if the first sub mission fails
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">subMission1</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">subMission2</span> = Mission:new()

<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:chain(subMission1, subMission2)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission2:getState())

mission:accept()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">accepted</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">accepted</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission2:getState())

mission:start()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission2:getState())

subMission1:fail()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">failed</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">failed</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="comment">-- subMission2 state is undefined</span></code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-chain-fails-if-the-second-sub-mission-fails" class="paragraph">
<p> <details><summary> 
Mission:chain() fails if the second sub mission fails
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">subMission1</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">subMission2</span> = Mission:new()

<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:chain(subMission1, subMission2)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission2:getState())

mission:accept()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">accepted</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">accepted</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission2:getState())

mission:start()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission2:getState())

subMission1:success()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, subMission2:getState())

subMission2:fail()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">failed</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">failed</span><span class="delimiter">&quot;</span></span>, subMission2:getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-chain-makes-every-sub-mission-a-playermission-if-it-is-a-playermission-itself" class="paragraph">
<p> <details><summary> 
Mission:chain() makes every sub mission a PlayerMission if it is a PlayerMission itself
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">subMission1</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">subMission2</span> = Mission:new()
Mission:forPlayer(subMission2)
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()

<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:chain(subMission1, subMission2)
Mission:forPlayer(mission)
mission:setPlayer(player)

mission:accept()
mission:start()

<span class="predefined">assert</span>.is_true(Mission:isPlayerMission(subMission1))
<span class="predefined">assert</span>.is_same(player, subMission1:getPlayer())

subMission1:success()

<span class="comment">-- subMission2 was already a player mission, but the player should be set anyways</span>
<span class="predefined">assert</span>.is_true(Mission:isPlayerMission(subMission2))
<span class="predefined">assert</span>.is_same(player, subMission2:getPlayer())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-chain-makes-the-current-sub-mission-fail-if-the-wrapper-mission-is-set-to-failure" class="paragraph">
<p> <details><summary> 
Mission:chain() makes the current sub mission fail if the wrapper mission is set to failure
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">subMission1</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">subMission2</span> = Mission:new()

<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:chain(subMission1, subMission2)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission2:getState())

mission:accept()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">accepted</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">accepted</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission2:getState())

mission:start()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission2:getState())

mission:fail()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">failed</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">failed</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission2:getState())

<span class="comment">-- behavior on any further sub mission state changes are undefined</span></code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-chain-makes-the-current-sub-mission-successful-if-the-wrapper-mission-is-set-to-success" class="paragraph">
<p> <details><summary> 
Mission:chain() makes the current sub mission successful if the wrapper mission is set to success
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">subMission1</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">subMission2</span> = Mission:new()

<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:chain(subMission1, subMission2)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission2:getState())

mission:accept()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">accepted</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">accepted</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission2:getState())

mission:start()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission2:getState())

mission:success()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission2:getState())

<span class="comment">-- behavior on any further sub mission state changes are undefined</span></code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-chain-starts-the-missions-one-after-another-happy-case" class="paragraph">
<p> <details><summary> 
Mission:chain() starts the missions one after another (happy case)
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">subMission1</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">subMission2</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">subMission3</span> = Mission:new()

<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:chain(subMission1, subMission2, subMission3)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission2:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission3:getState())

mission:accept()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">accepted</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">accepted</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission2:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission3:getState())

mission:start()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission2:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission3:getState())

subMission1:success()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, subMission2:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">new</span><span class="delimiter">&quot;</span></span>, subMission3:getState())

subMission2:success()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, subMission2:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, subMission3:getState())

subMission3:success()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, subMission1:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, subMission2:getState())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, subMission3:getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-chain-chain">Mission:chain():chain()</h3>
<div id="mission-chain-chain-allows-to-set-config" class="paragraph">
<p> <details><summary> 
Mission:chain():chain() allows to set config
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">subMission1</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">subMission2</span> = Mission:new()

<span class="keyword">local</span> <span class="local-variable">onAcceptCalled</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:chain(subMission1, subMission2, <span class="map"><span class="delimiter">{</span><span class="key">onAccept</span> = <span class="keyword">function</span>()
    <span class="key">onAcceptCalled</span> = <span class="predefined-constant">true</span>
<span class="keyword">end</span><span class="delimiter">}</span></span>)

mission:accept()
<span class="predefined">assert</span>.is_true(onAcceptCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-chain-chain-creates-a-valid-mission-and-sets-the-parent-mission" class="paragraph">
<p> <details><summary> 
Mission:chain():chain() creates a valid mission and sets the parent mission
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">subMission1</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">subMission2</span> = Mission:new()

<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:chain(subMission1, subMission2)

<span class="predefined">assert</span>.is_true(Mission:isMission(mission))
<span class="predefined">assert</span>.is_true(Mission:isSubMission(subMission1))
<span class="predefined">assert</span>.is_same(mission, subMission1:getParentMission())
<span class="predefined">assert</span>.is_true(Mission:isSubMission(subMission2))
<span class="predefined">assert</span>.is_same(mission, subMission2:getParentMission())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-chain-chain-fails-if-any-sub-mission-is-already-part-of-another-mission-container" class="paragraph">
<p> <details><summary> 
Mission:chain():chain() fails if any sub mission is already part of another mission container
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">subMission1</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">subMission2</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">subMission3</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">subMission4</span> = Mission:new()

Mission:chain(subMission1, subMission4)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:chain(subMission1, subMission2, subMission3) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-chain-chain-fails-if-any-sub-mission-is-not-new" class="paragraph">
<p> <details><summary> 
Mission:chain():chain() fails if any sub mission is not "new"
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">subMission1</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">subMission2</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">subMission3</span> = Mission:new()

subMission3:accept()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:chain(subMission1, subMission2, subMission3) <span class="keyword">end</span>)

subMission3:start()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:chain(subMission1, subMission2, subMission3) <span class="keyword">end</span>)

subMission3:success()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:chain(subMission1, subMission2, subMission3) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-chain-chain-fails-if-no-sub-missions-are-given" class="paragraph">
<p> <details><summary> 
Mission:chain():chain() fails if no sub missions are given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Mission:chain()
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-chain-chain-fails-if-no-sub-missions-are-given" class="paragraph">
<p> <details><summary> 
Mission:chain():chain() fails if no sub missions are given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Mission:chain()
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-chain-chain-fails-on-invalid-parameters" class="paragraph">
<p> <details><summary> 
Mission:chain():chain() fails on invalid parameters
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:chain(<span class="integer">42</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:chain(<span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:chain(<span class="string"><span class="delimiter">&quot;</span><span class="content">broken</span><span class="delimiter">&quot;</span></span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:chain(CpuShip()) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-chain-getcurrentmission">Mission:chain():getCurrentMission()</h3>
<div id="mission-chain-getcurrentmission-returns-the-correct-currently-running-mission" class="paragraph">
<p> <details><summary> 
Mission:chain():getCurrentMission() returns the correct currently running mission
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">subMission1</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">subMission2</span> = Mission:new()
<span class="keyword">local</span> <span class="local-variable">subMission3</span> = Mission:new()

<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:chain(subMission1, subMission2, subMission3)

<span class="predefined">assert</span>.is_nil(mission:getCurrentMission())

mission:accept()
<span class="predefined">assert</span>.is_nil(mission:getCurrentMission())

mission:start()
<span class="predefined">assert</span>.is_same(subMission1, mission:getCurrentMission())

subMission1:success()
<span class="predefined">assert</span>.is_same(subMission2, mission:getCurrentMission())

subMission2:success()
<span class="predefined">assert</span>.is_same(subMission3, mission:getCurrentMission())

subMission3:success()
<span class="predefined">assert</span>.is_nil(mission:getCurrentMission())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-forplayer">Mission:forPlayer()</h3>
<div id="mission-forplayer-fails-if-no-mission-is-given" class="paragraph">
<p> <details><summary> 
Mission:forPlayer() fails if no mission is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = missionMock()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:forPlayer(<span class="predefined-constant">nil</span>, player) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-forplayer-fails-if-the-mission-has-been-accepted-already" class="paragraph">
<p> <details><summary> 
Mission:forPlayer() fails if the mission has been accepted already
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = missionMock()
mission:accept()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:forPlayer(mission, player) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-forplayer-fails-if-the-mission-is-already-a-player-mission" class="paragraph">
<p> <details><summary> 
Mission:forPlayer() fails if the mission is already a player mission
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = missionMock()
Mission:forPlayer(mission, player)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:forPlayer(mission, player) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-forplayer-fails-if-the-player-is-destroyed" class="paragraph">
<p> <details><summary> 
Mission:forPlayer() fails if the player is destroyed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()

<span class="keyword">local</span> <span class="local-variable">onStartCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new(<span class="map"><span class="delimiter">{</span>
    <span class="key">onStart</span> = <span class="keyword">function</span>(self)
        <span class="key">onStartCalled</span> = onStartCalled + <span class="integer">1</span>
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
Mission:forPlayer(mission, player)

mission:setPlayer(player)
mission:accept()
mission:start()
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onStartCalled)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())

player:destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">failed</span><span class="delimiter">&quot;</span></span>, mission:getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-forplayer-should-create-a-valid-mission-with-player" class="paragraph">
<p> <details><summary> 
Mission:forPlayer() should create a valid Mission with player
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = missionMock()
Mission:forPlayer(mission, player)

<span class="predefined">assert</span>.is_true(Mission:isPlayerMission(mission))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-forplayer-accept">Mission:forPlayer():accept()</h3>
<div id="mission-forplayer-accept-adds-the-mission-to-the-mission-tracker-if-the-player-has-one" class="paragraph">
<p> <details><summary> 
Mission:forPlayer():accept() adds the mission to the mission tracker if the player has one
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMissionTracker(player)

<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new()
Mission:forPlayer(mission, player)
mission:setPlayer(player)

mission:accept()
mission:start()

<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span>mission<span class="delimiter">}</span></span>, player:getStartedMissions())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-forplayer-accept-also-calls-the-original-implementation" class="paragraph">
<p> <details><summary> 
Mission:forPlayer():accept() also calls the original implementation
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">originalCalled</span> = <span class="predefined-constant">false</span>

<span class="keyword">local</span> <span class="local-variable">mission</span> = missionMock()
mission.accept = <span class="keyword">function</span>() originalCalled = <span class="predefined-constant">true</span> <span class="keyword">end</span>
Mission:forPlayer(mission, player)
mission:setPlayer(PlayerSpaceship())

mission:accept()
<span class="predefined">assert</span>.is_true(originalCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-forplayer-accept-can-be-called-if-player-are-set" class="paragraph">
<p> <details><summary> 
Mission:forPlayer():accept() can be called if Player are set
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = missionWithPlayerMock()
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()

mission:setPlayer(player)

mission:accept()</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-forplayer-accept-can-not-be-called-if-player-is-not-set" class="paragraph">
<p> <details><summary> 
Mission:forPlayer():accept() can not be called if Player is not set
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = missionWithPlayerMock()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() mission:accept() <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-forplayer-getplayer">Mission:forPlayer():getPlayer()</h3>
<div id="mission-forplayer-getplayer-returns-the-set-player" class="paragraph">
<p> <details><summary> 
Mission:forPlayer():getPlayer() returns the set Player
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = missionWithPlayerMock()
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()

mission:setPlayer(player)

<span class="predefined">assert</span>.is_same(player, mission:getPlayer())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-forplayer-setplayer">Mission:forPlayer():setPlayer()</h3>
<div id="mission-forplayer-setplayer-can-not-be-changed-on-an-accepted-mission" class="paragraph">
<p> <details><summary> 
Mission:forPlayer():setPlayer() can not be changed on an accepted mission
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()

<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new()
Mission:forPlayer(mission, player)
mission:setPlayer(player)

mission:accept()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission:setPlayer(player)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-forplayer-setplayer-fails-if-argument-is-not-a-player" class="paragraph">
<p> <details><summary> 
Mission:forPlayer():setPlayer() fails if argument is not a player
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = missionWithPlayerMock()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()mission:setPlayer(<span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-new">Mission:new()</h3>
<div id="mission-new-allows-to-give-config" class="paragraph">
<p> <details><summary> 
Mission:new() allows to give config
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">id</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>
<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new(<span class="map"><span class="delimiter">{</span><span class="key">id</span> = id<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(id, mission:getId())
<span class="predefined">assert</span>.is_true(Mission:isMission(mission))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-fails-if-acceptcondition-is-not-a-function" class="paragraph">
<p> <details><summary> 
Mission:new() fails if acceptCondition is not a function
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:new(<span class="map"><span class="delimiter">{</span><span class="key">acceptCondition</span> = <span class="integer">42</span><span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-fails-if-onaccept-is-not-a-function" class="paragraph">
<p> <details><summary> 
Mission:new() fails if onAccept is not a function
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:new(<span class="map"><span class="delimiter">{</span><span class="key">onAccept</span> = <span class="integer">42</span><span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-fails-if-ondecline-is-not-a-function" class="paragraph">
<p> <details><summary> 
Mission:new() fails if onDecline is not a function
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:new(<span class="map"><span class="delimiter">{</span><span class="key">onDecline</span> = <span class="integer">42</span><span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-fails-if-onend-is-not-a-function" class="paragraph">
<p> <details><summary> 
Mission:new() fails if onEnd is not a function
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:new(<span class="map"><span class="delimiter">{</span><span class="key">onEnd</span> = <span class="integer">42</span><span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-fails-if-onfailure-is-not-a-function" class="paragraph">
<p> <details><summary> 
Mission:new() fails if onFailure is not a function
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:new(<span class="map"><span class="delimiter">{</span><span class="key">onFailure</span> = <span class="integer">42</span><span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-fails-if-onstart-is-not-a-function" class="paragraph">
<p> <details><summary> 
Mission:new() fails if onStart is not a function
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:new(<span class="map"><span class="delimiter">{</span><span class="key">onStart</span> = <span class="integer">42</span><span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-fails-if-onsuccess-is-not-a-function" class="paragraph">
<p> <details><summary> 
Mission:new() fails if onSuccess is not a function
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:new(<span class="map"><span class="delimiter">{</span><span class="key">onSuccess</span> = <span class="integer">42</span><span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-fails-if-the-config-is-not-a-table" class="paragraph">
<p> <details><summary> 
Mission:new() fails if the config is not a table
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:new(<span class="string"><span class="delimiter">&quot;</span><span class="content">thisBreaks</span><span class="delimiter">&quot;</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-should-create-a-valid-mission" class="paragraph">
<p> <details><summary> 
Mission:new() should create a valid Mission
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new()

<span class="predefined">assert</span>.is_true(Mission:isMission(mission))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-state-machine-allows-to-call-accept-on-a-mission-in-state-new" class="paragraph">
<p> <details><summary> 
Mission:new() state machine allows to call accept on a mission in state new
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">mission[funcName](mission) <span class="comment">-- it should not error</span></code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-state-machine-allows-to-call-decline-on-a-mission-in-state-new" class="paragraph">
<p> <details><summary> 
Mission:new() state machine allows to call decline on a mission in state new
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">mission[funcName](mission) <span class="comment">-- it should not error</span></code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-state-machine-allows-to-call-fail-on-a-mission-in-state-started" class="paragraph">
<p> <details><summary> 
Mission:new() state machine allows to call fail on a mission in state started
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">mission[funcName](mission) <span class="comment">-- it should not error</span></code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-state-machine-allows-to-call-start-on-a-mission-in-state-accepted" class="paragraph">
<p> <details><summary> 
Mission:new() state machine allows to call start on a mission in state accepted
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">mission[funcName](mission) <span class="comment">-- it should not error</span></code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-state-machine-allows-to-call-success-on-a-mission-in-state-started" class="paragraph">
<p> <details><summary> 
Mission:new() state machine allows to call success on a mission in state started
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">mission[funcName](mission) <span class="comment">-- it should not error</span></code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-state-machine-prevents-calls-to-accept-on-a-mission-in-state-accepted" class="paragraph">
<p> <details><summary> 
Mission:new() state machine prevents calls to accept on a mission in state accepted
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission[funcName](mission)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-state-machine-prevents-calls-to-accept-on-a-mission-in-state-declined" class="paragraph">
<p> <details><summary> 
Mission:new() state machine prevents calls to accept on a mission in state declined
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission[funcName](mission)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-state-machine-prevents-calls-to-accept-on-a-mission-in-state-failed" class="paragraph">
<p> <details><summary> 
Mission:new() state machine prevents calls to accept on a mission in state failed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission[funcName](mission)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-state-machine-prevents-calls-to-accept-on-a-mission-in-state-started" class="paragraph">
<p> <details><summary> 
Mission:new() state machine prevents calls to accept on a mission in state started
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission[funcName](mission)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-state-machine-prevents-calls-to-accept-on-a-mission-in-state-successful" class="paragraph">
<p> <details><summary> 
Mission:new() state machine prevents calls to accept on a mission in state successful
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission[funcName](mission)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-state-machine-prevents-calls-to-decline-on-a-mission-in-state-accepted" class="paragraph">
<p> <details><summary> 
Mission:new() state machine prevents calls to decline on a mission in state accepted
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission[funcName](mission)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-state-machine-prevents-calls-to-decline-on-a-mission-in-state-declined" class="paragraph">
<p> <details><summary> 
Mission:new() state machine prevents calls to decline on a mission in state declined
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission[funcName](mission)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-state-machine-prevents-calls-to-decline-on-a-mission-in-state-failed" class="paragraph">
<p> <details><summary> 
Mission:new() state machine prevents calls to decline on a mission in state failed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission[funcName](mission)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-state-machine-prevents-calls-to-decline-on-a-mission-in-state-started" class="paragraph">
<p> <details><summary> 
Mission:new() state machine prevents calls to decline on a mission in state started
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission[funcName](mission)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-state-machine-prevents-calls-to-decline-on-a-mission-in-state-successful" class="paragraph">
<p> <details><summary> 
Mission:new() state machine prevents calls to decline on a mission in state successful
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission[funcName](mission)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-state-machine-prevents-calls-to-fail-on-a-mission-in-state-accepted" class="paragraph">
<p> <details><summary> 
Mission:new() state machine prevents calls to fail on a mission in state accepted
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission[funcName](mission)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-state-machine-prevents-calls-to-fail-on-a-mission-in-state-declined" class="paragraph">
<p> <details><summary> 
Mission:new() state machine prevents calls to fail on a mission in state declined
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission[funcName](mission)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-state-machine-prevents-calls-to-fail-on-a-mission-in-state-failed" class="paragraph">
<p> <details><summary> 
Mission:new() state machine prevents calls to fail on a mission in state failed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission[funcName](mission)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-state-machine-prevents-calls-to-fail-on-a-mission-in-state-new" class="paragraph">
<p> <details><summary> 
Mission:new() state machine prevents calls to fail on a mission in state new
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission[funcName](mission)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-state-machine-prevents-calls-to-fail-on-a-mission-in-state-successful" class="paragraph">
<p> <details><summary> 
Mission:new() state machine prevents calls to fail on a mission in state successful
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission[funcName](mission)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-state-machine-prevents-calls-to-start-on-a-mission-in-state-declined" class="paragraph">
<p> <details><summary> 
Mission:new() state machine prevents calls to start on a mission in state declined
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission[funcName](mission)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-state-machine-prevents-calls-to-start-on-a-mission-in-state-failed" class="paragraph">
<p> <details><summary> 
Mission:new() state machine prevents calls to start on a mission in state failed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission[funcName](mission)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-state-machine-prevents-calls-to-start-on-a-mission-in-state-new" class="paragraph">
<p> <details><summary> 
Mission:new() state machine prevents calls to start on a mission in state new
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission[funcName](mission)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-state-machine-prevents-calls-to-start-on-a-mission-in-state-started" class="paragraph">
<p> <details><summary> 
Mission:new() state machine prevents calls to start on a mission in state started
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission[funcName](mission)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-state-machine-prevents-calls-to-start-on-a-mission-in-state-successful" class="paragraph">
<p> <details><summary> 
Mission:new() state machine prevents calls to start on a mission in state successful
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission[funcName](mission)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-state-machine-prevents-calls-to-success-on-a-mission-in-state-accepted" class="paragraph">
<p> <details><summary> 
Mission:new() state machine prevents calls to success on a mission in state accepted
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission[funcName](mission)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-state-machine-prevents-calls-to-success-on-a-mission-in-state-declined" class="paragraph">
<p> <details><summary> 
Mission:new() state machine prevents calls to success on a mission in state declined
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission[funcName](mission)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-state-machine-prevents-calls-to-success-on-a-mission-in-state-failed" class="paragraph">
<p> <details><summary> 
Mission:new() state machine prevents calls to success on a mission in state failed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission[funcName](mission)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-state-machine-prevents-calls-to-success-on-a-mission-in-state-new" class="paragraph">
<p> <details><summary> 
Mission:new() state machine prevents calls to success on a mission in state new
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission[funcName](mission)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-state-machine-prevents-calls-to-success-on-a-mission-in-state-successful" class="paragraph">
<p> <details><summary> 
Mission:new() state machine prevents calls to success on a mission in state successful
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission[funcName](mission)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-new-accept">Mission:new():accept()</h3>
<div id="mission-new-accept-calls-the-onaccept-callback" class="paragraph">
<p> <details><summary> 
Mission:new():accept() calls the onAccept callback
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">callbackCalled</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = newMission(<span class="map"><span class="delimiter">{</span><span class="key">onAccept</span> = <span class="keyword">function</span>(self)
    <span class="predefined">assert</span>.is_same(mission, self)
    <span class="key">callbackCalled</span> = <span class="predefined-constant">true</span>
<span class="keyword">end</span><span class="delimiter">}</span></span>)

mission:accept()
<span class="predefined">assert</span>.is_true(callbackCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-accept-calls-the-onaccept-eventlistener" class="paragraph">
<p> <details><summary> 
Mission:new():accept() calls the onAccept eventListener
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">listenerCalled</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">calledArg1</span>
<span class="keyword">local</span> <span class="local-variable">mission</span> = newMission()
mission:addAcceptListener(<span class="keyword">function</span>(_, arg1)
    calledArg1 = arg1
    listenerCalled = <span class="predefined-constant">true</span>
<span class="keyword">end</span>)

<span class="predefined">assert</span>.is_false(listenerCalled)
mission:accept()
<span class="predefined">assert</span>.is_true(listenerCalled)
<span class="predefined">assert</span>.is_same(mission, calledArg1)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-accept-fails-if-onaccept-callback-fails" class="paragraph">
<p> <details><summary> 
Mission:new():accept() fails if onAccept callback fails
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = newMission(<span class="map"><span class="delimiter">{</span><span class="key">onAccept</span> = <span class="keyword">function</span>() <span class="predefined">error</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">boom</span><span class="delimiter">&quot;</span></span>) <span class="keyword">end</span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() mission:accept() <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-accept-fails-when-acceptcondition-callback-returns-a-string" class="paragraph">
<p> <details><summary> 
Mission:new():accept() fails when acceptCondition callback returns a string
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = newMission(<span class="map"><span class="delimiter">{</span><span class="key">acceptCondition</span> = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Just... No</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() mission:accept() <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-accept-fails-when-acceptcondition-callback-returns-false" class="paragraph">
<p> <details><summary> 
Mission:new():accept() fails when acceptCondition callback returns false
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = newMission(<span class="map"><span class="delimiter">{</span><span class="key">acceptCondition</span> = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="predefined-constant">false</span> <span class="keyword">end</span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() mission:accept() <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-accept-switches-to-accepted-if-no-callback-is-set" class="paragraph">
<p> <details><summary> 
Mission:new():accept() switches to "accepted" if no callback is set
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = newMission()

mission:accept()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">accepted</span><span class="delimiter">&quot;</span></span>, mission:getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-new-canbeaccepted">Mission:new():canBeAccepted()</h3>
<div id="mission-new-canbeaccepted-is-true-when-no-config-is-set" class="paragraph">
<p> <details><summary> 
Mission:new():canBeAccepted() is true when no config is set
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = newMission()
<span class="predefined">assert</span>.is_true(mission:canBeAccepted())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-new-decline">Mission:new():decline()</h3>
<div id="mission-new-decline-calls-the-ondecline-callback" class="paragraph">
<p> <details><summary> 
Mission:new():decline() calls the onDecline callback
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">callbackCalled</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = newMission(<span class="map"><span class="delimiter">{</span><span class="key">onDecline</span> = <span class="keyword">function</span>(self)
    <span class="predefined">assert</span>.is_same(mission, self)
    <span class="key">callbackCalled</span> = <span class="predefined-constant">true</span>
<span class="keyword">end</span><span class="delimiter">}</span></span>)

mission:decline()
<span class="predefined">assert</span>.is_true(callbackCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-decline-calls-the-ondecline-eventlistener" class="paragraph">
<p> <details><summary> 
Mission:new():decline() calls the onDecline eventListener
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">listenerCalled</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">calledArg1</span>
<span class="keyword">local</span> <span class="local-variable">mission</span> = newMission()
mission:addDeclineListener(<span class="keyword">function</span>(_, arg1)
    calledArg1 = arg1
    listenerCalled = <span class="predefined-constant">true</span>
<span class="keyword">end</span>)

<span class="predefined">assert</span>.is_false(listenerCalled)
mission:decline()
<span class="predefined">assert</span>.is_true(listenerCalled)
<span class="predefined">assert</span>.is_same(mission, calledArg1)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-decline-fails-if-ondecline-callback-fails" class="paragraph">
<p> <details><summary> 
Mission:new():decline() fails if onDecline callback fails
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = newMission(<span class="map"><span class="delimiter">{</span><span class="key">onDecline</span> = <span class="keyword">function</span>() <span class="predefined">error</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">boom</span><span class="delimiter">&quot;</span></span>) <span class="keyword">end</span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() mission:decline() <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-new-fail">Mission:new():fail()</h3>
<div id="mission-new-fail-calls-the-onfailure-callback-and-then-the-onend-callback" class="paragraph">
<p> <details><summary> 
Mission:new():fail() calls the onFailure callback and then the onEnd callback
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">onFailure</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">onEndCalled</span> = <span class="predefined-constant">false</span>

<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = startedMission(<span class="map"><span class="delimiter">{</span>
    <span class="key">onFailure</span> = <span class="keyword">function</span>(self)
        <span class="predefined">assert</span>.is_same(mission, self)
        <span class="key">onFailure</span> = <span class="predefined-constant">true</span>
    <span class="keyword">end</span>,
    <span class="key">onEnd</span> = <span class="keyword">function</span>(self)
        <span class="predefined">assert</span>.is_same(mission, self)
        <span class="predefined">assert</span>.is_true(onFailure)
        <span class="key">onEndCalled</span> = <span class="predefined-constant">true</span>
    <span class="keyword">end</span>
<span class="delimiter">}</span></span>)

mission:fail()
<span class="predefined">assert</span>.is_true(onFailure)
<span class="predefined">assert</span>.is_true(onEndCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-fail-calls-the-onfailure-eventlistener-and-then-the-onend-eventlistener" class="paragraph">
<p> <details><summary> 
Mission:new():fail() calls the onFailure eventListener and then the onEnd eventListener
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">onFailureCalled</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">onFailureCalledArg1</span>
<span class="keyword">local</span> <span class="local-variable">onEndCalled</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">onEndCalledArg1</span>
<span class="keyword">local</span> <span class="local-variable">wasOnFailureCalled</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">mission</span> = startedMission()
mission:addFailureListener(<span class="keyword">function</span>(_, arg1)
    onFailureCalledArg1 = arg1
    onFailureCalled = <span class="predefined-constant">true</span>
<span class="keyword">end</span>)
mission:addEndListener(<span class="keyword">function</span>(_, arg1)
    wasOnFailureCalled = onFailureCalled
    onEndCalledArg1 = arg1
    onEndCalled = <span class="predefined-constant">true</span>
<span class="keyword">end</span>)

<span class="predefined">assert</span>.is_false(onFailureCalled)
<span class="predefined">assert</span>.is_false(onEndCalled)
mission:fail()
<span class="predefined">assert</span>.is_true(onFailureCalled)
<span class="predefined">assert</span>.is_same(mission, onFailureCalledArg1)
<span class="predefined">assert</span>.is_true(wasOnFailureCalled)
<span class="predefined">assert</span>.is_true(onEndCalled)
<span class="predefined">assert</span>.is_same(mission, onEndCalledArg1)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-fail-fails-if-onend-callback-fails" class="paragraph">
<p> <details><summary> 
Mission:new():fail() fails if onEnd callback fails
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = startedMission(<span class="map"><span class="delimiter">{</span><span class="key">onEnd</span> = <span class="keyword">function</span>() <span class="predefined">error</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">boom</span><span class="delimiter">&quot;</span></span>) <span class="keyword">end</span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() mission:fail() <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-fail-fails-if-onfailure-callback-fails" class="paragraph">
<p> <details><summary> 
Mission:new():fail() fails if onFailure callback fails
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = startedMission(<span class="map"><span class="delimiter">{</span><span class="key">onFailure</span> = <span class="keyword">function</span>() <span class="predefined">error</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">boom</span><span class="delimiter">&quot;</span></span>) <span class="keyword">end</span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() mission:fail() <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-new-getid">Mission:new():getId()</h3>
<div id="mission-new-getid-is-set-at-random-if-none-is-given" class="paragraph">
<p> <details><summary> 
Mission:new():getId() is set at random if none is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new()

<span class="predefined">assert</span>.is_true(isString(mission:getId()))
<span class="predefined">assert</span>.is_not_same(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>, mission:getId())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-getid-uses-the-given-id" class="paragraph">
<p> <details><summary> 
Mission:new():getId() uses the given id
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">id</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>
<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new(<span class="map"><span class="delimiter">{</span><span class="key">id</span> = id<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(id, mission:getId())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-new-getstate">Mission:new():getState()</h3>
<div id="mission-new-getstate-returns-accepted-for-an-accepted-mission" class="paragraph">
<p> <details><summary> 
Mission:new():getState() returns "accepted" for an accepted mission
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(accepted, acceptedMission():getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-getstate-returns-declined-for-a-declined-mission" class="paragraph">
<p> <details><summary> 
Mission:new():getState() returns "declined" for a declined mission
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(declined, declinedMission():getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-getstate-returns-failed-for-a-failed-mission" class="paragraph">
<p> <details><summary> 
Mission:new():getState() returns "failed" for a failed mission
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(failed, failedMission():getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-getstate-returns-new-for-a-new-mission" class="paragraph">
<p> <details><summary> 
Mission:new():getState() returns "new" for a new mission
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(new, newMission():getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-getstate-returns-started-for-a-started-mission" class="paragraph">
<p> <details><summary> 
Mission:new():getState() returns "started" for a started mission
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(started, startedMission():getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-getstate-returns-successful-for-a-successful-mission" class="paragraph">
<p> <details><summary> 
Mission:new():getState() returns "successful" for a successful mission
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(successful, successfulMission():getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-new-start">Mission:new():start()</h3>
<div id="mission-new-start-calls-the-onstart-callback" class="paragraph">
<p> <details><summary> 
Mission:new():start() calls the onStart callback
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">callbackCalled</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = acceptedMission(<span class="map"><span class="delimiter">{</span><span class="key">onStart</span> = <span class="keyword">function</span>(self)
    <span class="predefined">assert</span>.is_same(mission, self)
    <span class="key">callbackCalled</span> = <span class="predefined-constant">true</span>
<span class="keyword">end</span><span class="delimiter">}</span></span>)

mission:start()
<span class="predefined">assert</span>.is_true(callbackCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-start-calls-the-onstart-eventlistener" class="paragraph">
<p> <details><summary> 
Mission:new():start() calls the onStart eventListener
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">listenerCalled</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">calledArg1</span>
<span class="keyword">local</span> <span class="local-variable">mission</span> = acceptedMission()
mission:addStartListener(<span class="keyword">function</span>(_, arg1)
    calledArg1 = arg1
    listenerCalled = <span class="predefined-constant">true</span>
<span class="keyword">end</span>)

<span class="predefined">assert</span>.is_false(listenerCalled)
mission:start()
<span class="predefined">assert</span>.is_true(listenerCalled)
<span class="predefined">assert</span>.is_same(mission, calledArg1)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-start-fails-if-ondecline-callback-fails" class="paragraph">
<p> <details><summary> 
Mission:new():start() fails if onDecline callback fails
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = acceptedMission(<span class="map"><span class="delimiter">{</span><span class="key">onStart</span> = <span class="keyword">function</span>() <span class="predefined">error</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">boom</span><span class="delimiter">&quot;</span></span>) <span class="keyword">end</span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() mission:start() <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-new-success">Mission:new():success()</h3>
<div id="mission-new-success-calls-the-onfailure-eventlistener-and-then-the-onend-eventlistener" class="paragraph">
<p> <details><summary> 
Mission:new():success() calls the onFailure eventListener and then the onEnd eventListener
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">onSuccessCalled</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">onSuccessCalledArg1</span>
<span class="keyword">local</span> <span class="local-variable">onEndCalled</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">onEndCalledArg1</span>
<span class="keyword">local</span> <span class="local-variable">wasOnSuccessCalled</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">mission</span> = startedMission()
mission:addSuccessListener(<span class="keyword">function</span>(_, arg1)
    onSuccessCalledArg1 = arg1
    onSuccessCalled = <span class="predefined-constant">true</span>
<span class="keyword">end</span>)
mission:addEndListener(<span class="keyword">function</span>(_, arg1)
    wasOnSuccessCalled = onSuccessCalled
    onEndCalledArg1 = arg1
    onEndCalled = <span class="predefined-constant">true</span>
<span class="keyword">end</span>)

<span class="predefined">assert</span>.is_false(onSuccessCalled)
<span class="predefined">assert</span>.is_false(onEndCalled)
mission:success()
<span class="predefined">assert</span>.is_true(onSuccessCalled)
<span class="predefined">assert</span>.is_same(mission, onSuccessCalledArg1)
<span class="predefined">assert</span>.is_true(wasOnSuccessCalled)
<span class="predefined">assert</span>.is_true(onEndCalled)
<span class="predefined">assert</span>.is_same(mission, onEndCalledArg1)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-success-calls-the-onsuccess-callback-and-then-the-onend-callback" class="paragraph">
<p> <details><summary> 
Mission:new():success() calls the onSuccess callback and then the onEnd callback
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">onSuccessCalled</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">onEndCalled</span> = <span class="predefined-constant">false</span>

<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = startedMission(<span class="map"><span class="delimiter">{</span>
    <span class="key">onSuccess</span> = <span class="keyword">function</span>(self)
        <span class="predefined">assert</span>.is_same(mission, self)
        <span class="key">onSuccessCalled</span> = <span class="predefined-constant">true</span>
    <span class="keyword">end</span>,
    <span class="key">onEnd</span> = <span class="keyword">function</span>(self)
        <span class="predefined">assert</span>.is_same(mission, self)
        <span class="predefined">assert</span>.is_true(onSuccessCalled)
        <span class="key">onEndCalled</span> = <span class="predefined-constant">true</span>
    <span class="keyword">end</span>
<span class="delimiter">}</span></span>)

mission:success()
<span class="predefined">assert</span>.is_true(onSuccessCalled)
<span class="predefined">assert</span>.is_true(onEndCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-success-fails-if-onend-callback-fails" class="paragraph">
<p> <details><summary> 
Mission:new():success() fails if onEnd callback fails
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = startedMission(<span class="map"><span class="delimiter">{</span><span class="key">onEnd</span> = <span class="keyword">function</span>() <span class="predefined">error</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">boom</span><span class="delimiter">&quot;</span></span>) <span class="keyword">end</span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() mission:success() <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-new-success-fails-if-onsuccess-callback-fails" class="paragraph">
<p> <details><summary> 
Mission:new():success() fails if onSuccess callback fails
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = startedMission(<span class="map"><span class="delimiter">{</span><span class="key">onSuccess</span> = <span class="keyword">function</span>() <span class="predefined">error</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">boom</span><span class="delimiter">&quot;</span></span>) <span class="keyword">end</span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() mission:success() <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-registermissionacceptlistener">Mission:registerMissionAcceptListener()</h3>
<div id="mission-registermissionacceptlistener-fires-when-mission-is-accepted" class="paragraph">
<p> <details><summary> 
Mission:registerMissionAcceptListener() fires when mission is accepted
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">eventCalled</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">calledArg1</span>
Mission:registerMissionAcceptListener(<span class="keyword">function</span>(_, arg1)
    eventCalled = <span class="predefined-constant">true</span>
    calledArg1 = arg1
<span class="keyword">end</span>)

<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new()

<span class="predefined">assert</span>.is_false(eventCalled)

mission:accept()

<span class="predefined">assert</span>.is_true(eventCalled)
<span class="predefined">assert</span>.is_same(mission, calledArg1)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-registermissioncreationlistener">Mission:registerMissionCreationListener()</h3>
<div id="mission-registermissioncreationlistener-fires-when-mission-is-created" class="paragraph">
<p> <details><summary> 
Mission:registerMissionCreationListener() fires when mission is created
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">eventCalled</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">calledArg1</span>
Mission:registerMissionCreationListener(<span class="keyword">function</span>(_, arg1)
    eventCalled = <span class="predefined-constant">true</span>
    calledArg1 = arg1
<span class="keyword">end</span>)

<span class="predefined">assert</span>.is_false(eventCalled)

<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new()

<span class="predefined">assert</span>.is_true(eventCalled)
<span class="predefined">assert</span>.is_same(mission, calledArg1)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-registermissiondeclinelistener">Mission:registerMissionDeclineListener()</h3>
<div id="mission-registermissiondeclinelistener-fires-when-mission-is-declined" class="paragraph">
<p> <details><summary> 
Mission:registerMissionDeclineListener() fires when mission is declined
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">eventCalled</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">calledArg1</span>
Mission:registerMissionDeclineListener(<span class="keyword">function</span>(_, arg1)
    eventCalled = <span class="predefined-constant">true</span>
    calledArg1 = arg1
<span class="keyword">end</span>)

<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new()

<span class="predefined">assert</span>.is_false(eventCalled)

mission:decline()

<span class="predefined">assert</span>.is_true(eventCalled)
<span class="predefined">assert</span>.is_same(mission, calledArg1)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-registermissionendlistener">Mission:registerMissionEndListener()</h3>
<div id="mission-registermissionendlistener-fires-when-mission-is-fails" class="paragraph">
<p> <details><summary> 
Mission:registerMissionEndListener() fires when mission is fails
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">eventCalled</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">calledArg1</span>
Mission:registerMissionEndListener(<span class="keyword">function</span>(_, arg1)
    eventCalled = <span class="predefined-constant">true</span>
    calledArg1 = arg1
<span class="keyword">end</span>)

<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new()
mission:accept()
mission:start()

<span class="predefined">assert</span>.is_false(eventCalled)

mission:fail()

<span class="predefined">assert</span>.is_true(eventCalled)
<span class="predefined">assert</span>.is_same(mission, calledArg1)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-registermissionendlistener-fires-when-mission-is-successful" class="paragraph">
<p> <details><summary> 
Mission:registerMissionEndListener() fires when mission is successful
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">eventCalled</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">calledArg1</span>
Mission:registerMissionEndListener(<span class="keyword">function</span>(_, arg1)
    eventCalled = <span class="predefined-constant">true</span>
    calledArg1 = arg1
<span class="keyword">end</span>)

<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new()
mission:accept()
mission:start()

<span class="predefined">assert</span>.is_false(eventCalled)

mission:success()

<span class="predefined">assert</span>.is_true(eventCalled)
<span class="predefined">assert</span>.is_same(mission, calledArg1)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-registermissionfailurelistener">Mission:registerMissionFailureListener()</h3>
<div id="mission-registermissionfailurelistener-fires-when-mission-is-fails" class="paragraph">
<p> <details><summary> 
Mission:registerMissionFailureListener() fires when mission is fails
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">eventCalled</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">calledArg1</span>
Mission:registerMissionFailureListener(<span class="keyword">function</span>(_, arg1)
    eventCalled = <span class="predefined-constant">true</span>
    calledArg1 = arg1
<span class="keyword">end</span>)

<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new()
mission:accept()
mission:start()

<span class="predefined">assert</span>.is_false(eventCalled)

mission:fail()

<span class="predefined">assert</span>.is_true(eventCalled)
<span class="predefined">assert</span>.is_same(mission, calledArg1)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-registermissionstartlistener">Mission:registerMissionStartListener()</h3>
<div id="mission-registermissionstartlistener-fires-when-mission-is-started" class="paragraph">
<p> <details><summary> 
Mission:registerMissionStartListener() fires when mission is started
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">eventCalled</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">calledArg1</span>
Mission:registerMissionStartListener(<span class="keyword">function</span>(_, arg1)
    eventCalled = <span class="predefined-constant">true</span>
    calledArg1 = arg1
<span class="keyword">end</span>)

<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new()
mission:accept()

<span class="predefined">assert</span>.is_false(eventCalled)

mission:start()

<span class="predefined">assert</span>.is_true(eventCalled)
<span class="predefined">assert</span>.is_same(mission, calledArg1)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-registermissionsuccesslistener">Mission:registerMissionSuccessListener()</h3>
<div id="mission-registermissionsuccesslistener-fires-when-mission-is-successful" class="paragraph">
<p> <details><summary> 
Mission:registerMissionSuccessListener() fires when mission is successful
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">eventCalled</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">calledArg1</span>
Mission:registerMissionSuccessListener(<span class="keyword">function</span>(_, arg1)
    eventCalled = <span class="predefined-constant">true</span>
    calledArg1 = arg1
<span class="keyword">end</span>)

<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new()
mission:accept()
mission:start()

<span class="predefined">assert</span>.is_false(eventCalled)

mission:success()

<span class="predefined">assert</span>.is_true(eventCalled)
<span class="predefined">assert</span>.is_same(mission, calledArg1)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-withbroker">Mission:withBroker()</h3>
<div id="mission-withbroker-fails-automatically-if-the-broker-is-destroyed" class="paragraph">
<p> <details><summary> 
Mission:withBroker() fails automatically if the broker is destroyed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">onStartCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new(<span class="map"><span class="delimiter">{</span>
    <span class="key">onStart</span> = <span class="keyword">function</span>(self)
        <span class="key">onStartCalled</span> = onStartCalled + <span class="integer">1</span>
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
Mission:withBroker(mission, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)

mission:setMissionBroker(station)
mission:accept()
mission:start()

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onStartCalled)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())

station:destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">failed</span><span class="delimiter">&quot;</span></span>, mission:getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-withbroker-fails-if-no-mission-is-given" class="paragraph">
<p> <details><summary> 
Mission:withBroker() fails if no mission is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = missionMock()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:withBroker(<span class="predefined-constant">nil</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-withbroker-fails-if-no-title-is-given" class="paragraph">
<p> <details><summary> 
Mission:withBroker() fails if no title is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = missionMock()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:withBroker(mission) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-withbroker-fails-if-the-config-is-not-a-table" class="paragraph">
<p> <details><summary> 
Mission:withBroker() fails if the config is not a table
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = missionMock()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:withBroker(mission, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">thisBreaks</span><span class="delimiter">&quot;</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-withbroker-fails-if-the-description-is-a-number" class="paragraph">
<p> <details><summary> 
Mission:withBroker() fails if the description is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() missionWithBrokerMock(<span class="map"><span class="delimiter">{</span><span class="key">description</span> = <span class="integer">42</span><span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-withbroker-fails-if-the-mission-has-been-accepted-already" class="paragraph">
<p> <details><summary> 
Mission:withBroker() fails if the mission has been accepted already
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = missionMock()
mission:accept()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:withBroker(mission, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-withbroker-fails-if-the-mission-is-already-a-story-mission" class="paragraph">
<p> <details><summary> 
Mission:withBroker() fails if the mission is already a story mission
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = missionMock()
Mission:withBroker(mission, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:withBroker(mission, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-withbroker-should-create-a-valid-mission-with-story" class="paragraph">
<p> <details><summary> 
Mission:withBroker() should create a valid Mission with story
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = missionMock()
Mission:withBroker(mission, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.is_true(Mission:isBrokerMission(mission))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-withbroker-accept">Mission:withBroker():accept()</h3>
<div id="mission-withbroker-accept-also-calls-the-original-implementation" class="paragraph">
<p> <details><summary> 
Mission:withBroker():accept() also calls the original implementation
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">originalCalled</span> = <span class="predefined-constant">false</span>

<span class="keyword">local</span> <span class="local-variable">mission</span> = missionMock()
mission.accept = <span class="keyword">function</span>() originalCalled = <span class="predefined-constant">true</span> <span class="keyword">end</span>
Mission:withBroker(mission, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
mission:setMissionBroker(SpaceStation())

mission:accept()
<span class="predefined">assert</span>.is_true(originalCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-withbroker-accept-can-be-called-if-missionbroker-is-set" class="paragraph">
<p> <details><summary> 
Mission:withBroker():accept() can be called if MissionBroker is set
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = missionWithBrokerMock()
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

mission:setMissionBroker(station)

mission:accept()</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-withbroker-accept-can-not-be-called-if-no-missionbroker-is-set" class="paragraph">
<p> <details><summary> 
Mission:withBroker():accept() can not be called if no MissionBroker is set
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = missionWithBrokerMock()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() mission:accept() <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-withbroker-getacceptmessage">Mission:withBroker():getAcceptMessage()</h3>
<div id="mission-withbroker-getacceptmessage-returns-the-message-if-it-is-a-function" class="paragraph">
<p> <details><summary> 
Mission:withBroker():getAcceptMessage() returns the message if it is a function
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">message</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Thanks for taking that mission</span><span class="delimiter">&quot;</span></span>
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = missionWithBrokerMock(<span class="map"><span class="delimiter">{</span><span class="key">acceptMessage</span> = <span class="keyword">function</span>(callMission)
    <span class="predefined">assert</span>.is_same(mission, callMission)
    <span class="keyword">return</span> message
<span class="keyword">end</span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(message, mission:getAcceptMessage())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-withbroker-getacceptmessage-returns-the-message-if-it-is-a-string" class="paragraph">
<p> <details><summary> 
Mission:withBroker():getAcceptMessage() returns the message if it is a string
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">message</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Thanks for taking that mission</span><span class="delimiter">&quot;</span></span>
<span class="keyword">local</span> <span class="local-variable">mission</span> = missionWithBrokerMock(<span class="map"><span class="delimiter">{</span><span class="key">acceptMessage</span> = message <span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(message, mission:getAcceptMessage())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-withbroker-getdescription">Mission:withBroker():getDescription()</h3>
<div id="mission-withbroker-getdescription-returns-the-description-if-it-is-a-function" class="paragraph">
<p> <details><summary> 
Mission:withBroker():getDescription() returns the description if it is a function
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">description</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">This is a mission</span><span class="delimiter">&quot;</span></span>
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = missionWithBrokerMock(<span class="map"><span class="delimiter">{</span><span class="key">description</span> = <span class="keyword">function</span>(callMission)
    <span class="predefined">assert</span>.is_same(mission, callMission)
    <span class="keyword">return</span> description
<span class="keyword">end</span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(description, mission:getDescription())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-withbroker-getdescription-returns-the-description-if-it-is-a-string" class="paragraph">
<p> <details><summary> 
Mission:withBroker():getDescription() returns the description if it is a string
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">description</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">This is a mission</span><span class="delimiter">&quot;</span></span>
<span class="keyword">local</span> <span class="local-variable">mission</span> = missionWithBrokerMock(<span class="map"><span class="delimiter">{</span><span class="key">description</span> = description<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(description, mission:getDescription())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-withbroker-gethint-sethint">Mission:withBroker():getHint(),:setHint()</h3>
<div id="mission-withbroker-gethint-sethint-allows-to-remove-the-hint" class="paragraph">
<p> <details><summary> 
Mission:withBroker():getHint(),:setHint() allows to remove the hint
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = missionWithBrokerMock()
mission:setHint(<span class="predefined-constant">nil</span>)

<span class="predefined">assert</span>.is_nil(mission:getHint())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-withbroker-gethint-sethint-fails-if-number-is-to-be-set-as-hint" class="paragraph">
<p> <details><summary> 
Mission:withBroker():getHint(),:setHint() fails if number is to be set as hint
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = missionWithBrokerMock()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() mission:setHint(<span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-withbroker-gethint-sethint-returns-nil-by-default" class="paragraph">
<p> <details><summary> 
Mission:withBroker():getHint(),:setHint() returns nil by default
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = missionWithBrokerMock()

<span class="predefined">assert</span>.is_nil(mission:getHint())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-withbroker-gethint-sethint-returns-nil-if-the-function-returns-invalid-type" class="paragraph">
<p> <details><summary> 
Mission:withBroker():getHint(),:setHint() returns nil if the function returns invalid type
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = missionWithBrokerMock()
mission:setHint(<span class="keyword">function</span>() <span class="keyword">return</span> <span class="integer">42</span> <span class="keyword">end</span>)

<span class="predefined">assert</span>.is_nil(mission:getHint())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-withbroker-gethint-sethint-returns-the-set-hint" class="paragraph">
<p> <details><summary> 
Mission:withBroker():getHint(),:setHint() returns the set hint
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = missionWithBrokerMock()
mission:setHint(<span class="string"><span class="delimiter">&quot;</span><span class="content">Use force</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Use force</span><span class="delimiter">&quot;</span></span>, mission:getHint())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-withbroker-gethint-sethint-returns-the-set-hint-by-function" class="paragraph">
<p> <details><summary> 
Mission:withBroker():getHint(),:setHint() returns the set hint by function
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = missionWithBrokerMock()
mission:setHint(<span class="keyword">function</span>(theMission)
    <span class="predefined">assert</span>.is_same(mission, theMission)
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Use force</span><span class="delimiter">&quot;</span></span>
<span class="keyword">end</span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Use force</span><span class="delimiter">&quot;</span></span>, mission:getHint())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-withbroker-getmissionbroker">Mission:withBroker():getMissionBroker()</h3>
<div id="mission-withbroker-getmissionbroker-returns-the-set-missionbroker" class="paragraph">
<p> <details><summary> 
Mission:withBroker():getMissionBroker() returns the set MissionBroker
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = missionWithBrokerMock()
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

mission:setMissionBroker(station)

<span class="predefined">assert</span>.is_same(station, mission:getMissionBroker())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-withbroker-gettitle">Mission:withBroker():getTitle()</h3>
<div id="mission-withbroker-gettitle-returns-the-title-if-it-is-a-function" class="paragraph">
<p> <details><summary> 
Mission:withBroker():getTitle() returns the title if it is a function
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">title</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>
<span class="keyword">local</span> <span class="local-variable">mission</span> = missionMock()
Mission:withBroker(mission, <span class="keyword">function</span>(callMission)
    <span class="predefined">assert</span>.is_same(mission, callMission)
    <span class="keyword">return</span> title
<span class="keyword">end</span>)

<span class="predefined">assert</span>.is_same(title, mission:getTitle())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-withbroker-gettitle-returns-the-title-if-it-is-a-string" class="paragraph">
<p> <details><summary> 
Mission:withBroker():getTitle() returns the title if it is a string
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">title</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>
<span class="keyword">local</span> <span class="local-variable">mission</span> = missionMock()
Mission:withBroker(mission, title)

<span class="predefined">assert</span>.is_same(title, mission:getTitle())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-withtimelimit">Mission:withTimeLimit()</h3>
<div id="mission-withtimelimit-allows-to-manipulate-the-time-limit-on-a-running-mission" class="paragraph">
<p> <details><summary> 
Mission:withTimeLimit() allows to manipulate the time limit on a running mission
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new()
Mission:withTimeLimit(mission, <span class="integer">10</span>)

mission:accept()
mission:start()

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, mission:getElapsedTime())
<span class="predefined">assert</span>.is_same(<span class="integer">10</span>, mission:getRemainingTime())

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, mission:getElapsedTime())
<span class="predefined">assert</span>.is_same(<span class="integer">9</span>, mission:getRemainingTime())

mission:setTimeLimit(<span class="integer">42</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, mission:getElapsedTime())
<span class="predefined">assert</span>.is_same(<span class="integer">41</span>, mission:getRemainingTime())

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, mission:getElapsedTime())
<span class="predefined">assert</span>.is_same(<span class="integer">40</span>, mission:getRemainingTime())

mission:modifyTimeLimit(<span class="integer">-5</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, mission:getElapsedTime())
<span class="predefined">assert</span>.is_same(<span class="integer">35</span>, mission:getRemainingTime())

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, mission:getElapsedTime())
<span class="predefined">assert</span>.is_same(<span class="integer">34</span>, mission:getRemainingTime())

mission:modifyTimeLimit(<span class="integer">2</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, mission:getElapsedTime())
<span class="predefined">assert</span>.is_same(<span class="integer">36</span>, mission:getRemainingTime())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-withtimelimit-does-not-start-the-timer-before-mission-is-started" class="paragraph">
<p> <details><summary> 
Mission:withTimeLimit() does not start the timer before mission is started
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new()
Mission:withTimeLimit(mission, <span class="integer">10</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, mission:getElapsedTime())
<span class="predefined">assert</span>.is_same(<span class="integer">10</span>, mission:getRemainingTime())

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, mission:getElapsedTime())
<span class="predefined">assert</span>.is_same(<span class="integer">10</span>, mission:getRemainingTime())

mission:accept()
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, mission:getElapsedTime())
<span class="predefined">assert</span>.is_same(<span class="integer">10</span>, mission:getRemainingTime())

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, mission:getElapsedTime())
<span class="predefined">assert</span>.is_same(<span class="integer">10</span>, mission:getRemainingTime())

mission:start()
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, mission:getElapsedTime())
<span class="predefined">assert</span>.is_same(<span class="integer">10</span>, mission:getRemainingTime())

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, mission:getElapsedTime())
<span class="predefined">assert</span>.is_same(<span class="integer">9</span>, mission:getRemainingTime())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-withtimelimit-fails-if-mission-is-invalid" class="paragraph">
<p> <details><summary> 
Mission:withTimeLimit() fails if mission is invalid
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:withTimeLimit(<span class="predefined-constant">nil</span>, <span class="integer">10</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:withTimeLimit(PlayerSpaceship(), <span class="integer">10</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:withTimeLimit(<span class="integer">123</span>, <span class="integer">10</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-withtimelimit-fails-if-the-mission-already-has-a-time-limit" class="paragraph">
<p> <details><summary> 
Mission:withTimeLimit() fails if the mission already has a time limit
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new()
Mission:withTimeLimit(mission, <span class="integer">10</span>)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:withTimeLimit(mission, <span class="integer">10</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-withtimelimit-fails-if-the-mission-has-been-started-already" class="paragraph">
<p> <details><summary> 
Mission:withTimeLimit() fails if the mission has been started already
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new()
mission:accept()
mission:start()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:withTimeLimit(mission, <span class="integer">10</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-withtimelimit-fails-to-start-if-no-time-limit-is-set" class="paragraph">
<p> <details><summary> 
Mission:withTimeLimit() fails to start if no time limit is set
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new()
Mission:withTimeLimit(mission)

mission:accept()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() mission:start() <span class="keyword">end</span>)

mission:setTimeLimit(<span class="integer">10</span>)
mission:start()</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-withtimelimit-makes-the-mission-fail-if-the-time-is-up" class="paragraph">
<p> <details><summary> 
Mission:withTimeLimit() makes the mission fail if the time is up
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new()
Mission:withTimeLimit(mission, <span class="integer">10</span>)

mission:accept()
mission:start()

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="keyword">for</span> _ = <span class="integer">1</span>,<span class="integer">9</span> <span class="keyword">do</span>
    Cron.tick(<span class="integer">1</span>)
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="keyword">end</span>

Cron.tick(<span class="float">1.5</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">failed</span><span class="delimiter">&quot;</span></span>, mission:getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-withtimelimit-should-create-a-valid-mission-with-time-limit" class="paragraph">
<p> <details><summary> 
Mission:withTimeLimit() should create a valid Mission with time limit
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new()
Mission:withTimeLimit(mission, <span class="integer">10</span>)

<span class="predefined">assert</span>.is_true(Mission:isTimeLimitMission(mission))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-withtimelimit-getremainingtime">Mission:withTimeLimit():getRemainingTime()</h3>
<div id="mission-withtimelimit-getremainingtime-never-gets-negative" class="paragraph">
<p> <details><summary> 
Mission:withTimeLimit():getRemainingTime() never gets negative
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new()
Mission:withTimeLimit(mission, <span class="float">0.5</span>)

mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, mission:getRemainingTime())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-withtimelimit-modifytimelimit">Mission:withTimeLimit():modifyTimeLimit()</h3>
<div id="mission-withtimelimit-modifytimelimit-can-decrease-the-time-limit" class="paragraph">
<p> <details><summary> 
Mission:withTimeLimit():modifyTimeLimit() can decrease the time limit
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new()
Mission:withTimeLimit(mission, <span class="integer">10</span>)

mission:modifyTimeLimit(<span class="integer">-5</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">5</span>, mission:getRemainingTime())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-withtimelimit-modifytimelimit-can-increase-the-time-limit" class="paragraph">
<p> <details><summary> 
Mission:withTimeLimit():modifyTimeLimit() can increase the time limit
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new()
Mission:withTimeLimit(mission, <span class="integer">10</span>)

mission:modifyTimeLimit(<span class="integer">10</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">20</span>, mission:getRemainingTime())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-withtimelimit-modifytimelimit-fails-on-anything-but-a-number" class="paragraph">
<p> <details><summary> 
Mission:withTimeLimit():modifyTimeLimit() fails on anything but a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new()
Mission:withTimeLimit(mission)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() mission:modifyTimeLimit(<span class="predefined-constant">nil</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() mission:modifyTimeLimit(PlayerSpaceship()) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="mission-withtimelimit-settimelimit">Mission:withTimeLimit():setTimeLimit()</h3>
<div id="mission-withtimelimit-settimelimit-fails-on-non-positive-numbers" class="paragraph">
<p> <details><summary> 
Mission:withTimeLimit():setTimeLimit() fails on non-positive numbers
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new()
Mission:withTimeLimit(mission)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() mission:setTimeLimit(<span class="predefined-constant">nil</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() mission:setTimeLimit(<span class="integer">-1</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() mission:setTimeLimit(<span class="integer">0</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() mission:setTimeLimit(PlayerSpaceship()) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="mission-withtimelimit-settimelimit-sets-the-time-limit" class="paragraph">
<p> <details><summary> 
Mission:withTimeLimit():setTimeLimit() sets the time limit
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Mission:new()
Mission:withTimeLimit(mission)

mission:setTimeLimit(<span class="integer">10</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">10</span>, mission:getRemainingTime())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="missions">Missions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="missions-answer">Missions:answer()</h3>
<div id="missions-answer-can-have-dynamic-questions-and-answers" class="paragraph">
<p> <details><summary> 
Missions:answer() can have dynamic questions and answers
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Station</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Player</span><span class="delimiter">&quot;</span></span>)
Station:withComms(station)

<span class="keyword">local</span> <span class="local-variable">questionCallArg1</span>, <span class="local-variable">questionCallArg2</span>
<span class="keyword">local</span> <span class="local-variable">correctAnswerCallArg1</span>, <span class="local-variable">correctAnswerCallArg2</span>
<span class="keyword">local</span> <span class="local-variable">wrongAnswerCallArg1</span>, <span class="local-variable">wrongAnswerCallArg2</span>

<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:answer(
        station,
        <span class="keyword">function</span>(arg1, arg2)
            questionCallArg1, questionCallArg2 = arg1, arg2
            <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">What is your ships call sign?</span><span class="delimiter">&quot;</span></span>
        <span class="keyword">end</span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">I want to answer your question.</span><span class="delimiter">&quot;</span></span>, <span class="map"><span class="delimiter">{</span>
            <span class="key">correctAnswer</span> = <span class="keyword">function</span>(arg1, arg2)
                correctAnswerCallArg1, <span class="key">correctAnswerCallArg2</span> = arg1, arg2
                <span class="keyword">return</span> arg2:getCallSign()
            <span class="keyword">end</span>,
            <span class="key">correctAnswerResponse</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">You are right.</span><span class="delimiter">&quot;</span></span>,
            <span class="key">wrongAnswers</span> = <span class="keyword">function</span>(arg1, arg2)
                wrongAnswerCallArg1, <span class="key">wrongAnswerCallArg2</span> = arg1, arg2
                <span class="keyword">return</span> <span class="map"><span class="inline-delimiter">{</span>
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">Not </span><span class="delimiter">&quot;</span></span> .. arg2:getCallSign()
                <span class="inline-delimiter">}</span></span>
            <span class="keyword">end</span>,
            <span class="key">wrongAnswerResponse</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">You are wrong.</span><span class="delimiter">&quot;</span></span>,
        <span class="delimiter">}</span></span>
)

<span class="predefined">assert</span>.is_true(Mission:isMission(mission))
mission:accept()
mission:start()

player:commandOpenTextComm(station)
player:selectComms(<span class="string"><span class="delimiter">&quot;</span><span class="content">I want to answer your question.</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(mission, questionCallArg1)
<span class="predefined">assert</span>.is_same(player, questionCallArg2)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">What is your ships call sign?</span><span class="delimiter">&quot;</span></span>, player:getCurrentCommsText())
<span class="predefined">assert</span>.is_same(mission, correctAnswerCallArg1)
<span class="predefined">assert</span>.is_same(player, correctAnswerCallArg2)
<span class="predefined">assert</span>.is_same(mission, wrongAnswerCallArg1)
<span class="predefined">assert</span>.is_same(player, wrongAnswerCallArg2)
player:commandCloseTextComm(station)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-answer-is-possible-to-enable-the-right-answer-through-a-function" class="paragraph">
<p> <details><summary> 
Missions:answer() is possible to enable the right answer through a function
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Station:withComms(station)
<span class="keyword">local</span> <span class="local-variable">correctAnswer</span> = <span class="predefined-constant">nil</span>

<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:answer(
        station,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">What is my name?</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">I want to answer your question.</span><span class="delimiter">&quot;</span></span>, <span class="map"><span class="delimiter">{</span>
            <span class="key">correctAnswer</span> = <span class="keyword">function</span>() <span class="keyword">return</span> correctAnswer <span class="keyword">end</span>,
            <span class="key">correctAnswerResponse</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">You are right.</span><span class="delimiter">&quot;</span></span>,
            <span class="key">wrongAnswers</span> = <span class="map"><span class="inline-delimiter">{</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Paul</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Klaus</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hans</span><span class="delimiter">&quot;</span></span> <span class="inline-delimiter">}</span></span>,
            <span class="key">wrongAnswerResponse</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">You are wrong.</span><span class="delimiter">&quot;</span></span>,
        <span class="delimiter">}</span></span>
)

<span class="predefined">assert</span>.is_true(Mission:isMission(mission))
mission:accept()
mission:start()

<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
player:commandOpenTextComm(station)
player:selectComms(<span class="string"><span class="delimiter">&quot;</span><span class="content">I want to answer your question.</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">What is my name?</span><span class="delimiter">&quot;</span></span>, player:getCurrentCommsText())
<span class="predefined">assert</span>.is_true(player:hasComms(<span class="string"><span class="delimiter">&quot;</span><span class="content">Paul</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasComms(<span class="string"><span class="delimiter">&quot;</span><span class="content">Klaus</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasComms(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hans</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(player:hasComms(<span class="string"><span class="delimiter">&quot;</span><span class="content">Rumpelstiltskin</span><span class="delimiter">&quot;</span></span>))
player:commandCloseTextComm(station)

correctAnswer = <span class="string"><span class="delimiter">&quot;</span><span class="content">Rumpelstiltskin</span><span class="delimiter">&quot;</span></span>
player:commandOpenTextComm(station)
player:selectComms(<span class="string"><span class="delimiter">&quot;</span><span class="content">I want to answer your question.</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">What is my name?</span><span class="delimiter">&quot;</span></span>, player:getCurrentCommsText())
<span class="predefined">assert</span>.is_true(player:hasComms(<span class="string"><span class="delimiter">&quot;</span><span class="content">Rumpelstiltskin</span><span class="delimiter">&quot;</span></span>))
player:selectComms(<span class="string"><span class="delimiter">&quot;</span><span class="content">Rumpelstiltskin</span><span class="delimiter">&quot;</span></span>)
player:commandCloseTextComm(station)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-answer-mission-fails-if-the-wrong-answer-is-given" class="paragraph">
<p> <details><summary> 
Missions:answer() mission fails if the wrong answer is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Station:withComms(station)

<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:answer(
        station,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">What is the answer to my question?</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">I want to answer your question.</span><span class="delimiter">&quot;</span></span>, <span class="map"><span class="delimiter">{</span>
            <span class="key">correctAnswer</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">42</span><span class="delimiter">&quot;</span></span>,
            <span class="key">correctAnswerResponse</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">You are right.</span><span class="delimiter">&quot;</span></span>,
            <span class="key">wrongAnswers</span> = <span class="map"><span class="inline-delimiter">{</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">I don't know</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Yes</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">No</span><span class="delimiter">&quot;</span></span> <span class="inline-delimiter">}</span></span>,
            <span class="key">wrongAnswerResponse</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">You are wrong.</span><span class="delimiter">&quot;</span></span>,
        <span class="delimiter">}</span></span>
)

<span class="predefined">assert</span>.is_true(Mission:isMission(mission))
mission:accept()
mission:start()

<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
player:commandOpenTextComm(station)
<span class="predefined">assert</span>.is_true(player:hasComms(<span class="string"><span class="delimiter">&quot;</span><span class="content">I want to answer your question.</span><span class="delimiter">&quot;</span></span>))
player:selectComms(<span class="string"><span class="delimiter">&quot;</span><span class="content">I want to answer your question.</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">What is the answer to my question?</span><span class="delimiter">&quot;</span></span>, player:getCurrentCommsText())
player:selectComms(<span class="string"><span class="delimiter">&quot;</span><span class="content">Yes</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">You are wrong.</span><span class="delimiter">&quot;</span></span>, player:getCurrentCommsText())

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">failed</span><span class="delimiter">&quot;</span></span>, mission:getState())
player:commandCloseTextComm(station)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-answer-mission-is-successful-if-the-correct-answer-is-given" class="paragraph">
<p> <details><summary> 
Missions:answer() mission is successful if the correct answer is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Station:withComms(station)

<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:answer(
        station,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">What is the answer to my question?</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">I want to answer your question.</span><span class="delimiter">&quot;</span></span>, <span class="map"><span class="delimiter">{</span>
            <span class="key">correctAnswer</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">42</span><span class="delimiter">&quot;</span></span>,
            <span class="key">correctAnswerResponse</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">You are right.</span><span class="delimiter">&quot;</span></span>,
            <span class="key">wrongAnswers</span> = <span class="map"><span class="inline-delimiter">{</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">I don't know</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Yes</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">No</span><span class="delimiter">&quot;</span></span> <span class="inline-delimiter">}</span></span>,
            <span class="key">wrongAnswerResponse</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">You are wrong.</span><span class="delimiter">&quot;</span></span>,
        <span class="delimiter">}</span></span>
)

<span class="predefined">assert</span>.is_true(Mission:isMission(mission))
mission:accept()
mission:start()

<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
player:commandOpenTextComm(station)
<span class="predefined">assert</span>.is_true(player:hasComms(<span class="string"><span class="delimiter">&quot;</span><span class="content">I want to answer your question.</span><span class="delimiter">&quot;</span></span>))
player:selectComms(<span class="string"><span class="delimiter">&quot;</span><span class="content">I want to answer your question.</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">What is the answer to my question?</span><span class="delimiter">&quot;</span></span>, player:getCurrentCommsText())
player:selectComms(<span class="string"><span class="delimiter">&quot;</span><span class="content">42</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">You are right.</span><span class="delimiter">&quot;</span></span>, player:getCurrentCommsText())

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, mission:getState())
player:commandCloseTextComm(station)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-answer-should-create-a-valid-mission-with-one-station-and-a-guessing-game" class="paragraph">
<p> <details><summary> 
Missions:answer() should create a valid Mission with one station and a guessing game
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Station:withComms(station)

<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:answer(
    station,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">What is the answer to my question?</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">I want to answer your question.</span><span class="delimiter">&quot;</span></span>, <span class="map"><span class="delimiter">{</span>
        <span class="key">correctAnswer</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">42</span><span class="delimiter">&quot;</span></span>,
        <span class="key">correctAnswerResponse</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">You are right.</span><span class="delimiter">&quot;</span></span>,
        <span class="key">wrongAnswers</span> = <span class="map"><span class="inline-delimiter">{</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">I don't know</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Yes</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">No</span><span class="delimiter">&quot;</span></span> <span class="inline-delimiter">}</span></span>,
        <span class="key">wrongAnswerResponse</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">You are wrong.</span><span class="delimiter">&quot;</span></span>,
    <span class="delimiter">}</span></span>
)

<span class="predefined">assert</span>.is_true(Mission:isMission(mission))

<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()

player:commandOpenTextComm(station)
<span class="predefined">assert</span>.is_false(player:hasComms(<span class="string"><span class="delimiter">&quot;</span><span class="content">I want to answer your question.</span><span class="delimiter">&quot;</span></span>))
player:commandCloseTextComm(station)

mission:accept()
mission:start()

player:commandOpenTextComm(station)
<span class="predefined">assert</span>.is_true(player:hasComms(<span class="string"><span class="delimiter">&quot;</span><span class="content">I want to answer your question.</span><span class="delimiter">&quot;</span></span>))
player:selectComms(<span class="string"><span class="delimiter">&quot;</span><span class="content">I want to answer your question.</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">What is the answer to my question?</span><span class="delimiter">&quot;</span></span>, player:getCurrentCommsText())
<span class="predefined">assert</span>.is_true(player:hasComms(<span class="string"><span class="delimiter">&quot;</span><span class="content">42</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasComms(<span class="string"><span class="delimiter">&quot;</span><span class="content">I don't know</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasComms(<span class="string"><span class="delimiter">&quot;</span><span class="content">Yes</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasComms(<span class="string"><span class="delimiter">&quot;</span><span class="content">No</span><span class="delimiter">&quot;</span></span>))

player:commandCloseTextComm(station)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="missions-capture">Missions:capture()</h3>
<div id="missions-capture-can-run-a-successful-mission-with-drop-off-point" class="paragraph">
<p> <details><summary> 
Missions:capture() can run a successful mission with drop off point
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:capture(SpaceStation(), <span class="map"><span class="delimiter">{</span>
    <span class="key">dropOffTarget</span> = SpaceStation()
<span class="delimiter">}</span></span>)

mission:getBearer():setPosition(<span class="integer">0</span>,<span class="integer">0</span>)
player:setPosition(<span class="integer">0</span>,<span class="integer">0</span>)
player.isDocked = <span class="keyword">function</span>(thing) <span class="keyword">return</span> <span class="predefined-constant">false</span> <span class="keyword">end</span>
mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
mission:getBearer():destroy()
Cron.tick(<span class="integer">1</span>)
mission:getItemObject():destroy()
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())

player.isDocked = <span class="keyword">function</span>(self, thing) <span class="keyword">return</span> thing == mission:getDropOffTarget() <span class="keyword">end</span>
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, mission:getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-capture-can-run-a-successful-mission-without-drop-off-point" class="paragraph">
<p> <details><summary> 
Missions:capture() can run a successful mission without drop off point
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:capture(SpaceStation())

mission:getBearer():setPosition(<span class="integer">0</span>,<span class="integer">0</span>)
player:setPosition(<span class="integer">0</span>,<span class="integer">0</span>)
mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
mission:getBearer():destroy()
Cron.tick(<span class="integer">1</span>)
mission:getItemObject():destroy()
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, mission:getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-capture-config-onapproach-is-called-when-the-player-first-enters-around-the-bearer" class="paragraph">
<p> <details><summary> 
Missions:capture() config.onApproach is called when the player first enters around the bearer
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">onApproachCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">bearer</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:capture(bearer, <span class="map"><span class="delimiter">{</span>
    <span class="key">approachDistance</span> = <span class="integer">10000</span>,
    <span class="key">onApproach</span> = <span class="keyword">function</span>(callMission, callEnemy)
        <span class="key">onApproachCalled</span> = onApproachCalled + <span class="integer">1</span>
        <span class="predefined">assert</span>.is_same(mission, callMission)
        <span class="predefined">assert</span>.is_same(bearer, callEnemy)
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

player:setPosition(<span class="integer">20000</span>, <span class="integer">0</span>)
bearer:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)

mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onApproachCalled)

player:setPosition(<span class="integer">10001</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onApproachCalled)

player:setPosition(<span class="integer">9999</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onApproachCalled)

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onApproachCalled)

player:setPosition(<span class="integer">10001</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
player:setPosition(<span class="integer">9999</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onApproachCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-capture-config-onbearerdestruction-allows-to-return-a-custom-itemobject" class="paragraph">
<p> <details><summary> 
Missions:capture() config.onBearerDestruction allows to return a custom itemObject
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">bearer</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">itemObject</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:capture(bearer, <span class="map"><span class="delimiter">{</span>
    <span class="key">onBearerDestruction</span> = <span class="keyword">function</span>(callMission, lastX, lastY)
        <span class="predefined">assert</span>.is_same(mission, callMission)
        <span class="predefined">assert</span>.is_same(<span class="integer">4200</span>, lastX)
        <span class="predefined">assert</span>.is_same(<span class="integer">-4200</span>, lastY)
        <span class="keyword">return</span> itemObject
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

bearer:setPosition(<span class="integer">4200</span>, <span class="integer">-4200</span>)

mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
bearer:destroy()

Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_nil(mission:getBearer())
<span class="predefined">assert</span>.is_same(itemObject, mission:getItemObject())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-capture-config-onbearerdestruction-is-called-when-the-bearer-is-destroyed" class="paragraph">
<p> <details><summary> 
Missions:capture() config.onBearerDestruction is called when the bearer is destroyed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">onBearerDestructionCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">bearer</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:capture(bearer, <span class="map"><span class="delimiter">{</span>
    <span class="key">onBearerDestruction</span> = <span class="keyword">function</span>(callMission, lastX, lastY)
        <span class="key">onBearerDestructionCalled</span> = onBearerDestructionCalled + <span class="integer">1</span>
        <span class="predefined">assert</span>.is_same(mission, callMission)
        <span class="predefined">assert</span>.is_same(<span class="integer">4200</span>, lastX)
        <span class="predefined">assert</span>.is_same(<span class="integer">-4200</span>, lastY)
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

bearer:setPosition(<span class="integer">4200</span>, <span class="integer">-4200</span>)

mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onBearerDestructionCalled)
<span class="predefined">assert</span>.is_same(bearer, mission:getBearer())
<span class="predefined">assert</span>.is_nil(mission:getItemObject())

bearer:destroy()
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onBearerDestructionCalled)

<span class="predefined">assert</span>.is_nil(mission:getBearer())
<span class="predefined">assert</span>.is_true(isEeObject(mission:getItemObject()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-capture-config-ondropoff-is-called-when-the-player-returns-the-collected-item" class="paragraph">
<p> <details><summary> 
Missions:capture() config.onDropOff is called when the player returns the collected item
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">onDropOffCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:capture(SpaceStation(), <span class="map"><span class="delimiter">{</span>
    <span class="key">dropOffTarget</span> = SpaceStation(),
    <span class="key">onDropOff</span> = <span class="keyword">function</span>(callMission)
        <span class="key">onDropOffCalled</span> = onDropOffCalled + <span class="integer">1</span>
        <span class="predefined">assert</span>.is_same(mission, callMission)
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

<span class="keyword">local</span> <span class="local-variable">dockedToTarget</span> = <span class="keyword">function</span>(self, thing) <span class="keyword">return</span> thing == mission:getDropOffTarget() <span class="keyword">end</span>
<span class="keyword">local</span> <span class="local-variable">dockedToNil</span> = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="predefined-constant">false</span> <span class="keyword">end</span>

mission:getBearer():setPosition(<span class="integer">0</span>,<span class="integer">0</span>)
player:setPosition(<span class="integer">0</span>,<span class="integer">0</span>)
player.isDocked = dockedToNil
mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onDropOffCalled)

mission:getBearer():destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onDropOffCalled)
player.isDocked = dockedToTarget
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onDropOffCalled)

player.isDocked = dockedToNil
mission:getItemObject():destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onDropOffCalled)
player.isDocked = dockedToTarget
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onDropOffCalled)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, mission:getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-capture-config-ondropofftargetdestroyed-is-called" class="paragraph">
<p> <details><summary> 
Missions:capture() config.onDropOffTargetDestroyed is called
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">onDropOffTargetDestroyedCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:capture(SpaceStation(), <span class="map"><span class="delimiter">{</span>
    <span class="key">dropOffTarget</span> = SpaceStation(),
    <span class="key">onDropOffTargetDestroyed</span> = <span class="keyword">function</span>(callMission)
        <span class="key">onDropOffTargetDestroyedCalled</span> = onDropOffTargetDestroyedCalled + <span class="integer">1</span>
        <span class="predefined">assert</span>.is_same(mission, callMission)
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

mission:getBearer():setPosition(<span class="integer">0</span>,<span class="integer">0</span>)
player:setPosition(<span class="integer">0</span>,<span class="integer">0</span>)
mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onDropOffTargetDestroyedCalled)

mission:getBearer():destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onDropOffTargetDestroyedCalled)

mission:getItemObject():destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onDropOffTargetDestroyedCalled)

mission:getDropOffTarget():destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onDropOffTargetDestroyedCalled)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">failed</span><span class="delimiter">&quot;</span></span>, mission:getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-capture-config-onitemdestruction-is-called-when-the-item-is-destroyed-and-the-player-is-too-far" class="paragraph">
<p> <details><summary> 
Missions:capture() config.onItemDestruction is called when the item is destroyed and the player is too far
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">onItemDestructionCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:capture(SpaceStation(), <span class="map"><span class="delimiter">{</span>
    <span class="key">onItemDestruction</span> = <span class="keyword">function</span>(callMission, lastX, lastY)
        <span class="key">onItemDestructionCalled</span> = onItemDestructionCalled + <span class="integer">1</span>
        <span class="predefined">assert</span>.is_same(mission, callMission)
        <span class="predefined">assert</span>.is_same(<span class="integer">4200</span>, lastX)
        <span class="predefined">assert</span>.is_same(<span class="integer">-4200</span>, lastY)
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

mission:getBearer():setPosition(<span class="integer">4200</span>, <span class="integer">-4200</span>)
player:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onItemDestructionCalled)
mission:getBearer():destroy()

Cron.tick(<span class="integer">1</span>)

<span class="keyword">local</span> <span class="local-variable">x</span>, <span class="local-variable">y</span> = mission:getItemObject():getPosition()
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">4200</span>, <span class="integer">-4200</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>x,y<span class="delimiter">}</span></span>)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onItemDestructionCalled)

mission:getItemObject():destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onItemDestructionCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-capture-config-onpickup-is-called-when-the-item-is-destroyed-and-the-player-is-close-enough" class="paragraph">
<p> <details><summary> 
Missions:capture() config.onPickup is called when the item is destroyed and the player is close enough
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">onPickupCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:capture(SpaceStation(), <span class="map"><span class="delimiter">{</span>
    <span class="key">onPickup</span> = <span class="keyword">function</span>(callMission)
        <span class="key">onPickupCalled</span> = onPickupCalled + <span class="integer">1</span>
        <span class="predefined">assert</span>.is_same(mission, callMission)
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

mission:getBearer():setPosition(<span class="integer">4200</span>, <span class="integer">-4200</span>)
player:setPosition(<span class="integer">4100</span>, <span class="integer">-4200</span>)
mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onPickupCalled)
mission:getBearer():destroy()

Cron.tick(<span class="integer">1</span>)

<span class="keyword">local</span> <span class="local-variable">x</span>, <span class="local-variable">y</span> = mission:getItemObject():getPosition()
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">4200</span>, <span class="integer">-4200</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>x,y<span class="delimiter">}</span></span>)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onPickupCalled)

mission:getItemObject():destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onPickupCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-capture-fails-if-a-call-back-function-is-given-but-returns-a-person" class="paragraph">
<p> <details><summary> 
Missions:capture() fails if a call back function is given, but returns a person
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:capture(<span class="keyword">function</span>() <span class="keyword">return</span> <span class="predefined-constant">nil</span> <span class="keyword">end</span>)
mission:setPlayer(player)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission:accept()
    mission:start()
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-capture-fails-if-a-call-back-function-is-given-but-returns-a-person" class="paragraph">
<p> <details><summary> 
Missions:capture() fails if a call back function is given, but returns a person
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:capture(<span class="keyword">function</span>() <span class="keyword">return</span> personMock() <span class="keyword">end</span>)
mission:setPlayer(player)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission:accept()
    mission:start()
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-capture-fails-if-second-parameter-is-a-number" class="paragraph">
<p> <details><summary> 
Missions:capture() fails if second parameter is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Missions:capture(CpuShip(), <span class="integer">3</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-capture-fails-when-itemobject-is-destroyed-when-the-player-is-too-far-away" class="paragraph">
<p> <details><summary> 
Missions:capture() fails when itemObject is destroyed when the player is too far away
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:capture(SpaceStation())

mission:getBearer():setPosition(<span class="integer">0</span>,<span class="integer">0</span>)
player:setPosition(<span class="integer">4200</span>,<span class="integer">4200</span>)
mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
mission:getBearer():destroy()
Cron.tick(<span class="integer">1</span>)
mission:getItemObject():destroy()
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">failed</span><span class="delimiter">&quot;</span></span>, mission:getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-capture-should-create-a-valid-mission-if-a-callback-function-is-given-that-returns-one-ship" class="paragraph">
<p> <details><summary> 
Missions:capture() should create a valid Mission if a callback function is given that returns one ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:capture(<span class="keyword">function</span>() <span class="keyword">return</span> ship <span class="keyword">end</span>)
<span class="predefined">assert</span>.is_true(Mission:isMission(mission))
mission:setPlayer(player)
mission:accept()
mission:start()

<span class="predefined">assert</span>.is_same(ship, mission:getBearer())
<span class="predefined">assert</span>.is_nil(mission:getItemObject())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-capture-should-create-a-valid-mission-with-one-ship" class="paragraph">
<p> <details><summary> 
Missions:capture() should create a valid Mission with one ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:capture(ship)

<span class="predefined">assert</span>.is_true(Mission:isMission(mission))
<span class="predefined">assert</span>.is_same(ship, mission:getBearer())
<span class="predefined">assert</span>.is_nil(mission:getItemObject())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-capture-should-create-a-valid-mission-with-one-station" class="paragraph">
<p> <details><summary> 
Missions:capture() should create a valid Mission with one station
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:capture(station)

<span class="predefined">assert</span>.is_true(Mission:isMission(mission))
<span class="predefined">assert</span>.is_same(station, mission:getBearer())
<span class="predefined">assert</span>.is_nil(mission:getItemObject())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-capture-should-fail-if-a-person-is-given-instead-of-a-bearer" class="paragraph">
<p> <details><summary> 
Missions:capture() should fail if a person is given instead of a bearer
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Missions:capture(personMock()) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-capture-should-fail-if-nil-is-given-instead-of-a-bearer" class="paragraph">
<p> <details><summary> 
Missions:capture() should fail if nil is given instead of a bearer
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Missions:capture(<span class="predefined-constant">nil</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="missions-crewforrent">Missions:crewForRent()</h3>
<div id="missions-crewforrent-config-oncrewready-is-called-when-the-crew-can-be-picked-up-again" class="paragraph">
<p> <details><summary> 
Missions:crewForRent() config.onCrewReady is called when the crew can be picked up again
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">onCrewReadyCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player)
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:crewForRent(CpuShip(), <span class="map"><span class="delimiter">{</span>
    <span class="key">duration</span> = <span class="integer">3</span>,
    <span class="key">sendCrewLabel</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>,
    <span class="key">onCrewReady</span> = <span class="keyword">function</span>(callMission)
        <span class="key">onCrewReadyCalled</span> = onCrewReadyCalled + <span class="integer">1</span>
        <span class="predefined">assert</span>.is_same(mission, callMission)
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
mission:setPlayer(player)
player:setRepairCrewCount(<span class="integer">4</span>)
player:setPosition(<span class="integer">0</span>,<span class="integer">0</span>)
mission:getNeedy():setPosition(<span class="integer">0</span>,<span class="integer">0</span>)
mission:accept()
mission:start()

<span class="predefined">assert</span>.is_nil(mission:getTimeToReady())

Cron.tick(<span class="integer">1</span>)
player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, mission:getTimeToReady())
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, mission:getTimeToReady())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCrewReadyCalled)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onCrewReadyCalled)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onCrewReadyCalled)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, mission:getTimeToReady())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-crewforrent-fails-to-be-accepted-if-player-ship-does-not-have-menus" class="paragraph">
<p> <details><summary> 
Missions:crewForRent() fails to be accepted if player ship does not have Menus
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:crewForRent(ship)
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()

mission:setPlayer(player)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission:accept()
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-crewforrent-returning-crew-should-only-display-the-button-when-the-player-is-close-enough-to-the-ship" class="paragraph">
<p> <details><summary> 
Missions:crewForRent() returning crew should only display the button when the player is close enough to the ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">label</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Come Back</span><span class="delimiter">&quot;</span></span>
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player)
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:crewForRent(ship, <span class="map"><span class="delimiter">{</span>
    <span class="key">distance</span> = <span class="integer">1000</span>,
    <span class="key">crewCount</span> = <span class="integer">4</span>,
    <span class="key">duration</span> = <span class="integer">5</span>,
    <span class="key">sendCrewLabel</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>,
    <span class="key">returnCrewLabel</span> = label,
<span class="delimiter">}</span></span>)
mission:setPlayer(player)
player:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
mission:getNeedy():setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
player:setRepairCrewCount(<span class="integer">5</span>)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)

player:setPosition(<span class="integer">10000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, label))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering+</span><span class="delimiter">&quot;</span></span>, label))

player:setPosition(<span class="integer">1001</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, label))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering+</span><span class="delimiter">&quot;</span></span>, label))

player:setPosition(<span class="integer">999</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, label))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering+</span><span class="delimiter">&quot;</span></span>, label))

player:setPosition(<span class="integer">1001</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, label))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering+</span><span class="delimiter">&quot;</span></span>, label))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-crewforrent-returning-crew-should-return-the-crew" class="paragraph">
<p> <details><summary> 
Missions:crewForRent() returning crew should return the crew
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">onCrewReturnedCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player)
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:crewForRent(ship, <span class="map"><span class="delimiter">{</span>
    <span class="key">distance</span> = <span class="integer">1000</span>,
    <span class="key">crewCount</span> = <span class="integer">1</span>,
    <span class="key">duration</span> = <span class="integer">5</span>,
    <span class="key">sendCrewLabel</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>,
    <span class="key">returnCrewLabel</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Come Back</span><span class="delimiter">&quot;</span></span>,
    <span class="key">onCrewReturned</span> = <span class="keyword">function</span>(theMission)
        <span class="key">onCrewReturnedCalled</span> = onCrewReturnedCalled + <span class="integer">1</span>
        <span class="predefined">assert</span>.is_same(mission, theMission)
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
mission:setPlayer(player)
player:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
mission:getNeedy():setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
player:setRepairCrewCount(<span class="integer">1</span>)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)

Cron.tick(<span class="integer">5</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCrewReturnedCalled)
player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Come Back</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onCrewReturnedCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-crewforrent-sending-crew-fails-when-crew-count-is-too-low" class="paragraph">
<p> <details><summary> 
Missions:crewForRent() sending crew fails when crew count is too low
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">onCrewArrivedCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">sendCrewFailedCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player)
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:crewForRent(ship, <span class="map"><span class="delimiter">{</span>
    <span class="key">distance</span> = <span class="integer">1000</span>,
    <span class="key">crewCount</span> = <span class="integer">5</span>,
    <span class="key">sendCrewLabel</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>,
    <span class="key">onCrewArrived</span> = <span class="keyword">function</span>(callMission)
        <span class="key">onCrewArrivedCalled</span> = onCrewArrivedCalled + <span class="integer">1</span>
    <span class="keyword">end</span>,
    <span class="key">sendCrewFailed</span> = <span class="keyword">function</span>(callMission)
        <span class="key">sendCrewFailedCalled</span> = sendCrewFailedCalled + <span class="integer">1</span>
        <span class="predefined">assert</span>.is_same(mission, callMission)
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
mission:setPlayer(player)
player:setRepairCrewCount(<span class="integer">4</span>)
player:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
mission:getNeedy():setPosition(<span class="integer">500</span>, <span class="integer">0</span>)

mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCrewArrivedCalled)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, sendCrewFailedCalled)
<span class="predefined">assert</span>.is_same(<span class="integer">4</span>, player:getRepairCrewCount())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, mission:getRepairCrewCount())

player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCrewArrivedCalled)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, sendCrewFailedCalled)

<span class="predefined">assert</span>.is_same(<span class="integer">4</span>, player:getRepairCrewCount())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, mission:getRepairCrewCount())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-crewforrent-sending-crew-should-only-display-the-button-when-the-player-is-close-enough-to-the-ship" class="paragraph">
<p> <details><summary> 
Missions:crewForRent() sending crew should only display the button when the player is close enough to the ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">label</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player)
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:crewForRent(ship, <span class="map"><span class="delimiter">{</span>
    <span class="key">distance</span> = <span class="integer">1000</span>,
    <span class="key">sendCrewLabel</span> = label,
<span class="delimiter">}</span></span>)
mission:setPlayer(player)
player:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
mission:getNeedy():setPosition(<span class="integer">10000</span>, <span class="integer">0</span>)

mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, label))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering+</span><span class="delimiter">&quot;</span></span>, label))

mission:getNeedy():setPosition(<span class="integer">1001</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, label))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering+</span><span class="delimiter">&quot;</span></span>, label))

mission:getNeedy():setPosition(<span class="integer">999</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, label))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering+</span><span class="delimiter">&quot;</span></span>, label))

mission:getNeedy():setPosition(<span class="integer">1001</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, label))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering+</span><span class="delimiter">&quot;</span></span>, label))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-crewforrent-sending-crew-succeeds-when-crew-count-is-high-enough" class="paragraph">
<p> <details><summary> 
Missions:crewForRent() sending crew succeeds when crew count is high enough
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">onCrewArrivedCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">sendCrewFailedCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player)
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:crewForRent(ship, <span class="map"><span class="delimiter">{</span>
    <span class="key">distance</span> = <span class="integer">1000</span>,
    <span class="key">crewCount</span> = <span class="integer">4</span>,
    <span class="key">sendCrewLabel</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>,
    <span class="key">onCrewArrived</span> = <span class="keyword">function</span>(callMission)
        <span class="key">onCrewArrivedCalled</span> = onCrewArrivedCalled + <span class="integer">1</span>
        <span class="predefined">assert</span>.is_same(mission, callMission)
    <span class="keyword">end</span>,
    <span class="key">sendCrewFailed</span> = <span class="keyword">function</span>(callMission)
        <span class="key">sendCrewFailedCalled</span> = sendCrewFailedCalled + <span class="integer">1</span>
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
mission:setPlayer(player)
player:setRepairCrewCount(<span class="integer">4</span>)
player:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
mission:getNeedy():setPosition(<span class="integer">500</span>, <span class="integer">0</span>)

mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCrewArrivedCalled)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, sendCrewFailedCalled)
<span class="predefined">assert</span>.is_same(<span class="integer">4</span>, player:getRepairCrewCount())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, mission:getRepairCrewCount())

player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onCrewArrivedCalled)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, sendCrewFailedCalled)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getRepairCrewCount())
<span class="predefined">assert</span>.is_same(<span class="integer">4</span>, mission:getRepairCrewCount())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-crewforrent-should-create-a-valid-mission-with-one-ship" class="paragraph">
<p> <details><summary> 
Missions:crewForRent() should create a valid Mission with one ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:crewForRent(ship)

<span class="predefined">assert</span>.is_true(Mission:isMission(mission))
<span class="predefined">assert</span>.is_same(ship, mission:getNeedy())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, mission:getRepairCrewCount())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-crewforrent-successful-mission" class="paragraph">
<p> <details><summary> 
Missions:crewForRent() successful mission
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player)
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:crewForRent(CpuShip(), <span class="map"><span class="delimiter">{</span>
    <span class="key">distance</span> = <span class="integer">1000</span>,
    <span class="key">crewCount</span> = <span class="integer">4</span>,
    <span class="key">duration</span> = <span class="integer">5</span>,
    <span class="key">sendCrewLabel</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>,
    <span class="key">returnCrewLabel</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Come Back</span><span class="delimiter">&quot;</span></span>,
<span class="delimiter">}</span></span>)
mission:setPlayer(player)
player:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
mission:getNeedy():setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
player:setRepairCrewCount(<span class="integer">5</span>)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">5</span>, player:getRepairCrewCount())
player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, player:getRepairCrewCount())

Cron.tick(<span class="integer">5</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, player:getRepairCrewCount())
player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Come Back</span><span class="delimiter">&quot;</span></span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">5</span>, player:getRepairCrewCount())

<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Come Back</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering+</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Come Back</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, mission:getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="missions-destroy">Missions:destroy()</h3>
<div id="missions-destroy-can-run-a-successful-mission" class="paragraph">
<p> <details><summary> 
Missions:destroy() can run a successful mission
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">enemy1</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">enemy2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">enemy3</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:destroy(<span class="map"><span class="delimiter">{</span>enemy1, enemy2, enemy3<span class="delimiter">}</span></span>)

mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
enemy1:destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())
Cron.tick(<span class="integer">1</span>)
enemy2:destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())
Cron.tick(<span class="integer">1</span>)
enemy3:destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, mission:getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroy-config-onapproach-is-called-when-the-player-first-enters-10u-around-the-enemy" class="paragraph">
<p> <details><summary> 
Missions:destroy() config.onApproach is called when the player first enters 10u around the enemy
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">onApproachCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">enemy</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:destroy(enemy, <span class="map"><span class="delimiter">{</span><span class="key">onApproach</span> = <span class="keyword">function</span>(callMission, callEnemy)
    <span class="predefined">assert</span>.is_same(mission, callMission)
    <span class="predefined">assert</span>.is_same(enemy, callEnemy)
    <span class="key">onApproachCalled</span> = onApproachCalled + <span class="integer">1</span>
<span class="keyword">end</span><span class="delimiter">}</span></span>)

player:setPosition(<span class="integer">20000</span>, <span class="integer">0</span>)
enemy:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)

mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onApproachCalled)

player:setPosition(<span class="integer">10001</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onApproachCalled)

player:setPosition(<span class="integer">9999</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onApproachCalled)

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onApproachCalled)

player:setPosition(<span class="integer">10001</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
player:setPosition(<span class="integer">9999</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onApproachCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroy-config-onapproach-is-called-when-the-player-first-gets-closer-than-10u-to-any-enemy" class="paragraph">
<p> <details><summary> 
Missions:destroy() config.onApproach is called when the player first gets closer than 10u to any enemy
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">onApproachCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">enemy1</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">enemy2</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:destroy(<span class="map"><span class="delimiter">{</span>enemy1, enemy2<span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span><span class="key">onApproach</span> = <span class="keyword">function</span>(callMission, callEnemy)
    <span class="predefined">assert</span>.is_same(mission, callMission)
    <span class="predefined">assert</span>.is_same(enemy2, callEnemy)
    <span class="key">onApproachCalled</span> = onApproachCalled + <span class="integer">1</span>
<span class="keyword">end</span><span class="delimiter">}</span></span>)

enemy1:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
enemy2:setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)

mission:setPlayer(player)
mission:accept()
mission:start()

player:setPosition(<span class="integer">11001</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onApproachCalled)

player:setPosition(<span class="integer">10999</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onApproachCalled)

player:setPosition(<span class="integer">9999</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onApproachCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroy-config-ondestruction-is-called-each-time-an-enemy-is-destroyed" class="paragraph">
<p> <details><summary> 
Missions:destroy() config.onDestruction is called each time an enemy is destroyed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">enemy1</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">enemy2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">enemy3</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">enemy4</span> = WarpJammer()
<span class="keyword">local</span> <span class="local-variable">enemy5</span> = ScanProbe()
<span class="keyword">local</span> <span class="local-variable">callback1Called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">callback2Called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">callback3Called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">callback4Called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">callback5Called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:destroy(<span class="map"><span class="delimiter">{</span>enemy1, enemy2, enemy3, enemy4, enemy5<span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span><span class="key">onDestruction</span> = <span class="keyword">function</span>(callMission, callEnemy)
    <span class="predefined">assert</span>.is_same(mission, callMission)
    <span class="keyword">if</span> <span class="key">callEnemy</span> == enemy1 <span class="keyword">then</span> <span class="key">callback1Called</span> = callback1Called + <span class="integer">1</span> <span class="keyword">end</span>
    <span class="keyword">if</span> <span class="key">callEnemy</span> == enemy2 <span class="keyword">then</span> <span class="key">callback2Called</span> = callback2Called + <span class="integer">1</span> <span class="keyword">end</span>
    <span class="keyword">if</span> <span class="key">callEnemy</span> == enemy3 <span class="keyword">then</span> <span class="key">callback3Called</span> = callback3Called + <span class="integer">1</span> <span class="keyword">end</span>
    <span class="keyword">if</span> <span class="key">callEnemy</span> == enemy4 <span class="keyword">then</span> <span class="key">callback4Called</span> = callback4Called + <span class="integer">1</span> <span class="keyword">end</span>
    <span class="keyword">if</span> <span class="key">callEnemy</span> == enemy5 <span class="keyword">then</span> <span class="key">callback5Called</span> = callback5Called + <span class="integer">1</span> <span class="keyword">end</span>
<span class="keyword">end</span><span class="delimiter">}</span></span>)

mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, callback1Called)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, callback2Called)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, callback3Called)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, callback4Called)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, callback5Called)

enemy1:destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, callback1Called)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, callback2Called)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, callback3Called)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, callback4Called)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, callback5Called)

enemy2:destroy()
enemy3:destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, callback1Called)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, callback2Called)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, callback3Called)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, callback4Called)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, callback5Called)

enemy4:destroy()
enemy5:destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, callback1Called)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, callback2Called)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, callback3Called)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, callback4Called)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, callback5Called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroy-config-ondestruction-is-only-called-once-if-callback-errors" class="paragraph">
<p> <details><summary> 
Missions:destroy() config.onDestruction is only called once if callback errors
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">enemy1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">enemy2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">onDestructionCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:destroy(<span class="map"><span class="delimiter">{</span>enemy1, enemy2<span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span><span class="key">onDestruction</span> = <span class="keyword">function</span>(_)
    <span class="key">onDestructionCalled</span> = onDestructionCalled + <span class="integer">1</span>
    <span class="predefined">error</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Intentional error</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span><span class="delimiter">}</span></span>)

mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onDestructionCalled)

enemy1:destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onDestructionCalled)
<span class="comment">-- it should not be called again</span>
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onDestructionCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroy-fails-if-a-call-back-function-is-given-that-returns-nil" class="paragraph">
<p> <details><summary> 
Missions:destroy() fails if a call back function is given that returns nil
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:destroy(<span class="keyword">function</span>() <span class="keyword">return</span> <span class="predefined-constant">nil</span> <span class="keyword">end</span>)
mission:setPlayer(player)
mission:accept()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission:start()
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroy-fails-if-a-call-back-function-is-given-but-returns-a-person" class="paragraph">
<p> <details><summary> 
Missions:destroy() fails if a call back function is given, but returns a person
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:destroy(<span class="keyword">function</span>() <span class="keyword">return</span> personMock() <span class="keyword">end</span>)
mission:setPlayer(player)
mission:accept()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission:start()
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroy-fails-if-a-call-back-function-is-given-but-returns-a-table-where-one-item-is-a-person" class="paragraph">
<p> <details><summary> 
Missions:destroy() fails if a call back function is given, but returns a table where one item is a person
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:destroy(<span class="keyword">function</span>() <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>CpuShip(), SpaceStation(), personMock()<span class="delimiter">}</span></span> <span class="keyword">end</span>)
mission:setPlayer(player)
mission:accept()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission:start()
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroy-fails-if-second-parameter-is-a-number" class="paragraph">
<p> <details><summary> 
Missions:destroy() fails if second parameter is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Missions:destroy(CpuShip(), <span class="integer">3</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroy-fails-if-the-first-parameter-is-a-person" class="paragraph">
<p> <details><summary> 
Missions:destroy() fails if the first parameter is a person
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Missions:destroy(personMock()) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroy-fails-if-the-first-parameter-is-a-table-where-one-item-is-a-person" class="paragraph">
<p> <details><summary> 
Missions:destroy() fails if the first parameter is a table where one item is a person
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Missions:destroy(<span class="map"><span class="delimiter">{</span>CpuShip(), SpaceStation(), personMock()<span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroy-fails-if-the-first-parameter-is-not-given" class="paragraph">
<p> <details><summary> 
Missions:destroy() fails if the first parameter is not given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Missions:destroy() <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroy-should-create-a-valid-mission-if-a-callback-function-is-given-that-returns-mixed-space-objects" class="paragraph">
<p> <details><summary> 
Missions:destroy() should create a valid Mission if a callback function is given that returns mixed space objects
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">thing1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">thing2</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">thing3</span> = WarpJammer()
<span class="keyword">local</span> <span class="local-variable">thing4</span> = ScanProbe()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:destroy(<span class="keyword">function</span>() <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>thing1, thing2, thing3, thing4<span class="delimiter">}</span></span> <span class="keyword">end</span>)
<span class="predefined">assert</span>.is_true(Mission:isMission(mission))
mission:setPlayer(player)
mission:accept()
mission:start()

<span class="predefined">assert</span>.contains_value(thing1, mission:getValidEnemies())
<span class="predefined">assert</span>.contains_value(thing2, mission:getValidEnemies())
<span class="predefined">assert</span>.contains_value(thing3, mission:getValidEnemies())
<span class="predefined">assert</span>.contains_value(thing4, mission:getValidEnemies())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroy-should-create-a-valid-mission-if-a-callback-function-is-given-that-returns-one-scan-probe" class="paragraph">
<p> <details><summary> 
Missions:destroy() should create a valid Mission if a callback function is given that returns one scan probe
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">probe</span> = ScanProbe()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:destroy(<span class="keyword">function</span>() <span class="keyword">return</span> probe <span class="keyword">end</span>)
<span class="predefined">assert</span>.is_true(Mission:isMission(mission))
mission:setPlayer(player)
mission:accept()
mission:start()

<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span> probe <span class="delimiter">}</span></span>, mission:getValidEnemies())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroy-should-create-a-valid-mission-if-a-callback-function-is-given-that-returns-one-ship" class="paragraph">
<p> <details><summary> 
Missions:destroy() should create a valid Mission if a callback function is given that returns one ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:destroy(<span class="keyword">function</span>() <span class="keyword">return</span> ship <span class="keyword">end</span>)
<span class="predefined">assert</span>.is_true(Mission:isMission(mission))
mission:setPlayer(player)
mission:accept()
mission:start()

<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span>ship<span class="delimiter">}</span></span>, mission:getValidEnemies())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroy-should-create-a-valid-mission-if-a-callback-function-is-given-that-returns-one-station" class="paragraph">
<p> <details><summary> 
Missions:destroy() should create a valid Mission if a callback function is given that returns one station
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:destroy(<span class="keyword">function</span>() <span class="keyword">return</span> station <span class="keyword">end</span>)
<span class="predefined">assert</span>.is_true(Mission:isMission(mission))
mission:setPlayer(player)
mission:accept()
mission:start()

<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span>station<span class="delimiter">}</span></span>, mission:getValidEnemies())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroy-should-create-a-valid-mission-if-a-callback-function-is-given-that-returns-one-warp-jammer" class="paragraph">
<p> <details><summary> 
Missions:destroy() should create a valid Mission if a callback function is given that returns one warp jammer
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">jammer</span> = WarpJammer()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:destroy(<span class="keyword">function</span>() <span class="keyword">return</span> jammer <span class="keyword">end</span>)
<span class="predefined">assert</span>.is_true(Mission:isMission(mission))
mission:setPlayer(player)
mission:accept()
mission:start()

<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span> jammer <span class="delimiter">}</span></span>, mission:getValidEnemies())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroy-should-create-a-valid-mission-with-mixed-space-objects" class="paragraph">
<p> <details><summary> 
Missions:destroy() should create a valid Mission with mixed space objects
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:destroy(<span class="map"><span class="delimiter">{</span>CpuShip(), SpaceStation(), CpuShip(), WarpJammer(), ScanProbe()<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_true(Mission:isMission(mission))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroy-should-create-a-valid-mission-with-one-scanprobe" class="paragraph">
<p> <details><summary> 
Missions:destroy() should create a valid Mission with one ScanProbe
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:destroy(ScanProbe())

<span class="predefined">assert</span>.is_true(Mission:isMission(mission))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroy-should-create-a-valid-mission-with-one-warpjammer" class="paragraph">
<p> <details><summary> 
Missions:destroy() should create a valid Mission with one WarpJammer
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:destroy(WarpJammer())

<span class="predefined">assert</span>.is_true(Mission:isMission(mission))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroy-should-create-a-valid-mission-with-one-ship" class="paragraph">
<p> <details><summary> 
Missions:destroy() should create a valid Mission with one ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:destroy(CpuShip())

<span class="predefined">assert</span>.is_true(Mission:isMission(mission))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroy-should-create-a-valid-mission-with-one-station" class="paragraph">
<p> <details><summary> 
Missions:destroy() should create a valid Mission with one station
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:destroy(SpaceStation())

<span class="predefined">assert</span>.is_true(Mission:isMission(mission))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="missions-destroy-getvalidenemies">Missions:destroy():getValidEnemies(),</h3>
<div id="missions-destroy-getvalidenemies-countvalidenemies-getinvalidenemies-countinvalidenemies-getenemies-countenemies-return-correct-values" class="paragraph">
<p> <details><summary> 
Missions:destroy():getValidEnemies(), countValidEnemies(), getInvalidEnemies(), countInvalidEnemies(), getEnemies(), countEnemies() return correct values
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">enemy1</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">enemy2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">enemy3</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">enemy4</span> = WarpJammer()
<span class="keyword">local</span> <span class="local-variable">enemy5</span> = ScanProbe()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:destroy(<span class="map"><span class="delimiter">{</span>enemy1, enemy2, enemy3, enemy4, enemy5<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(<span class="integer">5</span>, mission:countEnemies())
<span class="predefined">assert</span>.is_same(<span class="integer">5</span>, mission:countValidEnemies())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, mission:countInvalidEnemies())
<span class="predefined">assert</span>.contains_value(enemy1, mission:getEnemies())
<span class="predefined">assert</span>.contains_value(enemy2, mission:getEnemies())
<span class="predefined">assert</span>.contains_value(enemy3, mission:getEnemies())
<span class="predefined">assert</span>.contains_value(enemy4, mission:getEnemies())
<span class="predefined">assert</span>.contains_value(enemy5, mission:getEnemies())
<span class="predefined">assert</span>.contains_value(enemy1, mission:getValidEnemies())
<span class="predefined">assert</span>.contains_value(enemy2, mission:getValidEnemies())
<span class="predefined">assert</span>.contains_value(enemy3, mission:getValidEnemies())
<span class="predefined">assert</span>.contains_value(enemy4, mission:getValidEnemies())
<span class="predefined">assert</span>.contains_value(enemy5, mission:getValidEnemies())
<span class="predefined">assert</span>.not_contains_value(enemy1, mission:getInvalidEnemies())
<span class="predefined">assert</span>.not_contains_value(enemy2, mission:getInvalidEnemies())
<span class="predefined">assert</span>.not_contains_value(enemy3, mission:getInvalidEnemies())
<span class="predefined">assert</span>.not_contains_value(enemy4, mission:getInvalidEnemies())
<span class="predefined">assert</span>.not_contains_value(enemy5, mission:getInvalidEnemies())

enemy1:destroy()

<span class="predefined">assert</span>.is_same(<span class="integer">5</span>, mission:countEnemies())
<span class="predefined">assert</span>.is_same(<span class="integer">4</span>, mission:countValidEnemies())
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, mission:countInvalidEnemies())
<span class="predefined">assert</span>.contains_value(enemy1, mission:getEnemies())
<span class="predefined">assert</span>.contains_value(enemy2, mission:getEnemies())
<span class="predefined">assert</span>.contains_value(enemy3, mission:getEnemies())
<span class="predefined">assert</span>.contains_value(enemy4, mission:getEnemies())
<span class="predefined">assert</span>.contains_value(enemy5, mission:getEnemies())
<span class="predefined">assert</span>.not_contains_value(enemy1, mission:getValidEnemies())
<span class="predefined">assert</span>.contains_value(enemy2, mission:getValidEnemies())
<span class="predefined">assert</span>.contains_value(enemy3, mission:getValidEnemies())
<span class="predefined">assert</span>.contains_value(enemy4, mission:getValidEnemies())
<span class="predefined">assert</span>.contains_value(enemy5, mission:getValidEnemies())
<span class="predefined">assert</span>.contains_value(enemy1, mission:getInvalidEnemies())
<span class="predefined">assert</span>.not_contains_value(enemy2, mission:getInvalidEnemies())
<span class="predefined">assert</span>.not_contains_value(enemy3, mission:getInvalidEnemies())
<span class="predefined">assert</span>.not_contains_value(enemy4, mission:getInvalidEnemies())
<span class="predefined">assert</span>.not_contains_value(enemy5, mission:getInvalidEnemies())

enemy2:destroy()
enemy3:destroy()

<span class="predefined">assert</span>.is_same(<span class="integer">5</span>, mission:countEnemies())
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, mission:countValidEnemies())
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, mission:countInvalidEnemies())
<span class="predefined">assert</span>.contains_value(enemy1, mission:getEnemies())
<span class="predefined">assert</span>.contains_value(enemy2, mission:getEnemies())
<span class="predefined">assert</span>.contains_value(enemy3, mission:getEnemies())
<span class="predefined">assert</span>.contains_value(enemy4, mission:getEnemies())
<span class="predefined">assert</span>.contains_value(enemy5, mission:getEnemies())
<span class="predefined">assert</span>.not_contains_value(enemy1, mission:getValidEnemies())
<span class="predefined">assert</span>.not_contains_value(enemy2, mission:getValidEnemies())
<span class="predefined">assert</span>.not_contains_value(enemy3, mission:getValidEnemies())
<span class="predefined">assert</span>.contains_value(enemy4, mission:getValidEnemies())
<span class="predefined">assert</span>.contains_value(enemy5, mission:getValidEnemies())
<span class="predefined">assert</span>.contains_value(enemy1, mission:getInvalidEnemies())
<span class="predefined">assert</span>.contains_value(enemy2, mission:getInvalidEnemies())
<span class="predefined">assert</span>.contains_value(enemy3, mission:getInvalidEnemies())
<span class="predefined">assert</span>.not_contains_value(enemy4, mission:getInvalidEnemies())
<span class="predefined">assert</span>.not_contains_value(enemy5, mission:getInvalidEnemies())

enemy4:destroy()
enemy5:destroy()

<span class="predefined">assert</span>.is_same(<span class="integer">5</span>, mission:countEnemies())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, mission:countValidEnemies())
<span class="predefined">assert</span>.is_same(<span class="integer">5</span>, mission:countInvalidEnemies())
<span class="predefined">assert</span>.contains_value(enemy1, mission:getEnemies())
<span class="predefined">assert</span>.contains_value(enemy2, mission:getEnemies())
<span class="predefined">assert</span>.contains_value(enemy3, mission:getEnemies())
<span class="predefined">assert</span>.contains_value(enemy4, mission:getEnemies())
<span class="predefined">assert</span>.contains_value(enemy5, mission:getEnemies())
<span class="predefined">assert</span>.not_contains_value(enemy1, mission:getValidEnemies())
<span class="predefined">assert</span>.not_contains_value(enemy2, mission:getValidEnemies())
<span class="predefined">assert</span>.not_contains_value(enemy3, mission:getValidEnemies())
<span class="predefined">assert</span>.not_contains_value(enemy4, mission:getValidEnemies())
<span class="predefined">assert</span>.not_contains_value(enemy5, mission:getValidEnemies())
<span class="predefined">assert</span>.contains_value(enemy1, mission:getInvalidEnemies())
<span class="predefined">assert</span>.contains_value(enemy2, mission:getInvalidEnemies())
<span class="predefined">assert</span>.contains_value(enemy3, mission:getInvalidEnemies())
<span class="predefined">assert</span>.contains_value(enemy4, mission:getInvalidEnemies())
<span class="predefined">assert</span>.contains_value(enemy5, mission:getInvalidEnemies())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroy-getvalidenemies-countvalidenemies-getinvalidenemies-countinvalidenemies-getenemies-countenemies-returns-nil-it-it-is-called-before-the-ships-are-created-in-the-callback" class="paragraph">
<p> <details><summary> 
Missions:destroy():getValidEnemies(), countValidEnemies(), getInvalidEnemies(), countInvalidEnemies(), getEnemies(), countEnemies() returns nil it it is called before the ships are created in the callback
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">enemy1</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">enemy2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">enemy3</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:destroy(<span class="keyword">function</span> () <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>enemy1, enemy2, enemy3<span class="delimiter">}</span></span> <span class="keyword">end</span>)

<span class="predefined">assert</span>.is_nil(mission:countEnemies())
<span class="predefined">assert</span>.is_nil(mission:countValidEnemies())
<span class="predefined">assert</span>.is_nil(mission:countInvalidEnemies())
<span class="predefined">assert</span>.is_nil(mission:getEnemies())
<span class="predefined">assert</span>.is_nil(mission:getValidEnemies())
<span class="predefined">assert</span>.is_nil(mission:getInvalidEnemies())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroy-getvalidenemies-countvalidenemies-getinvalidenemies-countinvalidenemies-getenemies-countenemies-should-not-allow-to-manipulate-the-tables" class="paragraph">
<p> <details><summary> 
Missions:destroy():getValidEnemies(), countValidEnemies(), getInvalidEnemies(), countInvalidEnemies(), getEnemies(), countEnemies() should not allow to manipulate the tables
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">enemy1</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">enemy2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">enemy3</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:destroy(<span class="map"><span class="delimiter">{</span>enemy1, enemy2<span class="delimiter">}</span></span>)

<span class="keyword">local</span> <span class="local-variable">enemies</span> = mission:getEnemies()
table.insert(enemies, enemy3)

<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, mission:countEnemies())
<span class="predefined">assert</span>.not_contains_value(enemy3, mission:getEnemies())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="missions-destroyragingminer">Missions:destroyRagingMiner()</h3>
<div id="missions-destroyragingminer-can-run-a-successful-mission" class="paragraph">
<p> <details><summary> 
Missions:destroyRagingMiner() can run a successful mission
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">enemy1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">enemy2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">enemy3</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:destroyRagingMiner(<span class="map"><span class="delimiter">{</span>enemy1, enemy2, enemy3<span class="delimiter">}</span></span>)

mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
enemy1:destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())
Cron.tick(<span class="integer">1</span>)
enemy2:destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())
Cron.tick(<span class="integer">1</span>)
enemy3:destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, mission:getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroyragingminer-config-ondestruction-is-called-each-time-an-enemy-is-destroyed" class="paragraph">
<p> <details><summary> 
Missions:destroyRagingMiner() config.onDestruction is called each time an enemy is destroyed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">enemy1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">enemy2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">enemy3</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">callback1Called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">callback2Called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">callback3Called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:destroyRagingMiner(<span class="map"><span class="delimiter">{</span>enemy1, enemy2, enemy3<span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span><span class="key">onDestruction</span> = <span class="keyword">function</span>(callMission, callEnemy)
    <span class="predefined">assert</span>.is_same(mission, callMission)
    <span class="keyword">if</span> <span class="key">callEnemy</span> == enemy1 <span class="keyword">then</span> <span class="key">callback1Called</span> = callback1Called + <span class="integer">1</span> <span class="keyword">end</span>
    <span class="keyword">if</span> <span class="key">callEnemy</span> == enemy2 <span class="keyword">then</span> <span class="key">callback2Called</span> = callback2Called + <span class="integer">1</span> <span class="keyword">end</span>
    <span class="keyword">if</span> <span class="key">callEnemy</span> == enemy3 <span class="keyword">then</span> <span class="key">callback3Called</span> = callback3Called + <span class="integer">1</span> <span class="keyword">end</span>
<span class="keyword">end</span><span class="delimiter">}</span></span>)

mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, callback1Called)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, callback2Called)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, callback3Called)

enemy1:destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, callback1Called)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, callback2Called)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, callback3Called)

enemy2:destroy()
enemy3:destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, callback1Called)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, callback2Called)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, callback3Called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroyragingminer-fails-if-a-call-back-function-is-given-that-returns-nil" class="paragraph">
<p> <details><summary> 
Missions:destroyRagingMiner() fails if a call back function is given that returns nil
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Missions:destroyRagingMiner(<span class="keyword">function</span>() <span class="keyword">return</span> <span class="predefined-constant">nil</span> <span class="keyword">end</span>)
    mission:setPlayer(player)
    mission:accept()
    mission:start()
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroyragingminer-fails-if-a-call-back-function-is-given-but-returns-a-person" class="paragraph">
<p> <details><summary> 
Missions:destroyRagingMiner() fails if a call back function is given, but returns a person
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Missions:destroyRagingMiner(<span class="keyword">function</span>() <span class="keyword">return</span> personMock() <span class="keyword">end</span>)
    mission:setPlayer(player)
    mission:accept()
    mission:start()
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroyragingminer-fails-if-a-call-back-function-is-given-but-returns-a-table-where-one-item-is-a-person" class="paragraph">
<p> <details><summary> 
Missions:destroyRagingMiner() fails if a call back function is given, but returns a table where one item is a person
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Missions:destroyRagingMiner(<span class="keyword">function</span>() <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>CpuShip(), CpuShip(), personMock()<span class="delimiter">}</span></span> <span class="keyword">end</span>)
    mission:setPlayer(player)
    mission:accept()
    mission:start()
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroyragingminer-fails-if-second-parameter-is-a-number" class="paragraph">
<p> <details><summary> 
Missions:destroyRagingMiner() fails if second parameter is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Missions:destroyRagingMiner(CpuShip(), <span class="integer">3</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroyragingminer-fails-if-the-first-parameter-is-a-person" class="paragraph">
<p> <details><summary> 
Missions:destroyRagingMiner() fails if the first parameter is a person
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Missions:destroyRagingMiner(personMock()) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroyragingminer-fails-if-the-first-parameter-is-a-table-where-one-item-is-a-person" class="paragraph">
<p> <details><summary> 
Missions:destroyRagingMiner() fails if the first parameter is a table where one item is a person
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Missions:destroyRagingMiner(<span class="map"><span class="delimiter">{</span>CpuShip(), CpuShip(), personMock()<span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroyragingminer-fails-if-the-first-parameter-is-not-given" class="paragraph">
<p> <details><summary> 
Missions:destroyRagingMiner() fails if the first parameter is not given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Missions:destroyRagingMiner() <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroyragingminer-should-create-a-valid-mission-if-a-callback-function-is-given-that-returns-multiple-ships" class="paragraph">
<p> <details><summary> 
Missions:destroyRagingMiner() should create a valid Mission if a callback function is given that returns multiple ships
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:destroyRagingMiner(<span class="keyword">function</span>() <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>CpuShip(), CpuShip(), CpuShip()<span class="delimiter">}</span></span> <span class="keyword">end</span>)
<span class="predefined">assert</span>.is_true(Mission:isMission(mission))
mission:setPlayer(player)
mission:accept()
mission:start()</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroyragingminer-should-create-a-valid-mission-if-a-callback-function-is-given-that-returns-one-ship" class="paragraph">
<p> <details><summary> 
Missions:destroyRagingMiner() should create a valid Mission if a callback function is given that returns one ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:destroyRagingMiner(<span class="keyword">function</span>() <span class="keyword">return</span> ship <span class="keyword">end</span>)
<span class="predefined">assert</span>.is_true(Mission:isMission(mission))
mission:setPlayer(player)
mission:accept()
mission:start()

<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span>ship<span class="delimiter">}</span></span>, mission:getValidEnemies())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroyragingminer-should-create-a-valid-mission-with-one-ship" class="paragraph">
<p> <details><summary> 
Missions:destroyRagingMiner() should create a valid Mission with one ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:destroyRagingMiner(CpuShip())

<span class="predefined">assert</span>.is_true(Mission:isMission(mission))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="missions-destroyragingminer-getvalidenemies">Missions:destroyRagingMiner():getValidEnemies(),</h3>
<div id="missions-destroyragingminer-getvalidenemies-countvalidenemies-getinvalidenemies-countinvalidenemies-getenemies-countenemies-return-correct-values" class="paragraph">
<p> <details><summary> 
Missions:destroyRagingMiner():getValidEnemies(), countValidEnemies(), getInvalidEnemies(), countInvalidEnemies(), getEnemies(), countEnemies() return correct values
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">enemy1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">enemy2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">enemy3</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:destroyRagingMiner(<span class="map"><span class="delimiter">{</span>enemy1, enemy2, enemy3<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, mission:countEnemies())
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, mission:countValidEnemies())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, mission:countInvalidEnemies())
<span class="predefined">assert</span>.contains_value(enemy1, mission:getEnemies())
<span class="predefined">assert</span>.contains_value(enemy2, mission:getEnemies())
<span class="predefined">assert</span>.contains_value(enemy3, mission:getEnemies())
<span class="predefined">assert</span>.contains_value(enemy1, mission:getValidEnemies())
<span class="predefined">assert</span>.contains_value(enemy2, mission:getValidEnemies())
<span class="predefined">assert</span>.contains_value(enemy3, mission:getValidEnemies())
<span class="predefined">assert</span>.not_contains_value(enemy1, mission:getInvalidEnemies())
<span class="predefined">assert</span>.not_contains_value(enemy2, mission:getInvalidEnemies())
<span class="predefined">assert</span>.not_contains_value(enemy3, mission:getInvalidEnemies())

enemy1:destroy()

<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, mission:countEnemies())
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, mission:countValidEnemies())
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, mission:countInvalidEnemies())
<span class="predefined">assert</span>.contains_value(enemy1, mission:getEnemies())
<span class="predefined">assert</span>.contains_value(enemy2, mission:getEnemies())
<span class="predefined">assert</span>.contains_value(enemy3, mission:getEnemies())
<span class="predefined">assert</span>.not_contains_value(enemy1, mission:getValidEnemies())
<span class="predefined">assert</span>.contains_value(enemy2, mission:getValidEnemies())
<span class="predefined">assert</span>.contains_value(enemy3, mission:getValidEnemies())
<span class="predefined">assert</span>.contains_value(enemy1, mission:getInvalidEnemies())
<span class="predefined">assert</span>.not_contains_value(enemy2, mission:getInvalidEnemies())
<span class="predefined">assert</span>.not_contains_value(enemy3, mission:getInvalidEnemies())

enemy2:destroy()
enemy3:destroy()

<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, mission:countEnemies())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, mission:countValidEnemies())
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, mission:countInvalidEnemies())
<span class="predefined">assert</span>.contains_value(enemy1, mission:getEnemies())
<span class="predefined">assert</span>.contains_value(enemy2, mission:getEnemies())
<span class="predefined">assert</span>.contains_value(enemy3, mission:getEnemies())
<span class="predefined">assert</span>.not_contains_value(enemy1, mission:getValidEnemies())
<span class="predefined">assert</span>.not_contains_value(enemy2, mission:getValidEnemies())
<span class="predefined">assert</span>.not_contains_value(enemy3, mission:getValidEnemies())
<span class="predefined">assert</span>.contains_value(enemy1, mission:getInvalidEnemies())
<span class="predefined">assert</span>.contains_value(enemy2, mission:getInvalidEnemies())
<span class="predefined">assert</span>.contains_value(enemy3, mission:getInvalidEnemies())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroyragingminer-getvalidenemies-countvalidenemies-getinvalidenemies-countinvalidenemies-getenemies-countenemies-returns-nil-it-it-is-called-before-the-ships-are-created-in-the-callback" class="paragraph">
<p> <details><summary> 
Missions:destroyRagingMiner():getValidEnemies(), countValidEnemies(), getInvalidEnemies(), countInvalidEnemies(), getEnemies(), countEnemies() returns nil it it is called before the ships are created in the callback
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">enemy1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">enemy2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">enemy3</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:destroyRagingMiner(<span class="keyword">function</span> () <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>enemy1, enemy2, enemy3<span class="delimiter">}</span></span> <span class="keyword">end</span>)

<span class="predefined">assert</span>.is_nil(mission:countEnemies())
<span class="predefined">assert</span>.is_nil(mission:countValidEnemies())
<span class="predefined">assert</span>.is_nil(mission:countInvalidEnemies())
<span class="predefined">assert</span>.is_nil(mission:getEnemies())
<span class="predefined">assert</span>.is_nil(mission:getValidEnemies())
<span class="predefined">assert</span>.is_nil(mission:getInvalidEnemies())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-destroyragingminer-getvalidenemies-countvalidenemies-getinvalidenemies-countinvalidenemies-getenemies-countenemies-should-not-allow-to-manipulate-the-tables" class="paragraph">
<p> <details><summary> 
Missions:destroyRagingMiner():getValidEnemies(), countValidEnemies(), getInvalidEnemies(), countInvalidEnemies(), getEnemies(), countEnemies() should not allow to manipulate the tables
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">enemy1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">enemy2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">enemy3</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:destroyRagingMiner(<span class="map"><span class="delimiter">{</span>enemy1, enemy2<span class="delimiter">}</span></span>)

<span class="keyword">local</span> <span class="local-variable">enemies</span> = mission:getEnemies()
table.insert(enemies, enemy3)

<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, mission:countEnemies())
<span class="predefined">assert</span>.not_contains_value(enemy3, mission:getEnemies())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="missions-disable">Missions:disable()</h3>
<div id="missions-disable-can-run-a-successful-mission" class="paragraph">
<p> <details><summary> 
Missions:disable() can run a successful mission
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:disable(ship, <span class="map"><span class="delimiter">{</span>
    <span class="key">damageThreshold</span> = <span class="float">-0.5</span>,
    <span class="key">distanceToFinish</span> = <span class="integer">1000</span>,
<span class="delimiter">}</span></span>)

ship:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
player:setPosition(<span class="integer">9999</span>, <span class="integer">0</span>)

mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())

player:setPosition(<span class="integer">500</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())

ship:setSystemHealth(<span class="string"><span class="delimiter">&quot;</span><span class="content">impulse</span><span class="delimiter">&quot;</span></span>, <span class="integer">-1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, mission:getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-disable-config-onapproach-is-called-when-the-player-first-enters-10u-around-the-target" class="paragraph">
<p> <details><summary> 
Missions:disable() config.onApproach is called when the player first enters 10u around the target
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">onApproachCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">onApproachArg1</span> = <span class="predefined-constant">nil</span>
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:disable(ship, <span class="map"><span class="delimiter">{</span> <span class="key">approachDistance</span> = <span class="integer">10000</span>, <span class="key">onApproach</span> = <span class="keyword">function</span>(arg1)
    <span class="key">onApproachArg1</span> = arg1
    <span class="key">onApproachCalled</span> = onApproachCalled + <span class="integer">1</span>
<span class="keyword">end</span><span class="delimiter">}</span></span>)

player:setPosition(<span class="integer">20000</span>, <span class="integer">0</span>)
ship:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)

mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onApproachCalled)

player:setPosition(<span class="integer">10001</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onApproachCalled)

player:setPosition(<span class="integer">9999</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onApproachCalled)
<span class="predefined">assert</span>.is_same(mission, onApproachArg1)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onApproachCalled)

player:setPosition(<span class="integer">10001</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
player:setPosition(<span class="integer">9999</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onApproachCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-disable-config-ondestruction-is-called-when-ship-is-completely-destroyed" class="paragraph">
<p> <details><summary> 
Missions:disable() config.onDestruction is called when ship is completely destroyed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">onDestructionCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">onDestructionArg1</span> = <span class="predefined-constant">nil</span>
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:disable(ship, <span class="map"><span class="delimiter">{</span> <span class="key">onDestruction</span> = <span class="keyword">function</span>(arg1)
    <span class="key">onDestructionArg1</span> = arg1
    <span class="key">onDestructionCalled</span> = onDestructionCalled + <span class="integer">1</span>
<span class="keyword">end</span><span class="delimiter">}</span></span>)

mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onDestructionCalled)

ship:destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onDestructionCalled)
<span class="predefined">assert</span>.is_same(mission, onDestructionArg1)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">failed</span><span class="delimiter">&quot;</span></span>, mission:getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-disable-config-onsurrender-closeness-is-necessary-for-surrender" class="paragraph">
<p> <details><summary> 
Missions:disable() config.onSurrender closeness is necessary for surrender
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">onSurrenderCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">onSurrenderArg1</span> = <span class="predefined-constant">nil</span>
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:disable(ship, <span class="map"><span class="delimiter">{</span>
    <span class="key">damageThreshold</span> = <span class="float">-0.5</span>,
    <span class="key">distanceToFinish</span> = <span class="integer">1000</span>,
    <span class="key">onSurrender</span> = <span class="keyword">function</span>(arg1)
        <span class="key">onSurrenderArg1</span> = arg1
        <span class="key">onSurrenderCalled</span> = onSurrenderCalled + <span class="integer">1</span>
    <span class="keyword">end</span>
<span class="delimiter">}</span></span>)

ship:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
player:setPosition(<span class="integer">9999</span>, <span class="integer">0</span>)

mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onSurrenderCalled)

ship:setSystemHealth(<span class="string"><span class="delimiter">&quot;</span><span class="content">impulse</span><span class="delimiter">&quot;</span></span>, <span class="integer">-1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onSurrenderCalled)

player:setPosition(<span class="integer">1001</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onSurrenderCalled)

player:setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onSurrenderCalled)
<span class="predefined">assert</span>.is_same(mission, onSurrenderArg1)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-disable-config-onsurrender-disabled-impulse-engine-is-necessary-for-surrender" class="paragraph">
<p> <details><summary> 
Missions:disable() config.onSurrender disabled impulse engine is necessary for surrender
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">onSurrenderCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">onSurrenderArg1</span> = <span class="predefined-constant">nil</span>
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:disable(ship, <span class="map"><span class="delimiter">{</span>
    <span class="key">damageThreshold</span> = <span class="float">-0.5</span>,
    <span class="key">distanceToFinish</span> = <span class="integer">1000</span>,
    <span class="key">onSurrender</span> = <span class="keyword">function</span>(arg1)
        <span class="key">onSurrenderArg1</span> = arg1
        <span class="key">onSurrenderCalled</span> = onSurrenderCalled + <span class="integer">1</span>
    <span class="keyword">end</span>
<span class="delimiter">}</span></span>)

ship:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
player:setPosition(<span class="integer">100</span>, <span class="integer">0</span>)

mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onSurrenderCalled)

ship:setSystemHealth(<span class="string"><span class="delimiter">&quot;</span><span class="content">impulse</span><span class="delimiter">&quot;</span></span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onSurrenderCalled)

ship:setSystemHealth(<span class="string"><span class="delimiter">&quot;</span><span class="content">impulse</span><span class="delimiter">&quot;</span></span>, <span class="float">-0.49</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onSurrenderCalled)

ship:setSystemHealth(<span class="string"><span class="delimiter">&quot;</span><span class="content">impulse</span><span class="delimiter">&quot;</span></span>, <span class="float">-0.5</span>)
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onSurrenderCalled)
<span class="predefined">assert</span>.is_same(mission, onSurrenderArg1)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-disable-config-onsurrender-jump-drive-needs-to-be-destroyed-too-if-a-ship-has-it" class="paragraph">
<p> <details><summary> 
Missions:disable() config.onSurrender jump drive needs to be destroyed too if a ship has it
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">onSurrenderCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">onSurrenderArg1</span> = <span class="predefined-constant">nil</span>
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
ship:setJumpDrive(<span class="predefined-constant">true</span>)
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:disable(ship, <span class="map"><span class="delimiter">{</span>
    <span class="key">damageThreshold</span> = <span class="float">-0.5</span>,
    <span class="key">distanceToFinish</span> = <span class="integer">1000</span>,
    <span class="key">onSurrender</span> = <span class="keyword">function</span>(arg1)
        <span class="key">onSurrenderArg1</span> = arg1
        <span class="key">onSurrenderCalled</span> = onSurrenderCalled + <span class="integer">1</span>
    <span class="keyword">end</span>
<span class="delimiter">}</span></span>)

mission:setPlayer(player)
mission:accept()
mission:start()

ship:setSystemHealth(<span class="string"><span class="delimiter">&quot;</span><span class="content">impulse</span><span class="delimiter">&quot;</span></span>, <span class="integer">-1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onSurrenderCalled)

ship:setSystemHealth(<span class="string"><span class="delimiter">&quot;</span><span class="content">jumpdrive</span><span class="delimiter">&quot;</span></span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onSurrenderCalled)


ship:setSystemHealth(<span class="string"><span class="delimiter">&quot;</span><span class="content">jumpdrive</span><span class="delimiter">&quot;</span></span>, <span class="float">-0.49</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onSurrenderCalled)

ship:setSystemHealth(<span class="string"><span class="delimiter">&quot;</span><span class="content">jumpdrive</span><span class="delimiter">&quot;</span></span>, <span class="float">-0.5</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onSurrenderCalled)
<span class="predefined">assert</span>.is_same(mission, onSurrenderArg1)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-disable-config-onsurrender-warp-drive-needs-to-be-destroyed-too-if-a-ship-has-it" class="paragraph">
<p> <details><summary> 
Missions:disable() config.onSurrender warp drive needs to be destroyed too if a ship has it
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">onSurrenderCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">onSurrenderArg1</span> = <span class="predefined-constant">nil</span>
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
ship:setWarpDrive(<span class="predefined-constant">true</span>)
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:disable(ship, <span class="map"><span class="delimiter">{</span>
    <span class="key">damageThreshold</span> = <span class="float">-0.5</span>,
    <span class="key">distanceToFinish</span> = <span class="integer">1000</span>,
    <span class="key">onSurrender</span> = <span class="keyword">function</span>(arg1)
        <span class="key">onSurrenderArg1</span> = arg1
        <span class="key">onSurrenderCalled</span> = onSurrenderCalled + <span class="integer">1</span>
    <span class="keyword">end</span>
<span class="delimiter">}</span></span>)

mission:setPlayer(player)
mission:accept()
mission:start()

ship:setSystemHealth(<span class="string"><span class="delimiter">&quot;</span><span class="content">impulse</span><span class="delimiter">&quot;</span></span>, <span class="integer">-1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onSurrenderCalled)

ship:setSystemHealth(<span class="string"><span class="delimiter">&quot;</span><span class="content">warp</span><span class="delimiter">&quot;</span></span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onSurrenderCalled)


ship:setSystemHealth(<span class="string"><span class="delimiter">&quot;</span><span class="content">warp</span><span class="delimiter">&quot;</span></span>, <span class="float">-0.49</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onSurrenderCalled)

ship:setSystemHealth(<span class="string"><span class="delimiter">&quot;</span><span class="content">warp</span><span class="delimiter">&quot;</span></span>, <span class="float">-0.5</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onSurrenderCalled)
<span class="predefined">assert</span>.is_same(mission, onSurrenderArg1)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-disable-fails-if-no-valid-ship-is-given" class="paragraph">
<p> <details><summary> 
Missions:disable() fails if no valid ship is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Missions:disable(<span class="predefined-constant">nil</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Missions:disable(personMock()) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Missions:disable(<span class="integer">42</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Missions:disable(SpaceStation()) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-disable-should-create-a-valid-mission-with-a-function-returning-a-ship" class="paragraph">
<p> <details><summary> 
Missions:disable() should create a valid Mission with a function returning a ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:disable(<span class="keyword">function</span>() <span class="keyword">return</span> CpuShip() <span class="keyword">end</span>)

<span class="predefined">assert</span>.is_true(Mission:isMission(mission))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-disable-should-create-a-valid-mission-with-one-ship" class="paragraph">
<p> <details><summary> 
Missions:disable() should create a valid Mission with one ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:disable(CpuShip())

<span class="predefined">assert</span>.is_true(Mission:isMission(mission))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="missions-disable-gettarget">Missions:disable():getTarget()</h3>
<div id="missions-disable-gettarget-returns-the-target-when-no-function-is-used" class="paragraph">
<p> <details><summary> 
Missions:disable():getTarget() returns the target when no function is used
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:disable(ship)

<span class="predefined">assert</span>.is_same(ship, mission:getTarget())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-disable-gettarget-returns-the-target-when-no-function-is-used" class="paragraph">
<p> <details><summary> 
Missions:disable():getTarget() returns the target when no function is used
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:disable(<span class="keyword">function</span>() <span class="keyword">return</span> ship <span class="keyword">end</span>)

<span class="predefined">assert</span>.is_nil(mission:getTarget())
mission:setPlayer(player)
mission:accept()
mission:start()
<span class="predefined">assert</span>.is_same(ship, mission:getTarget())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="missions-pickup">Missions:pickUp()</h3>
<div id="missions-pickup-can-run-a-happy-scenario-with-return-to-station" class="paragraph">
<p> <details><summary> 
Missions:pickUp() can run a happy scenario with return to station
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">artifact</span> = Artifact()
<span class="keyword">local</span> <span class="local-variable">supplyDrop</span> = SupplyDrop()
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()

<span class="keyword">local</span> <span class="local-variable">onStartCalled</span>, <span class="local-variable">onSuccessCalled</span>, <span class="local-variable">onEndCalled</span> = <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">onPickUpCalled</span>, <span class="local-variable">onPickUpArg1</span>, <span class="local-variable">onPickUpArg2</span> = <span class="integer">0</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>
<span class="keyword">local</span> <span class="local-variable">onAllPickedUpCalled</span>, <span class="local-variable">onAllPickedUpArg1</span> = <span class="integer">0</span>, <span class="predefined-constant">nil</span>
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:pickUp(<span class="map"><span class="delimiter">{</span>artifact, supplyDrop<span class="delimiter">}</span></span>, station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onStart</span> = <span class="keyword">function</span>() <span class="key">onStartCalled</span> = onStartCalled + <span class="integer">1</span> <span class="keyword">end</span>,
    <span class="key">onPickUp</span> = <span class="keyword">function</span>(arg1, arg2)
        <span class="key">onPickUpCalled</span> = onPickUpCalled + <span class="integer">1</span>
        <span class="key">onPickUpArg1</span> = arg1
        <span class="key">onPickUpArg2</span> = arg2
    <span class="keyword">end</span>,
    <span class="key">onAllPickedUp</span> = <span class="keyword">function</span>(arg1)
        <span class="key">onAllPickedUpCalled</span> = onAllPickedUpCalled + <span class="integer">1</span>
        <span class="key">onAllPickedUpArg1</span> = arg1
    <span class="keyword">end</span>,
    <span class="key">onSuccess</span> = <span class="keyword">function</span>() <span class="key">onSuccessCalled</span> = onSuccessCalled + <span class="integer">1</span> <span class="keyword">end</span>,
    <span class="key">onEnd</span> = <span class="keyword">function</span>() <span class="key">onEndCalled</span> = onEndCalled + <span class="integer">1</span> <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_true(Mission:isMission(mission))

mission:setPlayer(player)
mission:accept()
mission:start()

<span class="predefined">assert</span>.contains_value(artifact, mission:getPickUps())
<span class="predefined">assert</span>.contains_value(supplyDrop, mission:getPickUps())
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, mission:countPickUps())
<span class="predefined">assert</span>.is_same(station, mission:getDeliveryStation())
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onStartCalled)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onPickUpCalled)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onAllPickedUpCalled)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onSuccessCalled)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onEndCalled)

artifact:pickUp(player)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onPickUpCalled)
<span class="predefined">assert</span>.is_same(mission, onPickUpArg1)
<span class="predefined">assert</span>.is_same(artifact, onPickUpArg2)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onAllPickedUpCalled)

supplyDrop:pickUp(player)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, onPickUpCalled)
<span class="predefined">assert</span>.is_same(mission, onPickUpArg1)
<span class="predefined">assert</span>.is_same(supplyDrop, onPickUpArg2)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onAllPickedUpCalled)
<span class="predefined">assert</span>.is_same(mission, onAllPickedUpArg1)

Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onSuccessCalled)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onEndCalled)

player:setDockedAt(station)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onSuccessCalled)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onEndCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-pickup-can-run-a-happy-scenario-without-return-to-station" class="paragraph">
<p> <details><summary> 
Missions:pickUp() can run a happy scenario without return to station
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">artifact</span> = Artifact()
<span class="keyword">local</span> <span class="local-variable">supplyDrop</span> = SupplyDrop()
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()

<span class="keyword">local</span> <span class="local-variable">onStartCalled</span>, <span class="local-variable">onSuccessCalled</span>, <span class="local-variable">onEndCalled</span> = <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">onPickUpCalled</span>, <span class="local-variable">onPickUpArg1</span>, <span class="local-variable">onPickUpArg2</span> = <span class="integer">0</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>
<span class="keyword">local</span> <span class="local-variable">onAllPickedUpCalled</span>, <span class="local-variable">onAllPickedUpArg1</span> = <span class="integer">0</span>, <span class="predefined-constant">nil</span>
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:pickUp(<span class="map"><span class="delimiter">{</span>artifact, supplyDrop<span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">onStart</span> = <span class="keyword">function</span>() <span class="key">onStartCalled</span> = onStartCalled + <span class="integer">1</span> <span class="keyword">end</span>,
    <span class="key">onPickUp</span> = <span class="keyword">function</span>(arg1, arg2)
        <span class="key">onPickUpCalled</span> = onPickUpCalled + <span class="integer">1</span>
        <span class="key">onPickUpArg1</span> = arg1
        <span class="key">onPickUpArg2</span> = arg2
    <span class="keyword">end</span>,
    <span class="key">onAllPickedUp</span> = <span class="keyword">function</span>(arg1)
        <span class="key">onAllPickedUpCalled</span> = onAllPickedUpCalled + <span class="integer">1</span>
        <span class="key">onAllPickedUpArg1</span> = arg1
    <span class="keyword">end</span>,
    <span class="key">onSuccess</span> = <span class="keyword">function</span>() <span class="key">onSuccessCalled</span> = onSuccessCalled + <span class="integer">1</span> <span class="keyword">end</span>,
    <span class="key">onEnd</span> = <span class="keyword">function</span>() <span class="key">onEndCalled</span> = onEndCalled + <span class="integer">1</span> <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_true(Mission:isMission(mission))

mission:setPlayer(player)
mission:accept()
mission:start()

<span class="predefined">assert</span>.contains_value(artifact, mission:getPickUps())
<span class="predefined">assert</span>.contains_value(supplyDrop, mission:getPickUps())
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, mission:countPickUps())
<span class="predefined">assert</span>.is_nil(mission:getDeliveryStation())
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onStartCalled)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onPickUpCalled)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onAllPickedUpCalled)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onSuccessCalled)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onEndCalled)

artifact:pickUp(player)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onPickUpCalled)
<span class="predefined">assert</span>.is_same(mission, onPickUpArg1)
<span class="predefined">assert</span>.is_same(artifact, onPickUpArg2)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onAllPickedUpCalled)

supplyDrop:pickUp(player)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, onPickUpCalled)
<span class="predefined">assert</span>.is_same(mission, onPickUpArg1)
<span class="predefined">assert</span>.is_same(supplyDrop, onPickUpArg2)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onAllPickedUpCalled)
<span class="predefined">assert</span>.is_same(mission, onAllPickedUpArg1)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onSuccessCalled)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onEndCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-pickup-fails-if-a-pickup-disappears" class="paragraph">
<p> <details><summary> 
Missions:pickUp() fails if a pickup disappears
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">artifact</span> = Artifact()
<span class="keyword">local</span> <span class="local-variable">supplyDrop</span> = SupplyDrop()
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()

<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:pickUp(<span class="map"><span class="delimiter">{</span>artifact, supplyDrop<span class="delimiter">}</span></span>)

mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
artifact:destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">failed</span><span class="delimiter">&quot;</span></span>, mission:getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-pickup-fails-if-a-pickup-is-picked-up-by-a-different-player" class="paragraph">
<p> <details><summary> 
Missions:pickUp() fails if a pickup is picked up by a different player
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">artifact</span> = Artifact()
<span class="keyword">local</span> <span class="local-variable">supplyDrop</span> = SupplyDrop()
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">evilPlayer</span> = PlayerSpaceship()

<span class="keyword">local</span> <span class="local-variable">onPickUpCalled</span>, <span class="local-variable">onFailureCalled</span>, <span class="local-variable">onEndCalled</span> = <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:pickUp(<span class="map"><span class="delimiter">{</span>artifact, supplyDrop<span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">onPickUp</span> = <span class="keyword">function</span>() <span class="key">onPickUpCalled</span> = onPickUpCalled + <span class="integer">1</span> <span class="keyword">end</span>,
    <span class="key">onFailure</span> = <span class="keyword">function</span>() <span class="key">onFailureCalled</span> = onFailureCalled + <span class="integer">1</span> <span class="keyword">end</span>,
    <span class="key">onEnd</span> = <span class="keyword">function</span>() <span class="key">onEndCalled</span> = onEndCalled + <span class="integer">1</span> <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

mission:setPlayer(player)
mission:accept()
mission:start()

artifact:pickUp(evilPlayer)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onPickUpCalled)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onFailureCalled)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onEndCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-pickup-fails-if-deliverystation-disappears" class="paragraph">
<p> <details><summary> 
Missions:pickUp() fails if deliveryStation disappears
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">artifact</span> = Artifact()
<span class="keyword">local</span> <span class="local-variable">supplyDrop</span> = SupplyDrop()
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()

<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:pickUp(<span class="map"><span class="delimiter">{</span>artifact, supplyDrop<span class="delimiter">}</span></span>, station)

<span class="predefined">assert</span>.is_true(Mission:isMission(mission))

mission:setPlayer(player)
mission:accept()
mission:start()

station:destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">failed</span><span class="delimiter">&quot;</span></span>, mission:getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-pickup-fails-if-first-argument-is-invalid" class="paragraph">
<p> <details><summary> 
Missions:pickUp() fails if first argument is invalid
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:pickUp(SpaceStation()) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:pickUp(<span class="predefined-constant">nil</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:pickUp(<span class="integer">42</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:pickUp(<span class="map"><span class="delimiter">{</span>SpaceStation(), SupplyDrop()<span class="delimiter">}</span></span>) <span class="keyword">end</span>)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:pickUp(<span class="keyword">function</span>()
    <span class="keyword">return</span> SpaceStation()
<span class="keyword">end</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:pickUp(<span class="keyword">function</span>()
    <span class="keyword">return</span> <span class="predefined-constant">nil</span>
<span class="keyword">end</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:pickUp(<span class="keyword">function</span>()
    <span class="keyword">return</span> <span class="integer">42</span>
<span class="keyword">end</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Mission:pickUp(<span class="keyword">function</span>()
    <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>SpaceStation(), SupplyDrop()<span class="delimiter">}</span></span>
<span class="keyword">end</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-pickup-should-create-a-valid-mission-with-a-function-returning-a-supply-drop" class="paragraph">
<p> <details><summary> 
Missions:pickUp() should create a valid Mission with a function returning a supply drop
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">supplyDrop</span> = SupplyDrop()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:pickUp(<span class="keyword">function</span>() <span class="keyword">return</span> supplyDrop <span class="keyword">end</span>)

<span class="predefined">assert</span>.is_true(Mission:isMission(mission))

<span class="predefined">assert</span>.is_nil(mission:getPickUps())
<span class="predefined">assert</span>.is_nil(mission:countPickUps())

mission:setPlayer(player)
mission:accept()
mission:start()

<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span>supplyDrop<span class="delimiter">}</span></span>, mission:getPickUps())
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, mission:countPickUps())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-pickup-should-create-a-valid-mission-with-a-function-returning-a-supply-drop-and-artifact" class="paragraph">
<p> <details><summary> 
Missions:pickUp() should create a valid Mission with a function returning a supply drop and artifact
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">artifact</span> = Artifact()
<span class="keyword">local</span> <span class="local-variable">supplyDrop</span> = SupplyDrop()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:pickUp(<span class="keyword">function</span>() <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>artifact, supplyDrop<span class="delimiter">}</span></span> <span class="keyword">end</span>)

<span class="predefined">assert</span>.is_true(Mission:isMission(mission))

<span class="predefined">assert</span>.is_nil(mission:getPickUps())
<span class="predefined">assert</span>.is_nil(mission:countPickUps())

mission:setPlayer(player)
mission:accept()
mission:start()

<span class="predefined">assert</span>.contains_value(artifact, mission:getPickUps())
<span class="predefined">assert</span>.contains_value(supplyDrop, mission:getPickUps())
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, mission:countPickUps())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-pickup-should-create-a-valid-mission-with-a-function-returning-an-artifact" class="paragraph">
<p> <details><summary> 
Missions:pickUp() should create a valid Mission with a function returning an artifact
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">artifact</span> = Artifact()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:pickUp(<span class="keyword">function</span>() <span class="keyword">return</span> artifact <span class="keyword">end</span>)

<span class="predefined">assert</span>.is_true(Mission:isMission(mission))

<span class="predefined">assert</span>.is_nil(mission:getPickUps())
<span class="predefined">assert</span>.is_nil(mission:countPickUps())

mission:setPlayer(player)
mission:accept()
mission:start()

<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span>artifact<span class="delimiter">}</span></span>, mission:getPickUps())
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, mission:countPickUps())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-pickup-should-create-a-valid-mission-with-a-supply-drop" class="paragraph">
<p> <details><summary> 
Missions:pickUp() should create a valid Mission with a supply drop
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">supplyDrop</span> = SupplyDrop()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:pickUp(supplyDrop)

<span class="predefined">assert</span>.is_true(Mission:isMission(mission))

mission:setPlayer(player)
mission:accept()
mission:start()

<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span>supplyDrop<span class="delimiter">}</span></span>, mission:getPickUps())
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, mission:countPickUps())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-pickup-should-create-a-valid-mission-with-a-supply-drop-and-artifact" class="paragraph">
<p> <details><summary> 
Missions:pickUp() should create a valid Mission with a supply drop and artifact
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">artifact</span> = Artifact()
<span class="keyword">local</span> <span class="local-variable">supplyDrop</span> = SupplyDrop()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:pickUp(<span class="map"><span class="delimiter">{</span>artifact, supplyDrop<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_true(Mission:isMission(mission))

mission:setPlayer(player)
mission:accept()
mission:start()

<span class="predefined">assert</span>.contains_value(artifact, mission:getPickUps())
<span class="predefined">assert</span>.contains_value(supplyDrop, mission:getPickUps())
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, mission:countPickUps())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-pickup-should-create-a-valid-mission-with-an-artifact" class="paragraph">
<p> <details><summary> 
Missions:pickUp() should create a valid Mission with an artifact
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">artifact</span> = Artifact()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:pickUp(artifact)

<span class="predefined">assert</span>.is_true(Mission:isMission(mission))

mission:setPlayer(player)
mission:accept()
mission:start()

<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span>artifact<span class="delimiter">}</span></span>, mission:getPickUps())
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, mission:countPickUps())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="missions-scan">Missions:scan()</h3>
<div id="missions-scan-can-run-a-successful-mission-when-not-all-ships-are-destroyed" class="paragraph">
<p> <details><summary> 
Missions:scan() can run a successful mission when not all ships are destroyed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">target1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">target2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">target3</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:scan(<span class="map"><span class="delimiter">{</span> target1, target2, target3 <span class="delimiter">}</span></span>)

mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
target1:destroy()
target2:destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())
Cron.tick(<span class="integer">1</span>)
target3:fullScannedByPlayer()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, mission:getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-can-run-a-successful-mission-with-asteroids" class="paragraph">
<p> <details><summary> 
Missions:scan() can run a successful mission with asteroids
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">target1</span> = Asteroid()
<span class="keyword">local</span> <span class="local-variable">target2</span> = Asteroid()
<span class="keyword">local</span> <span class="local-variable">target3</span> = Asteroid()
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:scan(<span class="map"><span class="delimiter">{</span> target1, target2, target3 <span class="delimiter">}</span></span>)

mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
target1:scannedByPlayer()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())
Cron.tick(<span class="integer">1</span>)
target2:scannedByPlayer()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())
Cron.tick(<span class="integer">1</span>)
target3:scannedByPlayer()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, mission:getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-can-run-a-successful-mission-with-ships" class="paragraph">
<p> <details><summary> 
Missions:scan() can run a successful mission with ships
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">target1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">target2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">target3</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:scan(<span class="map"><span class="delimiter">{</span> target1, target2, target3 <span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span><span class="key">scan</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">full</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)

mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
target1:fullScannedByPlayer()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())
Cron.tick(<span class="integer">1</span>)
target2:fullScannedByPlayer()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())
Cron.tick(<span class="integer">1</span>)
target3:fullScannedByPlayer()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, mission:getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-config-ondestruction-is-called-when-a-target-is-destroyed" class="paragraph">
<p> <details><summary> 
Missions:scan() config.onDestruction is called when a target is destroyed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">target1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">target2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">callback1Called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">callback2Called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:scan(<span class="map"><span class="delimiter">{</span> target1, target2 <span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span><span class="key">onDestruction</span> = <span class="keyword">function</span>(callMission, callEnemy)
    <span class="predefined">assert</span>.is_same(mission, callMission)
    <span class="keyword">if</span> <span class="key">callEnemy</span> == target1 <span class="keyword">then</span> <span class="key">callback1Called</span> = callback1Called + <span class="integer">1</span> <span class="keyword">end</span>
    <span class="keyword">if</span> <span class="key">callEnemy</span> == target2 <span class="keyword">then</span> <span class="key">callback2Called</span> = callback2Called + <span class="integer">1</span> <span class="keyword">end</span>
<span class="keyword">end</span><span class="delimiter">}</span></span>)

mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, callback1Called)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, callback2Called)

target1:destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, callback1Called)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, callback2Called)

target2:destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, callback1Called)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, callback2Called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-config-ondestruction-the-unscanned-targets-are-already-updated" class="paragraph">
<p> <details><summary> 
Missions:scan() config.onDestruction the unscanned targets are already updated
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">target1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">target2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">calledArg1</span>, <span class="local-variable">calledArg2</span>, <span class="local-variable">calledUnscannedTargets</span>, <span class="local-variable">calledUnscannedTargetsCount</span>
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:scan(<span class="map"><span class="delimiter">{</span> target1, target2 <span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span><span class="key">onDestruction</span> = <span class="keyword">function</span>(arg1, arg2)
    <span class="key">calledArg1</span> = arg1
    <span class="key">calledArg2</span> = arg2
    <span class="key">calledUnscannedTargets</span> = arg1:getUnscannedTargets()
    <span class="key">calledUnscannedTargetsCount</span> = arg1:countUnscannedTargets()
<span class="keyword">end</span><span class="delimiter">}</span></span>)

mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)

target1:destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(mission, calledArg1)
<span class="predefined">assert</span>.is_same(target1, calledArg2)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, calledUnscannedTargetsCount)
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span>target2<span class="delimiter">}</span></span>, calledUnscannedTargets)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-config-onscan-is-called-by-default-simple-scan-was-run" class="paragraph">
<p> <details><summary> 
Missions:scan() config.onScan is called by default simple scan was run
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">target</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">callback1Called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:scan(target, <span class="map"><span class="delimiter">{</span><span class="key">onScan</span> = <span class="keyword">function</span>(callMission, callTarget)
    <span class="key">callback1Called</span> = callback1Called + <span class="integer">1</span>
    <span class="predefined">assert</span>.is_same(mission, callMission)
<span class="keyword">end</span><span class="delimiter">}</span></span>)

mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
target:friendOrFoeIdentifiedByPlayer()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, callback1Called)

Cron.tick(<span class="integer">1</span>)
target:scannedByPlayer()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, callback1Called)

target:fullScannedByPlayer()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, callback1Called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-config-onscan-is-called-each-time-a-target-is-scanned" class="paragraph">
<p> <details><summary> 
Missions:scan() config.onScan is called each time a target is scanned
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">target1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">target2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">target3</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">callback1Called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">callback2Called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">callback3Called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:scan(<span class="map"><span class="delimiter">{</span> target1, target2, target3 <span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span><span class="key">onScan</span> = <span class="keyword">function</span>(callMission, callTarget)
    <span class="keyword">if</span> <span class="key">callTarget</span> == target1 <span class="keyword">then</span> <span class="key">callback1Called</span> = callback1Called + <span class="integer">1</span> <span class="keyword">end</span>
    <span class="keyword">if</span> <span class="key">callTarget</span> == target2 <span class="keyword">then</span> <span class="key">callback2Called</span> = callback2Called + <span class="integer">1</span> <span class="keyword">end</span>
    <span class="keyword">if</span> <span class="key">callTarget</span> == target3 <span class="keyword">then</span> <span class="key">callback3Called</span> = callback3Called + <span class="integer">1</span> <span class="keyword">end</span>
    <span class="predefined">assert</span>.is_same(mission, callMission)
<span class="keyword">end</span><span class="delimiter">}</span></span>)

mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, callback1Called)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, callback2Called)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, callback3Called)

target1:fullScannedByPlayer()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, callback1Called)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, callback2Called)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, callback3Called)

target2:fullScannedByPlayer()
target3:fullScannedByPlayer()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, callback1Called)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, callback2Called)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, callback3Called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-config-onscan-is-called-when-friend-or-foe-is-identified" class="paragraph">
<p> <details><summary> 
Missions:scan() config.onScan is called when friend or foe is identified
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">target</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">callback1Called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:scan(target, <span class="map"><span class="delimiter">{</span><span class="key">scan</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">fof</span><span class="delimiter">&quot;</span></span>, <span class="key">onScan</span> = <span class="keyword">function</span>(callMission, callTarget)
    <span class="key">callback1Called</span> = callback1Called + <span class="integer">1</span>
    <span class="predefined">assert</span>.is_same(mission, callMission)
<span class="keyword">end</span><span class="delimiter">}</span></span>)

mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, callback1Called)

target:friendOrFoeIdentifiedByPlayer()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, callback1Called)

Cron.tick(<span class="integer">1</span>)
target:scannedByPlayer()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, callback1Called)

target:fullScannedByPlayer()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, callback1Called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-config-onscan-is-only-called-after-full-scan-when-a-full-scan-is-required" class="paragraph">
<p> <details><summary> 
Missions:scan() config.onScan is only called after full scan when a full scan is required
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">target</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">callback1Called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:scan(target, <span class="map"><span class="delimiter">{</span>
    <span class="key">scan</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">full</span><span class="delimiter">&quot;</span></span>,
    <span class="key">onScan</span> = <span class="keyword">function</span>(callMission, callTarget)
        <span class="key">callback1Called</span> = callback1Called + <span class="integer">1</span>
        <span class="predefined">assert</span>.is_same(mission, callMission)
    <span class="keyword">end</span> <span class="delimiter">}</span></span>
)

mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, callback1Called)

target:friendOrFoeIdentifiedByPlayer()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, callback1Called)

Cron.tick(<span class="integer">1</span>)
target:scannedByPlayer()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, callback1Called)

target:fullScannedByPlayer()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, callback1Called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-config-onscan-the-unscanned-targets-are-already-updated" class="paragraph">
<p> <details><summary> 
Missions:scan() config.onScan the unscanned targets are already updated
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">target1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">target2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">calledArg1</span>, <span class="local-variable">calledArg2</span>, <span class="local-variable">calledUnscannedTargets</span>, <span class="local-variable">calledUnscannedTargetsCount</span>
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:scan(<span class="map"><span class="delimiter">{</span> target1, target2 <span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span><span class="key">onScan</span> = <span class="keyword">function</span>(arg1, arg2)
    <span class="key">calledArg1</span> = arg1
    <span class="key">calledArg2</span> = arg2
    <span class="key">calledUnscannedTargets</span> = arg1:getUnscannedTargets()
    <span class="key">calledUnscannedTargetsCount</span> = arg1:countUnscannedTargets()
<span class="keyword">end</span><span class="delimiter">}</span></span>)

mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)

target1:fullScannedByPlayer()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(mission, calledArg1)
<span class="predefined">assert</span>.is_same(target1, calledArg2)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, calledUnscannedTargetsCount)
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span>target2<span class="delimiter">}</span></span>, calledUnscannedTargets)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-config-scan-can-be-set-to-fof-simple-or-full-for-ships" class="paragraph">
<p> <details><summary> 
Missions:scan() config.scan can be set to "fof", "simple" or "full" for ships
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">Missions:scan(CpuShip(), <span class="map"><span class="delimiter">{</span><span class="key">scan</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">fof</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
Missions:scan(<span class="map"><span class="delimiter">{</span>CpuShip(), CpuShip()<span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span><span class="key">scan</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">fof</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
Missions:scan(CpuShip(), <span class="map"><span class="delimiter">{</span><span class="key">scan</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">simple</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
Missions:scan(<span class="map"><span class="delimiter">{</span>CpuShip(), CpuShip()<span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span><span class="key">scan</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">simple</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
Missions:scan(CpuShip(), <span class="map"><span class="delimiter">{</span><span class="key">scan</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">full</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
Missions:scan(<span class="map"><span class="delimiter">{</span>CpuShip(), CpuShip()<span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span><span class="key">scan</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">full</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
<span class="comment">-- it does not error</span></code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-config-scan-can-be-set-to-simple-for-asteroids" class="paragraph">
<p> <details><summary> 
Missions:scan() config.scan can be set to "simple" for asteroids
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">Missions:scan(Asteroid(), <span class="map"><span class="delimiter">{</span><span class="key">scan</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">simple</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
Missions:scan(<span class="map"><span class="delimiter">{</span>Asteroid(), Asteroid()<span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span><span class="key">scan</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">simple</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
<span class="comment">-- it does not error</span></code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-config-scan-fails-if-it-is-an-unknown-string" class="paragraph">
<p> <details><summary> 
Missions:scan() config.scan fails if it is an unknown string
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Missions:scan(CpuShip(), <span class="map"><span class="delimiter">{</span><span class="key">scan</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-config-scan-fails-if-it-is-set-to-fof-and-function-returns-a-list-where-one-is-not-a-ship" class="paragraph">
<p> <details><summary> 
Missions:scan() config.scan fails if it is set to "fof" and function returns a list where one is not a ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:scan(<span class="keyword">function</span>() <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>Asteroid(), CpuShip()<span class="delimiter">}</span></span> <span class="keyword">end</span>, <span class="map"><span class="delimiter">{</span><span class="key">scan</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">fof</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
mission:setPlayer(player)
mission:accept()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission:start()
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-config-scan-fails-if-it-is-set-to-fof-and-function-returns-a-non-ship" class="paragraph">
<p> <details><summary> 
Missions:scan() config.scan fails if it is set to "fof" and function returns a non-ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:scan(<span class="keyword">function</span>() <span class="keyword">return</span> Asteroid() <span class="keyword">end</span>, <span class="map"><span class="delimiter">{</span><span class="key">scan</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">fof</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
mission:setPlayer(player)
mission:accept()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission:start()
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-config-scan-fails-if-it-is-set-to-fof-and-function-returns-multiple-non-ships" class="paragraph">
<p> <details><summary> 
Missions:scan() config.scan fails if it is set to "fof" and function returns multiple non-ships
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:scan(<span class="keyword">function</span>() <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>Asteroid(), Asteroid()<span class="delimiter">}</span></span> <span class="keyword">end</span>, <span class="map"><span class="delimiter">{</span><span class="key">scan</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">fof</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
mission:setPlayer(player)
mission:accept()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission:start()
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-config-scan-fails-if-it-is-set-to-fof-for-a-list-where-one-is-not-a-ship" class="paragraph">
<p> <details><summary> 
Missions:scan() config.scan fails if it is set to "fof" for a list where one is not a ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Missions:scan(<span class="map"><span class="delimiter">{</span>CpuShip(), Asteroid()<span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span><span class="key">scan</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">fof</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-config-scan-fails-if-it-is-set-to-fof-for-a-multiple-non-ship" class="paragraph">
<p> <details><summary> 
Missions:scan() config.scan fails if it is set to "fof" for a multiple non-ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Missions:scan(<span class="map"><span class="delimiter">{</span>Asteroid(), Asteroid()<span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span><span class="key">scan</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">fof</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-config-scan-fails-if-it-is-set-to-fof-for-a-non-ship" class="paragraph">
<p> <details><summary> 
Missions:scan() config.scan fails if it is set to "fof" for a non-ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Missions:scan(Asteroid(), <span class="map"><span class="delimiter">{</span><span class="key">scan</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">fof</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-config-scan-fails-if-it-is-set-to-full-and-function-returns-a-list-where-one-is-not-a-ship" class="paragraph">
<p> <details><summary> 
Missions:scan() config.scan fails if it is set to "full" and function returns a list where one is not a ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:scan(<span class="keyword">function</span>() <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>Asteroid(), CpuShip()<span class="delimiter">}</span></span> <span class="keyword">end</span>, <span class="map"><span class="delimiter">{</span><span class="key">scan</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">full</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
mission:setPlayer(player)
mission:accept()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission:start()
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-config-scan-fails-if-it-is-set-to-full-and-function-returns-a-non-ship" class="paragraph">
<p> <details><summary> 
Missions:scan() config.scan fails if it is set to "full" and function returns a non-ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:scan(<span class="keyword">function</span>() <span class="keyword">return</span> Asteroid() <span class="keyword">end</span>, <span class="map"><span class="delimiter">{</span><span class="key">scan</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">full</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
mission:setPlayer(player)
mission:accept()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission:start()
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-config-scan-fails-if-it-is-set-to-full-and-function-returns-multiple-non-ships" class="paragraph">
<p> <details><summary> 
Missions:scan() config.scan fails if it is set to "full" and function returns multiple non-ships
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:scan(<span class="keyword">function</span>() <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>Asteroid(), Asteroid()<span class="delimiter">}</span></span> <span class="keyword">end</span>, <span class="map"><span class="delimiter">{</span><span class="key">scan</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">full</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
mission:setPlayer(player)
mission:accept()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission:start()
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-config-scan-fails-if-it-is-set-to-full-for-a-list-where-one-is-not-a-ship" class="paragraph">
<p> <details><summary> 
Missions:scan() config.scan fails if it is set to "full" for a list where one is not a ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Missions:scan(<span class="map"><span class="delimiter">{</span>CpuShip(), Asteroid()<span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span><span class="key">scan</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">full</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-config-scan-fails-if-it-is-set-to-full-for-a-multiple-non-ship" class="paragraph">
<p> <details><summary> 
Missions:scan() config.scan fails if it is set to "full" for a multiple non-ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Missions:scan(<span class="map"><span class="delimiter">{</span>Asteroid(), Asteroid()<span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span><span class="key">scan</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">full</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-config-scan-fails-if-it-is-set-to-full-for-a-non-ship" class="paragraph">
<p> <details><summary> 
Missions:scan() config.scan fails if it is set to "full" for a non-ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Missions:scan(Asteroid(), <span class="map"><span class="delimiter">{</span><span class="key">scan</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">full</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-fails-if-a-call-back-function-is-given-that-returns-nil" class="paragraph">
<p> <details><summary> 
Missions:scan() fails if a call back function is given that returns nil
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:scan(<span class="keyword">function</span>() <span class="keyword">return</span> <span class="predefined-constant">nil</span> <span class="keyword">end</span>)
mission:setPlayer(player)
mission:accept()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission:start()
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-fails-if-no-player-was-set" class="paragraph">
<p> <details><summary> 
Missions:scan() fails if no player was set
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:scan(CpuShip())

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    mission:accept()
    mission:start()
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-fails-if-second-parameter-is-a-number" class="paragraph">
<p> <details><summary> 
Missions:scan() fails if second parameter is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Missions:scan(CpuShip(), <span class="integer">3</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-fails-if-the-first-parameter-is-not-given" class="paragraph">
<p> <details><summary> 
Missions:scan() fails if the first parameter is not given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Missions:scan() <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-fails-when-all-ships-are-destroyed-without-having-scanned-one" class="paragraph">
<p> <details><summary> 
Missions:scan() fails when all ships are destroyed without having scanned one
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">target1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">target2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">target3</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:scan(<span class="map"><span class="delimiter">{</span> target1, target2, target3 <span class="delimiter">}</span></span>)

mission:setPlayer(player)
mission:accept()
mission:start()

Cron.tick(<span class="integer">1</span>)
target1:destroy()
target2:destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())
Cron.tick(<span class="integer">1</span>)
target3:destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">failed</span><span class="delimiter">&quot;</span></span>, mission:getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-should-create-a-valid-mission-if-a-callback-function-is-given-that-returns-multiple-asteroids" class="paragraph">
<p> <details><summary> 
Missions:scan() should create a valid Mission if a callback function is given that returns multiple asteroids
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">thing1</span> = Asteroid()
<span class="keyword">local</span> <span class="local-variable">thing2</span> = Asteroid()
<span class="keyword">local</span> <span class="local-variable">thing3</span> = Asteroid()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:scan(<span class="keyword">function</span>() <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>thing1, thing2, thing3<span class="delimiter">}</span></span> <span class="keyword">end</span>)
<span class="predefined">assert</span>.is_true(Mission:isMission(mission))
mission:setPlayer(player)
mission:accept()
mission:start()

<span class="predefined">assert</span>.contains_value(thing1, mission:getTargets())
<span class="predefined">assert</span>.contains_value(thing2, mission:getTargets())
<span class="predefined">assert</span>.contains_value(thing3, mission:getTargets())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-should-create-a-valid-mission-if-a-callback-function-is-given-that-returns-multiple-mixed-objects" class="paragraph">
<p> <details><summary> 
Missions:scan() should create a valid Mission if a callback function is given that returns multiple mixed objects
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">thing1</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">thing2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">thing3</span> = Asteroid()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:scan(<span class="keyword">function</span>() <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>thing1, thing2, thing3<span class="delimiter">}</span></span> <span class="keyword">end</span>)
<span class="predefined">assert</span>.is_true(Mission:isMission(mission))
mission:setPlayer(player)
mission:accept()
mission:start()

<span class="predefined">assert</span>.contains_value(thing1, mission:getTargets())
<span class="predefined">assert</span>.contains_value(thing2, mission:getTargets())
<span class="predefined">assert</span>.contains_value(thing3, mission:getTargets())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-should-create-a-valid-mission-if-a-callback-function-is-given-that-returns-multiple-ships" class="paragraph">
<p> <details><summary> 
Missions:scan() should create a valid Mission if a callback function is given that returns multiple ships
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">thing1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">thing2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">thing3</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:scan(<span class="keyword">function</span>() <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>thing1, thing2, thing3<span class="delimiter">}</span></span> <span class="keyword">end</span>)
<span class="predefined">assert</span>.is_true(Mission:isMission(mission))
mission:setPlayer(player)
mission:accept()
mission:start()

<span class="predefined">assert</span>.contains_value(thing1, mission:getTargets())
<span class="predefined">assert</span>.contains_value(thing2, mission:getTargets())
<span class="predefined">assert</span>.contains_value(thing3, mission:getTargets())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-should-create-a-valid-mission-if-a-callback-function-is-given-that-returns-one-ship" class="paragraph">
<p> <details><summary> 
Missions:scan() should create a valid Mission if a callback function is given that returns one ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:scan(<span class="keyword">function</span>() <span class="keyword">return</span> ship <span class="keyword">end</span>)
<span class="predefined">assert</span>.is_true(Mission:isMission(mission))
mission:setPlayer(player)
mission:accept()
mission:start()

<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span>ship<span class="delimiter">}</span></span>, mission:getTargets())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-should-create-a-valid-mission-with-mixed-objects" class="paragraph">
<p> <details><summary> 
Missions:scan() should create a valid Mission with mixed objects
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">thing1</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">thing2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">thing3</span> = Asteroid()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:scan(<span class="map"><span class="delimiter">{</span>thing1, thing2, thing3<span class="delimiter">}</span></span>)
<span class="predefined">assert</span>.is_true(Mission:isMission(mission))
mission:setPlayer(player)
mission:accept()
mission:start()

<span class="predefined">assert</span>.contains_value(thing1, mission:getTargets())
<span class="predefined">assert</span>.contains_value(thing2, mission:getTargets())
<span class="predefined">assert</span>.contains_value(thing3, mission:getTargets())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-should-create-a-valid-mission-with-multiple-asteroids" class="paragraph">
<p> <details><summary> 
Missions:scan() should create a valid Mission with multiple asteroids
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">thing1</span> = Asteroid()
<span class="keyword">local</span> <span class="local-variable">thing2</span> = Asteroid()
<span class="keyword">local</span> <span class="local-variable">thing3</span> = Asteroid()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:scan(<span class="map"><span class="delimiter">{</span>thing1, thing2, thing3<span class="delimiter">}</span></span>)
<span class="predefined">assert</span>.is_true(Mission:isMission(mission))
mission:setPlayer(player)
mission:accept()
mission:start()

<span class="predefined">assert</span>.contains_value(thing1, mission:getTargets())
<span class="predefined">assert</span>.contains_value(thing2, mission:getTargets())
<span class="predefined">assert</span>.contains_value(thing3, mission:getTargets())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-should-create-a-valid-mission-with-multiple-ships" class="paragraph">
<p> <details><summary> 
Missions:scan() should create a valid Mission with multiple ships
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">thing1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">thing2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">thing3</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:scan(<span class="map"><span class="delimiter">{</span>thing1, thing2, thing3<span class="delimiter">}</span></span>)
<span class="predefined">assert</span>.is_true(Mission:isMission(mission))
mission:setPlayer(player)
mission:accept()
mission:start()

<span class="predefined">assert</span>.contains_value(thing1, mission:getTargets())
<span class="predefined">assert</span>.contains_value(thing2, mission:getTargets())
<span class="predefined">assert</span>.contains_value(thing3, mission:getTargets())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-should-create-a-valid-mission-with-one-ship" class="paragraph">
<p> <details><summary> 
Missions:scan() should create a valid Mission with one ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:scan(CpuShip())

<span class="predefined">assert</span>.is_true(Mission:isMission(mission))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="missions-scan-gettargets">Missions:scan():getTargets(),</h3>
<div id="missions-scan-gettargets-counttargets-getscannedtargets-countscannedtargets-getunscannedtargets-countunscannedtargets-return-correct-values" class="paragraph">
<p> <details><summary> 
Missions:scan():getTargets(), countTargets(), getScannedTargets(), countScannedTargets(), getUnscannedTargets(), countUnscannedTargets() return correct values
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">target1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">target2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">target3</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:scan(<span class="map"><span class="delimiter">{</span> target1, target2, target3 <span class="delimiter">}</span></span>)
mission:setPlayer(player)
mission:accept()
mission:start()

<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, mission:countTargets())
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, mission:countUnscannedTargets())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, mission:countScannedTargets())
<span class="predefined">assert</span>.contains_value(target1, mission:getTargets())
<span class="predefined">assert</span>.contains_value(target2, mission:getTargets())
<span class="predefined">assert</span>.contains_value(target3, mission:getTargets())
<span class="predefined">assert</span>.contains_value(target1, mission:getUnscannedTargets())
<span class="predefined">assert</span>.contains_value(target2, mission:getUnscannedTargets())
<span class="predefined">assert</span>.contains_value(target3, mission:getUnscannedTargets())
<span class="predefined">assert</span>.not_contains_value(target1, mission:getScannedTargets())
<span class="predefined">assert</span>.not_contains_value(target2, mission:getScannedTargets())
<span class="predefined">assert</span>.not_contains_value(target3, mission:getScannedTargets())

target1:fullScannedByPlayer()
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, mission:countTargets())
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, mission:countUnscannedTargets())
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, mission:countScannedTargets())
<span class="predefined">assert</span>.contains_value(target1, mission:getTargets())
<span class="predefined">assert</span>.contains_value(target2, mission:getTargets())
<span class="predefined">assert</span>.contains_value(target3, mission:getTargets())
<span class="predefined">assert</span>.not_contains_value(target1, mission:getUnscannedTargets())
<span class="predefined">assert</span>.contains_value(target2, mission:getUnscannedTargets())
<span class="predefined">assert</span>.contains_value(target3, mission:getUnscannedTargets())
<span class="predefined">assert</span>.contains_value(target1, mission:getScannedTargets())
<span class="predefined">assert</span>.not_contains_value(target2, mission:getScannedTargets())
<span class="predefined">assert</span>.not_contains_value(target3, mission:getScannedTargets())

target2:fullScannedByPlayer()
target3:fullScannedByPlayer()
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, mission:countTargets())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, mission:countUnscannedTargets())
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, mission:countScannedTargets())
<span class="predefined">assert</span>.contains_value(target1, mission:getTargets())
<span class="predefined">assert</span>.contains_value(target2, mission:getTargets())
<span class="predefined">assert</span>.contains_value(target3, mission:getTargets())
<span class="predefined">assert</span>.not_contains_value(target1, mission:getUnscannedTargets())
<span class="predefined">assert</span>.not_contains_value(target2, mission:getUnscannedTargets())
<span class="predefined">assert</span>.not_contains_value(target3, mission:getUnscannedTargets())
<span class="predefined">assert</span>.contains_value(target1, mission:getScannedTargets())
<span class="predefined">assert</span>.contains_value(target2, mission:getScannedTargets())
<span class="predefined">assert</span>.contains_value(target3, mission:getScannedTargets())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-gettargets-counttargets-getscannedtargets-countscannedtargets-getunscannedtargets-countunscannedtargets-return-correct-values-when-ships-are-destroyed" class="paragraph">
<p> <details><summary> 
Missions:scan():getTargets(), countTargets(), getScannedTargets(), countScannedTargets(), getUnscannedTargets(), countUnscannedTargets() return correct values when ships are destroyed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">target1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">target2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">target3</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:scan(<span class="map"><span class="delimiter">{</span> target1, target2, target3 <span class="delimiter">}</span></span>)
mission:setPlayer(player)
mission:accept()
mission:start()

<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, mission:countTargets())
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, mission:countUnscannedTargets())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, mission:countScannedTargets())
<span class="predefined">assert</span>.contains_value(target1, mission:getTargets())
<span class="predefined">assert</span>.contains_value(target2, mission:getTargets())
<span class="predefined">assert</span>.contains_value(target3, mission:getTargets())
<span class="predefined">assert</span>.contains_value(target1, mission:getUnscannedTargets())
<span class="predefined">assert</span>.contains_value(target2, mission:getUnscannedTargets())
<span class="predefined">assert</span>.contains_value(target3, mission:getUnscannedTargets())
<span class="predefined">assert</span>.not_contains_value(target1, mission:getScannedTargets())
<span class="predefined">assert</span>.not_contains_value(target2, mission:getScannedTargets())
<span class="predefined">assert</span>.not_contains_value(target3, mission:getScannedTargets())

target1:destroy()
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, mission:countTargets())
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, mission:countUnscannedTargets())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, mission:countScannedTargets())
<span class="predefined">assert</span>.contains_value(target1, mission:getTargets())
<span class="predefined">assert</span>.contains_value(target2, mission:getTargets())
<span class="predefined">assert</span>.contains_value(target3, mission:getTargets())
<span class="predefined">assert</span>.not_contains_value(target1, mission:getUnscannedTargets())
<span class="predefined">assert</span>.contains_value(target2, mission:getUnscannedTargets())
<span class="predefined">assert</span>.contains_value(target3, mission:getUnscannedTargets())
<span class="predefined">assert</span>.not_contains_value(target1, mission:getScannedTargets())
<span class="predefined">assert</span>.not_contains_value(target2, mission:getScannedTargets())
<span class="predefined">assert</span>.not_contains_value(target3, mission:getScannedTargets())

target2:fullScannedByPlayer()
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, mission:countTargets())
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, mission:countUnscannedTargets())
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, mission:countScannedTargets())
<span class="predefined">assert</span>.contains_value(target1, mission:getTargets())
<span class="predefined">assert</span>.contains_value(target2, mission:getTargets())
<span class="predefined">assert</span>.contains_value(target3, mission:getTargets())
<span class="predefined">assert</span>.not_contains_value(target1, mission:getUnscannedTargets())
<span class="predefined">assert</span>.not_contains_value(target2, mission:getUnscannedTargets())
<span class="predefined">assert</span>.contains_value(target3, mission:getUnscannedTargets())
<span class="predefined">assert</span>.not_contains_value(target1, mission:getScannedTargets())
<span class="predefined">assert</span>.contains_value(target2, mission:getScannedTargets())
<span class="predefined">assert</span>.not_contains_value(target3, mission:getScannedTargets())

target2:destroy()
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, mission:countTargets())
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, mission:countUnscannedTargets())
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, mission:countScannedTargets())
<span class="predefined">assert</span>.contains_value(target1, mission:getTargets())
<span class="predefined">assert</span>.contains_value(target2, mission:getTargets())
<span class="predefined">assert</span>.contains_value(target3, mission:getTargets())
<span class="predefined">assert</span>.not_contains_value(target1, mission:getUnscannedTargets())
<span class="predefined">assert</span>.not_contains_value(target2, mission:getUnscannedTargets())
<span class="predefined">assert</span>.contains_value(target3, mission:getUnscannedTargets())
<span class="predefined">assert</span>.not_contains_value(target1, mission:getScannedTargets())
<span class="predefined">assert</span>.contains_value(target2, mission:getScannedTargets())
<span class="predefined">assert</span>.not_contains_value(target3, mission:getScannedTargets())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-gettargets-counttargets-getscannedtargets-countscannedtargets-getunscannedtargets-countunscannedtargets-returns-nil-it-it-is-called-before-the-ships-are-created-in-the-callback" class="paragraph">
<p> <details><summary> 
Missions:scan():getTargets(), countTargets(), getScannedTargets(), countScannedTargets(), getUnscannedTargets(), countUnscannedTargets() returns nil it it is called before the ships are created in the callback
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">enemy1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">enemy2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">enemy3</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:scan(<span class="keyword">function</span> () <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>enemy1, enemy2, enemy3<span class="delimiter">}</span></span> <span class="keyword">end</span>)

<span class="predefined">assert</span>.is_nil(mission:countTargets())
<span class="predefined">assert</span>.is_nil(mission:countScannedTargets())
<span class="predefined">assert</span>.is_nil(mission:countUnscannedTargets())
<span class="predefined">assert</span>.is_nil(mission:getTargets())
<span class="predefined">assert</span>.is_nil(mission:getScannedTargets())
<span class="predefined">assert</span>.is_nil(mission:getUnscannedTargets())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-scan-gettargets-counttargets-getscannedtargets-countscannedtargets-getunscannedtargets-countunscannedtargets-should-not-allow-to-manipulate-the-tables" class="paragraph">
<p> <details><summary> 
Missions:scan():getTargets(), countTargets(), getScannedTargets(), countScannedTargets(), getUnscannedTargets(), countUnscannedTargets() should not allow to manipulate the tables
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">target1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">target2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">target3</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:scan(<span class="map"><span class="delimiter">{</span> target1, target2 <span class="delimiter">}</span></span>)
mission:setPlayer(player)
mission:accept()
mission:start()


<span class="keyword">local</span> <span class="local-variable">targets</span> = mission:getTargets()
table.insert(targets, target3)

<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, mission:countTargets())
<span class="predefined">assert</span>.not_contains_value(target3, mission:getTargets())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="missions-transportproduct">Missions:transportProduct()</h3>
<div id="missions-transportproduct-calls-oninsufficientstorage-if-the-player-ship-has-no-storage-as-soon-as-the-player-docks" class="paragraph">
<p> <details><summary> 
Missions:transportProduct() calls onInsufficientStorage if the player ship has no storage as soon as the player docks
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">onInsufficientStorageCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()

<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:transportProduct(from, to, product, <span class="map"><span class="delimiter">{</span>
    <span class="key">amount</span> = <span class="integer">42</span>,
    <span class="key">onInsufficientStorage</span> = <span class="keyword">function</span>(theMission)
        <span class="predefined">assert</span>.is_same(mission, theMission)
        <span class="key">onInsufficientStorageCalled</span> = onInsufficientStorageCalled + <span class="integer">1</span>
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
Mission:withBroker(mission, <span class="string"><span class="delimiter">&quot;</span><span class="content">Dummy</span><span class="delimiter">&quot;</span></span>)
Player:withStorage(player, <span class="map"><span class="delimiter">{</span><span class="key">maxStorage</span>=<span class="integer">100</span><span class="delimiter">}</span></span>)

mission:setPlayer(player)
mission:setMissionBroker(from)
mission:accept()
mission:start()

player:modifyProductStorage(product, <span class="integer">60</span>)

player.isDocked = <span class="keyword">function</span>(self, thing)
    <span class="keyword">return</span> thing == from
<span class="keyword">end</span>

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onInsufficientStorageCalled)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onInsufficientStorageCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-transportproduct-fails-if-first-parameter-is-not-a-station" class="paragraph">
<p> <details><summary> 
Missions:transportProduct() fails if first parameter is not a station
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">from</span> = CpuShip()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Missions:transportProduct(from, to, product) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-transportproduct-fails-if-fourth-parameter-is-a-number" class="paragraph">
<p> <details><summary> 
Missions:transportProduct() fails if fourth parameter is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Missions:transportProduct(from, to, product, <span class="integer">3</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-transportproduct-fails-if-second-parameter-is-not-a-station" class="paragraph">
<p> <details><summary> 
Missions:transportProduct() fails if second parameter is not a station
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Missions:transportProduct(from, CpuShip, product) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-transportproduct-fails-if-third-parameter-is-a-number" class="paragraph">
<p> <details><summary> 
Missions:transportProduct() fails if third parameter is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Missions:transportProduct(from, to, <span class="integer">3</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-transportproduct-fails-to-accept-if-mission-is-not-a-broker-mission" class="paragraph">
<p> <details><summary> 
Missions:transportProduct() fails to accept if mission is not a broker mission
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:transportProduct(from, to, product)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() mission:accept() <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-transportproduct-fails-to-accept-if-the-player-ship-has-no-storage-at-all" class="paragraph">
<p> <details><summary> 
Missions:transportProduct() fails to accept if the player ship has no storage at all
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">acceptConditionCalled</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:transportProduct(from, to, product, <span class="map"><span class="delimiter">{</span>
    <span class="key">acceptCondition</span> = <span class="keyword">function</span>(theMission, theError)
        <span class="predefined">assert</span>.is_same(mission, theMission)
        <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">no_storage</span><span class="delimiter">&quot;</span></span>, theError)
        <span class="key">acceptConditionCalled</span> = <span class="predefined-constant">true</span>
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">You have no storage</span><span class="delimiter">&quot;</span></span>
    <span class="keyword">end</span>
<span class="delimiter">}</span></span>)
Mission:withBroker(mission, <span class="string"><span class="delimiter">&quot;</span><span class="content">Dummy</span><span class="delimiter">&quot;</span></span>)

mission:setPlayer(player)
mission:setMissionBroker(from)

<span class="keyword">local</span> <span class="local-variable">success</span>, <span class="local-variable">message</span> = mission:canBeAccepted()
<span class="predefined">assert</span>.is_true(acceptConditionCalled)
<span class="predefined">assert</span>.is_false(success)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">You have no storage</span><span class="delimiter">&quot;</span></span>, message)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() mission:accept() <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-transportproduct-fails-to-accept-if-the-player-ship-has-too-little-storage-even-if-they-removed-everything" class="paragraph">
<p> <details><summary> 
Missions:transportProduct() fails to accept if the player ship has too little storage even if they removed everything
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">acceptConditionCalled</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:transportProduct(from, to, product, <span class="map"><span class="delimiter">{</span>
    <span class="key">amount</span> = <span class="integer">42</span>,
    <span class="key">acceptCondition</span> = <span class="keyword">function</span>(theMission, theError)
        <span class="predefined">assert</span>.is_same(mission, theMission)
        <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">small_storage</span><span class="delimiter">&quot;</span></span>, theError)
        <span class="key">acceptConditionCalled</span> = <span class="predefined-constant">true</span>
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">You have too little storage</span><span class="delimiter">&quot;</span></span>
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
Mission:withBroker(mission, <span class="string"><span class="delimiter">&quot;</span><span class="content">Dummy</span><span class="delimiter">&quot;</span></span>)

mission:setPlayer(player)
Player:withStorage(player, <span class="map"><span class="delimiter">{</span><span class="key">maxStorage</span>=<span class="integer">40</span><span class="delimiter">}</span></span>)
mission:setMissionBroker(from)

<span class="keyword">local</span> <span class="local-variable">success</span>, <span class="local-variable">message</span> = mission:canBeAccepted()
<span class="predefined">assert</span>.is_true(acceptConditionCalled)
<span class="predefined">assert</span>.is_false(success)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">You have too little storage</span><span class="delimiter">&quot;</span></span>, message)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() mission:accept() <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-transportproduct-fails-when-product-is-sold-or-lost" class="paragraph">
<p> <details><summary> 
Missions:transportProduct() fails when product is sold or lost
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">onProductLostCalled</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withStorage(player, <span class="map"><span class="delimiter">{</span><span class="key">maxStorage</span>=<span class="integer">100</span><span class="delimiter">}</span></span>)

<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:transportProduct(from, to, product, <span class="map"><span class="delimiter">{</span>
    <span class="key">amount</span> = <span class="integer">42</span>,
    <span class="key">onProductLost</span> = <span class="keyword">function</span>(theMission)
        <span class="predefined">assert</span>.is_same(mission, theMission)
        <span class="key">onProductLostCalled</span> = <span class="predefined-constant">true</span>
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
Mission:withBroker(mission, <span class="string"><span class="delimiter">&quot;</span><span class="content">Dummy</span><span class="delimiter">&quot;</span></span>)

mission:setPlayer(player)
mission:setMissionBroker(from)
mission:accept()
mission:start()

player.isDocked = <span class="keyword">function</span>()
    <span class="keyword">return</span> <span class="predefined-constant">false</span>
<span class="keyword">end</span>

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(mission:isLoaded())
<span class="predefined">assert</span>.is_false(onProductLostCalled)

player.isDocked = <span class="keyword">function</span>(self, thing)
    <span class="keyword">return</span> thing == from
<span class="keyword">end</span>

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_true(mission:isLoaded())
<span class="predefined">assert</span>.is_false(onProductLostCalled)

player:modifyProductStorage(product, <span class="integer">-10</span>)

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(mission:isLoaded())
<span class="predefined">assert</span>.is_true(onProductLostCalled)
<span class="predefined">assert</span>.is_same(<span class="integer">32</span>, player:getProductStorage(product))

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">failed</span><span class="delimiter">&quot;</span></span>, mission:getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-transportproduct-should-create-a-valid-mission" class="paragraph">
<p> <details><summary> 
Missions:transportProduct() should create a valid Mission
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:transportProduct(from, to, product)
<span class="predefined">assert</span>.is_true(Mission:isMission(mission))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-transportproduct-successful-mission" class="paragraph">
<p> <details><summary> 
Missions:transportProduct() successful mission
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">onLoadCalled</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">onUnloadCalled</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:transportProduct(from, to, product, <span class="map"><span class="delimiter">{</span>
    <span class="key">amount</span> = <span class="integer">42</span>,
    <span class="key">onLoad</span> = <span class="keyword">function</span>(theMission)
        <span class="predefined">assert</span>.is_same(mission, theMission)
        <span class="key">onLoadCalled</span> = <span class="predefined-constant">true</span>
    <span class="keyword">end</span>,
    <span class="key">onUnload</span> = <span class="keyword">function</span>(theMission)
        <span class="predefined">assert</span>.is_same(mission, theMission)
        <span class="key">onUnloadCalled</span> = <span class="predefined-constant">true</span>
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
Mission:withBroker(mission, <span class="string"><span class="delimiter">&quot;</span><span class="content">Dummy</span><span class="delimiter">&quot;</span></span>)

mission:setPlayer(player)
Player:withStorage(player, <span class="map"><span class="delimiter">{</span><span class="key">maxStorage</span>=<span class="integer">100</span><span class="delimiter">}</span></span>)
mission:setMissionBroker(from)
mission:accept()
mission:start()

player.isDocked = <span class="keyword">function</span>()
    <span class="keyword">return</span> <span class="predefined-constant">false</span>
<span class="keyword">end</span>

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(mission:isLoaded())
<span class="predefined">assert</span>.is_false(onLoadCalled)
<span class="predefined">assert</span>.is_false(onUnloadCalled)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getProductStorage(product))

player.isDocked = <span class="keyword">function</span>(self, thing)
    <span class="keyword">return</span> thing == from
<span class="keyword">end</span>

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_true(mission:isLoaded())
<span class="predefined">assert</span>.is_true(onLoadCalled)
<span class="predefined">assert</span>.is_false(onUnloadCalled)
<span class="predefined">assert</span>.is_same(<span class="integer">42</span>, player:getProductStorage(product))

player.isDocked = <span class="keyword">function</span>()
    <span class="keyword">return</span> <span class="predefined-constant">false</span>
<span class="keyword">end</span>

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)

player.isDocked = <span class="keyword">function</span>(self, thing)
    <span class="keyword">return</span> thing == to
<span class="keyword">end</span>

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(mission:isLoaded())
<span class="predefined">assert</span>.is_true(onLoadCalled)
<span class="predefined">assert</span>.is_true(onUnloadCalled)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getProductStorage(product))

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, mission:getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="missions-transporttoken">Missions:transportToken()</h3>
<div id="missions-transporttoken-can-run-a-successful-mission" class="paragraph">
<p> <details><summary> 
Missions:transportToken() can run a successful mission
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">onLoadCalled</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">onUnloadCalled</span> = <span class="predefined-constant">false</span>

<span class="keyword">local</span> <span class="local-variable">from</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">to</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:transportToken(from, to, <span class="map"><span class="delimiter">{</span>
    <span class="key">onLoad</span> = <span class="keyword">function</span>() <span class="key">onLoadCalled</span> = <span class="predefined-constant">true</span> <span class="keyword">end</span>,
    <span class="key">onUnload</span> = <span class="keyword">function</span>() <span class="key">onUnloadCalled</span> = <span class="predefined-constant">true</span> <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
Mission:withBroker(mission, <span class="string"><span class="delimiter">&quot;</span><span class="content">Dummy</span><span class="delimiter">&quot;</span></span>)

mission:setPlayer(player)
mission:setMissionBroker(from)
mission:accept()
mission:start()

player.isDocked = <span class="keyword">function</span>()
    <span class="keyword">return</span> <span class="predefined-constant">false</span>
<span class="keyword">end</span>

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(mission:isTokenLoaded())
<span class="predefined">assert</span>.is_false(onLoadCalled)
<span class="predefined">assert</span>.is_false(onUnloadCalled)

player.isDocked = <span class="keyword">function</span>(self, thing)
    <span class="keyword">return</span> thing == from
<span class="keyword">end</span>

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_true(mission:isTokenLoaded())
<span class="predefined">assert</span>.is_true(onLoadCalled)
<span class="predefined">assert</span>.is_false(onUnloadCalled)

player.isDocked = <span class="keyword">function</span>(self, thing)
    <span class="keyword">return</span> thing == to
<span class="keyword">end</span>

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(mission:isTokenLoaded())
<span class="predefined">assert</span>.is_true(onLoadCalled)
<span class="predefined">assert</span>.is_true(onUnloadCalled)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, mission:getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-transporttoken-fails-if-first-parameter-is-not-a-station" class="paragraph">
<p> <details><summary> 
Missions:transportToken() fails if first parameter is not a station
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">from</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">to</span> = SpaceStation()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Missions:transportToken(from, to) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-transporttoken-fails-if-second-parameter-is-not-a-station" class="paragraph">
<p> <details><summary> 
Missions:transportToken() fails if second parameter is not a station
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">from</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">to</span> = CpuShip()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Missions:transportToken(from, to) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-transporttoken-fails-if-third-parameter-is-a-number" class="paragraph">
<p> <details><summary> 
Missions:transportToken() fails if third parameter is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">from</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">to</span> = SpaceStation()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Missions:transportToken(from, to, <span class="integer">3</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-transporttoken-fails-to-start-if-mission-is-not-a-broker-mission" class="paragraph">
<p> <details><summary> 
Missions:transportToken() fails to start if mission is not a broker mission
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">from</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">to</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:transportToken(from, to)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() mission:accept() <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-transporttoken-should-create-a-valid-mission" class="paragraph">
<p> <details><summary> 
Missions:transportToken() should create a valid Mission
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">from</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">to</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:transportToken(from, to)

<span class="predefined">assert</span>.is_true(Mission:isMission(mission))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="missions-visit">Missions:visit()</h3>
<div id="missions-visit-can-run-a-successful-mission" class="paragraph">
<p> <details><summary> 
Missions:visit() can run a successful mission
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">onVisitCalled</span> = <span class="predefined-constant">false</span>

<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:visit(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onVisit</span> = <span class="keyword">function</span>() <span class="key">onVisitCalled</span> = <span class="predefined-constant">true</span> <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
Mission:withBroker(mission, <span class="string"><span class="delimiter">&quot;</span><span class="content">Dummy</span><span class="delimiter">&quot;</span></span>)

mission:setPlayer(player)
mission:setMissionBroker(station)
mission:accept()
mission:start()

player.isDocked = <span class="keyword">function</span>()
    <span class="keyword">return</span> <span class="predefined-constant">false</span>
<span class="keyword">end</span>

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(onVisitCalled)

player.isDocked = <span class="keyword">function</span>(self, thing)
    <span class="keyword">return</span> thing == station
<span class="keyword">end</span>

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_true(onVisitCalled)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, mission:getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-visit-fails-if-first-parameter-is-not-a-station" class="paragraph">
<p> <details><summary> 
Missions:visit() fails if first parameter is not a station
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = CpuShip()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Missions:visit(station) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-visit-fails-if-second-parameter-is-a-number" class="paragraph">
<p> <details><summary> 
Missions:visit() fails if second parameter is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Missions:visit(station, <span class="integer">3</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-visit-fails-to-start-if-mission-is-not-a-broker-mission" class="paragraph">
<p> <details><summary> 
Missions:visit() fails to start if mission is not a broker mission
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:visit(station)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() mission:accept() <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-visit-should-create-a-valid-mission" class="paragraph">
<p> <details><summary> 
Missions:visit() should create a valid Mission
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:visit(station, to)

<span class="predefined">assert</span>.is_true(Mission:isMission(mission))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="missions-waypoints">Missions:wayPoints()</h3>
<div id="missions-waypoints-can-run-a-successful-mission-while-adding-waypoints-dynamically" class="paragraph">
<p> <details><summary> 
Missions:wayPoints() can run a successful mission while adding waypoints dynamically
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">onWayPointCalled</span> = <span class="integer">0</span>

<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:wayPoints(<span class="predefined-constant">nil</span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">minDistance</span> = <span class="integer">1000</span>,
    <span class="key">onStart</span> = <span class="keyword">function</span>(self)
        self:addWayPoint(<span class="integer">10000</span>, <span class="integer">0</span>)
    <span class="keyword">end</span>,
    <span class="key">onWayPoint</span> = <span class="keyword">function</span>(self, x, y)
        <span class="key">onWayPointCalled</span> = onWayPointCalled + <span class="integer">1</span>
        <span class="keyword">if</span> isEeObject(x) <span class="keyword">then</span>
            x, <span class="key">y</span> = x:getPosition()
        <span class="keyword">end</span>
        <span class="keyword">if</span> x &lt; <span class="integer">49999</span> <span class="keyword">then</span>
            <span class="key">x</span> = x + <span class="integer">10000</span>
            <span class="keyword">if</span> x &gt; <span class="integer">25000</span> <span class="keyword">then</span>
                <span class="comment">-- make sure the current position is used and not the one when it was added</span>
                <span class="keyword">local</span> <span class="local-variable">artifact</span> = Artifact():setPosition(x / <span class="integer">2</span>, y / <span class="integer">2</span>)
                self:addWayPoint(artifact)
                artifact:setPosition(x, y)
            <span class="keyword">else</span>
                self:addWayPoint(x, y)
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

mission:setPlayer(player)
mission:accept()
mission:start()

player:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, mission:countVisitedWayPoints())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onWayPointCalled)

player:setPosition(<span class="integer">10000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, mission:countVisitedWayPoints())
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onWayPointCalled)

player:setPosition(<span class="integer">20000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, mission:countVisitedWayPoints())
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, onWayPointCalled)

player:setPosition(<span class="integer">30000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, mission:countVisitedWayPoints())
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, onWayPointCalled)

player:setPosition(<span class="integer">40000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="integer">4</span>, mission:countVisitedWayPoints())
<span class="predefined">assert</span>.is_same(<span class="integer">4</span>, onWayPointCalled)

player:setPosition(<span class="integer">50000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, mission:getState())
<span class="predefined">assert</span>.is_same(<span class="integer">5</span>, mission:countVisitedWayPoints())
<span class="predefined">assert</span>.is_same(<span class="integer">5</span>, onWayPointCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-waypoints-can-run-a-successful-mission-with-a-static-list-of-waypoints" class="paragraph">
<p> <details><summary> 
Missions:wayPoints() can run a successful mission with a static list of waypoints
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">onWayPointCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">callbackArg2</span> = <span class="predefined-constant">nil</span>
<span class="keyword">local</span> <span class="local-variable">callbackArg3</span> = <span class="predefined-constant">nil</span>

<span class="keyword">local</span> <span class="local-variable">artifact</span> = Artifact():setPosition(<span class="integer">10000</span>, <span class="integer">0</span>)

<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">mission</span>
mission = Missions:wayPoints(<span class="map"><span class="delimiter">{</span>
    <span class="map"><span class="inline-delimiter">{</span><span class="integer">10000</span>, <span class="integer">10000</span><span class="inline-delimiter">}</span></span>,
    artifact,
    <span class="map"><span class="inline-delimiter">{</span><span class="integer">0</span>, <span class="integer">0</span><span class="inline-delimiter">}</span></span>
<span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">minDistance</span> = <span class="integer">1000</span>,
    <span class="key">onWayPoint</span> = <span class="keyword">function</span>(callMission, arg2, arg3)
        <span class="key">onWayPointCalled</span> = onWayPointCalled + <span class="integer">1</span>
        callbackArg2, <span class="key">callbackArg3</span> = arg2, arg3
        <span class="predefined">assert</span>.is_same(mission, callMission)
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

mission:setPlayer(player)
mission:accept()
mission:start()

player:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, mission:countVisitedWayPoints())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onWayPointCalled)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())

<span class="comment">-- move artifact to verify the current position of the object is used</span>
artifact:setPosition(<span class="integer">20000</span>, <span class="integer">0</span>)

player:setPosition(<span class="integer">20000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="comment">-- it should not count, because the waypoints should be visited sequentially</span>
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, mission:countVisitedWayPoints())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onWayPointCalled)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())

player:setPosition(<span class="integer">10000</span>, <span class="integer">10000</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, mission:countVisitedWayPoints())
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onWayPointCalled)
<span class="predefined">assert</span>.is_same(<span class="integer">10000</span>, callbackArg2)
<span class="predefined">assert</span>.is_same(<span class="integer">10000</span>, callbackArg3)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())

player:setPosition(<span class="integer">20000</span>, <span class="integer">900</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="comment">-- it should allow to be minDistance away</span>
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, mission:countVisitedWayPoints())
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, onWayPointCalled)
<span class="predefined">assert</span>.is_same(artifact, callbackArg2)
<span class="predefined">assert</span>.is_same(<span class="predefined-constant">nil</span>, callbackArg3)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">started</span><span class="delimiter">&quot;</span></span>, mission:getState())

player:setPosition(<span class="integer">200</span>, <span class="integer">-300</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, mission:countVisitedWayPoints())
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, onWayPointCalled)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, callbackArg2)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, callbackArg3)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">successful</span><span class="delimiter">&quot;</span></span>, mission:getState())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-waypoints-fails-if-first-parameter-does-not-contain-valid-data" class="paragraph">
<p> <details><summary> 
Missions:wayPoints() fails if first parameter does not contain valid data
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Missions:wayPoints(<span class="map"><span class="delimiter">{</span> <span class="integer">42</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Missions:wayPoints(<span class="map"><span class="delimiter">{</span> <span class="map"><span class="inline-delimiter">{</span> <span class="integer">42</span>, <span class="integer">42</span><span class="inline-delimiter">}</span></span>, <span class="map"><span class="inline-delimiter">{</span> <span class="integer">0</span>, <span class="integer">0</span><span class="inline-delimiter">}</span></span>, <span class="map"><span class="inline-delimiter">{</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">this</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">is</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">invalid</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span><span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-waypoints-fails-if-first-parameter-is-a-number" class="paragraph">
<p> <details><summary> 
Missions:wayPoints() fails if first parameter is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Missions:wayPoints(<span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-waypoints-should-create-a-valid-mission" class="paragraph">
<p> <details><summary> 
Missions:wayPoints() should create a valid Mission
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:wayPoints(<span class="map"><span class="delimiter">{</span> <span class="map"><span class="inline-delimiter">{</span> <span class="integer">0</span>, <span class="integer">0</span><span class="inline-delimiter">}</span></span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_true(Mission:isMission(mission))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="missions-waypoints-addwaypoint">Missions:wayPoints():addWayPoint()</h3>
<div id="missions-waypoints-addwaypoint-allows-to-add-an-ee-object" class="paragraph">
<p> <details><summary> 
Missions:wayPoints():addWayPoint() allows to add an EE object
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:wayPoints()
mission:addWayPoint(Artifact():setPosition(<span class="integer">2000</span>, <span class="integer">-2000</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-waypoints-addwaypoint-allows-to-add-coordinates" class="paragraph">
<p> <details><summary> 
Missions:wayPoints():addWayPoint() allows to add coordinates
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:wayPoints()
mission:addWayPoint(<span class="integer">2000</span>, <span class="integer">-2000</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-waypoints-addwaypoint-fails-if-first-parameter-is-not-a-number" class="paragraph">
<p> <details><summary> 
Missions:wayPoints():addWayPoint() fails if first parameter is not a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:wayPoints()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() mission:addWayPoint(<span class="predefined-constant">nil</span>, <span class="integer">0</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() mission:addWayPoint(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>, <span class="integer">0</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="missions-waypoints-addwaypoint-fails-if-second-parameter-is-not-a-number" class="paragraph">
<p> <details><summary> 
Missions:wayPoints():addWayPoint() fails if second parameter is not a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">mission</span> = Missions:wayPoints()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() mission:addWayPoint(<span class="integer">0</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() mission:addWayPoint(<span class="integer">0</span>, <span class="predefined-constant">nil</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() mission:addWayPoint(<span class="integer">0</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() mission:addWayPoint(<span class="integer">0</span>, SpaceShip()) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="order">Order</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="order-attack">Order:attack()</h3>
<div id="order-attack-fails-if-enemy-is-neutral-for-fleet" class="paragraph">
<p> <details><summary> 
Order:attack() fails if enemy is neutral for fleet
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>
    CpuShip():setFactionId(<span class="integer">0</span>),
    CpuShip():setFactionId(<span class="integer">0</span>),
    CpuShip():setFactionId(<span class="integer">0</span>),
<span class="delimiter">}</span></span>)
<span class="keyword">local</span> <span class="local-variable">enemy</span> = SpaceStation():setFactionId(<span class="integer">1</span>)

Fleet:withOrderQueue(fleet)
<span class="keyword">local</span> <span class="local-variable">onAbortCalled</span>, <span class="local-variable">abortArg1</span>, <span class="local-variable">abortArg2</span>, <span class="local-variable">abortArg3</span> = <span class="integer">0</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>
<span class="keyword">local</span> <span class="local-variable">order</span> = Order:attack(enemy, <span class="map"><span class="delimiter">{</span>
    <span class="key">onAbort</span> = <span class="keyword">function</span>(arg1, arg2, arg3)
        <span class="key">onAbortCalled</span> = onAbortCalled + <span class="integer">1</span>
        <span class="key">abortArg1</span> = arg1
        <span class="key">abortArg2</span> = arg2
        <span class="key">abortArg3</span> = arg3
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
fleet:addOrder(order)

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onAbortCalled)
<span class="predefined">assert</span>.is_same(order, abortArg1)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">no_enemy</span><span class="delimiter">&quot;</span></span>, abortArg2)
<span class="predefined">assert</span>.is_same(fleet, abortArg3)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Idle</span><span class="delimiter">&quot;</span></span>, fleet:getLeader():getOrder())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-attack-fails-if-enemy-is-neutral-for-ship" class="paragraph">
<p> <details><summary> 
Order:attack() fails if enemy is neutral for ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setFactionId(<span class="integer">0</span>)
<span class="keyword">local</span> <span class="local-variable">enemy</span> = SpaceStation():setFactionId(<span class="integer">1</span>)

Ship:withOrderQueue(ship)
<span class="keyword">local</span> <span class="local-variable">onAbortCalled</span>, <span class="local-variable">abortArg1</span>, <span class="local-variable">abortArg2</span>, <span class="local-variable">abortArg3</span> = <span class="integer">0</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>
<span class="keyword">local</span> <span class="local-variable">order</span> = Order:attack(enemy, <span class="map"><span class="delimiter">{</span>
    <span class="key">onAbort</span> = <span class="keyword">function</span>(arg1, arg2, arg3)
        <span class="key">onAbortCalled</span> = onAbortCalled + <span class="integer">1</span>
        <span class="key">abortArg1</span> = arg1
        <span class="key">abortArg2</span> = arg2
        <span class="key">abortArg3</span> = arg3
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
ship:addOrder(order)

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onAbortCalled)
<span class="predefined">assert</span>.is_same(order, abortArg1)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">no_enemy</span><span class="delimiter">&quot;</span></span>, abortArg2)
<span class="predefined">assert</span>.is_same(ship, abortArg3)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Idle</span><span class="delimiter">&quot;</span></span>, ship:getOrder())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-attack-fails-if-enemy-turns-into-neutral-for-fleet" class="paragraph">
<p> <details><summary> 
Order:attack() fails if enemy turns into neutral for fleet
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>
    CpuShip():setFactionId(<span class="integer">1</span>),
    CpuShip():setFactionId(<span class="integer">1</span>),
    CpuShip():setFactionId(<span class="integer">1</span>),
<span class="delimiter">}</span></span>)
<span class="keyword">local</span> <span class="local-variable">enemy</span> = SpaceStation():setFactionId(<span class="integer">2</span>)

Fleet:withOrderQueue(fleet)
<span class="keyword">local</span> <span class="local-variable">onAbortCalled</span>, <span class="local-variable">abortArg1</span>, <span class="local-variable">abortArg2</span>, <span class="local-variable">abortArg3</span> = <span class="integer">0</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>
<span class="keyword">local</span> <span class="local-variable">order</span> = Order:attack(enemy, <span class="map"><span class="delimiter">{</span>
    <span class="key">onAbort</span> = <span class="keyword">function</span>(arg1, arg2, arg3)
        <span class="key">onAbortCalled</span> = onAbortCalled + <span class="integer">1</span>
        <span class="key">abortArg1</span> = arg1
        <span class="key">abortArg2</span> = arg2
        <span class="key">abortArg3</span> = arg3
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
fleet:addOrder(order)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Attack</span><span class="delimiter">&quot;</span></span>, fleet:getLeader():getOrder())

enemy:setFactionId(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onAbortCalled)
<span class="predefined">assert</span>.is_same(order, abortArg1)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">no_enemy</span><span class="delimiter">&quot;</span></span>, abortArg2)
<span class="predefined">assert</span>.is_same(fleet, abortArg3)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Idle</span><span class="delimiter">&quot;</span></span>, fleet:getLeader():getOrder())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-attack-fails-if-enemy-turns-into-neutral-for-ship" class="paragraph">
<p> <details><summary> 
Order:attack() fails if enemy turns into neutral for ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setFactionId(<span class="integer">1</span>)
<span class="keyword">local</span> <span class="local-variable">enemy</span> = SpaceStation():setFactionId(<span class="integer">2</span>)

Ship:withOrderQueue(ship)
<span class="keyword">local</span> <span class="local-variable">onAbortCalled</span>, <span class="local-variable">abortArg1</span>, <span class="local-variable">abortArg2</span>, <span class="local-variable">abortArg3</span> = <span class="integer">0</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>
<span class="keyword">local</span> <span class="local-variable">order</span> = Order:attack(enemy, <span class="map"><span class="delimiter">{</span>
    <span class="key">onAbort</span> = <span class="keyword">function</span>(arg1, arg2, arg3)
        <span class="key">onAbortCalled</span> = onAbortCalled + <span class="integer">1</span>
        <span class="key">abortArg1</span> = arg1
        <span class="key">abortArg2</span> = arg2
        <span class="key">abortArg3</span> = arg3
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
ship:addOrder(order)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Attack</span><span class="delimiter">&quot;</span></span>, ship:getOrder())

enemy:setFactionId(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onAbortCalled)
<span class="predefined">assert</span>.is_same(order, abortArg1)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">no_enemy</span><span class="delimiter">&quot;</span></span>, abortArg2)
<span class="predefined">assert</span>.is_same(ship, abortArg3)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Idle</span><span class="delimiter">&quot;</span></span>, ship:getOrder())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-attack-fails-if-no-station-or-ship-is-given" class="paragraph">
<p> <details><summary> 
Order:attack() fails if no station or ship is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:attack(<span class="predefined-constant">nil</span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:attack(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:attack(Asteroid())
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="order-defend">Order:defend()</h3>
<div id="order-defend-target-aborts-if-target-is-destroyed-fleet" class="paragraph">
<p> <details><summary> 
Order:defend() target aborts if target is destroyed (fleet)
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>
    CpuShip(),
    CpuShip(),
    CpuShip(),
<span class="delimiter">}</span></span>)
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
station.areEnemiesInRange = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="predefined-constant">false</span> <span class="keyword">end</span>

Fleet:withOrderQueue(fleet)
<span class="keyword">local</span> <span class="local-variable">onAbortCalled</span>, <span class="local-variable">abortArg1</span>, <span class="local-variable">abortArg2</span>, <span class="local-variable">abortArg3</span> = <span class="integer">0</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>
<span class="keyword">local</span> <span class="local-variable">order</span> = Order:defend(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onAbort</span> = <span class="keyword">function</span>(arg1, arg2, arg3)
        <span class="key">onAbortCalled</span> = onAbortCalled + <span class="integer">1</span>
        <span class="key">abortArg1</span> = arg1
        <span class="key">abortArg2</span> = arg2
        <span class="key">abortArg3</span> = arg3
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
fleet:addOrder(order)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onAbortCalled)
Cron.tick(<span class="integer">1</span>)

station:destroy()
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onAbortCalled)
<span class="predefined">assert</span>.is_same(order, abortArg1)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">destroyed</span><span class="delimiter">&quot;</span></span>, abortArg2)
<span class="predefined">assert</span>.is_same(fleet, abortArg3)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Idle</span><span class="delimiter">&quot;</span></span>, fleet:getLeader():getOrder())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-defend-target-aborts-if-target-is-destroyed-ship" class="paragraph">
<p> <details><summary> 
Order:defend() target aborts if target is destroyed (ship)
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
station.areEnemiesInRange = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="predefined-constant">false</span> <span class="keyword">end</span>

Ship:withOrderQueue(ship)
<span class="keyword">local</span> <span class="local-variable">onAbortCalled</span>, <span class="local-variable">abortArg1</span>, <span class="local-variable">abortArg2</span>, <span class="local-variable">abortArg3</span> = <span class="integer">0</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>
<span class="keyword">local</span> <span class="local-variable">order</span> = Order:defend(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onAbort</span> = <span class="keyword">function</span>(arg1, arg2, arg3)
        <span class="key">onAbortCalled</span> = onAbortCalled + <span class="integer">1</span>
        <span class="key">abortArg1</span> = arg1
        <span class="key">abortArg2</span> = arg2
        <span class="key">abortArg3</span> = arg3
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
ship:addOrder(order)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onAbortCalled)
Cron.tick(<span class="integer">1</span>)

station:destroy()
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onAbortCalled)
<span class="predefined">assert</span>.is_same(order, abortArg1)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">destroyed</span><span class="delimiter">&quot;</span></span>, abortArg2)
<span class="predefined">assert</span>.is_same(ship, abortArg3)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Idle</span><span class="delimiter">&quot;</span></span>, ship:getOrder())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-defend-target-aborts-if-target-is-enemy-of-fleet" class="paragraph">
<p> <details><summary> 
Order:defend() target aborts if target is enemy of fleet
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>
    CpuShip():setFactionId(<span class="integer">1</span>),
    CpuShip():setFactionId(<span class="integer">1</span>),
    CpuShip():setFactionId(<span class="integer">1</span>)
<span class="delimiter">}</span></span>)
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation():setFactionId(<span class="integer">2</span>)
station.areEnemiesInRange = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="predefined-constant">false</span> <span class="keyword">end</span>

Fleet:withOrderQueue(fleet)
<span class="keyword">local</span> <span class="local-variable">onAbortCalled</span>, <span class="local-variable">abortArg1</span>, <span class="local-variable">abortArg2</span>, <span class="local-variable">abortArg3</span> = <span class="integer">0</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>
<span class="keyword">local</span> <span class="local-variable">order</span> = Order:defend(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onAbort</span> = <span class="keyword">function</span>(arg1, arg2, arg3)
        <span class="key">onAbortCalled</span> = onAbortCalled + <span class="integer">1</span>
        <span class="key">abortArg1</span> = arg1
        <span class="key">abortArg2</span> = arg2
        <span class="key">abortArg3</span> = arg3
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
fleet:addOrder(order)

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onAbortCalled)
<span class="predefined">assert</span>.is_same(order, abortArg1)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">is_enemy</span><span class="delimiter">&quot;</span></span>, abortArg2)
<span class="predefined">assert</span>.is_same(fleet, abortArg3)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Idle</span><span class="delimiter">&quot;</span></span>, fleet:getLeader():getOrder())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-defend-target-aborts-if-target-is-enemy-of-ship" class="paragraph">
<p> <details><summary> 
Order:defend() target aborts if target is enemy of ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setFactionId(<span class="integer">1</span>)
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation():setFactionId(<span class="integer">2</span>)
station.areEnemiesInRange = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="predefined-constant">false</span> <span class="keyword">end</span>

Ship:withOrderQueue(ship)
<span class="keyword">local</span> <span class="local-variable">onAbortCalled</span>, <span class="local-variable">abortArg1</span>, <span class="local-variable">abortArg2</span>, <span class="local-variable">abortArg3</span> = <span class="integer">0</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>
<span class="keyword">local</span> <span class="local-variable">order</span> = Order:defend(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onAbort</span> = <span class="keyword">function</span>(arg1, arg2, arg3)
        <span class="key">onAbortCalled</span> = onAbortCalled + <span class="integer">1</span>
        <span class="key">abortArg1</span> = arg1
        <span class="key">abortArg2</span> = arg2
        <span class="key">abortArg3</span> = arg3
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
ship:addOrder(order)

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onAbortCalled)
<span class="predefined">assert</span>.is_same(order, abortArg1)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">is_enemy</span><span class="delimiter">&quot;</span></span>, abortArg2)
<span class="predefined">assert</span>.is_same(ship, abortArg3)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Idle</span><span class="delimiter">&quot;</span></span>, ship:getOrder())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-defend-target-carries-out-the-order-for-30-seconds-by-default-ship" class="paragraph">
<p> <details><summary> 
Order:defend() target carries out the order for 30 seconds by default (ship)
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
station.areEnemiesInRange = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="predefined-constant">false</span> <span class="keyword">end</span>

Ship:withOrderQueue(ship)
<span class="keyword">local</span> <span class="local-variable">onCompletionCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">order</span> = Order:defend(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">minDefendTime</span> = <span class="integer">30</span>,
    <span class="key">onCompletion</span> = <span class="keyword">function</span>() <span class="key">onCompletionCalled</span> = onCompletionCalled + <span class="integer">1</span> <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

ship:addOrder(order)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Defend Target</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(station, ship:getOrderTarget())

<span class="keyword">for</span> _=<span class="integer">1</span>,<span class="integer">29</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Defend Target</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(station, ship:getOrderTarget())

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onCompletionCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-defend-target-carries-out-the-order-for-60-seconds-by-default-fleet" class="paragraph">
<p> <details><summary> 
Order:defend() target carries out the order for 60 seconds by default (fleet)
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>
    CpuShip(),
    CpuShip(),
    CpuShip(),
<span class="delimiter">}</span></span>)
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
station.areEnemiesInRange = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="predefined-constant">false</span> <span class="keyword">end</span>

Fleet:withOrderQueue(fleet)
<span class="keyword">local</span> <span class="local-variable">onCompletionCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">order</span> = Order:defend(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">minDefendTime</span> = <span class="integer">30</span>,
    <span class="key">onCompletion</span> = <span class="keyword">function</span>() <span class="key">onCompletionCalled</span> = onCompletionCalled + <span class="integer">1</span> <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

fleet:addOrder(order)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Defend Target</span><span class="delimiter">&quot;</span></span>, fleet:getLeader():getOrder())
<span class="predefined">assert</span>.is_same(station, fleet:getLeader():getOrderTarget())

<span class="keyword">for</span> _=<span class="integer">1</span>,<span class="integer">29</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Defend Target</span><span class="delimiter">&quot;</span></span>, fleet:getLeader():getOrder())
<span class="predefined">assert</span>.is_same(station, fleet:getLeader():getOrderTarget())

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onCompletionCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-defend-target-carries-out-the-order-until-there-are-no-enemies-in-range-for-15-seconds-fleet" class="paragraph">
<p> <details><summary> 
Order:defend() target carries out the order until there are no enemies in range for 15 seconds (fleet)
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>
    CpuShip(),
    CpuShip(),
    CpuShip(),
<span class="delimiter">}</span></span>)
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">rangeCalled</span> = <span class="predefined-constant">nil</span>
station.areEnemiesInRange = <span class="keyword">function</span>(_, range)
    rangeCalled = range
    <span class="keyword">return</span> <span class="predefined-constant">true</span>
<span class="keyword">end</span>

Fleet:withOrderQueue(fleet)
<span class="keyword">local</span> <span class="local-variable">onCompletionCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">order</span> = Order:defend(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">range</span> = <span class="integer">20000</span>,
    <span class="key">minClearTime</span> = <span class="integer">15</span>,
    <span class="key">onCompletion</span> = <span class="keyword">function</span>() <span class="key">onCompletionCalled</span> = onCompletionCalled + <span class="integer">1</span> <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

fleet:addOrder(order)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Defend Target</span><span class="delimiter">&quot;</span></span>, fleet:getLeader():getOrder())
<span class="predefined">assert</span>.is_same(station, fleet:getLeader():getOrderTarget())
<span class="predefined">assert</span>.is_same(<span class="integer">20000</span>, rangeCalled)

<span class="keyword">for</span> _=<span class="integer">1</span>,<span class="integer">60</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Defend Target</span><span class="delimiter">&quot;</span></span>, fleet:getLeader():getOrder())
<span class="predefined">assert</span>.is_same(station, fleet:getLeader():getOrderTarget())

<span class="comment">-- no enemies for 5 seconds - is too short</span>
station.areEnemiesInRange = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="predefined-constant">false</span> <span class="keyword">end</span>
<span class="keyword">for</span> _=<span class="integer">1</span>,<span class="integer">5</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)

<span class="comment">-- ...an other enemy appears</span>
station.areEnemiesInRange = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="predefined-constant">true</span> <span class="keyword">end</span>
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)

<span class="comment">-- ...and goes away</span>
station.areEnemiesInRange = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="predefined-constant">false</span> <span class="keyword">end</span>
<span class="keyword">for</span> _=<span class="integer">1</span>,<span class="integer">14</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onCompletionCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-defend-target-carries-out-the-order-until-there-are-no-enemies-in-range-for-15-seconds-ship" class="paragraph">
<p> <details><summary> 
Order:defend() target carries out the order until there are no enemies in range for 15 seconds (ship)
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">rangeCalled</span> = <span class="predefined-constant">nil</span>
station.areEnemiesInRange = <span class="keyword">function</span>(_, range)
    rangeCalled = range
    <span class="keyword">return</span> <span class="predefined-constant">true</span>
<span class="keyword">end</span>

Ship:withOrderQueue(ship)
<span class="keyword">local</span> <span class="local-variable">onCompletionCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">order</span> = Order:defend(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">range</span> = <span class="integer">20000</span>,
    <span class="key">minClearTime</span> = <span class="integer">15</span>,
    <span class="key">onCompletion</span> = <span class="keyword">function</span>() <span class="key">onCompletionCalled</span> = onCompletionCalled + <span class="integer">1</span> <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

ship:addOrder(order)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Defend Target</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(station, ship:getOrderTarget())
<span class="predefined">assert</span>.is_same(<span class="integer">20000</span>, rangeCalled)

<span class="keyword">for</span> _=<span class="integer">1</span>,<span class="integer">60</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Defend Target</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(station, ship:getOrderTarget())

<span class="comment">-- no enemies for 5 seconds - is too short</span>
station.areEnemiesInRange = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="predefined-constant">false</span> <span class="keyword">end</span>
<span class="keyword">for</span> _=<span class="integer">1</span>,<span class="integer">5</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)

<span class="comment">-- ...an other enemy appears</span>
station.areEnemiesInRange = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="predefined-constant">true</span> <span class="keyword">end</span>
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)

<span class="comment">-- ...and goes away</span>
station.areEnemiesInRange = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="predefined-constant">false</span> <span class="keyword">end</span>
<span class="keyword">for</span> _=<span class="integer">1</span>,<span class="integer">14</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onCompletionCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-defend-target-fails-if-mincleartime-is-not-a-positive-number" class="paragraph">
<p> <details><summary> 
Order:defend() target fails if minClearTime is not a positive number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(SpaceStation(), <span class="map"><span class="delimiter">{</span>
        <span class="key">minClearTime</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>,
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(SpaceStation(), <span class="map"><span class="delimiter">{</span>
        <span class="key">minClearTime</span> = SpaceStation(),
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(SpaceStation(), <span class="map"><span class="delimiter">{</span>
        <span class="key">minClearTime</span> = <span class="integer">-42</span>,
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-defend-target-fails-if-mindefendtime-is-not-a-positive-number" class="paragraph">
<p> <details><summary> 
Order:defend() target fails if minDefendTime is not a positive number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(SpaceStation(), <span class="map"><span class="delimiter">{</span>
        <span class="key">minDefendTime</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>,
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(SpaceStation(), <span class="map"><span class="delimiter">{</span>
        <span class="key">minDefendTime</span> = SpaceStation(),
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(SpaceStation(), <span class="map"><span class="delimiter">{</span>
        <span class="key">minDefendTime</span> = <span class="integer">-42</span>,
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-defend-target-fails-if-parameter-is-an-invalid-target" class="paragraph">
<p> <details><summary> 
Order:defend() target fails if parameter is an invalid target
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(<span class="integer">42</span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(Asteroid())
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-defend-target-fails-if-range-is-not-a-positive-number" class="paragraph">
<p> <details><summary> 
Order:defend() target fails if range is not a positive number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(SpaceStation(), <span class="map"><span class="delimiter">{</span>
        <span class="key">range</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>,
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(SpaceStation(), <span class="map"><span class="delimiter">{</span>
        <span class="key">range</span> = SpaceStation(),
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(SpaceStation(), <span class="map"><span class="delimiter">{</span>
        <span class="key">range</span> = <span class="integer">-42</span>,
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-defend-with-location-carries-out-the-order-for-30-seconds-fleet" class="paragraph">
<p> <details><summary> 
Order:defend() with location carries out the order for 30 seconds (fleet)
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>
    CpuShip(),
    CpuShip(),
    CpuShip(),
<span class="delimiter">}</span></span>)
fleet:getLeader().areEnemiesInRange = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="predefined-constant">false</span> <span class="keyword">end</span>

Fleet:withOrderQueue(fleet)
<span class="keyword">local</span> <span class="local-variable">onCompletionCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">order</span> = Order:defend(<span class="integer">5000</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">minDefendTime</span> = <span class="integer">30</span>,
    <span class="key">onCompletion</span> = <span class="keyword">function</span>() <span class="key">onCompletionCalled</span> = onCompletionCalled + <span class="integer">1</span> <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

fleet:addOrder(order)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Defend Location</span><span class="delimiter">&quot;</span></span>, fleet:getLeader():getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">5000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>fleet:getLeader():getOrderTargetLocation()<span class="delimiter">}</span></span>)

<span class="keyword">for</span> _=<span class="integer">1</span>,<span class="integer">29</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Defend Location</span><span class="delimiter">&quot;</span></span>, fleet:getLeader():getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">5000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>fleet:getLeader():getOrderTargetLocation()<span class="delimiter">}</span></span>)

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onCompletionCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-defend-with-location-carries-out-the-order-for-30-seconds-ship" class="paragraph">
<p> <details><summary> 
Order:defend() with location carries out the order for 30 seconds (ship)
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="predefined">_G</span>.getObjectsInRadius = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span> <span class="keyword">end</span>

Ship:withOrderQueue(ship)
<span class="keyword">local</span> <span class="local-variable">onCompletionCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">order</span> = Order:defend(<span class="integer">5000</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">minDefendTime</span> = <span class="integer">30</span>,
    <span class="key">onCompletion</span> = <span class="keyword">function</span>() <span class="key">onCompletionCalled</span> = onCompletionCalled + <span class="integer">1</span> <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

ship:addOrder(order)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Defend Location</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">5000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)

<span class="keyword">for</span> _=<span class="integer">1</span>,<span class="integer">29</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Defend Location</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">5000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onCompletionCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-defend-with-location-carries-out-the-order-until-there-are-no-enemies-in-range-for-15-seconds-fleet" class="paragraph">
<p> <details><summary> 
Order:defend() with location carries out the order until there are no enemies in range for 15 seconds (fleet)
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>
    CpuShip():setFactionId(<span class="integer">1</span>),
    CpuShip():setFactionId(<span class="integer">1</span>),
    CpuShip():setFactionId(<span class="integer">1</span>),
<span class="delimiter">}</span></span>)
<span class="keyword">local</span> <span class="local-variable">calledRange</span> = <span class="predefined-constant">nil</span>
<span class="predefined">_G</span>.getObjectsInRadius = <span class="keyword">function</span>(_, _, range)
    calledRange = range
    <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>CpuShip():setFactionId(<span class="integer">2</span>)<span class="delimiter">}</span></span>
<span class="keyword">end</span>

Fleet:withOrderQueue(fleet)
<span class="keyword">local</span> <span class="local-variable">onCompletionCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">order</span> = Order:defend(<span class="integer">5000</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">range</span> = <span class="integer">20000</span>,
    <span class="key">minClearTime</span> = <span class="integer">15</span>,
    <span class="key">onCompletion</span> = <span class="keyword">function</span>() <span class="key">onCompletionCalled</span> = onCompletionCalled + <span class="integer">1</span> <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

fleet:addOrder(order)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Defend Location</span><span class="delimiter">&quot;</span></span>, fleet:getLeader():getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">5000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>fleet:getLeader():getOrderTargetLocation()<span class="delimiter">}</span></span>)
<span class="predefined">assert</span>.is_same(<span class="integer">20000</span>, calledRange)

<span class="keyword">for</span> _=<span class="integer">1</span>,<span class="integer">60</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Defend Location</span><span class="delimiter">&quot;</span></span>, fleet:getLeader():getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">5000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>fleet:getLeader():getOrderTargetLocation()<span class="delimiter">}</span></span>)

<span class="comment">-- no enemies for 5 seconds - is too short</span>
<span class="predefined">_G</span>.getObjectsInRadius = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span> <span class="keyword">end</span>
<span class="keyword">for</span> _=<span class="integer">1</span>,<span class="integer">5</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)

<span class="comment">-- ...an other enemy appears</span>
<span class="predefined">_G</span>.getObjectsInRadius = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>CpuShip():setFactionId(<span class="integer">2</span>)<span class="delimiter">}</span></span> <span class="keyword">end</span>
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)

<span class="comment">-- ...and goes away</span>
<span class="predefined">_G</span>.getObjectsInRadius = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span> <span class="keyword">end</span>
<span class="keyword">for</span> _=<span class="integer">1</span>,<span class="integer">14</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onCompletionCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-defend-with-location-carries-out-the-order-until-there-are-no-enemies-in-range-for-15-seconds-ship" class="paragraph">
<p> <details><summary> 
Order:defend() with location carries out the order until there are no enemies in range for 15 seconds (ship)
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setFactionId(<span class="integer">1</span>)
<span class="keyword">local</span> <span class="local-variable">calledRange</span> = <span class="predefined-constant">nil</span>
<span class="predefined">_G</span>.getObjectsInRadius = <span class="keyword">function</span>(_, _, range)
    calledRange = range
    <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>CpuShip():setFactionId(<span class="integer">2</span>)<span class="delimiter">}</span></span>
<span class="keyword">end</span>

Ship:withOrderQueue(ship)
<span class="keyword">local</span> <span class="local-variable">onCompletionCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">order</span> = Order:defend(<span class="integer">5000</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">range</span> = <span class="integer">20000</span>,
    <span class="key">minClearTime</span> = <span class="integer">15</span>,
    <span class="key">onCompletion</span> = <span class="keyword">function</span>() <span class="key">onCompletionCalled</span> = onCompletionCalled + <span class="integer">1</span> <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

ship:addOrder(order)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Defend Location</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">5000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)
<span class="predefined">assert</span>.is_same(<span class="integer">20000</span>, calledRange)

<span class="keyword">for</span> _=<span class="integer">1</span>,<span class="integer">60</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Defend Location</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">5000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)

<span class="comment">-- no enemies for 5 seconds - is too short</span>
<span class="predefined">_G</span>.getObjectsInRadius = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span> <span class="keyword">end</span>
<span class="keyword">for</span> _=<span class="integer">1</span>,<span class="integer">5</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)

<span class="comment">-- ...an other enemy appears</span>
<span class="predefined">_G</span>.getObjectsInRadius = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>CpuShip():setFactionId(<span class="integer">2</span>)<span class="delimiter">}</span></span> <span class="keyword">end</span>
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)

<span class="comment">-- ...and goes away</span>
<span class="predefined">_G</span>.getObjectsInRadius = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span> <span class="keyword">end</span>
<span class="keyword">for</span> _=<span class="integer">1</span>,<span class="integer">14</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onCompletionCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-defend-with-location-fails-if-any-coordinate-is-not-a-number" class="paragraph">
<p> <details><summary> 
Order:defend() with location fails if any coordinate is not a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(<span class="predefined-constant">nil</span>, <span class="integer">42</span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(<span class="integer">5000</span>, <span class="predefined-constant">nil</span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="integer">42</span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(<span class="integer">5000</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(SpaceStation(), <span class="integer">42</span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(<span class="integer">5000</span>, SpaceStation())
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-defend-with-location-fails-if-mincleartime-is-not-a-positive-number" class="paragraph">
<p> <details><summary> 
Order:defend() with location fails if minClearTime is not a positive number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(<span class="integer">0</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
        <span class="key">minClearTime</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>,
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(<span class="integer">0</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
        <span class="key">minClearTime</span> = SpaceStation(),
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(<span class="integer">0</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
        <span class="key">minClearTime</span> = <span class="integer">-42</span>,
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-defend-with-location-fails-if-mindefendtime-is-not-a-positive-number" class="paragraph">
<p> <details><summary> 
Order:defend() with location fails if minDefendTime is not a positive number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(<span class="integer">0</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
        <span class="key">minDefendTime</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>,
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(<span class="integer">0</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
        <span class="key">minDefendTime</span> = SpaceStation(),
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(<span class="integer">0</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
        <span class="key">minDefendTime</span> = <span class="integer">-42</span>,
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-defend-with-location-fails-if-range-is-not-a-positive-number" class="paragraph">
<p> <details><summary> 
Order:defend() with location fails if range is not a positive number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(<span class="integer">0</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
        <span class="key">range</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>,
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(<span class="integer">0</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
        <span class="key">range</span> = SpaceStation(),
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(<span class="integer">0</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
        <span class="key">range</span> = <span class="integer">-42</span>,
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-defend-without-argument-carries-out-the-order-for-30-seconds-by-default-fleet" class="paragraph">
<p> <details><summary> 
Order:defend() without argument carries out the order for 30 seconds by default (fleet)
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>
    CpuShip(),
    CpuShip(),
    CpuShip(),
<span class="delimiter">}</span></span>)
fleet:getLeader().areEnemiesInRange = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="predefined-constant">false</span> <span class="keyword">end</span>

Fleet:withOrderQueue(fleet)
<span class="keyword">local</span> <span class="local-variable">onCompletionCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">order</span> = Order:defend(<span class="map"><span class="delimiter">{</span>
    <span class="key">minDefendTime</span> = <span class="integer">30</span>,
    <span class="key">onCompletion</span> = <span class="keyword">function</span>() <span class="key">onCompletionCalled</span> = onCompletionCalled + <span class="integer">1</span> <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

fleet:addOrder(order)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Stand Ground</span><span class="delimiter">&quot;</span></span>, fleet:getLeader():getOrder())

<span class="keyword">for</span> _=<span class="integer">1</span>,<span class="integer">29</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Stand Ground</span><span class="delimiter">&quot;</span></span>, fleet:getLeader():getOrder())

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onCompletionCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-defend-without-argument-carries-out-the-order-for-30-seconds-by-default-ship" class="paragraph">
<p> <details><summary> 
Order:defend() without argument carries out the order for 30 seconds by default (ship)
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
ship.areEnemiesInRange = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="predefined-constant">false</span> <span class="keyword">end</span>

Ship:withOrderQueue(ship)
<span class="keyword">local</span> <span class="local-variable">onCompletionCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">order</span> = Order:defend(<span class="map"><span class="delimiter">{</span>
    <span class="key">minDefendTime</span> = <span class="integer">30</span>,
    <span class="key">onCompletion</span> = <span class="keyword">function</span>() <span class="key">onCompletionCalled</span> = onCompletionCalled + <span class="integer">1</span> <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

ship:addOrder(order)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Stand Ground</span><span class="delimiter">&quot;</span></span>, ship:getOrder())

<span class="keyword">for</span> _=<span class="integer">1</span>,<span class="integer">29</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Stand Ground</span><span class="delimiter">&quot;</span></span>, ship:getOrder())

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onCompletionCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-defend-without-argument-carries-out-the-order-until-there-are-no-enemies-in-range-for-15-seconds-fleet" class="paragraph">
<p> <details><summary> 
Order:defend() without argument carries out the order until there are no enemies in range for 15 seconds (fleet)
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>
    CpuShip(),
    CpuShip(),
    CpuShip(),
<span class="delimiter">}</span></span>)
<span class="keyword">local</span> <span class="local-variable">calledRange</span> = <span class="predefined-constant">nil</span>
fleet:getLeader().areEnemiesInRange = <span class="keyword">function</span>(_, range)
    calledRange = range
    <span class="keyword">return</span> <span class="predefined-constant">true</span>
<span class="keyword">end</span>

Fleet:withOrderQueue(fleet)
<span class="keyword">local</span> <span class="local-variable">onCompletionCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">order</span> = Order:defend(<span class="map"><span class="delimiter">{</span>
    <span class="key">range</span> = <span class="integer">20000</span>,
    <span class="key">minClearTime</span> = <span class="integer">15</span>,
    <span class="key">onCompletion</span> = <span class="keyword">function</span>() <span class="key">onCompletionCalled</span> = onCompletionCalled + <span class="integer">1</span> <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

fleet:addOrder(order)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Stand Ground</span><span class="delimiter">&quot;</span></span>, fleet:getLeader():getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">20000</span>, calledRange)

<span class="keyword">for</span> _=<span class="integer">1</span>,<span class="integer">60</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Stand Ground</span><span class="delimiter">&quot;</span></span>, fleet:getLeader():getOrder())

<span class="comment">-- no enemies for 5 seconds - is too short</span>
fleet:getLeader().areEnemiesInRange = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="predefined-constant">false</span> <span class="keyword">end</span>
<span class="keyword">for</span> _=<span class="integer">1</span>,<span class="integer">5</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)

<span class="comment">-- ...an other enemy appears</span>
fleet:getLeader().areEnemiesInRange = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="predefined-constant">true</span> <span class="keyword">end</span>
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)

<span class="comment">-- ...and goes away</span>
fleet:getLeader().areEnemiesInRange = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="predefined-constant">false</span> <span class="keyword">end</span>
<span class="keyword">for</span> _=<span class="integer">1</span>,<span class="integer">14</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onCompletionCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-defend-without-argument-carries-out-the-order-until-there-are-no-enemies-in-range-for-15-seconds-ship" class="paragraph">
<p> <details><summary> 
Order:defend() without argument carries out the order until there are no enemies in range for 15 seconds (ship)
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">calledRange</span> = <span class="predefined-constant">nil</span>
ship.areEnemiesInRange = <span class="keyword">function</span>(_, range)
    calledRange = range
    <span class="keyword">return</span> <span class="predefined-constant">true</span>
<span class="keyword">end</span>

Ship:withOrderQueue(ship)
<span class="keyword">local</span> <span class="local-variable">onCompletionCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">order</span> = Order:defend(<span class="map"><span class="delimiter">{</span>
    <span class="key">range</span> = <span class="integer">20000</span>,
    <span class="key">minClearTime</span> = <span class="integer">15</span>,
    <span class="key">onCompletion</span> = <span class="keyword">function</span>() <span class="key">onCompletionCalled</span> = onCompletionCalled + <span class="integer">1</span> <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

ship:addOrder(order)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Stand Ground</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">20000</span>, calledRange)

<span class="keyword">for</span> _=<span class="integer">1</span>,<span class="integer">60</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Stand Ground</span><span class="delimiter">&quot;</span></span>, ship:getOrder())

<span class="comment">-- no enemies for 5 seconds - is too short</span>
ship.areEnemiesInRange = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="predefined-constant">false</span> <span class="keyword">end</span>
<span class="keyword">for</span> _=<span class="integer">1</span>,<span class="integer">5</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)

<span class="comment">-- ...an other enemy appears</span>
ship.areEnemiesInRange = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="predefined-constant">true</span> <span class="keyword">end</span>
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)

<span class="comment">-- ...and goes away</span>
ship.areEnemiesInRange = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="predefined-constant">false</span> <span class="keyword">end</span>
<span class="keyword">for</span> _=<span class="integer">1</span>,<span class="integer">14</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onCompletionCalled)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-defend-without-argument-fails-if-mincleartime-is-not-a-positive-number" class="paragraph">
<p> <details><summary> 
Order:defend() without argument fails if minClearTime is not a positive number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(<span class="map"><span class="delimiter">{</span>
        <span class="key">minClearTime</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>,
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(<span class="map"><span class="delimiter">{</span>
        <span class="key">minClearTime</span> = SpaceStation(),
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(<span class="map"><span class="delimiter">{</span>
        <span class="key">minClearTime</span> = <span class="integer">-42</span>,
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-defend-without-argument-fails-if-mindefendtime-is-not-a-positive-number" class="paragraph">
<p> <details><summary> 
Order:defend() without argument fails if minDefendTime is not a positive number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(<span class="map"><span class="delimiter">{</span>
        <span class="key">minDefendTime</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>,
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(<span class="map"><span class="delimiter">{</span>
        <span class="key">minDefendTime</span> = SpaceStation(),
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(<span class="map"><span class="delimiter">{</span>
        <span class="key">minDefendTime</span> = <span class="integer">-42</span>,
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-defend-without-argument-fails-if-range-is-not-a-positive-number" class="paragraph">
<p> <details><summary> 
Order:defend() without argument fails if range is not a positive number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(<span class="map"><span class="delimiter">{</span>
        <span class="key">range</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>,
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(<span class="map"><span class="delimiter">{</span>
        <span class="key">range</span> = SpaceStation(),
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:defend(<span class="map"><span class="delimiter">{</span>
        <span class="key">range</span> = <span class="integer">-42</span>,
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="order-dock">Order:dock()</h3>
<div id="order-dock-does-not-wait-for-missiles-when-waitformissilerestock-is-false" class="paragraph">
<p> <details><summary> 
Order:dock() does not wait for missiles, when waitForMissileRestock is false
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setWeaponStorageMax(<span class="string"><span class="delimiter">&quot;</span><span class="content">homing</span><span class="delimiter">&quot;</span></span>, <span class="integer">8</span>):setWeaponStorage(<span class="string"><span class="delimiter">&quot;</span><span class="content">homing</span><span class="delimiter">&quot;</span></span>, <span class="integer">0</span>)

<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

Ship:withOrderQueue(ship)
<span class="keyword">local</span> <span class="local-variable">completed</span> = <span class="predefined-constant">false</span>
ship:addOrder(Order:dock(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">waitForMissileRestock</span> = <span class="predefined-constant">false</span>,
    <span class="key">onCompletion</span> = <span class="keyword">function</span>() <span class="key">completed</span> = <span class="predefined-constant">true</span> <span class="keyword">end</span>,
<span class="delimiter">}</span></span>))

<span class="comment">-- ship not docked</span>
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(completed)

<span class="comment">-- ship docked but no missiles</span>
ship:setDockedAt(station)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_true(completed)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-dock-does-not-wait-for-repairs-when-waitforrepair-is-false" class="paragraph">
<p> <details><summary> 
Order:dock() does not wait for repairs, when waitForRepair is false
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setHullMax(<span class="integer">100</span>):setHull(<span class="integer">50</span>)

<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
station:setRepairDocked(<span class="predefined-constant">true</span>)

Ship:withOrderQueue(ship)
<span class="keyword">local</span> <span class="local-variable">completed</span> = <span class="predefined-constant">false</span>
ship:addOrder(Order:dock(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">waitForRepair</span> = <span class="predefined-constant">false</span>,
    <span class="key">onCompletion</span> = <span class="keyword">function</span>() <span class="key">completed</span> = <span class="predefined-constant">true</span> <span class="keyword">end</span>,
<span class="delimiter">}</span></span>))

<span class="comment">-- ship not docked</span>
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(completed)

<span class="comment">-- ship docked</span>
ship:setDockedAt(station)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_true(completed)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-dock-does-not-wait-for-shields-to-recharge-when-waitforshieldrecharge-is-false" class="paragraph">
<p> <details><summary> 
Order:dock() does not wait for shields to recharge, when waitForShieldRecharge is false
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setShieldsMax(<span class="integer">100</span>, <span class="integer">50</span>, <span class="integer">10</span>):setShields(<span class="integer">20</span>, <span class="integer">50</span>, <span class="integer">0</span>)

<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

Ship:withOrderQueue(ship)
<span class="keyword">local</span> <span class="local-variable">completed</span> = <span class="predefined-constant">false</span>
ship:addOrder(Order:dock(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">waitForShieldRecharge</span> = <span class="predefined-constant">false</span>,
    <span class="key">onCompletion</span> = <span class="keyword">function</span>() <span class="key">completed</span> = <span class="predefined-constant">true</span> <span class="keyword">end</span>,
<span class="delimiter">}</span></span>))

<span class="comment">-- ship not docked</span>
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(completed)

<span class="comment">-- ship docked but low shields</span>
ship:setDockedAt(station)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_true(completed)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-dock-fails-if-no-station-is-given" class="paragraph">
<p> <details><summary> 
Order:dock() fails if no station is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:dock(<span class="predefined-constant">nil</span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:dock(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:dock(CpuShip())
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-dock-fails-if-station-is-an-enemy-for-fleet" class="paragraph">
<p> <details><summary> 
Order:dock() fails if station is an enemy for fleet
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>
    CpuShip():setFactionId(<span class="integer">1</span>),
    CpuShip():setFactionId(<span class="integer">1</span>),
    CpuShip():setFactionId(<span class="integer">1</span>),
<span class="delimiter">}</span></span>)
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation():setFactionId(<span class="integer">2</span>)

Fleet:withOrderQueue(fleet)
<span class="keyword">local</span> <span class="local-variable">onAbortCalled</span>, <span class="local-variable">abortArg1</span>, <span class="local-variable">abortArg2</span>, <span class="local-variable">abortArg3</span> = <span class="integer">0</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>
<span class="keyword">local</span> <span class="local-variable">order</span> = Order:dock(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onAbort</span> = <span class="keyword">function</span>(arg1, arg2, arg3)
        <span class="key">onAbortCalled</span> = onAbortCalled + <span class="integer">1</span>
        <span class="key">abortArg1</span> = arg1
        <span class="key">abortArg2</span> = arg2
        <span class="key">abortArg3</span> = arg3
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
fleet:addOrder(order)

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onAbortCalled)
<span class="predefined">assert</span>.is_same(order, abortArg1)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">enemy_station</span><span class="delimiter">&quot;</span></span>, abortArg2)
<span class="predefined">assert</span>.is_same(fleet, abortArg3)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Idle</span><span class="delimiter">&quot;</span></span>, fleet:getLeader():getOrder())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-dock-fails-if-station-is-an-enemy-for-ship" class="paragraph">
<p> <details><summary> 
Order:dock() fails if station is an enemy for ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setFactionId(<span class="integer">1</span>)
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation():setFactionId(<span class="integer">2</span>)

Ship:withOrderQueue(ship)

<span class="keyword">local</span> <span class="local-variable">onAbortCalled</span>, <span class="local-variable">abortArg1</span>, <span class="local-variable">abortArg2</span>, <span class="local-variable">abortArg3</span> = <span class="integer">0</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>
<span class="keyword">local</span> <span class="local-variable">order</span> = Order:dock(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onAbort</span> = <span class="keyword">function</span>(arg1, arg2, arg3)
        <span class="key">onAbortCalled</span> = onAbortCalled + <span class="integer">1</span>
        <span class="key">abortArg1</span> = arg1
        <span class="key">abortArg2</span> = arg2
        <span class="key">abortArg3</span> = arg3
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
ship:addOrder(order)

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onAbortCalled)
<span class="predefined">assert</span>.is_same(order, abortArg1)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">enemy_station</span><span class="delimiter">&quot;</span></span>, abortArg2)
<span class="predefined">assert</span>.is_same(ship, abortArg3)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Idle</span><span class="delimiter">&quot;</span></span>, ship:getOrder())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-dock-fails-if-station-is-destroyed-for-fleet" class="paragraph">
<p> <details><summary> 
Order:dock() fails if station is destroyed for fleet
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>CpuShip(), CpuShip(), CpuShip()<span class="delimiter">}</span></span>)
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

Fleet:withOrderQueue(fleet)
<span class="keyword">local</span> <span class="local-variable">onAbortCalled</span>, <span class="local-variable">abortArg1</span>, <span class="local-variable">abortArg2</span>, <span class="local-variable">abortArg3</span> = <span class="integer">0</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>
<span class="keyword">local</span> <span class="local-variable">order</span> = Order:dock(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onAbort</span> = <span class="keyword">function</span>(arg1, arg2, arg3)
        <span class="key">onAbortCalled</span> = onAbortCalled + <span class="integer">1</span>
        <span class="key">abortArg1</span> = arg1
        <span class="key">abortArg2</span> = arg2
        <span class="key">abortArg3</span> = arg3
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
fleet:addOrder(order)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Dock</span><span class="delimiter">&quot;</span></span>, fleet:getLeader():getOrder())

station:destroy()

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onAbortCalled)
<span class="predefined">assert</span>.is_same(order, abortArg1)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">invalid_station</span><span class="delimiter">&quot;</span></span>, abortArg2)
<span class="predefined">assert</span>.is_same(fleet, abortArg3)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Idle</span><span class="delimiter">&quot;</span></span>, fleet:getLeader():getOrder())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-dock-fails-if-station-is-destroyed-for-ship" class="paragraph">
<p> <details><summary> 
Order:dock() fails if station is destroyed for ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

Ship:withOrderQueue(ship)
<span class="keyword">local</span> <span class="local-variable">onAbortCalled</span>, <span class="local-variable">abortArg1</span>, <span class="local-variable">abortArg2</span>, <span class="local-variable">abortArg3</span> = <span class="integer">0</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>
<span class="keyword">local</span> <span class="local-variable">order</span> = Order:dock(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onAbort</span> = <span class="keyword">function</span>(arg1, arg2, arg3)
        <span class="key">onAbortCalled</span> = onAbortCalled + <span class="integer">1</span>
        <span class="key">abortArg1</span> = arg1
        <span class="key">abortArg2</span> = arg2
        <span class="key">abortArg3</span> = arg3
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
ship:addOrder(order)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Dock</span><span class="delimiter">&quot;</span></span>, ship:getOrder())

station:destroy()

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onAbortCalled)
<span class="predefined">assert</span>.is_same(order, abortArg1)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">invalid_station</span><span class="delimiter">&quot;</span></span>, abortArg2)
<span class="predefined">assert</span>.is_same(ship, abortArg3)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Idle</span><span class="delimiter">&quot;</span></span>, ship:getOrder())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-dock-fails-if-station-turns-into-an-enemy-for-fleet" class="paragraph">
<p> <details><summary> 
Order:dock() fails if station turns into an enemy for fleet
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>
    CpuShip():setFactionId(<span class="integer">1</span>),
    CpuShip():setFactionId(<span class="integer">1</span>),
    CpuShip():setFactionId(<span class="integer">1</span>),
<span class="delimiter">}</span></span>)
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation():setFactionId(<span class="integer">0</span>)

Fleet:withOrderQueue(fleet)
<span class="keyword">local</span> <span class="local-variable">onAbortCalled</span>, <span class="local-variable">abortArg1</span>, <span class="local-variable">abortArg2</span>, <span class="local-variable">abortArg3</span> = <span class="integer">0</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>
<span class="keyword">local</span> <span class="local-variable">order</span> = Order:dock(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onAbort</span> = <span class="keyword">function</span>(arg1, arg2, arg3)
        <span class="key">onAbortCalled</span> = onAbortCalled + <span class="integer">1</span>
        <span class="key">abortArg1</span> = arg1
        <span class="key">abortArg2</span> = arg2
        <span class="key">abortArg3</span> = arg3
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
fleet:addOrder(order)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Dock</span><span class="delimiter">&quot;</span></span>, fleet:getLeader():getOrder())

station:setFactionId(<span class="integer">2</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onAbortCalled)
<span class="predefined">assert</span>.is_same(order, abortArg1)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">enemy_station</span><span class="delimiter">&quot;</span></span>, abortArg2)
<span class="predefined">assert</span>.is_same(fleet, abortArg3)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Idle</span><span class="delimiter">&quot;</span></span>, fleet:getLeader():getOrder())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-dock-fails-if-station-turns-into-an-enemy-for-ship" class="paragraph">
<p> <details><summary> 
Order:dock() fails if station turns into an enemy for ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setFactionId(<span class="integer">1</span>)
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation():setFactionId(<span class="integer">0</span>)

Ship:withOrderQueue(ship)

<span class="keyword">local</span> <span class="local-variable">onAbortCalled</span>, <span class="local-variable">abortArg1</span>, <span class="local-variable">abortArg2</span>, <span class="local-variable">abortArg3</span> = <span class="integer">0</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>
<span class="keyword">local</span> <span class="local-variable">order</span> = Order:dock(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onAbort</span> = <span class="keyword">function</span>(arg1, arg2, arg3)
        <span class="key">onAbortCalled</span> = onAbortCalled + <span class="integer">1</span>
        <span class="key">abortArg1</span> = arg1
        <span class="key">abortArg2</span> = arg2
        <span class="key">abortArg3</span> = arg3
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
ship:addOrder(order)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Dock</span><span class="delimiter">&quot;</span></span>, ship:getOrder())

station:setFactionId(<span class="integer">2</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onAbortCalled)
<span class="predefined">assert</span>.is_same(order, abortArg1)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">enemy_station</span><span class="delimiter">&quot;</span></span>, abortArg2)
<span class="predefined">assert</span>.is_same(ship, abortArg3)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Idle</span><span class="delimiter">&quot;</span></span>, ship:getOrder())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-dock-repairs-a-docked-fleet-if-the-station-is-friendly-and-supports-it" class="paragraph">
<p> <details><summary> 
Order:dock() repairs a docked fleet if the station is friendly and supports it
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship1</span> = CpuShip():setHullMax(<span class="integer">100</span>):setHull(<span class="integer">50</span>)
<span class="keyword">local</span> <span class="local-variable">ship2</span> = CpuShip():setHullMax(<span class="integer">100</span>):setHull(<span class="integer">50</span>)
<span class="keyword">local</span> <span class="local-variable">ship3</span> = CpuShip():setHullMax(<span class="integer">100</span>):setHull(<span class="integer">50</span>)
<span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>ship1, ship2, ship3<span class="delimiter">}</span></span>)

<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
station:setRepairDocked(<span class="predefined-constant">true</span>)

Fleet:withOrderQueue(fleet)
<span class="keyword">local</span> <span class="local-variable">completed</span> = <span class="predefined-constant">false</span>
fleet:addOrder(Order:dock(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onCompletion</span> = <span class="keyword">function</span>() <span class="key">completed</span> = <span class="predefined-constant">true</span> <span class="keyword">end</span>,
<span class="delimiter">}</span></span>))
fleet:addOrder(Order:flyTo(<span class="integer">1000</span>, <span class="integer">0</span>))

<span class="comment">-- fleet leader not docked</span>
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(completed)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Dock</span><span class="delimiter">&quot;</span></span>, ship1:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship2:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship3:getOrder())

<span class="comment">-- fleet leader docked, fleet leader unrepaired</span>
ship1:setDockedAt(station)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(completed)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Dock</span><span class="delimiter">&quot;</span></span>, ship1:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Dock</span><span class="delimiter">&quot;</span></span>, ship2:getOrder())
<span class="predefined">assert</span>.is_same(station, ship2:getOrderTarget())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Dock</span><span class="delimiter">&quot;</span></span>, ship3:getOrder())
<span class="predefined">assert</span>.is_same(station, ship3:getOrderTarget())

<span class="comment">-- fleet leader docked, fleet leader repaired, wingmen not docked</span>
ship1:setHull(<span class="integer">100</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(completed)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Dock</span><span class="delimiter">&quot;</span></span>, ship1:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Dock</span><span class="delimiter">&quot;</span></span>, ship2:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Dock</span><span class="delimiter">&quot;</span></span>, ship3:getOrder())

<span class="comment">-- fleet leader repaired, wingmen docked</span>
ship2:setDockedAt(station)
ship3:setDockedAt(station)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(completed)

<span class="comment">-- fleet leader repaired, wingmen repaired</span>
ship2:setHull(<span class="integer">100</span>)
ship3:setHull(<span class="integer">100</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_true(completed)

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship1:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship2:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship3:getOrder())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-dock-repairs-a-docked-ship-if-the-station-is-friendly-and-supports-it" class="paragraph">
<p> <details><summary> 
Order:dock() repairs a docked ship if the station is friendly and supports it
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setHullMax(<span class="integer">100</span>):setHull(<span class="integer">50</span>)

<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
station:setRepairDocked(<span class="predefined-constant">true</span>)

Ship:withOrderQueue(ship)
<span class="keyword">local</span> <span class="local-variable">completed</span> = <span class="predefined-constant">false</span>
ship:addOrder(Order:dock(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onCompletion</span> = <span class="keyword">function</span>() <span class="key">completed</span> = <span class="predefined-constant">true</span> <span class="keyword">end</span>,
<span class="delimiter">}</span></span>))

<span class="comment">-- ship not docked</span>
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(completed)

<span class="comment">-- ship docked but unrepaired</span>
ship:setDockedAt(station)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(completed)

<span class="comment">-- ship docked and repaired</span>
ship:setHull(<span class="integer">100</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_true(completed)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-dock-undocks-all-fleet-ships-if-the-order-is-aborted" class="paragraph">
<p> <details><summary> 
Order:dock() undocks all fleet ships if the order is aborted
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship1</span> = CpuShip():setHullMax(<span class="integer">100</span>):setHull(<span class="integer">50</span>)
<span class="keyword">local</span> <span class="local-variable">ship2</span> = CpuShip():setHullMax(<span class="integer">100</span>):setHull(<span class="integer">50</span>)
<span class="keyword">local</span> <span class="local-variable">ship3</span> = CpuShip():setHullMax(<span class="integer">100</span>):setHull(<span class="integer">50</span>)
<span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>ship1, ship2, ship3<span class="delimiter">}</span></span>)

<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
station:setRepairDocked(<span class="predefined-constant">true</span>)

Fleet:withOrderQueue(fleet)
fleet:addOrder(Order:dock(station))

<span class="comment">-- fleet leader docked, fleet leader unrepaired</span>
ship1:setDockedAt(station)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Dock</span><span class="delimiter">&quot;</span></span>, ship1:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Dock</span><span class="delimiter">&quot;</span></span>, ship2:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Dock</span><span class="delimiter">&quot;</span></span>, ship3:getOrder())

fleet:abortCurrentOrder()
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Idle</span><span class="delimiter">&quot;</span></span>, ship1:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship2:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship3:getOrder())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-dock-waits-for-all-ships-to-be-repaired-refilled-and-recharged" class="paragraph">
<p> <details><summary> 
Order:dock() waits for all ships to be repaired, refilled and recharged
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship2</span> = CpuShip():setHullMax(<span class="integer">100</span>):setHull(<span class="integer">50</span>) <span class="comment">-- damaged</span>
<span class="keyword">local</span> <span class="local-variable">ship3</span> = CpuShip():setWeaponStorageMax(<span class="string"><span class="delimiter">&quot;</span><span class="content">homing</span><span class="delimiter">&quot;</span></span>, <span class="integer">8</span>):setWeaponStorage(<span class="string"><span class="delimiter">&quot;</span><span class="content">homing</span><span class="delimiter">&quot;</span></span>, <span class="integer">0</span>) <span class="comment">-- weapons</span>
<span class="keyword">local</span> <span class="local-variable">ship4</span> = CpuShip():setShieldsMax(<span class="integer">100</span>, <span class="integer">50</span>, <span class="integer">10</span>):setShields(<span class="integer">20</span>, <span class="integer">50</span>, <span class="integer">0</span>) <span class="comment">-- broken shields</span>
<span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>ship1, ship2, ship3, ship4<span class="delimiter">}</span></span>)

<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
station:setRepairDocked(<span class="predefined-constant">true</span>)

Fleet:withOrderQueue(fleet)
<span class="keyword">local</span> <span class="local-variable">completed</span> = <span class="predefined-constant">false</span>
fleet:addOrder(Order:dock(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onCompletion</span> = <span class="keyword">function</span>() <span class="key">completed</span> = <span class="predefined-constant">true</span> <span class="keyword">end</span>,
<span class="delimiter">}</span></span>))
fleet:addOrder(Order:flyTo(<span class="integer">1000</span>, <span class="integer">0</span>))

ship1:setDockedAt(station)
ship2:setDockedAt(station)
ship3:setDockedAt(station)
ship4:setDockedAt(station)

<span class="predefined">assert</span>.is_false(completed)

<span class="comment">-- repair ship</span>
ship2:setHull(<span class="integer">100</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>) <span class="comment">--twice for Fleet's cron to catch up</span>
<span class="predefined">assert</span>.is_false(completed)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship2:getOrder())

<span class="comment">-- refill missiles</span>
ship3:setWeaponStorage(<span class="string"><span class="delimiter">&quot;</span><span class="content">homing</span><span class="delimiter">&quot;</span></span>, <span class="integer">8</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>) <span class="comment">--twice for Fleet's cron to catch up</span>
<span class="predefined">assert</span>.is_false(completed)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship3:getOrder())

<span class="comment">-- recharge shields</span>
ship4:setShields(<span class="integer">100</span>, <span class="integer">50</span>, <span class="integer">10</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>) <span class="comment">--twice for Fleet's cron to catch up</span>
<span class="predefined">assert</span>.is_true(completed)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship4:getOrder())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-dock-waits-for-missiles-to-be-refilled" class="paragraph">
<p> <details><summary> 
Order:dock() waits for missiles to be refilled
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setWeaponStorageMax(<span class="string"><span class="delimiter">&quot;</span><span class="content">homing</span><span class="delimiter">&quot;</span></span>, <span class="integer">8</span>):setWeaponStorage(<span class="string"><span class="delimiter">&quot;</span><span class="content">homing</span><span class="delimiter">&quot;</span></span>, <span class="integer">0</span>)

<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

Ship:withOrderQueue(ship)
<span class="keyword">local</span> <span class="local-variable">completed</span> = <span class="predefined-constant">false</span>
ship:addOrder(Order:dock(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onCompletion</span> = <span class="keyword">function</span>() <span class="key">completed</span> = <span class="predefined-constant">true</span> <span class="keyword">end</span>,
<span class="delimiter">}</span></span>))

<span class="comment">-- ship not docked</span>
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(completed)

<span class="comment">-- ship docked but no missiles</span>
ship:setDockedAt(station)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(completed)

<span class="comment">-- ship docked and refilled</span>
ship:setWeaponStorage(<span class="string"><span class="delimiter">&quot;</span><span class="content">homing</span><span class="delimiter">&quot;</span></span>, <span class="integer">8</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_true(completed)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-dock-waits-for-shields-to-recharge" class="paragraph">
<p> <details><summary> 
Order:dock() waits for shields to recharge
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setShieldsMax(<span class="integer">100</span>, <span class="integer">50</span>, <span class="integer">10</span>):setShields(<span class="integer">20</span>, <span class="integer">50</span>, <span class="integer">0</span>)

<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

Ship:withOrderQueue(ship)
<span class="keyword">local</span> <span class="local-variable">completed</span> = <span class="predefined-constant">false</span>
ship:addOrder(Order:dock(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onCompletion</span> = <span class="keyword">function</span>() <span class="key">completed</span> = <span class="predefined-constant">true</span> <span class="keyword">end</span>,
<span class="delimiter">}</span></span>))

<span class="comment">-- ship not docked</span>
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(completed)

<span class="comment">-- ship docked but low shields</span>
ship:setDockedAt(station)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(completed)

<span class="comment">-- ship docked and shields loaded</span>
ship:setShields(<span class="integer">100</span>, <span class="integer">50</span>, <span class="integer">10</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_true(completed)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="order-flyto">Order:flyTo()</h3>
<div id="order-flyto-config-ignoreenemies-allows-to-set-the-distance-to-trigger-for-fleet" class="paragraph">
<p> <details><summary> 
Order:flyTo() config.ignoreEnemies allows to set the distance to trigger for fleet
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withOrderQueue(ship)

ship:setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)

ship:addOrder(Order:flyTo(<span class="integer">0</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">ignoreEnemies</span> = <span class="predefined-constant">true</span>,
<span class="delimiter">}</span></span>))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards (ignore all)</span><span class="delimiter">&quot;</span></span>, ship:getOrder())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-flyto-config-ignoreenemies-allows-to-set-the-distance-to-trigger-for-ship" class="paragraph">
<p> <details><summary> 
Order:flyTo() config.ignoreEnemies allows to set the distance to trigger for ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>
    CpuShip(),
    CpuShip(),
    CpuShip(),
<span class="delimiter">}</span></span>)
Fleet:withOrderQueue(fleet)

fleet:getLeader():setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)

fleet:addOrder(Order:flyTo(<span class="integer">0</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">ignoreEnemies</span> = <span class="predefined-constant">true</span>,
<span class="delimiter">}</span></span>))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards (ignore all)</span><span class="delimiter">&quot;</span></span>, fleet:getLeader():getOrder())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-flyto-config-ignoreenemies-fails-if-it-is-not-a-boolean" class="paragraph">
<p> <details><summary> 
Order:flyTo() config.ignoreEnemies fails if it is not a boolean
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withOrderQueue(ship)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:flyTo(<span class="integer">0</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
        <span class="key">ignoreEnemies</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>,
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:flyTo(<span class="integer">0</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
        <span class="key">ignoreEnemies</span> = <span class="integer">42</span>,
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-flyto-config-mindistance-allows-to-set-the-distance-to-trigger-for-fleet-leader" class="paragraph">
<p> <details><summary> 
Order:flyTo() config.minDistance allows to set the distance to trigger for fleet leader
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>
    CpuShip(),
    CpuShip(),
    CpuShip(),
<span class="delimiter">}</span></span>)
Fleet:withOrderQueue(fleet)

fleet:getLeader():setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)

<span class="keyword">local</span> <span class="local-variable">completed</span> = <span class="predefined-constant">false</span>
fleet:addOrder(Order:flyTo(<span class="integer">0</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">minDistance</span> = <span class="integer">100</span>,
    <span class="key">onCompletion</span> = <span class="keyword">function</span>() <span class="key">completed</span> = <span class="predefined-constant">true</span> <span class="keyword">end</span>,
<span class="delimiter">}</span></span>))

<span class="predefined">assert</span>.is_false(completed)

fleet:getLeader():setPosition(<span class="integer">500</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(completed)

fleet:getLeader():setPosition(<span class="integer">101</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(completed)

fleet:getLeader():setPosition(<span class="integer">99</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_true(completed)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-flyto-config-mindistance-allows-to-set-the-distance-to-trigger-for-ship" class="paragraph">
<p> <details><summary> 
Order:flyTo() config.minDistance allows to set the distance to trigger for ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withOrderQueue(ship)

ship:setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)

<span class="keyword">local</span> <span class="local-variable">completed</span> = <span class="predefined-constant">false</span>
ship:addOrder(Order:flyTo(<span class="integer">0</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">minDistance</span> = <span class="integer">100</span>,
    <span class="key">onCompletion</span> = <span class="keyword">function</span>() <span class="key">completed</span> = <span class="predefined-constant">true</span> <span class="keyword">end</span>,
<span class="delimiter">}</span></span>))

<span class="predefined">assert</span>.is_false(completed)

ship:setPosition(<span class="integer">500</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(completed)

ship:setPosition(<span class="integer">101</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_false(completed)

ship:setPosition(<span class="integer">99</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_true(completed)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-flyto-config-mindistance-fails-if-it-is-not-a-number-or-negative" class="paragraph">
<p> <details><summary> 
Order:flyTo() config.minDistance fails if it is not a number or negative
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withOrderQueue(ship)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:flyTo(<span class="integer">0</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
        <span class="key">minDistance</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>,
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:flyTo(<span class="integer">0</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
        <span class="key">minDistance</span> = <span class="integer">-42</span>,
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-flyto-fails-if-x-or-y-are-not-numbers" class="paragraph">
<p> <details><summary> 
Order:flyTo() fails if x or y are not numbers
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:flyTo(<span class="predefined-constant">nil</span>, <span class="integer">0</span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:flyTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="integer">0</span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:flyTo(<span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>, <span class="integer">0</span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:flyTo(<span class="integer">0</span>, <span class="predefined-constant">nil</span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:flyTo(<span class="integer">0</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:flyTo(<span class="integer">0</span>, <span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="order-use">Order:use()</h3>
<div id="order-use-fails-if-wormhole-is-not-a-wormhole" class="paragraph">
<p> <details><summary> 
Order:use() fails if wormHole is not a WormHole
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:use(<span class="predefined-constant">nil</span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:use(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:use(<span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Order:use(<span class="integer">0</span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-use-fails-if-wormhole-is-not-valid" class="paragraph">
<p> <details><summary> 
Order:use() fails if wormHole is not valid
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    <span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
    <span class="keyword">local</span> <span class="local-variable">wormhole</span> = WormHole():destroy()

    ship:addOrder(Order:use(wormhole))
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-use-fails-if-wormhole-disappears" class="paragraph">
<p> <details><summary> 
Order:use() fails if wormhole disappears
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">wormhole</span> = WormHole():setPosition(<span class="integer">0</span>,<span class="integer">0</span>):setTargetPosition(<span class="integer">10000</span>, <span class="integer">0</span>)

Ship:withOrderQueue(ship)

<span class="keyword">local</span> <span class="local-variable">onAbortCalled</span>, <span class="local-variable">abortArg1</span>, <span class="local-variable">abortArg2</span>, <span class="local-variable">abortArg3</span> = <span class="integer">0</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>
<span class="keyword">local</span> <span class="local-variable">order</span> = Order:use(wormhole, <span class="map"><span class="delimiter">{</span>
    <span class="key">onAbort</span> = <span class="keyword">function</span>(arg1, arg2, arg3)
        <span class="key">onAbortCalled</span> = onAbortCalled + <span class="integer">1</span>
        <span class="key">abortArg1</span> = arg1
        <span class="key">abortArg2</span> = arg2
        <span class="key">abortArg3</span> = arg3
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
ship:addOrder(order)

Cron.tick(<span class="integer">1</span>)
wormhole:destroy()
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onAbortCalled)
<span class="predefined">assert</span>.is_same(order, abortArg1)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">invalid_target</span><span class="delimiter">&quot;</span></span>, abortArg2)
<span class="predefined">assert</span>.is_same(ship, abortArg3)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Idle</span><span class="delimiter">&quot;</span></span>, ship:getOrder())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-use-fleet-breaks-up-in-front-of-the-wormhole-and-calls-the-config-onbreakup-callback" class="paragraph">
<p> <details><summary> 
Order:use() fleet breaks up in front of the wormhole and calls the config.onBreakUp callback
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">leader</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">wormhole</span> = WormHole():setPosition(<span class="integer">5000</span>,<span class="integer">0</span>):setTargetPosition(<span class="integer">99999</span>, <span class="integer">0</span>)

<span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>leader, ship1, ship2<span class="delimiter">}</span></span>)
Fleet:withOrderQueue(fleet)

<span class="keyword">local</span> <span class="local-variable">onBreakUpCalled</span>, <span class="local-variable">breakUpArg1</span>, <span class="local-variable">breakUpArg2</span> = <span class="integer">0</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>
<span class="keyword">local</span> <span class="local-variable">order</span> = Order:use(wormhole, <span class="map"><span class="delimiter">{</span>
    <span class="key">onBreakUp</span> = <span class="keyword">function</span>(arg1, arg2)
        <span class="key">onBreakUpCalled</span> = onBreakUpCalled + <span class="integer">1</span>
        <span class="key">breakUpArg1</span> = arg1
        <span class="key">breakUpArg2</span> = arg2
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
fleet:addOrder(order)
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onBreakUpCalled)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, leader:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship1:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship2:getOrder())

leader:setPosition(<span class="integer">3000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards (ignore all)</span><span class="delimiter">&quot;</span></span>, leader:getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">5000</span>, leader:getOrderTargetLocationX())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, leader:getOrderTargetLocationY())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards (ignore all)</span><span class="delimiter">&quot;</span></span>, ship1:getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">5000</span>, ship1:getOrderTargetLocationX())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, ship1:getOrderTargetLocationY())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards (ignore all)</span><span class="delimiter">&quot;</span></span>, ship2:getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">5000</span>, ship2:getOrderTargetLocationX())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, ship2:getOrderTargetLocationY())
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onBreakUpCalled)
<span class="predefined">assert</span>.is_same(order, breakUpArg1)
<span class="predefined">assert</span>.is_same(fleet, breakUpArg2)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onBreakUpCalled) <span class="comment">-- it is only called once</span></code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-use-fleet-leader-waits-after-jump-and-regroups" class="paragraph">
<p> <details><summary> 
Order:use() fleet leader waits after jump and regroups
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">leader</span> = CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">leader</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">ship1</span> = CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">ship 1</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">ship2</span> = CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">ship 2</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">wormhole</span> = WormHole():setPosition(<span class="integer">5000</span>,<span class="integer">0</span>):setTargetPosition(<span class="integer">99999</span>, <span class="integer">0</span>)

<span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>leader, ship1, ship2<span class="delimiter">}</span></span>)
Fleet:withOrderQueue(fleet)

<span class="keyword">local</span> <span class="local-variable">order</span> = Order:use(wormhole)
fleet:addOrder(order)

Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, leader:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship1:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship2:getOrder())

leader:setPosition(<span class="integer">3000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards (ignore all)</span><span class="delimiter">&quot;</span></span>, leader:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards (ignore all)</span><span class="delimiter">&quot;</span></span>, ship1:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards (ignore all)</span><span class="delimiter">&quot;</span></span>, ship2:getOrder())

<span class="comment">-- leader jumps first</span>
leader:setPosition(<span class="integer">99999</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Stand Ground</span><span class="delimiter">&quot;</span></span>, leader:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards (ignore all)</span><span class="delimiter">&quot;</span></span>, ship1:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards (ignore all)</span><span class="delimiter">&quot;</span></span>, ship2:getOrder())

<span class="comment">-- wingman jumps second</span>
ship1:setPosition(<span class="integer">99999</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Stand Ground</span><span class="delimiter">&quot;</span></span>, leader:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship1:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards (ignore all)</span><span class="delimiter">&quot;</span></span>, ship2:getOrder())

<span class="comment">-- second wingman jumps</span>
ship2:setPosition(<span class="integer">99999</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Stand Ground</span><span class="delimiter">&quot;</span></span>, leader:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship1:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship2:getOrder())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="order-use-fleet-waits-after-jump-and-regroups" class="paragraph">
<p> <details><summary> 
Order:use() fleet waits after jump and regroups
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">leader</span> = CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">leader</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">ship1</span> = CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">ship 1</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">ship2</span> = CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">ship 2</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">ship3</span> = CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">ship 3</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">wormhole</span> = WormHole():setPosition(<span class="integer">5000</span>,<span class="integer">0</span>):setTargetPosition(<span class="integer">99999</span>, <span class="integer">0</span>)

<span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>leader, ship1, ship2, ship3<span class="delimiter">}</span></span>)
Fleet:withOrderQueue(fleet)

<span class="keyword">local</span> <span class="local-variable">order</span> = Order:use(wormhole)
fleet:addOrder(order)

Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, leader:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship1:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship2:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship3:getOrder())

leader:setPosition(<span class="integer">3000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards (ignore all)</span><span class="delimiter">&quot;</span></span>, leader:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards (ignore all)</span><span class="delimiter">&quot;</span></span>, ship1:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards (ignore all)</span><span class="delimiter">&quot;</span></span>, ship2:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards (ignore all)</span><span class="delimiter">&quot;</span></span>, ship3:getOrder())

<span class="comment">-- wingman jumps first</span>
ship1:setPosition(<span class="integer">99999</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards (ignore all)</span><span class="delimiter">&quot;</span></span>, leader:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Stand Ground</span><span class="delimiter">&quot;</span></span>, ship1:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards (ignore all)</span><span class="delimiter">&quot;</span></span>, ship2:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards (ignore all)</span><span class="delimiter">&quot;</span></span>, ship3:getOrder())


<span class="comment">-- leader jumps second</span>
leader:setPosition(<span class="integer">99999</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Stand Ground</span><span class="delimiter">&quot;</span></span>, leader:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship1:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards (ignore all)</span><span class="delimiter">&quot;</span></span>, ship2:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards (ignore all)</span><span class="delimiter">&quot;</span></span>, ship3:getOrder())

<span class="comment">-- second wingman jumps</span>
ship2:setPosition(<span class="integer">99999</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Stand Ground</span><span class="delimiter">&quot;</span></span>, leader:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship1:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship2:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards (ignore all)</span><span class="delimiter">&quot;</span></span>, ship3:getOrder())

ship3:setPosition(<span class="integer">99999</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Stand Ground</span><span class="delimiter">&quot;</span></span>, leader:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship1:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship2:getOrder())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly in formation</span><span class="delimiter">&quot;</span></span>, ship3:getOrder())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="person">Person</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="person-byname">Person:byName()</h3>
<div id="person-byname-should-create-a-valid-person-object-by-name" class="paragraph">
<p> <details><summary> 
Person:byName() should create a valid Person object by name
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">person</span> = Person:byName(<span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span>, person.getFormalName())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span>, person.getNickName())
<span class="predefined">assert</span>.is_true(Person:isPerson(person))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="person-byname-should-create-a-valid-person-object-by-name-with-nickname" class="paragraph">
<p> <details><summary> 
Person:byName() should create a valid Person object by name with nickname
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">person</span> = Person:byName(<span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span>, person.getFormalName())
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>, person.getNickName())
<span class="predefined">assert</span>.is_true(Person:isPerson(person))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="player">Player</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="player-withmenu">Player:withMenu()</h3>
<div id="player-withmenu-creates-a-valid-menu" class="paragraph">
<p> <details><summary> 
Player:withMenu() creates a valid menu
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player)

<span class="predefined">assert</span>.is_true(Player:hasMenu(player))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withmenu-does-not-change-menus-on-the-6-5-stations-when-buttons-on-the-4-3-stations-are-clicked" class="paragraph">
<p> <details><summary> 
Player:withMenu() does not change menus on the 6/5 stations when buttons on the 4/3 stations are clicked
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player, <span class="map"><span class="delimiter">{</span>
    <span class="key">backLabel</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span>,
<span class="delimiter">}</span></span>)

<span class="keyword">local</span> <span class="local-variable">submenu</span> = mockSubmenu(<span class="string"><span class="delimiter">&quot;</span><span class="content">Submenu</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>(menu)
    menu:addItem(mockMenuLabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">You are in a submenu</span><span class="delimiter">&quot;</span></span>))
<span class="keyword">end</span>)

player:addScienceMenuItem(submenu)

<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">science</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Submenu</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">operations</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Submenu</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">science</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">operations</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span>))

player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">operations</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Submenu</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">operations</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Submenu</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">operations</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">You are in a submenu</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">operations</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span>))

<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">science</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Submenu</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">science</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">You are in a submenu</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">science</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span>))

player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">science</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Submenu</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">science</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Submenu</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">science</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">You are in a submenu</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">science</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span>))

player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">operations</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">operations</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Submenu</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">operations</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span>))

<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">science</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Submenu</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">science</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">You are in a submenu</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">science</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withmenu-draws-submenus" class="paragraph">
<p> <details><summary> 
Player:withMenu() draws submenus
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="comment">-- test setup</span>
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player, <span class="map"><span class="delimiter">{</span>
    <span class="key">backLabel</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span>,
<span class="delimiter">}</span></span>)

<span class="keyword">local</span> <span class="local-variable">submenu</span> = mockSubmenu(<span class="string"><span class="delimiter">&quot;</span><span class="content">Submenu</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>(menu)
    menu:addItem(mockMenuLabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">You are in a submenu</span><span class="delimiter">&quot;</span></span>))
<span class="keyword">end</span>)

player:addScienceMenuItem(submenu)
player:addScienceMenuItem(mockMenuLabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">Original Item</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">science</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Submenu</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">science</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Original Item</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">science</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span>))

player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">science</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Submenu</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">science</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Submenu</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">science</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Original Item</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">science</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">You are in a submenu</span><span class="delimiter">&quot;</span></span>))

<span class="comment">-- there should ALWAYS! be a back button so the player can go back to the main menu</span>
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">science</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span>))

player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">science</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">science</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Submenu</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">science</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Original Item</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">science</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">You are in a submenu</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">science</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withmenu-fails-if-the-first-argument-already-has-menus" class="paragraph">
<p> <details><summary> 
Player:withMenu() fails if the first argument already has menus
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Player:withMenu(player) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withmenu-fails-if-the-first-argument-is-not-a-player" class="paragraph">
<p> <details><summary> 
Player:withMenu() fails if the first argument is not a player
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Player:withMenu(<span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withmenu-lets-menus-fall-back-to-the-4-3-station-and-single-pilot" class="paragraph">
<p> <details><summary> 
Player:withMenu() lets menus fall back to the 4/3 station and single pilot
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player)

<span class="keyword">local</span> <span class="local-variable">helmsCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">weaponsCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">relayCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">scienceCalled</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">engineeringCalled</span> = <span class="integer">0</span>
player:addHelmsMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, Menu:newItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">Helms</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() helmsCalled = helmsCalled + <span class="integer">1</span> <span class="keyword">end</span>))
player:addWeaponsMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">weapons</span><span class="delimiter">&quot;</span></span>, Menu:newItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">Weapons</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() weaponsCalled = weaponsCalled + <span class="integer">1</span> <span class="keyword">end</span>))
player:addRelayMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">relay</span><span class="delimiter">&quot;</span></span>, Menu:newItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">Relay</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() relayCalled = relayCalled + <span class="integer">1</span> <span class="keyword">end</span>))
player:addScienceMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">science</span><span class="delimiter">&quot;</span></span>, Menu:newItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">Science</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() scienceCalled = scienceCalled + <span class="integer">1</span> <span class="keyword">end</span>))
player:addEngineeringMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, Menu:newItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">Engineering</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() engineeringCalled = engineeringCalled + <span class="integer">1</span> <span class="keyword">end</span>))

<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">tactical</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Helms</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">tactical</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Weapons</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">operations</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Relay</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">operations</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Science</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering+</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Engineering</span><span class="delimiter">&quot;</span></span>))

<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">single</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Helms</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">single</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Weapons</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">single</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Relay</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">single</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Science</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">single</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Engineering</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withmenu-only-shows-a-message-on-the-station-where-the-button-was-clicked" class="paragraph">
<p> <details><summary> 
Player:withMenu() only shows a message on the station where the button was clicked
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player)

player:addHelmsMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">button</span><span class="delimiter">&quot;</span></span>, Menu:newItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">Click Me</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hey, it's me: your friendly pop up</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>))

player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">tactical</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Click Me</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hey, it's me: your friendly pop up</span><span class="delimiter">&quot;</span></span>, player:getCustomMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">tactical</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_nil(player:getCustomMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>))

player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Click Me</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hey, it's me: your friendly pop up</span><span class="delimiter">&quot;</span></span>, player:getCustomMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withmenu-should-not-have-functions-for-tactical-operations-engineering-and-single-pilot" class="paragraph">
<p> <details><summary> 
Player:withMenu() should not have functions for tactical, operations, engineering+ and single pilot
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player)

<span class="predefined">assert</span>.is_nil(player.addTacticalMenuItem)
<span class="predefined">assert</span>.is_nil(player.addOperationsMenuItem)
<span class="predefined">assert</span>.is_nil(player.addSingleMenuItem)
<span class="predefined">assert</span>.is_nil(player.removeTacticalMenuItem)
<span class="predefined">assert</span>.is_nil(player.removeOperationsMenuItem)
<span class="predefined">assert</span>.is_nil(player.removeSingleMenuItem)
<span class="predefined">assert</span>.is_nil(player.drawTacticalMenu)
<span class="predefined">assert</span>.is_nil(player.drawOperationsMenu)
<span class="predefined">assert</span>.is_nil(player.drawSingleMenu)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    player:addMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">operations</span><span class="delimiter">&quot;</span></span>, Menu:newItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">Boom</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">This should not work</span><span class="delimiter">&quot;</span></span>))
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    player:addMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">tactical</span><span class="delimiter">&quot;</span></span>, Menu:newItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">Boom</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">This should not work</span><span class="delimiter">&quot;</span></span>))
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    player:addMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering+</span><span class="delimiter">&quot;</span></span>, Menu:newItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">Boom</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">This should not work</span><span class="delimiter">&quot;</span></span>))
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    player:addMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">single</span><span class="delimiter">&quot;</span></span>, Menu:newItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">Boom</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">This should not work</span><span class="delimiter">&quot;</span></span>))
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withmenu-triggers-callbacks-on-click" class="paragraph">
<p> <details><summary> 
Player:withMenu() triggers callbacks on click
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player)

<span class="keyword">local</span> <span class="local-variable">called</span>, <span class="local-variable">callArg1</span>, <span class="local-variable">callArg2</span> = <span class="integer">0</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>
player:addRelayMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">function</span><span class="delimiter">&quot;</span></span>, Menu:newItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">Callback</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>(arg1, arg2)
    called = called + <span class="integer">1</span>
    callArg1 = arg1
    callArg2 = arg2
<span class="keyword">end</span>))

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)
<span class="predefined">assert</span>.is_nil(callArg1)
<span class="predefined">assert</span>.is_nil(callArg2)
player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">relay</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Callback</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)
<span class="predefined">assert</span>.is_same(player, callArg1)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">relay</span><span class="delimiter">&quot;</span></span>, callArg2)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="player-withmenu-addhelmsmenuitem">Player:withMenu():addHelmsMenuItem(),</h3>
<div id="player-withmenu-addhelmsmenuitem-removehelmsmenuitem-drawhelmsmenu-adds-and-removes-menu-items" class="paragraph">
<p> <details><summary> 
Player:withMenu():addHelmsMenuItem(), removeHelmsMenuItem(), drawHelmsMenu() adds and removes menu items
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player)

player:addHelmsMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">submenu</span><span class="delimiter">&quot;</span></span>, mockSubmenu(<span class="string"><span class="delimiter">&quot;</span><span class="content">Submenu 1</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Submenu 1</span><span class="delimiter">&quot;</span></span>))
player:addHelmsMenuItem(mockSubmenu(<span class="string"><span class="delimiter">&quot;</span><span class="content">Submenu 2</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Submenu 2</span><span class="delimiter">&quot;</span></span>))

player:addHelmsMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>, mockMenuLabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">Label 1</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Label 1</span><span class="delimiter">&quot;</span></span>))
player:addHelmsMenuItem(mockMenuLabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">Label 2</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Label 2</span><span class="delimiter">&quot;</span></span>))

player:addHelmsMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">sideeffects</span><span class="delimiter">&quot;</span></span>, mockMenuItemWithSideEffects(<span class="string"><span class="delimiter">&quot;</span><span class="content">Effect 1</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Effect 1</span><span class="delimiter">&quot;</span></span>))
player:addHelmsMenuItem(mockMenuItemWithSideEffects(<span class="string"><span class="delimiter">&quot;</span><span class="content">Effect 2</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Effect 2</span><span class="delimiter">&quot;</span></span>))

player:removeHelmsMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">submenu</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Submenu 1</span><span class="delimiter">&quot;</span></span>))

player:removeHelmsMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Label 1</span><span class="delimiter">&quot;</span></span>))

player:removeHelmsMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">sideeffects</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Effect 1</span><span class="delimiter">&quot;</span></span>))

<span class="comment">-- you usually do not need to call that, but lets see if it throws an error</span>
player:drawHelmsMenu()</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="player-withmenu-addmenuitem">Player:withMenu():addMenuItem()</h3>
<div id="player-withmenu-addmenuitem-fails-if-an-invalid-position-is-given" class="paragraph">
<p> <details><summary> 
Player:withMenu():addMenuItem() fails if an invalid position is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    player:addMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">invalid</span><span class="delimiter">&quot;</span></span>, mockSubmenu())
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    player:addMenuItem(<span class="predefined-constant">nil</span>, mockSubmenu())
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    player:addMenuItem(<span class="integer">42</span>, mockSubmenu())
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="player-withmenu-addmenuitem">Player:withMenu():addMenuItem(),</h3>
<div id="player-withmenu-addmenuitem-removemenuitem-drawmenu-adds-and-removes-menu-items" class="paragraph">
<p> <details><summary> 
Player:withMenu():addMenuItem(), removeMenuItem(), drawMenu() adds and removes menu items
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player)

player:addMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">submenu</span><span class="delimiter">&quot;</span></span>, mockSubmenu(<span class="string"><span class="delimiter">&quot;</span><span class="content">Submenu 1</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Submenu 1</span><span class="delimiter">&quot;</span></span>))
player:addMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, mockSubmenu(<span class="string"><span class="delimiter">&quot;</span><span class="content">Submenu 2</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Submenu 2</span><span class="delimiter">&quot;</span></span>))

player:addMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>, mockMenuLabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">Label 1</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Label 1</span><span class="delimiter">&quot;</span></span>))
player:addMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, mockMenuLabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">Label 2</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Label 2</span><span class="delimiter">&quot;</span></span>))

player:addMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sideeffects</span><span class="delimiter">&quot;</span></span>, mockMenuItemWithSideEffects(<span class="string"><span class="delimiter">&quot;</span><span class="content">Effect 1</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Effect 1</span><span class="delimiter">&quot;</span></span>))
player:addMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, mockMenuItemWithSideEffects(<span class="string"><span class="delimiter">&quot;</span><span class="content">Effect 2</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Effect 2</span><span class="delimiter">&quot;</span></span>))

player:removeMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">submenu</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Submenu 1</span><span class="delimiter">&quot;</span></span>))

player:removeMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Label 1</span><span class="delimiter">&quot;</span></span>))

player:removeMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sideeffects</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Effect 1</span><span class="delimiter">&quot;</span></span>))

<span class="comment">-- you usually do not need to call that, but lets test in anyways</span>
player:drawMenu(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withmenu-addmenuitem-removemenuitem-drawmenu-does-not-redraw-the-menu-if-some-submenu-is-currently-opened" class="paragraph">
<p> <details><summary> 
Player:withMenu():addMenuItem(), removeMenuItem(), drawMenu() does not redraw the menu if some submenu is currently opened
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player, <span class="map"><span class="delimiter">{</span><span class="key">backLabel</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)

<span class="keyword">local</span> <span class="local-variable">menu</span> = Menu:new()
menu:addItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">dummy</span><span class="delimiter">&quot;</span></span>, Menu:newItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">You are in the submenu</span><span class="delimiter">&quot;</span></span>))

player:addMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">submenu</span><span class="delimiter">&quot;</span></span>, Menu:newItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">Submenu</span><span class="delimiter">&quot;</span></span>, menu))
player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Submenu</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">You are in the submenu</span><span class="delimiter">&quot;</span></span>))
player:addMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">dummy</span><span class="delimiter">&quot;</span></span>, mockMenuLabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">Main Menu</span><span class="delimiter">&quot;</span></span>))

<span class="comment">-- assert you are not thrown back to the main menu</span>
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">You are in the submenu</span><span class="delimiter">&quot;</span></span>))
player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Main Menu</span><span class="delimiter">&quot;</span></span>))
player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Submenu</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">You are in the submenu</span><span class="delimiter">&quot;</span></span>))

player:removeMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">dummy</span><span class="delimiter">&quot;</span></span>)

<span class="comment">-- assert you are not thrown back to the main menu</span>
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">You are in the submenu</span><span class="delimiter">&quot;</span></span>))
player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Main Menu</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="player-withmenu-drawmenu">Player:withMenu():drawMenu()</h3>
<div id="player-withmenu-drawmenu-can-draw-an-arbitrary-menu" class="paragraph">
<p> <details><summary> 
Player:withMenu():drawMenu() can draw an arbitrary menu
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="comment">-- test setup</span>
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player, <span class="map"><span class="delimiter">{</span>
    <span class="key">backLabel</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span>,
<span class="delimiter">}</span></span>)

player:addMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">weapons</span><span class="delimiter">&quot;</span></span>, mockSubmenu(<span class="string"><span class="delimiter">&quot;</span><span class="content">Original Item 1</span><span class="delimiter">&quot;</span></span>))
player:addMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">weapons</span><span class="delimiter">&quot;</span></span>, mockMenuLabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">Original Item 2</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">weapons</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Original Item 1</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">weapons</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Original Item 2</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">weapons</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span>))

<span class="keyword">local</span> <span class="local-variable">overrideMenu</span> = Menu:new()
overrideMenu:addItem(mockMenuLabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">Override Item</span><span class="delimiter">&quot;</span></span>))

player:drawMenu(<span class="string"><span class="delimiter">&quot;</span><span class="content">weapons</span><span class="delimiter">&quot;</span></span>, overrideMenu)
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">weapons</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Original Item 1</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">weapons</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Original Item 2</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">weapons</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Override Item</span><span class="delimiter">&quot;</span></span>))

<span class="comment">-- there should ALWAYS! be a back button so the player can go back to the main menu</span>
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">weapons</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span>))
player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">weapons</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">weapons</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Original Item 1</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">weapons</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Original Item 2</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">weapons</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Override Item</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">weapons</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withmenu-drawmenu-compensates-for-the-back-button-on-submenus" class="paragraph">
<p> <details><summary> 
Player:withMenu():drawMenu() compensates for the back button on submenus
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player, <span class="map"><span class="delimiter">{</span>
    <span class="key">backLabel</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span>,
    <span class="key">labelNext</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Next</span><span class="delimiter">&quot;</span></span>,
    <span class="key">labelPrevious</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Previous</span><span class="delimiter">&quot;</span></span>,
    <span class="key">itemsPerPage</span> = <span class="integer">6</span>,
<span class="delimiter">}</span></span>)

<span class="keyword">local</span> <span class="local-variable">menu</span> = Menu:new()
player:addMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, Menu:newItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">Click Me</span><span class="delimiter">&quot;</span></span>, menu))

<span class="keyword">for</span> i=<span class="integer">1</span>,<span class="integer">11</span> <span class="keyword">do</span>
    menu:addItem(mockMenuLabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">Item </span><span class="delimiter">&quot;</span></span> .. i, i))
<span class="keyword">end</span>

player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Click Me</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 1</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 2</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 3</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 4</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 5</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Next</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Previous</span><span class="delimiter">&quot;</span></span>))

player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Next</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 4</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 5</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 6</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 7</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 8</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Next</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Previous</span><span class="delimiter">&quot;</span></span>))

player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Next</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 7</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 8</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 9</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 10</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 11</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Next</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Previous</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withmenu-drawmenu-draws-a-main-menu-on-one-page-if-it-fits" class="paragraph">
<p> <details><summary> 
Player:withMenu():drawMenu() draws a main menu on one page if it fits
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player, <span class="map"><span class="delimiter">{</span>
    <span class="key">backLabel</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span>,
    <span class="key">labelNext</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Next</span><span class="delimiter">&quot;</span></span>,
    <span class="key">labelPrevious</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Previous</span><span class="delimiter">&quot;</span></span>,
    <span class="key">itemsPerPage</span> = <span class="integer">8</span>,
<span class="delimiter">}</span></span>)
<span class="keyword">for</span> i=<span class="integer">1</span>,<span class="integer">8</span> <span class="keyword">do</span>
    player:addMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, mockMenuLabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">Item </span><span class="delimiter">&quot;</span></span> .. i, i))
<span class="keyword">end</span>
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 1</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 2</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 3</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 4</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 5</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 6</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 7</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 8</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Next</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Previous</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withmenu-drawmenu-draws-the-last-page-of-the-main-menu-on-one-page-if-it-fits" class="paragraph">
<p> <details><summary> 
Player:withMenu():drawMenu() draws the last page of the main menu on one page if it fits
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player, <span class="map"><span class="delimiter">{</span>
    <span class="key">backLabel</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span>,
    <span class="key">labelNext</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Next</span><span class="delimiter">&quot;</span></span>,
    <span class="key">labelPrevious</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Previous</span><span class="delimiter">&quot;</span></span>,
    <span class="key">itemsPerPage</span> = <span class="integer">6</span>,
<span class="delimiter">}</span></span>)
<span class="keyword">for</span> i=<span class="integer">1</span>,<span class="integer">14</span> <span class="keyword">do</span>
    player:addMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, mockMenuLabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">Item </span><span class="delimiter">&quot;</span></span> .. i, i))
<span class="keyword">end</span>
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 1</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 2</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 3</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 4</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 5</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 6</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Next</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Previous</span><span class="delimiter">&quot;</span></span>))

player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Next</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 5</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 6</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 7</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 8</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 9</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 10</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Next</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Previous</span><span class="delimiter">&quot;</span></span>))

player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Next</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 9</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 10</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 11</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 12</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 13</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 14</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Next</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Previous</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withmenu-drawmenu-fails-if-an-invalid-position-is-given" class="paragraph">
<p> <details><summary> 
Player:withMenu():drawMenu() fails if an invalid position is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    player:drawMenu(<span class="string"><span class="delimiter">&quot;</span><span class="content">invalid</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    player:drawMenu(<span class="predefined-constant">nil</span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    player:drawMenu(<span class="integer">42</span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withmenu-drawmenu-paginates-long-main-menus" class="paragraph">
<p> <details><summary> 
Player:withMenu():drawMenu() paginates long main menus
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player, <span class="map"><span class="delimiter">{</span>
    <span class="key">backLabel</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span>,
    <span class="key">labelNext</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Next</span><span class="delimiter">&quot;</span></span>,
    <span class="key">labelPrevious</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Previous</span><span class="delimiter">&quot;</span></span>,
    <span class="key">itemsPerPage</span> = <span class="integer">8</span>,
<span class="delimiter">}</span></span>)
<span class="keyword">for</span> i=<span class="integer">1</span>,<span class="integer">10</span> <span class="keyword">do</span>
    player:addMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, mockMenuLabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">Item </span><span class="delimiter">&quot;</span></span> .. i, i))
<span class="keyword">end</span>
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 1</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 2</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 3</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 4</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 5</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 6</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 7</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 8</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Next</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Previous</span><span class="delimiter">&quot;</span></span>))

player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Next</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 7</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 8</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 9</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 10</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Next</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Previous</span><span class="delimiter">&quot;</span></span>))

player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Previous</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 1</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 2</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 3</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 4</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 5</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 6</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 7</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Item 8</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="player-withmenu-removemenuitem">Player:withMenu():removeMenuItem()</h3>
<div id="player-withmenu-removemenuitem-fails-if-an-invalid-position-is-given" class="paragraph">
<p> <details><summary> 
Player:withMenu():removeMenuItem() fails if an invalid position is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    player:removeMenuItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">invalid</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    player:removeMenuItem(<span class="predefined-constant">nil</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    player:removeMenuItem(<span class="integer">42</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="player-withmissiondisplay">Player:withMissionDisplay()</h3>
<div id="player-withmissiondisplay-creates-a-valid-mission-display" class="paragraph">
<p> <details><summary> 
Player:withMissionDisplay() creates a valid mission display
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player)
Player:withMissionTracker(player)
Player:withMissionDisplay(player, defaultConfig)

<span class="predefined">assert</span>.is_true(Player:hasMissionDisplay(player))

<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">relay</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Missions</span><span class="delimiter">&quot;</span></span>))
player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">relay</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Missions</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_true(player:hasCustomMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">relay</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withmissiondisplay-fails-if-the-first-argument-is-a-player-without-storage" class="paragraph">
<p> <details><summary> 
Player:withMissionDisplay() fails if the first argument is a player without storage
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Player:withMissionDisplay(PlayerSpaceship(), defaultConfig) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withmissiondisplay-fails-if-the-first-argument-is-already-a-mission-display-player" class="paragraph">
<p> <details><summary> 
Player:withMissionDisplay() fails if the first argument is already a mission display player
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player)
Player:withMissionTracker(player)
Player:withMissionDisplay(player, defaultConfig)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Player:withMissionDisplay(player, defaultConfig) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withmissiondisplay-fails-if-the-first-argument-is-not-a-player" class="paragraph">
<p> <details><summary> 
Player:withMissionDisplay() fails if the first argument is not a player
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Player:withMissionDisplay(<span class="integer">42</span>, defaultConfig) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="player-withmissiontracker">Player:withMissionTracker()</h3>
<div id="player-withmissiontracker-creates-a-valid-mission-tracker" class="paragraph">
<p> <details><summary> 
Player:withMissionTracker() creates a valid mission tracker
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMissionTracker(player)

<span class="predefined">assert</span>.is_true(Player:hasMissionTracker(player))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withmissiontracker-fails-if-the-first-argument-is-already-a-mission-tracker-player" class="paragraph">
<p> <details><summary> 
Player:withMissionTracker() fails if the first argument is already a mission tracker player
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMissionTracker(player)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Player:withMissionTracker(player) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withmissiontracker-fails-if-the-first-argument-is-not-a-player" class="paragraph">
<p> <details><summary> 
Player:withMissionTracker() fails if the first argument is not a player
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Player:withMissionTracker(<span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="player-withmissiontracker-addmission">Player:withMissionTracker():addMission()</h3>
<div id="player-withmissiontracker-addmission-adds-a-mission" class="paragraph">
<p> <details><summary> 
Player:withMissionTracker():addMission() adds a mission
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMissionTracker(player)

<span class="keyword">local</span> <span class="local-variable">mission</span> = startedMissionWithBrokerMock()

player:addMission(mission)

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, Util.size(player:getStartedMissions()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withmissiontracker-addmission-fails-if-the-first-parameter-is-not-a-mission" class="paragraph">
<p> <details><summary> 
Player:withMissionTracker():addMission() fails if the first parameter is not a mission
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMissionTracker(player)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() player:addMission(<span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="player-withmissiontracker-getstartedmissions">Player:withMissionTracker():getStartedMissions()</h3>
<div id="player-withmissiontracker-getstartedmissions-does-not-return-missions-that-do-not-have-the-state-started" class="paragraph">
<p> <details><summary> 
Player:withMissionTracker():getStartedMissions() does not return missions that do not have the state started
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMissionTracker(player)

player:addMission(missionWithBrokerMock())
player:addMission(acceptedMissionWithBrokerMock())
player:addMission(declinedMissionWithBrokerMock())
player:addMission(failedMissionWithBrokerMock())
player:addMission(successfulMissionWithBrokerMock())

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, Util.size(player:getStartedMissions()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withmissiontracker-getstartedmissions-manipulating-the-result-set-does-not-add-missions" class="paragraph">
<p> <details><summary> 
Player:withMissionTracker():getStartedMissions() manipulating the result set does not add missions
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMissionTracker(player)

player:addMission(startedMissionWithBrokerMock())

<span class="keyword">local</span> <span class="local-variable">missions</span> = player:getStartedMissions()
table.insert(missions, startedMissionWithBrokerMock())

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, Util.size(player:getStartedMissions()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withmissiontracker-getstartedmissions-returns-all-started-missions" class="paragraph">
<p> <details><summary> 
Player:withMissionTracker():getStartedMissions() returns all started missions
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMissionTracker(player)

player:addMission(startedMissionWithBrokerMock())
player:addMission(startedMissionWithBrokerMock())
player:addMission(startedMissionWithBrokerMock())

<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, Util.size(player:getStartedMissions()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="player-withpowerpresets">Player:withPowerPresets()</h3>
<div id="player-withpowerpresets-can-add-a-reset-button" class="paragraph">
<p> <details><summary> 
Player:withPowerPresets() can add a reset button
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player, <span class="map"><span class="delimiter">{</span><span class="key">backLabel</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
Player:withPowerPresets(player, Util.mergeTables(defaultConfig, <span class="map"><span class="delimiter">{</span> <span class="key">labelReset</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Reset</span><span class="delimiter">&quot;</span></span> <span class="delimiter">}</span></span>))
<span class="predefined">assert</span>.is_true(Player:hasPowerPresets(player))

player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Presets</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Reset</span><span class="delimiter">&quot;</span></span>))

player:setSystemPower(<span class="string"><span class="delimiter">&quot;</span><span class="content">impulse</span><span class="delimiter">&quot;</span></span>, <span class="integer">2</span>)
player:setSystemCoolant(<span class="string"><span class="delimiter">&quot;</span><span class="content">impulse</span><span class="delimiter">&quot;</span></span>, <span class="integer">1</span>)
player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Reset</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, player:getSystemPower(<span class="string"><span class="delimiter">&quot;</span><span class="content">impulse</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getSystemCoolant(<span class="string"><span class="delimiter">&quot;</span><span class="content">impulse</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withpowerpresets-can-add-an-info-button" class="paragraph">
<p> <details><summary> 
Player:withPowerPresets() can add an info button
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player, <span class="map"><span class="delimiter">{</span><span class="key">backLabel</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
Player:withPowerPresets(player, Util.mergeTables(defaultConfig, <span class="map"><span class="delimiter">{</span> <span class="key">labelInfo</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Info</span><span class="delimiter">&quot;</span></span>, <span class="key">infoText</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span> <span class="delimiter">}</span></span>))
<span class="predefined">assert</span>.is_true(Player:hasPowerPresets(player))

player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Presets</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Info</span><span class="delimiter">&quot;</span></span>))
player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Info</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>, player:getCustomMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withpowerpresets-works-with-default-parameters" class="paragraph">
<p> <details><summary> 
Player:withPowerPresets() works with default parameters
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player, <span class="map"><span class="delimiter">{</span><span class="key">backLabel</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
Player:withPowerPresets(player, Util.mergeTables(defaultConfig, <span class="map"><span class="delimiter">{</span> <span class="key">slots</span> = <span class="integer">4</span> <span class="delimiter">}</span></span>))
<span class="predefined">assert</span>.is_true(Player:hasPowerPresets(player))

<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Presets</span><span class="delimiter">&quot;</span></span>))
player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Presets</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Load</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Store</span><span class="delimiter">&quot;</span></span>))
player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Store</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Store 1</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Store 2</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Store 3</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Store 4</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Store 5</span><span class="delimiter">&quot;</span></span>))

player:setSystemPower(<span class="string"><span class="delimiter">&quot;</span><span class="content">impulse</span><span class="delimiter">&quot;</span></span>, <span class="float">0.5</span>)
player:setSystemCoolant(<span class="string"><span class="delimiter">&quot;</span><span class="content">impulse</span><span class="delimiter">&quot;</span></span>, <span class="float">0.42</span>)
player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Store 1</span><span class="delimiter">&quot;</span></span>)
player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span>)

player:setSystemPower(<span class="string"><span class="delimiter">&quot;</span><span class="content">impulse</span><span class="delimiter">&quot;</span></span>, <span class="integer">1</span>)
player:setSystemCoolant(<span class="string"><span class="delimiter">&quot;</span><span class="content">impulse</span><span class="delimiter">&quot;</span></span>, <span class="integer">0</span>)
player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Presets</span><span class="delimiter">&quot;</span></span>)
player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Load</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Load 1</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Load 2</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Load 3</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Load 4</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Load 5</span><span class="delimiter">&quot;</span></span>))

player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Load 1</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.is_same(<span class="float">0.5</span>, player:getSystemPower(<span class="string"><span class="delimiter">&quot;</span><span class="content">impulse</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_same(<span class="float">0.42</span>, player:getSystemCoolant(<span class="string"><span class="delimiter">&quot;</span><span class="content">impulse</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="player-withquickdial">Player:withQuickDial()</h3>
<div id="player-withquickdial-ignores-invalid-stations" class="paragraph">
<p> <details><summary> 
Player:withQuickDial() ignores invalid stations
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Outpost 42</span><span class="delimiter">&quot;</span></span>)
Player:withMenu(player, <span class="map"><span class="delimiter">{</span><span class="key">backLabel</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
Player:withQuickDial(player, defaultConfig)
<span class="predefined">assert</span>.is_true(Player:hasQuickDial(player))

player:addQuickDial(station)

station:destroy()

<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">relay</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Quick Dial</span><span class="delimiter">&quot;</span></span>))
player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">relay</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Quick Dial</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">relay</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Outpost 42</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withquickdial-works-with-default-parameters" class="paragraph">
<p> <details><summary> 
Player:withQuickDial() works with default parameters
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player, <span class="map"><span class="delimiter">{</span><span class="key">backLabel</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
Player:withQuickDial(player, defaultConfig)
<span class="predefined">assert</span>.is_true(Player:hasQuickDial(player))

<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">relay</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Quick Dial</span><span class="delimiter">&quot;</span></span>))
player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">relay</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Quick Dial</span><span class="delimiter">&quot;</span></span>)
player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">relay</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="player-withquickdial-addquickdial">Player:withQuickDial():addQuickDial()</h3>
<div id="player-withquickdial-addquickdial-allows-to-add-fleets" class="paragraph">
<p> <details><summary> 
Player:withQuickDial():addQuickDial() allows to add fleets
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>
    CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fleet Leader</span><span class="delimiter">&quot;</span></span>),
    CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Wingman</span><span class="delimiter">&quot;</span></span>)
<span class="delimiter">}</span></span>)
Player:withMenu(player, <span class="map"><span class="delimiter">{</span><span class="key">backLabel</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
Player:withQuickDial(player, defaultConfig)
<span class="predefined">assert</span>.is_true(Player:hasQuickDial(player))

player:addQuickDial(fleet)

<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">relay</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Quick Dial</span><span class="delimiter">&quot;</span></span>))
player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">relay</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Quick Dial</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">relay</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Fleet Leader</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withquickdial-addquickdial-allows-to-add-ships" class="paragraph">
<p> <details><summary> 
Player:withQuickDial():addQuickDial() allows to add ships
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Nostromo</span><span class="delimiter">&quot;</span></span>)
Player:withMenu(player, <span class="map"><span class="delimiter">{</span><span class="key">backLabel</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
Player:withQuickDial(player, defaultConfig)
<span class="predefined">assert</span>.is_true(Player:hasQuickDial(player))

player:addQuickDial(ship)

<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">relay</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Quick Dial</span><span class="delimiter">&quot;</span></span>))
player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">relay</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Quick Dial</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">relay</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Nostromo</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withquickdial-addquickdial-allows-to-add-stations" class="paragraph">
<p> <details><summary> 
Player:withQuickDial():addQuickDial() allows to add stations
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Outpost 42</span><span class="delimiter">&quot;</span></span>)
Player:withMenu(player, <span class="map"><span class="delimiter">{</span><span class="key">backLabel</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
Player:withQuickDial(player, defaultConfig)
<span class="predefined">assert</span>.is_true(Player:hasQuickDial(player))

player:addQuickDial(station)

<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">relay</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Quick Dial</span><span class="delimiter">&quot;</span></span>))
player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">relay</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Quick Dial</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">relay</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Outpost 42</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withquickdial-addquickdial-fails-when-adding-an-invalid-thing" class="paragraph">
<p> <details><summary> 
Player:withQuickDial():addQuickDial() fails when adding an invalid thing
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player, <span class="map"><span class="delimiter">{</span><span class="key">backLabel</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
Player:withQuickDial(player, defaultConfig)
<span class="predefined">assert</span>.is_true(Player:hasQuickDial(player))

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    player:addQuickDial()
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    player:addQuickDial(<span class="integer">42</span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    player:addQuickDial(Asteroid())
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="player-withquickdial-getquickdials">Player:withQuickDial():getQuickDials()</h3>
<div id="player-withquickdial-getquickdials-does-not-return-invalid-entities" class="paragraph">
<p> <details><summary> 
Player:withQuickDial():getQuickDials() does not return invalid entities
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Outpost 42</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>
    CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fleet Leader</span><span class="delimiter">&quot;</span></span>),
    CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Wingman</span><span class="delimiter">&quot;</span></span>)
<span class="delimiter">}</span></span>)
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Nostromo</span><span class="delimiter">&quot;</span></span>)
Player:withMenu(player, <span class="map"><span class="delimiter">{</span><span class="key">backLabel</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
Player:withQuickDial(player, defaultConfig)
<span class="predefined">assert</span>.is_true(Player:hasQuickDial(player))

player:addQuickDial(station)
player:addQuickDial(fleet)
player:addQuickDial(ship)

<span class="predefined">assert</span>.contains_value(station, player:getQuickDials())
<span class="predefined">assert</span>.contains_value(fleet, player:getQuickDials())
<span class="predefined">assert</span>.contains_value(ship, player:getQuickDials())

ship:destroy()

<span class="predefined">assert</span>.contains_value(station, player:getQuickDials())
<span class="predefined">assert</span>.contains_value(fleet, player:getQuickDials())
<span class="predefined">assert</span>.not_contains_value(ship, player:getQuickDials())

station:destroy()

<span class="predefined">assert</span>.not_contains_value(station, player:getQuickDials())
<span class="predefined">assert</span>.contains_value(fleet, player:getQuickDials())
<span class="predefined">assert</span>.not_contains_value(ship, player:getQuickDials())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withquickdial-getquickdials-returns-a-table-with-all-added-quick-dials" class="paragraph">
<p> <details><summary> 
Player:withQuickDial():getQuickDials() returns a table with all added quick dials
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Outpost 42</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">fleet</span> = Fleet:new(<span class="map"><span class="delimiter">{</span>
    CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fleet Leader</span><span class="delimiter">&quot;</span></span>),
    CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Wingman</span><span class="delimiter">&quot;</span></span>)
<span class="delimiter">}</span></span>)
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Nostromo</span><span class="delimiter">&quot;</span></span>)
Player:withMenu(player, <span class="map"><span class="delimiter">{</span><span class="key">backLabel</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
Player:withQuickDial(player, defaultConfig)
<span class="predefined">assert</span>.is_true(Player:hasQuickDial(player))

<span class="predefined">assert</span>.not_contains_value(station, player:getQuickDials())
<span class="predefined">assert</span>.not_contains_value(fleet, player:getQuickDials())
<span class="predefined">assert</span>.not_contains_value(ship, player:getQuickDials())

player:addQuickDial(station)

<span class="predefined">assert</span>.contains_value(station, player:getQuickDials())

player:addQuickDial(fleet)
player:addQuickDial(ship)

<span class="predefined">assert</span>.contains_value(fleet, player:getQuickDials())
<span class="predefined">assert</span>.contains_value(ship, player:getQuickDials())

player:removeQuickDial(station)

<span class="predefined">assert</span>.not_contains_value(station, player:getQuickDials())
<span class="predefined">assert</span>.contains_value(fleet, player:getQuickDials())
<span class="predefined">assert</span>.contains_value(ship, player:getQuickDials())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="player-withquickdial-removequickdial">Player:withQuickDial():removeQuickDial()</h3>
<div id="player-withquickdial-removequickdial-allows-to-remove-a-quick-dial" class="paragraph">
<p> <details><summary> 
Player:withQuickDial():removeQuickDial() allows to remove a quick dial
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Outpost 42</span><span class="delimiter">&quot;</span></span>)
Player:withMenu(player, <span class="map"><span class="delimiter">{</span><span class="key">backLabel</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
Player:withQuickDial(player, defaultConfig)
<span class="predefined">assert</span>.is_true(Player:hasQuickDial(player))

player:addQuickDial(CpuShip())
player:addQuickDial(CpuShip())
player:addQuickDial(station)
player:addQuickDial(CpuShip())

<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">relay</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Quick Dial</span><span class="delimiter">&quot;</span></span>))
player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">relay</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Quick Dial</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">relay</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Outpost 42</span><span class="delimiter">&quot;</span></span>))
player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">relay</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span>)

player:removeQuickDial(station)
player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">relay</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Quick Dial</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_false(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">relay</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Outpost 42</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="player-withstorage">Player:withStorage()</h3>
<div id="player-withstorage-allows-to-configure-the-maxstorage" class="paragraph">
<p> <details><summary> 
Player:withStorage() allows to configure the maxStorage
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()

Player:withStorage(player, <span class="map"><span class="delimiter">{</span><span class="key">maxStorage</span> = <span class="integer">1000</span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_true(Player:hasStorage(player))
<span class="predefined">assert</span>.is_same(<span class="integer">1000</span>, player:getMaxStorageSpace())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withstorage-creates-a-valid-storage" class="paragraph">
<p> <details><summary> 
Player:withStorage() creates a valid storage
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()

Player:withStorage(player)
<span class="predefined">assert</span>.is_true(Player:hasStorage(player))
<span class="predefined">assert</span>.is_number(player:getMaxStorageSpace())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withstorage-fails-if-first-argument-is-a-number" class="paragraph">
<p> <details><summary> 
Player:withStorage() fails if first argument is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Player:withStorage(<span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withstorage-fails-if-second-argument-is-a-number" class="paragraph">
<p> <details><summary> 
Player:withStorage() fails if second argument is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Player:withStorage(PlayerSpaceship(), <span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="player-withstorage-getproductstorage-getemptyproductstorage-getmaxproductstorage">Player:withStorage():getProductStorage(),:getEmptyProductStorage(),:getMaxProductStorage()</h3>
<div id="player-withstorage-getproductstorage-getemptyproductstorage-getmaxproductstorage-returns-the-correct-value" class="paragraph">
<p> <details><summary> 
Player:withStorage():getProductStorage(),:getEmptyProductStorage(),:getMaxProductStorage() returns the correct value
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withStorage(player, <span class="map"><span class="delimiter">{</span><span class="key">maxStorage</span> = <span class="integer">100</span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getMaxProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getEmptyProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getMaxProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getEmptyProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getProductStorage(product3))
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getMaxProductStorage(product3))
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getEmptyProductStorage(product3))

player:modifyProductStorage(product1, <span class="integer">10</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">10</span>, player:getProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getMaxProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">90</span>, player:getEmptyProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">90</span>, player:getMaxProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">90</span>, player:getEmptyProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getProductStorage(product3))
<span class="predefined">assert</span>.is_same(<span class="integer">90</span>, player:getMaxProductStorage(product3))
<span class="predefined">assert</span>.is_same(<span class="integer">90</span>, player:getEmptyProductStorage(product3))

player:modifyProductStorage(product2, <span class="integer">10</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">10</span>, player:getProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">90</span>, player:getMaxProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">80</span>, player:getEmptyProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">10</span>, player:getProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">90</span>, player:getMaxProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">80</span>, player:getEmptyProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getProductStorage(product3))
<span class="predefined">assert</span>.is_same(<span class="integer">80</span>, player:getMaxProductStorage(product3))
<span class="predefined">assert</span>.is_same(<span class="integer">80</span>, player:getEmptyProductStorage(product3))

player:modifyProductStorage(product2, <span class="integer">-5</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">10</span>, player:getProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">95</span>, player:getMaxProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">85</span>, player:getEmptyProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">5</span>, player:getProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">90</span>, player:getMaxProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">85</span>, player:getEmptyProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getProductStorage(product3))
<span class="predefined">assert</span>.is_same(<span class="integer">85</span>, player:getMaxProductStorage(product3))
<span class="predefined">assert</span>.is_same(<span class="integer">85</span>, player:getEmptyProductStorage(product3))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withstorage-getproductstorage-getemptyproductstorage-getmaxproductstorage-they-fail-when-called-without-argument" class="paragraph">
<p> <details><summary> 
Player:withStorage():getProductStorage(),:getEmptyProductStorage(),:getMaxProductStorage() they fail when called without argument
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withStorage(player)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() player:getProductStorage() <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() player:getMaxProductStorage() <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() player:getEmptyProductStorage() <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withstorage-getproductstorage-getemptyproductstorage-getmaxproductstorage-works-correctly-with-sized-products" class="paragraph">
<p> <details><summary> 
Player:withStorage():getProductStorage(),:getEmptyProductStorage(),:getMaxProductStorage() works correctly with sized products
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">product1</span> = productMock()
<span class="keyword">local</span> <span class="local-variable">product2</span> = productMock()
<span class="keyword">local</span> <span class="local-variable">product3</span> = productMock()
product1.getSize = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="integer">1</span> <span class="keyword">end</span>
product2.getSize = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="integer">2</span> <span class="keyword">end</span>
product3.getSize = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="integer">4</span> <span class="keyword">end</span>

<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withStorage(player, <span class="map"><span class="delimiter">{</span><span class="key">maxStorage</span> = <span class="integer">100</span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getMaxProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getEmptyProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">50</span>, player:getMaxProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">50</span>, player:getEmptyProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getProductStorage(product3))
<span class="predefined">assert</span>.is_same(<span class="integer">25</span>, player:getMaxProductStorage(product3))
<span class="predefined">assert</span>.is_same(<span class="integer">25</span>, player:getEmptyProductStorage(product3))

player:modifyProductStorage(product1, <span class="integer">10</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">10</span>, player:getProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getMaxProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">90</span>, player:getEmptyProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">45</span>, player:getMaxProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">45</span>, player:getEmptyProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getProductStorage(product3))
<span class="predefined">assert</span>.is_same(<span class="integer">22</span>, player:getMaxProductStorage(product3))
<span class="predefined">assert</span>.is_same(<span class="integer">22</span>, player:getEmptyProductStorage(product3))

player:modifyProductStorage(product2, <span class="integer">10</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">10</span>, player:getProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">80</span>, player:getMaxProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">70</span>, player:getEmptyProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">10</span>, player:getProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">45</span>, player:getMaxProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">35</span>, player:getEmptyProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getProductStorage(product3))
<span class="predefined">assert</span>.is_same(<span class="integer">17</span>, player:getMaxProductStorage(product3))
<span class="predefined">assert</span>.is_same(<span class="integer">17</span>, player:getEmptyProductStorage(product3))

player:modifyProductStorage(product2, <span class="integer">-5</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">10</span>, player:getProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">90</span>, player:getMaxProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">80</span>, player:getEmptyProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">5</span>, player:getProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">45</span>, player:getMaxProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">40</span>, player:getEmptyProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getProductStorage(product3))
<span class="predefined">assert</span>.is_same(<span class="integer">20</span>, player:getMaxProductStorage(product3))
<span class="predefined">assert</span>.is_same(<span class="integer">20</span>, player:getEmptyProductStorage(product3))

player:modifyProductStorage(product3, <span class="integer">5</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">10</span>, player:getProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">70</span>, player:getMaxProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">60</span>, player:getEmptyProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">5</span>, player:getProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">35</span>, player:getMaxProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">30</span>, player:getEmptyProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">5</span>, player:getProductStorage(product3))
<span class="predefined">assert</span>.is_same(<span class="integer">20</span>, player:getMaxProductStorage(product3))
<span class="predefined">assert</span>.is_same(<span class="integer">15</span>, player:getEmptyProductStorage(product3))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withstorage-getproductstorage-getemptyproductstorage-getmaxproductstorage-works-with-rockets" class="paragraph">
<p> <details><summary> 
Player:withStorage():getProductStorage(),:getEmptyProductStorage(),:getMaxProductStorage() works with rockets
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">hvli</span> = Product:new(<span class="string"><span class="delimiter">&quot;</span><span class="content">HVLI</span><span class="delimiter">&quot;</span></span>, <span class="map"><span class="delimiter">{</span><span class="key">id</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">hvli</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withStorage(player)
player:setWeaponStorageMax(<span class="string"><span class="delimiter">&quot;</span><span class="content">hvli</span><span class="delimiter">&quot;</span></span>, <span class="integer">8</span>)
player:setWeaponStorage(<span class="string"><span class="delimiter">&quot;</span><span class="content">hvli</span><span class="delimiter">&quot;</span></span>, <span class="integer">6</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">6</span>, player:getProductStorage(hvli))
<span class="predefined">assert</span>.is_same(<span class="integer">8</span>, player:getMaxProductStorage(hvli))
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, player:getEmptyProductStorage(hvli))

<span class="keyword">for</span> _, weapon <span class="keyword">in</span> <span class="predefined">pairs</span>(<span class="map"><span class="delimiter">{</span><span class="string"><span class="delimiter">&quot;</span><span class="content">hvli</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">homing</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">mine</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">nuke</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">emp</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>) <span class="keyword">do</span>
    <span class="keyword">local</span> <span class="local-variable">rocket</span> = Product:new(weapon, <span class="map"><span class="delimiter">{</span><span class="key">id</span> = weapon<span class="delimiter">}</span></span>)
    player:setWeaponStorageMax(weapon, <span class="integer">0</span>)
    player:setWeaponStorage(weapon, <span class="integer">0</span>)

    <span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getProductStorage(rocket))
    <span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getMaxProductStorage(rocket))
    <span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getEmptyProductStorage(rocket))
<span class="keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withstorage-getproductstorage-getemptyproductstorage-getmaxproductstorage-works-with-scan-probes" class="paragraph">
<p> <details><summary> 
Player:withStorage():getProductStorage(),:getEmptyProductStorage(),:getMaxProductStorage() works with scan probes
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">probe</span> = Product:new(<span class="string"><span class="delimiter">&quot;</span><span class="content">Scan Probe</span><span class="delimiter">&quot;</span></span>, <span class="map"><span class="delimiter">{</span><span class="key">id</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">scanProbe</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withStorage(player)
player:setMaxScanProbeCount(<span class="integer">8</span>)
player:setScanProbeCount(<span class="integer">6</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">6</span>, player:getProductStorage(probe))
<span class="predefined">assert</span>.is_same(<span class="integer">8</span>, player:getMaxProductStorage(probe))
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, player:getEmptyProductStorage(probe))

player:setMaxScanProbeCount(<span class="integer">0</span>)
player:setScanProbeCount(<span class="integer">0</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getProductStorage(probe))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getMaxProductStorage(probe))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getEmptyProductStorage(probe))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="player-withstorage-getstoragespace">Player:withStorage():getStorageSpace(),</h3>
<div id="player-withstorage-getstoragespace-getemptystoragespace-getmaxstoragespace-returns-the-correct-value" class="paragraph">
<p> <details><summary> 
Player:withStorage():getStorageSpace(), getEmptyStorageSpace(), getMaxStorageSpace() returns the correct value
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withStorage(player, <span class="map"><span class="delimiter">{</span><span class="key">maxStorage</span> = <span class="integer">100</span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getMaxStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getEmptyStorageSpace())

player:modifyProductStorage(product1, <span class="integer">10</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">10</span>, player:getStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getMaxStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">90</span>, player:getEmptyStorageSpace())

player:modifyProductStorage(product2, <span class="integer">10</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">20</span>, player:getStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getMaxStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">80</span>, player:getEmptyStorageSpace())

player:modifyProductStorage(product2, <span class="integer">-5</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">15</span>, player:getStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getMaxStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">85</span>, player:getEmptyStorageSpace())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withstorage-getstoragespace-getemptystoragespace-getmaxstoragespace-returns-the-correct-values-for-sized-products" class="paragraph">
<p> <details><summary> 
Player:withStorage():getStorageSpace(), getEmptyStorageSpace(), getMaxStorageSpace() returns the correct values for sized products
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">product1</span> = productMock()
<span class="keyword">local</span> <span class="local-variable">product2</span> = productMock()
<span class="keyword">local</span> <span class="local-variable">product3</span> = productMock()
product1.getSize = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="integer">1</span> <span class="keyword">end</span>
product2.getSize = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="integer">2</span> <span class="keyword">end</span>
product3.getSize = <span class="keyword">function</span>() <span class="keyword">return</span> <span class="integer">4</span> <span class="keyword">end</span>

<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withStorage(player, <span class="map"><span class="delimiter">{</span><span class="key">maxStorage</span> = <span class="integer">100</span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getMaxStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getEmptyStorageSpace())

player:modifyProductStorage(product1, <span class="integer">10</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">10</span>, player:getStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getMaxStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">90</span>, player:getEmptyStorageSpace())

player:modifyProductStorage(product2, <span class="integer">10</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">30</span>, player:getStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getMaxStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">70</span>, player:getEmptyStorageSpace())

player:modifyProductStorage(product2, <span class="integer">-5</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">20</span>, player:getStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getMaxStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">80</span>, player:getEmptyStorageSpace())

player:modifyProductStorage(product3, <span class="integer">5</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">40</span>, player:getStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getMaxStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">60</span>, player:getEmptyStorageSpace())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="player-withstorage-getstoredproducts">Player:withStorage():getStoredProducts()</h3>
<div id="player-withstorage-getstoredproducts-does-not-return-rockets-and-probes-because-we-might-not-know-the-correct-object-to-return" class="paragraph">
<p> <details><summary> 
Player:withStorage():getStoredProducts() does not return rockets and probes, because we might not know the correct object to return
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withStorage(player)

player:setWeaponStorageMax(<span class="string"><span class="delimiter">&quot;</span><span class="content">hvli</span><span class="delimiter">&quot;</span></span>, <span class="integer">5</span>)
player:setWeaponStorage(<span class="string"><span class="delimiter">&quot;</span><span class="content">hvli</span><span class="delimiter">&quot;</span></span>, <span class="integer">5</span>)
player:setWeaponStorageMax(<span class="string"><span class="delimiter">&quot;</span><span class="content">homing</span><span class="delimiter">&quot;</span></span>, <span class="integer">4</span>)
player:setWeaponStorage(<span class="string"><span class="delimiter">&quot;</span><span class="content">homing</span><span class="delimiter">&quot;</span></span>, <span class="integer">4</span>)
player:setWeaponStorageMax(<span class="string"><span class="delimiter">&quot;</span><span class="content">mine</span><span class="delimiter">&quot;</span></span>, <span class="integer">3</span>)
player:setWeaponStorage(<span class="string"><span class="delimiter">&quot;</span><span class="content">mine</span><span class="delimiter">&quot;</span></span>, <span class="integer">3</span>)
player:setWeaponStorageMax(<span class="string"><span class="delimiter">&quot;</span><span class="content">emp</span><span class="delimiter">&quot;</span></span>, <span class="integer">2</span>)
player:setWeaponStorage(<span class="string"><span class="delimiter">&quot;</span><span class="content">emp</span><span class="delimiter">&quot;</span></span>, <span class="integer">2</span>)
player:setWeaponStorageMax(<span class="string"><span class="delimiter">&quot;</span><span class="content">nuke</span><span class="delimiter">&quot;</span></span>, <span class="integer">1</span>)
player:setWeaponStorage(<span class="string"><span class="delimiter">&quot;</span><span class="content">nuke</span><span class="delimiter">&quot;</span></span>, <span class="integer">1</span>)
player:setMaxScanProbeCount(<span class="integer">4</span>)
player:setScanProbeCount(<span class="integer">4</span>)

<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>, player:getStoredProducts())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withstorage-getstoredproducts-returns-all-the-products-that-are-currently-stored" class="paragraph">
<p> <details><summary> 
Player:withStorage():getStoredProducts() returns all the products that are currently stored
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withStorage(player)

<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>, player:getStoredProducts())

player:modifyProductStorage(product1, <span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, Util.size(player:getStoredProducts()))
<span class="predefined">assert</span>.contains_value(product1, player:getStoredProducts())

player:modifyProductStorage(product1, <span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, Util.size(player:getStoredProducts()))
<span class="predefined">assert</span>.contains_value(product1, player:getStoredProducts())

player:modifyProductStorage(product2, <span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, Util.size(player:getStoredProducts()))
<span class="predefined">assert</span>.contains_value(product2, player:getStoredProducts())

player:modifyProductStorage(product2, <span class="integer">-1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, Util.size(player:getStoredProducts()))
<span class="predefined">assert</span>.contains_value(product1, player:getStoredProducts())
<span class="predefined">assert</span>.not_contains_value(product2, player:getStoredProducts())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="player-withstorage-modifyproductstorage">Player:withStorage():modifyProductStorage()</h3>
<div id="player-withstorage-modifyproductstorage-allows-to-handle-rockets" class="paragraph">
<p> <details><summary> 
Player:withStorage():modifyProductStorage() allows to handle rockets
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withStorage(player)
<span class="keyword">for</span> _, weapon <span class="keyword">in</span> <span class="predefined">pairs</span>(<span class="map"><span class="delimiter">{</span><span class="string"><span class="delimiter">&quot;</span><span class="content">hvli</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">homing</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">mine</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">nuke</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">emp</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>) <span class="keyword">do</span>
    <span class="keyword">local</span> <span class="local-variable">rocket</span> = Product:new(weapon, <span class="map"><span class="delimiter">{</span><span class="key">id</span> = weapon<span class="delimiter">}</span></span>)
    player:setWeaponStorageMax(weapon, <span class="integer">4</span>)
    player:setWeaponStorage(weapon, <span class="integer">0</span>)

    player:modifyProductStorage(rocket, <span class="integer">2</span>)
    <span class="predefined">assert</span>.is_same(<span class="integer">2</span>, player:getWeaponStorage(weapon))
<span class="keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withstorage-modifyproductstorage-allows-to-handle-scan-probes" class="paragraph">
<p> <details><summary> 
Player:withStorage():modifyProductStorage() allows to handle scan probes
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">probe</span> = Product:new(<span class="string"><span class="delimiter">&quot;</span><span class="content">Scan Probe</span><span class="delimiter">&quot;</span></span>, <span class="map"><span class="delimiter">{</span><span class="key">id</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">scanProbe</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withStorage(player)

player:setMaxScanProbeCount(<span class="integer">4</span>)
player:setScanProbeCount(<span class="integer">0</span>)

player:modifyProductStorage(probe, <span class="integer">2</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, player:getScanProbeCount())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withstorage-modifyproductstorage-fails-if-no-amount-is-given" class="paragraph">
<p> <details><summary> 
Player:withStorage():modifyProductStorage() fails if no amount is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withStorage(player)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() player:modifyProductStorage(product1, <span class="predefined-constant">nil</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withstorage-modifyproductstorage-fails-if-no-product-is-given" class="paragraph">
<p> <details><summary> 
Player:withStorage():modifyProductStorage() fails if no product is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withStorage(player)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() player:modifyProductStorage(<span class="predefined-constant">nil</span>, <span class="integer">10</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withstorage-modifyproductstorage-it-allows-to-overload-the-storage-so-that-important-mission-items-are-not-lost" class="paragraph">
<p> <details><summary> 
Player:withStorage():modifyProductStorage() it allows to overload the storage so that important mission items are not lost
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withStorage(player, <span class="map"><span class="delimiter">{</span><span class="key">maxStorage</span> = <span class="integer">100</span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getMaxStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getEmptyStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getMaxProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getEmptyProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getMaxProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getEmptyProductStorage(product2))

player:modifyProductStorage(product1, <span class="integer">999</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">999</span>, player:getStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getMaxStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getEmptyStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">999</span>, player:getProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getMaxProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getEmptyProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getMaxProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getEmptyProductStorage(product2))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withstorage-modifyproductstorage-it-keeps-sure-the-storage-level-will-not-be-negative" class="paragraph">
<p> <details><summary> 
Player:withStorage():modifyProductStorage() it keeps sure the storage level will not be negative
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withStorage(player, <span class="map"><span class="delimiter">{</span><span class="key">maxStorage</span> = <span class="integer">100</span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getMaxStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getEmptyStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getMaxProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getEmptyProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getMaxProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getEmptyProductStorage(product2))

player:modifyProductStorage(product1, <span class="integer">-10</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getMaxStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getEmptyStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getMaxProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getEmptyProductStorage(product1))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getMaxProductStorage(product2))
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getEmptyProductStorage(product2))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="player-withstorage-setmaxstoragespace">Player:withStorage():setMaxStorageSpace()</h3>
<div id="player-withstorage-setmaxstoragespace-allows-to-set-the-maximum-storage-space" class="paragraph">
<p> <details><summary> 
Player:withStorage():setMaxStorageSpace() allows to set the maximum storage space
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withStorage(player, <span class="map"><span class="delimiter">{</span><span class="key">maxStorage</span> = <span class="integer">100</span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getMaxStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, player:getEmptyStorageSpace())

player:setMaxStorageSpace(<span class="integer">120</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, player:getStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">120</span>, player:getMaxStorageSpace())
<span class="predefined">assert</span>.is_same(<span class="integer">120</span>, player:getEmptyStorageSpace())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="player-withstoragedisplay">Player:withStorageDisplay()</h3>
<div id="player-withstoragedisplay-creates-a-valid-storage-display" class="paragraph">
<p> <details><summary> 
Player:withStorageDisplay() creates a valid storage display
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player)
Player:withStorage(player)
Player:withStorageDisplay(player, defaultConfig)

<span class="predefined">assert</span>.is_true(Player:hasStorageDisplay(player))

<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Storage</span><span class="delimiter">&quot;</span></span>))
player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Storage</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_true(player:hasCustomMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withstoragedisplay-fails-if-the-first-argument-is-a-player-without-storage" class="paragraph">
<p> <details><summary> 
Player:withStorageDisplay() fails if the first argument is a player without storage
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Player:withStorageDisplay(player, defaultConfig) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withstoragedisplay-fails-if-the-first-argument-is-already-a-storage-display-player" class="paragraph">
<p> <details><summary> 
Player:withStorageDisplay() fails if the first argument is already a storage display player
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player)
Player:withStorage(player)
Player:withStorageDisplay(player, defaultConfig)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Player:withStorageDisplay(player, defaultConfig) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withstoragedisplay-fails-if-the-first-argument-is-not-a-player" class="paragraph">
<p> <details><summary> 
Player:withStorageDisplay() fails if the first argument is not a player
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Player:withStorageDisplay(<span class="integer">42</span>, defaultConfig) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="player-withupgradedisplay">Player:withUpgradeDisplay()</h3>
<div id="player-withupgradedisplay-creates-a-valid-upgrade-display" class="paragraph">
<p> <details><summary> 
Player:withUpgradeDisplay() creates a valid upgrade display
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player)
Player:withUpgradeTracker(player)
Player:withUpgradeDisplay(player, defaultConfig)

<span class="predefined">assert</span>.is_true(Player:hasUpgradeDisplay(player))

<span class="predefined">assert</span>.is_true(player:hasButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Upgrades</span><span class="delimiter">&quot;</span></span>))
player:clickButton(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Upgrades</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_true(player:hasCustomMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withupgradedisplay-fails-if-the-first-argument-is-a-player-without-storage" class="paragraph">
<p> <details><summary> 
Player:withUpgradeDisplay() fails if the first argument is a player without storage
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Player:withUpgradeDisplay(PlayerSpaceship(), defaultConfig) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withupgradedisplay-fails-if-the-first-argument-is-already-an-upgrade-display-player" class="paragraph">
<p> <details><summary> 
Player:withUpgradeDisplay() fails if the first argument is already an upgrade display player
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withMenu(player)
Player:withUpgradeTracker(player)
Player:withUpgradeDisplay(player, defaultConfig)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Player:withUpgradeDisplay(player, defaultConfig) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withupgradedisplay-fails-if-the-first-argument-is-not-a-player" class="paragraph">
<p> <details><summary> 
Player:withUpgradeDisplay() fails if the first argument is not a player
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Player:withUpgradeDisplay(<span class="integer">42</span>, defaultConfig) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="player-withupgradetracker">Player:withUpgradeTracker()</h3>
<div id="player-withupgradetracker-creates-a-valid-upgrade-tracker" class="paragraph">
<p> <details><summary> 
Player:withUpgradeTracker() creates a valid upgrade tracker
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withUpgradeTracker(player)

<span class="predefined">assert</span>.is_true(Player:hasUpgradeTracker(player))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withupgradetracker-fails-if-the-first-argument-is-already-an-upgrade-tracker-player" class="paragraph">
<p> <details><summary> 
Player:withUpgradeTracker() fails if the first argument is already an upgrade tracker player
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withUpgradeTracker(player)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Player:withUpgradeTracker(player) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withupgradetracker-fails-if-the-first-argument-is-not-a-player" class="paragraph">
<p> <details><summary> 
Player:withUpgradeTracker() fails if the first argument is not a player
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Player:withUpgradeTracker(<span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="player-withupgradetracker-addupgrade">Player:withUpgradeTracker():addUpgrade()</h3>
<div id="player-withupgradetracker-addupgrade-adds-a-upgrade" class="paragraph">
<p> <details><summary> 
Player:withUpgradeTracker():addUpgrade() adds a upgrade
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withUpgradeTracker(player)

<span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock()

player:addUpgrade(upgrade)

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, Util.size(player:getUpgrades()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withupgradetracker-addupgrade-fails-if-the-first-parameter-is-not-a-upgrade" class="paragraph">
<p> <details><summary> 
Player:withUpgradeTracker():addUpgrade() fails if the first parameter is not a upgrade
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withUpgradeTracker(player)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() player:addUpgrade(<span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="player-withupgradetracker-getupgrades">Player:withUpgradeTracker():getUpgrades()</h3>
<div id="player-withupgradetracker-getupgrades-manipulating-the-result-set-does-not-add-upgrades" class="paragraph">
<p> <details><summary> 
Player:withUpgradeTracker():getUpgrades() manipulating the result set does not add upgrades
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withUpgradeTracker(player)

player:addUpgrade(upgradeMock())

<span class="keyword">local</span> <span class="local-variable">upgrades</span> = player:getUpgrades()
table.insert(upgrades, upgradeMock())

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, Util.size(player:getUpgrades()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withupgradetracker-getupgrades-returns-all-upgrades" class="paragraph">
<p> <details><summary> 
Player:withUpgradeTracker():getUpgrades() returns all upgrades
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withUpgradeTracker(player)

player:addUpgrade(upgradeMock())
player:addUpgrade(upgradeMock())
player:addUpgrade(upgradeMock())

<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, Util.size(player:getUpgrades()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="player-withupgradetracker-hasupgrade">Player:withUpgradeTracker():hasUpgrade()</h3>
<div id="player-withupgradetracker-hasupgrade-fails-if-the-given-argument-is-a-number" class="paragraph">
<p> <details><summary> 
Player:withUpgradeTracker():hasUpgrade() fails if the given argument is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withUpgradeTracker(player)

player:addUpgrade(upgradeMock())

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() player:hasUpgrade(<span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withupgradetracker-hasupgrade-returns-false-if-the-upgrade-is-not-installed-by-name" class="paragraph">
<p> <details><summary> 
Player:withUpgradeTracker():hasUpgrade() returns false if the upgrade is not installed by name
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withUpgradeTracker(player)

player:addUpgrade(upgradeMock())
player:addUpgrade(upgradeMock())

<span class="predefined">assert</span>.is_false(player:hasUpgrade(<span class="string"><span class="delimiter">&quot;</span><span class="content">fake</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withupgradetracker-hasupgrade-returns-false-if-the-upgrade-is-not-installed-by-name" class="paragraph">
<p> <details><summary> 
Player:withUpgradeTracker():hasUpgrade() returns false if the upgrade is not installed by name
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withUpgradeTracker(player)

player:addUpgrade(upgradeMock())
player:addUpgrade(upgradeMock())

<span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock()
player:addUpgrade(upgrade)

<span class="predefined">assert</span>.is_true(player:hasUpgrade(upgrade:getId()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withupgradetracker-hasupgrade-returns-false-if-the-upgrade-is-not-installed-by-object" class="paragraph">
<p> <details><summary> 
Player:withUpgradeTracker():hasUpgrade() returns false if the upgrade is not installed by object
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withUpgradeTracker(player)

player:addUpgrade(upgradeMock())
player:addUpgrade(upgradeMock())

<span class="predefined">assert</span>.is_false(player:hasUpgrade(upgradeMock()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="player-withupgradetracker-hasupgrade-returns-true-if-the-upgrade-is-installed-by-object" class="paragraph">
<p> <details><summary> 
Player:withUpgradeTracker():hasUpgrade() returns true if the upgrade is installed by object
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
Player:withUpgradeTracker(player)

player:addUpgrade(upgradeMock())
player:addUpgrade(upgradeMock())

<span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock()
player:addUpgrade(upgrade)

<span class="predefined">assert</span>.is_true(player:hasUpgrade(upgrade))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="product">Product</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="product-new">Product:new()</h3>
<div id="product-new-allows-to-set-an-id" class="paragraph">
<p> <details><summary> 
Product:new() allows to set an id
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">product</span> = Product:new(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fake</span><span class="delimiter">&quot;</span></span>, <span class="map"><span class="delimiter">{</span><span class="key">id</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">unobtainium</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">unobtainium</span><span class="delimiter">&quot;</span></span>, product:getId())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="product-new-allows-to-set-size" class="paragraph">
<p> <details><summary> 
Product:new() allows to set size
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">product</span> = Product:new(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fake</span><span class="delimiter">&quot;</span></span>, <span class="map"><span class="delimiter">{</span><span class="key">size</span> = <span class="integer">42</span><span class="delimiter">}</span></span>)
<span class="predefined">assert</span>.is_same(<span class="integer">42</span>, product:getSize())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="product-new-auto-generates-an-id" class="paragraph">
<p> <details><summary> 
Product:new() auto generates an id
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">product</span> = Product:new(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fake</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.is_string(product:getId())
<span class="predefined">assert</span>.not_same(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>, product:getId())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="product-new-fails-if-first-argument-is-a-number" class="paragraph">
<p> <details><summary> 
Product:new() fails if first argument is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Product:new(<span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="product-new-fails-if-second-argument-is-numeric" class="paragraph">
<p> <details><summary> 
Product:new() fails if second argument is numeric
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Product:new(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fake</span><span class="delimiter">&quot;</span></span>, <span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="product-new-fails-if-size-is-non-numeric" class="paragraph">
<p> <details><summary> 
Product:new() fails if size is non-numeric
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Product:new(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fake</span><span class="delimiter">&quot;</span></span>, <span class="map"><span class="delimiter">{</span><span class="key">size</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="product-new-returns-a-valid-product" class="paragraph">
<p> <details><summary> 
Product:new() returns a valid Product
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">product</span> = Product:new(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fake</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.is_true(Product:isProduct(product))

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fake</span><span class="delimiter">&quot;</span></span>, product:getName())
<span class="predefined">assert</span>.is_string(product:getId())
<span class="predefined">assert</span>.not_same(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>, product:getId())
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, product:getSize())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="product-new-toid">Product:new():toId()</h3>
<div id="product-new-toid-returns-a-string-if-product-is-given" class="paragraph">
<p> <details><summary> 
Product:new():toId() returns a string if product is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">product</span> = Product:new(<span class="string"><span class="delimiter">&quot;</span><span class="content">Product</span><span class="delimiter">&quot;</span></span>, <span class="map"><span class="delimiter">{</span><span class="key">id</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">theId</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">theId</span><span class="delimiter">&quot;</span></span>, Product:toId(product))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="product-new-toid-returns-string-if-a-string-was-given" class="paragraph">
<p> <details><summary> 
Product:new():toId() returns string if a string was given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>, Product:toId(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="other">Other</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="ship">Ship</h3>
<div id="ship-gm-interaction-gm-can-carry-out-orders-on-behalf-of-the-ship" class="paragraph">
<p> <details><summary> 
Ship GM interaction GM can carry out orders on behalf of the ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withOrderQueue(ship)
ship:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)

ship:addOrder(Order:flyTo(<span class="integer">1000</span>, <span class="integer">0</span>))
ship:addOrder(Order:flyTo(<span class="integer">0</span>, <span class="integer">0</span>))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">1000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)

<span class="comment">-- GM interferes</span>
ship:orderRoaming()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Roaming</span><span class="delimiter">&quot;</span></span>, ship:getOrder())

<span class="comment">-- ship passes by accident :)</span>
ship:setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">0</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-gm-interaction-recovers-after-gm-interaction" class="paragraph">
<p> <details><summary> 
Ship GM interaction recovers after GM interaction
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withOrderQueue(ship)
ship:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)

ship:addOrder(Order:flyTo(<span class="integer">1000</span>, <span class="integer">0</span>))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">1000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)

<span class="comment">-- GM interferes</span>
ship:orderRoaming()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Roaming</span><span class="delimiter">&quot;</span></span>, ship:getOrder())

<span class="comment">-- GM resets</span>
ship:orderIdle()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">1000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-delay-delays-the-execution-of-the-next-command" class="paragraph">
<p> <details><summary> 
Ship delay delays the execution of the next command
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withOrderQueue(ship)
ship:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)

<span class="keyword">local</span> <span class="local-variable">onCompletionCalled</span> = <span class="integer">0</span>
ship:addOrder(Order:flyTo(<span class="integer">1000</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">onCompletion</span> = <span class="keyword">function</span>() <span class="key">onCompletionCalled</span> = onCompletionCalled + <span class="integer">1</span> <span class="keyword">end</span>,
    <span class="key">delayAfter</span> = <span class="integer">10</span>,
<span class="delimiter">}</span></span>))
ship:addOrder(Order:flyTo(<span class="integer">0</span>, <span class="integer">1000</span>))

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">1000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onCompletionCalled)
ship:setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onCompletionCalled)
<span class="comment">-- but the command should not have changed yet</span>
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">1000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)
<span class="keyword">for</span> _=<span class="integer">1</span>,<span class="integer">9</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">1000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">0</span>, <span class="integer">1000</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-delay-will-be-respected-if-addcommand-is-called-during-delay" class="paragraph">
<p> <details><summary> 
Ship delay will be respected if addCommand is called during delay
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withOrderQueue(ship)
ship:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)

ship:addOrder(Order:flyTo(<span class="integer">0</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">delayAfter</span> = <span class="integer">10</span>,
<span class="delimiter">}</span></span>))

<span class="keyword">for</span> _=<span class="integer">1</span>,<span class="integer">5</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">0</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)

ship:addOrder(Order:flyTo(<span class="integer">1000</span>, <span class="integer">0</span>))
<span class="comment">-- it should not change yet</span>
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">0</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)

<span class="keyword">for</span> _=<span class="integer">1</span>,<span class="integer">4</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">0</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">1000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-loop-allows-to-loop-orders" class="paragraph">
<p> <details><summary> 
Ship loop allows to loop orders
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withOrderQueue(ship)
ship:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)

ship:addOrder(Order:flyTo(<span class="integer">1000</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">onCompletion</span> = <span class="keyword">function</span>(self, ship) ship:addOrder(self) <span class="keyword">end</span>,
<span class="delimiter">}</span></span>))
ship:addOrder(Order:flyTo(<span class="integer">0</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">onCompletion</span> = <span class="keyword">function</span>(self, ship) ship:addOrder(self) <span class="keyword">end</span>,
<span class="delimiter">}</span></span>))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">1000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)

ship:setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">0</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)

ship:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">1000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)

ship:setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">0</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ship">Ship</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="ship-order-tick">Ship:Order:tick()</h3>
<div id="ship-order-tick-executes-the-next-order-if-order-tick-returns-false" class="paragraph">
<p> <details><summary> 
Ship:Order:tick() executes the next order if Order:tick() returns false
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">order</span> = mockOrder()

<span class="keyword">local</span> <span class="local-variable">called</span> = <span class="integer">0</span>
order.getShipExecutor = <span class="keyword">function</span>()
    <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>
        <span class="key">go</span> = <span class="keyword">function</span>(_, ship) ship:orderRoaming() <span class="keyword">end</span>,
        <span class="key">tick</span> = <span class="keyword">function</span>()
            <span class="key">called</span> = called + <span class="integer">1</span>
            <span class="keyword">if</span> called &gt; <span class="integer">3</span> <span class="keyword">then</span>
                <span class="keyword">return</span> <span class="predefined-constant">false</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">boom</span><span class="delimiter">&quot;</span></span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>,
    <span class="delimiter">}</span></span>
<span class="keyword">end</span>

<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withOrderQueue(ship)

ship:addOrder(order)
ship:addOrder(Order:flyTo(<span class="integer">1000</span>, <span class="integer">0</span>))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Roaming</span><span class="delimiter">&quot;</span></span>, ship:getOrder())

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-order-tick-makes-the-ship-idle-if-order-tick-returns-false-and-there-is-no-next-order" class="paragraph">
<p> <details><summary> 
Ship:Order:tick() makes the ship idle if Order:tick() returns false and there is no next order
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">order</span> = mockOrder()

<span class="keyword">local</span> <span class="local-variable">called</span> = <span class="integer">0</span>
order.getShipExecutor = <span class="keyword">function</span>()
    <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>
        <span class="key">go</span> = <span class="keyword">function</span>(_, ship) ship:orderRoaming() <span class="keyword">end</span>,
        <span class="key">tick</span> = <span class="keyword">function</span>()
            <span class="key">called</span> = called + <span class="integer">1</span>
            <span class="keyword">if</span> called &gt; <span class="integer">3</span> <span class="keyword">then</span>
                <span class="keyword">return</span> <span class="predefined-constant">false</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">boom</span><span class="delimiter">&quot;</span></span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>,
    <span class="delimiter">}</span></span>
<span class="keyword">end</span>

<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withOrderQueue(ship)

ship:addOrder(order)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Roaming</span><span class="delimiter">&quot;</span></span>, ship:getOrder())

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Idle</span><span class="delimiter">&quot;</span></span>, ship:getOrder())

ship:addOrder(Order:flyTo(<span class="integer">1000</span>, <span class="integer">0</span>))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="ship-ship-withorderqueue">Ship:Ship:withOrderQueue()</h3>
<div id="ship-ship-withorderqueue-fails-if-parameter-is-not-a-ship" class="paragraph">
<p> <details><summary> 
Ship:Ship:withOrderQueue() fails if parameter is not a ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Ship:withOrderQueue()
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Ship:withOrderQueue(<span class="integer">42</span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Ship:withOrderQueue(SpaceStation())
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Ship:withOrderQueue(Fleet:new(<span class="map"><span class="delimiter">{</span>CpuShip(), CpuShip(), CpuShip()<span class="delimiter">}</span></span>))
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-ship-withorderqueue-should-create-a-ship-with-order-queue" class="paragraph">
<p> <details><summary> 
Ship:Ship:withOrderQueue() should create a ship with order queue
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withOrderQueue(ship)

<span class="predefined">assert</span>.is_true(Ship:hasOrderQueue(ship))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="ship-abortcurrentorder">Ship:abortCurrentOrder()</h3>
<div id="ship-abortcurrentorder-carries-out-next-order-if-there-is-one-in-the-cue" class="paragraph">
<p> <details><summary> 
Ship:abortCurrentOrder() carries out next order if there is one in the cue
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withOrderQueue(ship)
ship:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)

ship:addOrder(Order:flyTo(<span class="integer">1000</span>, <span class="integer">0</span>))
ship:addOrder(Order:flyTo(<span class="integer">2000</span>, <span class="integer">0</span>))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">1000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)

ship:abortCurrentOrder()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">2000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-abortcurrentorder-carries-out-next-order-without-delay-if-there-is-one-in-the-cue" class="paragraph">
<p> <details><summary> 
Ship:abortCurrentOrder() carries out next order without delay if there is one in the cue
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withOrderQueue(ship)
ship:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)

ship:addOrder(Order:flyTo(<span class="integer">1000</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span><span class="key">delayAfter</span> = <span class="integer">10</span><span class="delimiter">}</span></span>))
ship:addOrder(Order:flyTo(<span class="integer">2000</span>, <span class="integer">0</span>))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">1000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)

Cron.tick(<span class="integer">1</span>)

ship:abortCurrentOrder()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">2000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-abortcurrentorder-does-nothing-if-there-is-no-current-order" class="paragraph">
<p> <details><summary> 
Ship:abortCurrentOrder() does nothing if there is no current order
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withOrderQueue(ship)

ship:abortCurrentOrder()</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-abortcurrentorder-ship-idles-if-there-is-no-next-order" class="paragraph">
<p> <details><summary> 
Ship:abortCurrentOrder() ship idles if there is no next order
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withOrderQueue(ship)
ship:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
<span class="keyword">local</span> <span class="local-variable">onAbortCalled</span>, <span class="local-variable">abortArg1</span>, <span class="local-variable">abortArg2</span>, <span class="local-variable">abortArg3</span> = <span class="integer">0</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>

<span class="keyword">local</span> <span class="local-variable">order</span> = Order:flyTo(<span class="integer">1000</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">onAbort</span> = <span class="keyword">function</span>(arg1, arg2, arg3)
        <span class="key">onAbortCalled</span> = onAbortCalled + <span class="integer">1</span>
        <span class="key">abortArg1</span> = arg1
        <span class="key">abortArg2</span> = arg2
        <span class="key">abortArg3</span> = arg3
    <span class="keyword">end</span>
<span class="delimiter">}</span></span>)
ship:addOrder(order)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onAbortCalled)

ship:abortCurrentOrder()
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onAbortCalled)
<span class="predefined">assert</span>.is_same(order, abortArg1)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>, abortArg2)
<span class="predefined">assert</span>.is_same(ship, abortArg3)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Idle</span><span class="delimiter">&quot;</span></span>, ship:getOrder())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="ship-addorder">Ship:addOrder()</h3>
<div id="ship-addorder-carries-out-an-order-until-the-next-one-is-given" class="paragraph">
<p> <details><summary> 
Ship:addOrder() carries out an order until the next one is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withOrderQueue(ship)
ship:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)

ship:addOrder(Order:flyTo(<span class="integer">0</span>, <span class="integer">0</span>))

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">0</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)

ship:setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">0</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)

ship:addOrder(Order:flyTo(<span class="integer">0</span>, <span class="integer">1000</span>))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">0</span>, <span class="integer">1000</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-addorder-fails-if-parameter-is-not-an-order" class="paragraph">
<p> <details><summary> 
Ship:addOrder() fails if parameter is not an order
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withOrderQueue(ship)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    ship:addOrder()
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    ship:addOrder(<span class="integer">42</span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    ship:addOrder(CpuShip())
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-addorder-immediately-carries-out-an-order-if-there-are-no-other-order-queued" class="paragraph">
<p> <details><summary> 
Ship:addOrder() immediately carries out an order if there are no other order queued
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withOrderQueue(ship)
ship:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)

ship:addOrder(Order:flyTo(<span class="integer">1000</span>, <span class="integer">0</span>))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">1000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-addorder-queues-orders-and-carries-them-out-consecutively" class="paragraph">
<p> <details><summary> 
Ship:addOrder() queues orders and carries them out consecutively
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withOrderQueue(ship)
ship:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)

ship:addOrder(Order:flyTo(<span class="integer">1000</span>, <span class="integer">0</span>))
ship:addOrder(Order:flyTo(<span class="integer">0</span>, <span class="integer">1000</span>))
ship:addOrder(Order:flyTo(<span class="integer">-1000</span>, <span class="integer">0</span>))

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">1000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)

ship:setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">0</span>, <span class="integer">1000</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)

ship:setPosition(<span class="integer">0</span>, <span class="integer">1000</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">-1000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-addorder-waits-until-the-first-order-is-issued" class="paragraph">
<p> <details><summary> 
Ship:addOrder() waits until the first order is issued
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withOrderQueue(ship)
ship:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Idle</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Idle</span><span class="delimiter">&quot;</span></span>, ship:getOrder())

ship:addOrder(Order:flyTo(<span class="integer">1000</span>, <span class="integer">0</span>))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">1000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="ship-behaveasminer">Ship:behaveAsMiner()</h3>
<div id="ship-behaveasminer-gm-can-change-the-mined-asteroid" class="paragraph">
<p> <details><summary> 
Ship:behaveAsMiner() GM can change the mined asteroid
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">withUniverse(<span class="keyword">function</span>()

    <span class="keyword">local</span> <span class="local-variable">station</span> = mockValidStation()
    <span class="keyword">local</span> <span class="local-variable">miner</span> = mockValidMiner()
    <span class="keyword">local</span> <span class="local-variable">asteroid1</span> = Asteroid()
    <span class="keyword">local</span> <span class="local-variable">asteroid2</span> = Asteroid()

    station:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
    miner:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
    miner:setDockedAt(station)
    asteroid1:setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)
    asteroid2:setPosition(<span class="integer">99999</span>, <span class="integer">0</span>)

    <span class="keyword">local</span> <span class="local-variable">whenMinedCalled</span> = <span class="integer">0</span>
    Ship:behaveAsMiner(miner, station, <span class="keyword">function</span>()
        whenMinedCalled = whenMinedCalled + <span class="integer">1</span>
        <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>
            [product] = <span class="integer">42</span>,
        <span class="delimiter">}</span></span>
    <span class="keyword">end</span>)

    <span class="comment">-- find a close asteroid</span>
    Cron.tick(<span class="integer">1</span>)
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Attack</span><span class="delimiter">&quot;</span></span>, miner:getOrder())
    <span class="predefined">assert</span>.is_same(asteroid1, miner:getOrderTarget())
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">asteroid</span><span class="delimiter">&quot;</span></span>, miner:getMinerState())

    <span class="comment">-- now it is close and should start mining</span>
    miner:setPosition(<span class="integer">800</span>, <span class="integer">0</span>)
    Cron.tick(<span class="integer">1</span>)
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Attack</span><span class="delimiter">&quot;</span></span>, miner:getOrder())
    <span class="predefined">assert</span>.is_same(asteroid1, miner:getOrderTarget())
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">mining</span><span class="delimiter">&quot;</span></span>, miner:getMinerState())

    <span class="comment">-- it should spend some time mining, but not finish</span>
    <span class="keyword">for</span> i=<span class="integer">1</span>,<span class="integer">10</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>
    <span class="predefined">assert</span>.is_same(<span class="integer">0</span>, whenMinedCalled)
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">mining</span><span class="delimiter">&quot;</span></span>, miner:getMinerState())

    <span class="comment">-- now the GM interjects</span>
    miner:orderFlyTowardsBlind(asteroid2:getPosition()) <span class="comment">-- GM interface does not allow to issue Attack orders on asteroids</span>
    Cron.tick(<span class="integer">1</span>)
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Attack</span><span class="delimiter">&quot;</span></span>, miner:getOrder())
    <span class="predefined">assert</span>.is_same(asteroid2, miner:getOrderTarget())
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">asteroid</span><span class="delimiter">&quot;</span></span>, miner:getMinerState())

    <span class="comment">-- now it is close and should start mining</span>
    miner:setPosition(asteroid2:getPosition())
    Cron.tick(<span class="integer">1</span>)
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Attack</span><span class="delimiter">&quot;</span></span>, miner:getOrder())
    <span class="predefined">assert</span>.is_same(asteroid2, miner:getOrderTarget())
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">mining</span><span class="delimiter">&quot;</span></span>, miner:getMinerState())

    <span class="comment">-- it should spend the whole time mining</span>
    <span class="keyword">for</span> i=<span class="integer">1</span>,<span class="integer">14</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>
    <span class="predefined">assert</span>.is_same(<span class="integer">0</span>, whenMinedCalled)
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">mining</span><span class="delimiter">&quot;</span></span>, miner:getMinerState())

    <span class="comment">-- now the mining should have finished</span>
    Cron.tick(<span class="integer">1</span>)
    <span class="predefined">assert</span>.is_same(<span class="integer">1</span>, whenMinedCalled)
    <span class="predefined">assert</span>.is_same(<span class="integer">42</span>, miner:getProductStorage(product))
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Dock</span><span class="delimiter">&quot;</span></span>, miner:getOrder())
    <span class="predefined">assert</span>.is_same(station, miner:getOrderTarget())
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">home</span><span class="delimiter">&quot;</span></span>, miner:getMinerState())

<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-behaveasminer-gm-can-force-a-miner-to-go-home" class="paragraph">
<p> <details><summary> 
Ship:behaveAsMiner() GM can force a miner to go home
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">withUniverse(<span class="keyword">function</span>()
    <span class="keyword">local</span> <span class="local-variable">station</span> = mockValidStation()
    <span class="keyword">local</span> <span class="local-variable">miner</span> = mockValidMiner()
    <span class="keyword">local</span> <span class="local-variable">asteroid</span> = Asteroid()

    station:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
    miner:setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)
    asteroid:setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)

    <span class="keyword">local</span> <span class="local-variable">headingHomeCalled</span> = <span class="integer">0</span>
    Ship:behaveAsMiner(miner, station, <span class="keyword">function</span>()
        <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span> [product] = <span class="integer">42</span>, <span class="delimiter">}</span></span>
    <span class="keyword">end</span>, <span class="map"><span class="delimiter">{</span>
        <span class="key">onHeadingHome</span> = <span class="keyword">function</span>()
            <span class="key">headingHomeCalled</span> = headingHomeCalled + <span class="integer">1</span>
        <span class="keyword">end</span>
    <span class="delimiter">}</span></span>)

    <span class="keyword">local</span> <span class="local-variable">asteroid2</span> = Asteroid()
    asteroid2:setPosition(<span class="integer">2000</span>, <span class="integer">0</span>)

    <span class="keyword">for</span> i=<span class="integer">1</span>,<span class="integer">20</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Attack</span><span class="delimiter">&quot;</span></span>, miner:getOrder())
    <span class="predefined">assert</span>.is_same(asteroid2, miner:getOrderTarget())

    miner:orderDock(station)
    Cron.tick(<span class="integer">1</span>)
    <span class="predefined">assert</span>.is_same(<span class="integer">1</span>, headingHomeCalled)

    <span class="comment">-- ...GM rethinks...</span>
    miner:orderIdle()
    Cron.tick(<span class="integer">1</span>)
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">asteroid</span><span class="delimiter">&quot;</span></span>, miner:getMinerState())

    <span class="comment">-- ...but then orders miner home again...</span>
    miner:orderDock(station)
    Cron.tick(<span class="integer">1</span>)
    <span class="predefined">assert</span>.is_same(<span class="integer">2</span>, headingHomeCalled)

    miner:setPosition(station:getPosition())
    miner:setDockedAt(station)
    <span class="keyword">for</span> i=<span class="integer">1</span>,<span class="integer">20</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>

    <span class="predefined">assert</span>.is_same(<span class="integer">0</span>, miner:getProductStorage(product))
    <span class="predefined">assert</span>.is_same(<span class="integer">42</span>, station:getProductStorage(product))
    <span class="comment">-- ...miner goes on as usual after unloading</span>
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Attack</span><span class="delimiter">&quot;</span></span>, miner:getOrder())
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-behaveasminer-gm-can-issue-custom-orders-and-reset-them-using-the-idle-order" class="paragraph">
<p> <details><summary> 
Ship:behaveAsMiner() GM can issue custom orders and reset them using the Idle order
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">withUniverse(<span class="keyword">function</span>()
    <span class="keyword">local</span> <span class="local-variable">station</span> = mockValidStation()
    <span class="keyword">local</span> <span class="local-variable">otherStation</span> = SpaceStation()
    <span class="keyword">local</span> <span class="local-variable">miner</span> = mockValidMiner()
    <span class="keyword">local</span> <span class="local-variable">asteroid</span> = Asteroid()

    station:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
    miner:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
    miner:setDockedAt(station)
    asteroid:setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)

    <span class="keyword">local</span> <span class="local-variable">whenMinedCalled</span> = <span class="integer">0</span>
    Ship:behaveAsMiner(miner, station, <span class="keyword">function</span>()
        whenMinedCalled = whenMinedCalled + <span class="integer">1</span>
        <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>
            [product] = <span class="integer">42</span>,
        <span class="delimiter">}</span></span>
    <span class="keyword">end</span>)


    <span class="comment">-- find a close asteroid</span>
    Cron.tick(<span class="integer">1</span>)
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Attack</span><span class="delimiter">&quot;</span></span>, miner:getOrder())
    <span class="predefined">assert</span>.is_same(asteroid, miner:getOrderTarget())
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">asteroid</span><span class="delimiter">&quot;</span></span>, miner:getMinerState())

    <span class="comment">-- GM interjects</span>
    miner:orderRoaming()
    <span class="keyword">for</span> i=<span class="integer">1</span>,<span class="integer">15</span> <span class="keyword">do</span>
        Cron.tick(<span class="integer">1</span>)
        <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">unknown</span><span class="delimiter">&quot;</span></span>, miner:getMinerState())
    <span class="keyword">end</span>

    <span class="comment">-- GM resets the order</span>
    miner:orderIdle()
    <span class="keyword">for</span> i=<span class="integer">1</span>,<span class="integer">15</span> <span class="keyword">do</span>
        Cron.tick(<span class="integer">1</span>)
        <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Attack</span><span class="delimiter">&quot;</span></span>, miner:getOrder())
        <span class="predefined">assert</span>.is_same(asteroid, miner:getOrderTarget())
        <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">asteroid</span><span class="delimiter">&quot;</span></span>, miner:getMinerState())
    <span class="keyword">end</span>

    <span class="comment">-- GM interjects</span>
    miner:orderDock(otherStation)
    <span class="keyword">for</span> i=<span class="integer">1</span>,<span class="integer">15</span> <span class="keyword">do</span>
        Cron.tick(<span class="integer">1</span>)
        <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">unknown</span><span class="delimiter">&quot;</span></span>, miner:getMinerState())
    <span class="keyword">end</span>

    <span class="comment">-- GM resets the order</span>
    miner:orderIdle()
    <span class="keyword">for</span> i=<span class="integer">1</span>,<span class="integer">15</span> <span class="keyword">do</span>
        Cron.tick(<span class="integer">1</span>)
        <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Attack</span><span class="delimiter">&quot;</span></span>, miner:getOrder())
        <span class="predefined">assert</span>.is_same(asteroid, miner:getOrderTarget())
        <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">asteroid</span><span class="delimiter">&quot;</span></span>, miner:getMinerState())
    <span class="keyword">end</span>
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-behaveasminer-does-basically-work" class="paragraph">
<p> <details><summary> 
Ship:behaveAsMiner() does basically work:)
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">withUniverse(<span class="keyword">function</span>()
    <span class="keyword">local</span> <span class="local-variable">station</span> = mockValidStation()
    <span class="keyword">local</span> <span class="local-variable">miner</span> = mockValidMiner()
    <span class="keyword">local</span> <span class="local-variable">asteroid</span> = Asteroid()

    station:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
    miner:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
    asteroid:setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)

    <span class="keyword">local</span> <span class="local-variable">whenMinedCalled</span> = <span class="integer">0</span>
    <span class="keyword">local</span> <span class="local-variable">asteroidMinedCalled</span> = <span class="integer">0</span>
    <span class="keyword">local</span> <span class="local-variable">asteroidMinedArg1</span>, <span class="local-variable">asteroidMinedArg2</span>, <span class="local-variable">asteroidMinedArg3</span>
    <span class="keyword">local</span> <span class="local-variable">headingAsteroidCalled</span> = <span class="integer">0</span>
    <span class="keyword">local</span> <span class="local-variable">headingAsteroidArg1</span>, <span class="local-variable">headingAsteroidArg2</span>
    <span class="keyword">local</span> <span class="local-variable">unloadedCalled</span> = <span class="integer">0</span>
    <span class="keyword">local</span> <span class="local-variable">unloadedArg1</span>, <span class="local-variable">unloadedArg2</span>, <span class="local-variable">unloadedArg3</span>
    <span class="keyword">local</span> <span class="local-variable">headingHomeCalled</span> = <span class="integer">0</span>
    <span class="keyword">local</span> <span class="local-variable">headingHomeArg1</span>, <span class="local-variable">headingHomeArg2</span>, <span class="local-variable">headingHomeArg3</span>
    Ship:behaveAsMiner(miner, station, <span class="keyword">function</span>()
        whenMinedCalled = whenMinedCalled + <span class="integer">1</span>
        <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>
            [product] = <span class="integer">42</span>,
        <span class="delimiter">}</span></span>
    <span class="keyword">end</span>, <span class="map"><span class="delimiter">{</span>
        <span class="key">onHeadingAsteroid</span> = <span class="keyword">function</span>(arg1, arg2)
            <span class="key">headingAsteroidCalled</span> = headingAsteroidCalled + <span class="integer">1</span>
            headingAsteroidArg1, <span class="key">headingAsteroidArg2</span> = arg1, arg2
        <span class="keyword">end</span>,
        <span class="key">onAsteroidMined</span> = <span class="keyword">function</span>(arg1, arg2, arg3)
            <span class="key">asteroidMinedCalled</span> = asteroidMinedCalled + <span class="integer">1</span>
            asteroidMinedArg1, asteroidMinedArg2, <span class="key">asteroidMinedArg3</span> = arg1, arg2, arg3
        <span class="keyword">end</span>,
        <span class="key">onHeadingHome</span> = <span class="keyword">function</span>(arg1, arg2, arg3)
            <span class="key">headingHomeCalled</span> = headingHomeCalled + <span class="integer">1</span>
            headingHomeArg1, headingHomeArg2, <span class="key">headingHomeArg3</span> = arg1, arg2, arg3
        <span class="keyword">end</span>,
        <span class="key">onUnloaded</span> = <span class="keyword">function</span>(arg1, arg2, arg3)
            <span class="key">unloadedCalled</span> = unloadedCalled + <span class="integer">1</span>
            unloadedArg1, unloadedArg2, <span class="key">unloadedArg3</span> = arg1, arg2, arg3
        <span class="keyword">end</span>,
    <span class="delimiter">}</span></span>)

    <span class="comment">-- find a close asteroid</span>
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Attack</span><span class="delimiter">&quot;</span></span>, miner:getOrder())
    <span class="predefined">assert</span>.is_same(asteroid, miner:getOrderTarget())
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">asteroid</span><span class="delimiter">&quot;</span></span>, miner:getMinerState())
    <span class="predefined">assert</span>.is_same(<span class="integer">1</span>, headingAsteroidCalled)
    <span class="predefined">assert</span>.is_same(miner, headingAsteroidArg1)
    <span class="predefined">assert</span>.is_same(asteroid, headingAsteroidArg2)

    miner:setPosition(<span class="integer">100</span>, <span class="integer">0</span>)
    Cron.tick(<span class="integer">1</span>)
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Attack</span><span class="delimiter">&quot;</span></span>, miner:getOrder())
    <span class="predefined">assert</span>.is_same(asteroid, miner:getOrderTarget())

    miner:setPosition(<span class="integer">200</span>, <span class="integer">0</span>)
    Cron.tick(<span class="integer">1</span>)
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Attack</span><span class="delimiter">&quot;</span></span>, miner:getOrder())
    <span class="predefined">assert</span>.is_same(asteroid, miner:getOrderTarget())

    <span class="comment">-- now it is close and should start mining</span>
    miner:setPosition(<span class="integer">800</span>, <span class="integer">0</span>)
    Cron.tick(<span class="integer">1</span>)
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Attack</span><span class="delimiter">&quot;</span></span>, miner:getOrder())
    <span class="predefined">assert</span>.is_same(asteroid, miner:getOrderTarget())
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">mining</span><span class="delimiter">&quot;</span></span>, miner:getMinerState())

    <span class="comment">-- ...let it mine a little...</span>
    <span class="keyword">for</span> i=<span class="integer">1</span>,<span class="integer">14</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>
    <span class="predefined">assert</span>.is_same(<span class="integer">0</span>, whenMinedCalled)
    <span class="predefined">assert</span>.is_same(<span class="integer">0</span>, asteroidMinedCalled)
    <span class="predefined">assert</span>.is_same(<span class="integer">0</span>, headingHomeCalled)
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">mining</span><span class="delimiter">&quot;</span></span>, miner:getMinerState())

    <span class="comment">-- now the mining should have finished</span>
    Cron.tick(<span class="integer">1</span>)
    <span class="predefined">assert</span>.is_same(<span class="integer">1</span>, whenMinedCalled)
    <span class="predefined">assert</span>.is_same(<span class="integer">42</span>, miner:getProductStorage(product))
    <span class="predefined">assert</span>.is_same(<span class="integer">1</span>, asteroidMinedCalled)
    <span class="predefined">assert</span>.is_same(miner, asteroidMinedArg1)
    <span class="predefined">assert</span>.is_same(asteroid, asteroidMinedArg2)
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">table</span><span class="delimiter">&quot;</span></span>, <span class="predefined">type</span>(asteroidMinedArg3))
    <span class="predefined">assert</span>.is_same(<span class="integer">42</span>, asteroidMinedArg3[product])

    <span class="predefined">assert</span>.is_same(<span class="integer">1</span>, headingHomeCalled)
    <span class="predefined">assert</span>.is_same(miner, headingHomeArg1)
    <span class="predefined">assert</span>.is_same(station, headingHomeArg2)
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">table</span><span class="delimiter">&quot;</span></span>, <span class="predefined">type</span>(headingHomeArg3))
    <span class="predefined">assert</span>.is_same(<span class="integer">42</span>, headingHomeArg3[product])

    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Dock</span><span class="delimiter">&quot;</span></span>, miner:getOrder())
    <span class="predefined">assert</span>.is_same(station, miner:getOrderTarget())
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">home</span><span class="delimiter">&quot;</span></span>, miner:getMinerState())

    miner:setPosition(<span class="integer">200</span>, <span class="integer">0</span>)
    Cron.tick(<span class="integer">1</span>)
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Dock</span><span class="delimiter">&quot;</span></span>, miner:getOrder())
    <span class="predefined">assert</span>.is_same(station, miner:getOrderTarget())
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">home</span><span class="delimiter">&quot;</span></span>, miner:getMinerState())

    miner:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
    miner:setDockedAt(station)
    Cron.tick(<span class="integer">1</span>)
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Dock</span><span class="delimiter">&quot;</span></span>, miner:getOrder())
    <span class="predefined">assert</span>.is_same(station, miner:getOrderTarget())
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">unloading</span><span class="delimiter">&quot;</span></span>, miner:getMinerState())

    <span class="comment">-- ...let it unload a little...</span>
    <span class="keyword">for</span> i=<span class="integer">1</span>,<span class="integer">14</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Dock</span><span class="delimiter">&quot;</span></span>, miner:getOrder())
    <span class="predefined">assert</span>.is_same(station, miner:getOrderTarget())
    <span class="predefined">assert</span>.is_same(<span class="integer">42</span>, miner:getProductStorage(product))
    <span class="predefined">assert</span>.is_same(<span class="integer">0</span>, station:getProductStorage(product))
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">unloading</span><span class="delimiter">&quot;</span></span>, miner:getMinerState())
    <span class="predefined">assert</span>.is_same(<span class="integer">0</span>, unloadedCalled)

    <span class="comment">-- ...now delivery should be complete</span>
    Cron.tick(<span class="integer">1</span>)
    <span class="predefined">assert</span>.is_same(<span class="integer">0</span>, miner:getProductStorage(product))
    <span class="predefined">assert</span>.is_same(<span class="integer">42</span>, station:getProductStorage(product))
    <span class="predefined">assert</span>.is_same(<span class="integer">1</span>, unloadedCalled)
    <span class="predefined">assert</span>.is_same(miner, unloadedArg1)
    <span class="predefined">assert</span>.is_same(station, unloadedArg2)
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">table</span><span class="delimiter">&quot;</span></span>, <span class="predefined">type</span>(unloadedArg3))
    <span class="predefined">assert</span>.is_same(<span class="integer">42</span>, unloadedArg3[product])

    <span class="comment">-- cycle starts again</span>
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Attack</span><span class="delimiter">&quot;</span></span>, miner:getOrder())
    <span class="predefined">assert</span>.is_same(asteroid, miner:getOrderTarget())
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">asteroid</span><span class="delimiter">&quot;</span></span>, miner:getMinerState())
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-behaveasminer-does-not-mine-more-asteroids-when-a-maximum-time-has-run-out" class="paragraph">
<p> <details><summary> 
Ship:behaveAsMiner() does not mine more asteroids when a maximum time has run out
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">withUniverse(<span class="keyword">function</span>()
    <span class="keyword">local</span> <span class="local-variable">station</span> = mockValidStation()
    <span class="keyword">local</span> <span class="local-variable">miner</span> = mockValidMiner()
    <span class="keyword">local</span> <span class="local-variable">asteroid1</span> = Asteroid()

    station:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
    miner:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
    asteroid1:setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)

    <span class="keyword">local</span> <span class="local-variable">whenMinedCalled</span> = <span class="integer">0</span>
    Ship:behaveAsMiner(miner, station, <span class="keyword">function</span>()
        whenMinedCalled = whenMinedCalled + <span class="integer">1</span>
        <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>
            [product] = <span class="integer">42</span>,
        <span class="delimiter">}</span></span>
    <span class="keyword">end</span>)

    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Attack</span><span class="delimiter">&quot;</span></span>, miner:getOrder())
    <span class="predefined">assert</span>.is_same(asteroid1, miner:getOrderTarget())

    <span class="keyword">for</span> i=<span class="integer">1</span>,<span class="integer">999</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>

    <span class="keyword">local</span> <span class="local-variable">asteroid2</span> = Asteroid()
    asteroid2:setPosition(<span class="integer">2000</span>, <span class="integer">0</span>)

    <span class="comment">-- it cares out its order first</span>
    miner:setPosition(asteroid1:getPosition())
    Cron.tick(<span class="integer">1</span>)
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Attack</span><span class="delimiter">&quot;</span></span>, miner:getOrder())
    <span class="predefined">assert</span>.is_same(asteroid1, miner:getOrderTarget())
    <span class="keyword">for</span> i=<span class="integer">1</span>,<span class="integer">15</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Dock</span><span class="delimiter">&quot;</span></span>, miner:getOrder())
    <span class="predefined">assert</span>.is_same(station, miner:getOrderTarget())
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-behaveasminer-fails-if-homestation-is-not-a-station" class="paragraph">
<p> <details><summary> 
Ship:behaveAsMiner() fails if homeStation is not a Station
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">miner</span> = mockValidMiner()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Ship:behaveAsMiner(miner, <span class="predefined-constant">nil</span>, <span class="keyword">function</span>() <span class="keyword">end</span>)
<span class="keyword">end</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Expected homeStation to be a Station, but got &lt;nil&gt;</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Ship:behaveAsMiner(miner, <span class="integer">42</span>, <span class="keyword">function</span>() <span class="keyword">end</span>)
<span class="keyword">end</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Expected homeStation to be a Station, but got &lt;number&gt;42</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Ship:behaveAsMiner(miner, SpaceShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Test</span><span class="delimiter">&quot;</span></span>), <span class="keyword">function</span>() <span class="keyword">end</span>)
<span class="keyword">end</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Expected homeStation to be a Station, but got &lt;SpaceShip&gt;</span><span class="char">\&quot;</span><span class="content">Test</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-behaveasminer-fails-if-ship-does-not-have-storage" class="paragraph">
<p> <details><summary> 
Ship:behaveAsMiner() fails if ship does not have storage
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = mockValidStation()
<span class="keyword">local</span> <span class="local-variable">miner</span> = CpuShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Dummy</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Ship:behaveAsMiner(miner, station, <span class="keyword">function</span>() <span class="keyword">end</span>)
<span class="keyword">end</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Ship Dummy needs to have storage configured</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-behaveasminer-fails-if-ship-is-destroyed" class="paragraph">
<p> <details><summary> 
Ship:behaveAsMiner() fails if ship is destroyed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = mockValidStation()
<span class="keyword">local</span> <span class="local-variable">miner</span> = mockValidMiner()
miner:destroy()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Ship:behaveAsMiner(miner, station, <span class="keyword">function</span>() <span class="keyword">end</span>)
<span class="keyword">end</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Expected ship to be a valid CpuShip, but got a destroyed one</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-behaveasminer-fails-if-ship-is-not-a-ship" class="paragraph">
<p> <details><summary> 
Ship:behaveAsMiner() fails if ship is not a ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = mockValidStation()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Ship:behaveAsMiner(<span class="predefined-constant">nil</span>, station, <span class="keyword">function</span>() <span class="keyword">end</span>)
<span class="keyword">end</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Expected ship to be a CpuShip, but got &lt;nil&gt;</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Ship:behaveAsMiner(<span class="integer">42</span>, station, <span class="keyword">function</span>() <span class="keyword">end</span>)
<span class="keyword">end</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Expected ship to be a CpuShip, but got &lt;number&gt;42</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Ship:behaveAsMiner(SpaceStation():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Test</span><span class="delimiter">&quot;</span></span>), station, <span class="keyword">function</span>() <span class="keyword">end</span>)
<span class="keyword">end</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Expected ship to be a CpuShip, but got &lt;SpaceStation&gt;</span><span class="char">\&quot;</span><span class="content">Test</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Ship:behaveAsMiner(SpaceShip():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Test</span><span class="delimiter">&quot;</span></span>), station, <span class="keyword">function</span>() <span class="keyword">end</span>)
<span class="keyword">end</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Expected ship to be a CpuShip, but got &lt;SpaceShip&gt;</span><span class="char">\&quot;</span><span class="content">Test</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-behaveasminer-fails-if-station-does-not-have-storage" class="paragraph">
<p> <details><summary> 
Ship:behaveAsMiner() fails if station does not have storage
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Home</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">miner</span> = mockValidMiner()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Ship:behaveAsMiner(miner, station, <span class="keyword">function</span>() <span class="keyword">end</span>)
<span class="keyword">end</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Station Home needs to have storage configured</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-behaveasminer-idles-when-home-base-is-destroyed" class="paragraph">
<p> <details><summary> 
Ship:behaveAsMiner() idles when home base is destroyed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">withUniverse(<span class="keyword">function</span>() withLogCatcher(<span class="keyword">function</span>(logs)
    <span class="keyword">local</span> <span class="local-variable">station</span> = mockValidStation():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Home</span><span class="delimiter">&quot;</span></span>)
    <span class="keyword">local</span> <span class="local-variable">miner</span> = mockValidMiner():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Dummy</span><span class="delimiter">&quot;</span></span>)
    <span class="keyword">local</span> <span class="local-variable">asteroid</span> = Asteroid()

    station:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
    miner:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
    miner:setDockedAt(station)
    asteroid:setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)

    Ship:behaveAsMiner(miner, station, <span class="keyword">function</span>()
        <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>
            [product] = <span class="integer">42</span>,
        <span class="delimiter">}</span></span>
    <span class="keyword">end</span>)

    Cron.tick(<span class="integer">1</span>)
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">asteroid</span><span class="delimiter">&quot;</span></span>, miner:getMinerState())

    station:destroy()
    Cron.tick(<span class="integer">1</span>)
    <span class="predefined">assert</span>.is_same(<span class="integer">1</span>, logs:countWarnings())
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">unknown</span><span class="delimiter">&quot;</span></span>, miner:getMinerState())
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Dummy has lost its home base. :(</span><span class="delimiter">&quot;</span></span>, logs:popLastWarning())
    <span class="predefined">assert</span>.is_same(<span class="predefined-constant">nil</span>, logs:popLastWarning()) <span class="comment">-- no further errors</span>

    Cron.tick(<span class="integer">1</span>)
    <span class="predefined">assert</span>.is_same(<span class="predefined-constant">nil</span>, logs:popLastWarning()) <span class="comment">-- it does not spam</span>

<span class="keyword">end</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-behaveasminer-selects-a-new-asteroid-if-the-current-target-is-destroyed" class="paragraph">
<p> <details><summary> 
Ship:behaveAsMiner() selects a new asteroid if the current target is destroyed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">withUniverse(<span class="keyword">function</span>(logs)
    <span class="keyword">local</span> <span class="local-variable">station</span> = mockValidStation():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Home</span><span class="delimiter">&quot;</span></span>)
    <span class="keyword">local</span> <span class="local-variable">miner</span> = mockValidMiner():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Dummy</span><span class="delimiter">&quot;</span></span>)
    <span class="keyword">local</span> <span class="local-variable">asteroid1</span> = Asteroid():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">one</span><span class="delimiter">&quot;</span></span>)
    <span class="keyword">local</span> <span class="local-variable">asteroid2</span> = Asteroid():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">two</span><span class="delimiter">&quot;</span></span>)

    station:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
    miner:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
    miner:setDockedAt(station)
    asteroid1:setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)
    asteroid2:setPosition(<span class="integer">2000</span>, <span class="integer">0</span>)

    Ship:behaveAsMiner(miner, station, <span class="keyword">function</span>()
        <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>
            [product] = <span class="integer">42</span>,
        <span class="delimiter">}</span></span>
    <span class="keyword">end</span>)

    Cron.tick(<span class="integer">1</span>)
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">asteroid</span><span class="delimiter">&quot;</span></span>, miner:getMinerState())
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Attack</span><span class="delimiter">&quot;</span></span>, miner:getOrder())

    <span class="keyword">local</span> <span class="local-variable">target</span> = miner:getOrderTarget()

    target:destroy()
    Cron.tick(<span class="integer">1</span>)
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">asteroid</span><span class="delimiter">&quot;</span></span>, miner:getMinerState())
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Attack</span><span class="delimiter">&quot;</span></span>, miner:getOrder())
    <span class="predefined">assert</span>.not_is_same(target, miner:getOrderTarget())
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-behaveasminer-selects-a-new-asteroid-if-the-current-target-is-destroyed-while-mining" class="paragraph">
<p> <details><summary> 
Ship:behaveAsMiner() selects a new asteroid if the current target is destroyed while mining
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">withUniverse(<span class="keyword">function</span>(logs)
    <span class="keyword">local</span> <span class="local-variable">station</span> = mockValidStation():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Home</span><span class="delimiter">&quot;</span></span>)
    <span class="keyword">local</span> <span class="local-variable">miner</span> = mockValidMiner():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Dummy</span><span class="delimiter">&quot;</span></span>)
    <span class="keyword">local</span> <span class="local-variable">asteroid1</span> = Asteroid():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">one</span><span class="delimiter">&quot;</span></span>)
    <span class="keyword">local</span> <span class="local-variable">asteroid2</span> = Asteroid():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">two</span><span class="delimiter">&quot;</span></span>)

    station:setPosition(<span class="integer">100</span>, <span class="integer">0</span>)
    miner:setPosition(<span class="integer">0</span>, <span class="integer">100</span>)
    miner:setDockedAt(station)
    asteroid1:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
    asteroid2:setPosition(<span class="integer">0</span>, <span class="integer">500</span>)

    Ship:behaveAsMiner(miner, station, <span class="keyword">function</span>()
        <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>
            [product] = <span class="integer">42</span>,
        <span class="delimiter">}</span></span>
    <span class="keyword">end</span>)

    Cron.tick(<span class="integer">1</span>)
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">mining</span><span class="delimiter">&quot;</span></span>, miner:getMinerState())
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Attack</span><span class="delimiter">&quot;</span></span>, miner:getOrder())

    <span class="keyword">local</span> <span class="local-variable">target</span> = miner:getOrderTarget()

    target:destroy()
    Cron.tick(<span class="integer">1</span>)
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">asteroid</span><span class="delimiter">&quot;</span></span>, miner:getMinerState())
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Attack</span><span class="delimiter">&quot;</span></span>, miner:getOrder())
    <span class="predefined">assert</span>.not_is_same(target, miner:getOrderTarget())
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-behaveasminer-warns-when-there-are-no-mineable-asteroids-around-the-station" class="paragraph">
<p> <details><summary> 
Ship:behaveAsMiner() warns when there are no mineable asteroids around the station
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">withUniverse(<span class="keyword">function</span>() withLogCatcher(<span class="keyword">function</span>(logs)
    <span class="keyword">local</span> <span class="local-variable">station</span> = mockValidStation():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Home</span><span class="delimiter">&quot;</span></span>)
    <span class="keyword">local</span> <span class="local-variable">miner</span> = mockValidMiner():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Dummy</span><span class="delimiter">&quot;</span></span>)
    <span class="keyword">local</span> <span class="local-variable">asteroid</span> = Asteroid()

    station:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
    miner:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
    miner:setDockedAt(station)
    asteroid:setPosition(<span class="integer">99999</span>, <span class="integer">0</span>)

    <span class="keyword">local</span> <span class="local-variable">whenMinedCalled</span> = <span class="integer">0</span>
    Ship:behaveAsMiner(miner, station, <span class="keyword">function</span>()
        whenMinedCalled = whenMinedCalled + <span class="integer">1</span>
        <span class="keyword">return</span> <span class="map"><span class="delimiter">{</span>
            [product] = <span class="integer">42</span>,
        <span class="delimiter">}</span></span>
    <span class="keyword">end</span>)

    <span class="predefined">assert</span>.is_same(<span class="integer">1</span>, logs:countWarnings())
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">unknown</span><span class="delimiter">&quot;</span></span>, miner:getMinerState())
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Dummy did not find any mineable asteroids around Home</span><span class="delimiter">&quot;</span></span>, logs:popLastWarning())
    <span class="predefined">assert</span>.is_same(<span class="predefined-constant">nil</span>, logs:popLastWarning()) <span class="comment">-- no further errors</span>

    Cron.tick(<span class="integer">1</span>)
    <span class="predefined">assert</span>.is_same(<span class="predefined-constant">nil</span>, logs:popLastWarning()) <span class="comment">-- it does not spam</span>

    <span class="comment">-- but it starts as soon as an asteroid is close enough</span>
    asteroid:setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)
    Cron.tick(<span class="integer">1</span>)
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Attack</span><span class="delimiter">&quot;</span></span>, miner:getOrder())
    <span class="predefined">assert</span>.is_same(asteroid, miner:getOrderTarget())
    <span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">asteroid</span><span class="delimiter">&quot;</span></span>, miner:getMinerState())
<span class="keyword">end</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="ship-flushorders">Ship:flushOrders()</h3>
<div id="ship-flushorders-does-nothing-if-there-are-no-further-orders" class="paragraph">
<p> <details><summary> 
Ship:flushOrders() does nothing if there are no further orders
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withOrderQueue(ship)

ship:abortCurrentOrder()</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-flushorders-ship-does-not-carry-out-any-new-orders-after-the-one-is-completed" class="paragraph">
<p> <details><summary> 
Ship:flushOrders() ship does not carry out any new orders after the one is completed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withOrderQueue(ship)
ship:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)

ship:addOrder(Order:flyTo(<span class="integer">1000</span>, <span class="integer">0</span>))
ship:addOrder(Order:flyTo(<span class="integer">2000</span>, <span class="integer">0</span>))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">1000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)

Cron.tick(<span class="integer">1</span>)
ship:flushOrders()
ship:setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">1000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="ship-forceordernow">Ship:forceOrderNow()</h3>
<div id="ship-forceordernow-excutes-the-order-if-none-was-executed-before" class="paragraph">
<p> <details><summary> 
Ship:forceOrderNow() excutes the order if none was executed before
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withOrderQueue(ship)
ship:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)

Cron.tick(<span class="integer">1</span>)

ship:forceOrderNow(Order:flyTo(<span class="integer">1000</span>, <span class="integer">0</span>))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">1000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">1000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-forceordernow-executes-a-ship-order-immediately" class="paragraph">
<p> <details><summary> 
Ship:forceOrderNow() executes a ship order immediately
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withOrderQueue(ship)
ship:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
<span class="keyword">local</span> <span class="local-variable">onAbortCalled</span>, <span class="local-variable">abortArg1</span>, <span class="local-variable">abortArg2</span>, <span class="local-variable">abortArg3</span> = <span class="integer">0</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>, <span class="predefined-constant">nil</span>

<span class="keyword">local</span> <span class="local-variable">order</span> = Order:flyTo(<span class="integer">1000</span>, <span class="integer">0</span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">onAbort</span> = <span class="keyword">function</span>(arg1, arg2, arg3)
        <span class="key">onAbortCalled</span> = onAbortCalled + <span class="integer">1</span>
        <span class="key">abortArg1</span> = arg1
        <span class="key">abortArg2</span> = arg2
        <span class="key">abortArg3</span> = arg3
    <span class="keyword">end</span>
<span class="delimiter">}</span></span>)
ship:addOrder(order)
ship:addOrder(Order:flyTo(<span class="integer">2000</span>, <span class="integer">0</span>))
ship:addOrder(Order:flyTo(<span class="integer">3000</span>, <span class="integer">0</span>))
ship:addOrder(Order:flyTo(<span class="integer">4000</span>, <span class="integer">0</span>))

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, onAbortCalled)

ship:forceOrderNow(Order:flyTo(<span class="integer">0</span>, <span class="integer">1000</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, onAbortCalled)
<span class="predefined">assert</span>.is_same(order, abortArg1)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>, abortArg2)
<span class="predefined">assert</span>.is_same(ship, abortArg3)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">0</span>, <span class="integer">1000</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-forceordernow-fails-if-parameter-is-not-an-order" class="paragraph">
<p> <details><summary> 
Ship:forceOrderNow() fails if parameter is not an order
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withOrderQueue(ship)
ship:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
ship:addOrder(Order:flyTo(<span class="integer">1000</span>, <span class="integer">0</span>))
ship:addOrder(Order:flyTo(<span class="integer">2000</span>, <span class="integer">0</span>))
ship:addOrder(Order:flyTo(<span class="integer">3000</span>, <span class="integer">0</span>))
ship:addOrder(Order:flyTo(<span class="integer">4000</span>, <span class="integer">0</span>))

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    ship:forceOrderNow()
<span class="keyword">end</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">1000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)

ship:setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    ship:forceOrderNow(<span class="integer">42</span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">2000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)

ship:setPosition(<span class="integer">2000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    ship:forceOrderNow(CpuShip())
<span class="keyword">end</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">3000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)

ship:setPosition(<span class="integer">3000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fly towards</span><span class="delimiter">&quot;</span></span>, ship:getOrder())
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">4000</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>ship:getOrderTargetLocation()<span class="delimiter">}</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="ship-withcaptain-getcaptain">Ship:withCaptain(),:getCaptain()</h3>
<div id="ship-withcaptain-getcaptain-sets-the-captain" class="paragraph">
<p> <details><summary> 
Ship:withCaptain(),:getCaptain() sets the captain
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">person</span> = personMock()
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()

Ship:withCaptain(ship, person)
<span class="predefined">assert</span>.is_true(ship:hasCrewAtPosition(<span class="string"><span class="delimiter">&quot;</span><span class="content">captain</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(ship:hasCaptain())
<span class="predefined">assert</span>.is_same(person, ship:getCrewAtPosition(<span class="string"><span class="delimiter">&quot;</span><span class="content">captain</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_same(person, ship:getCaptain())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="ship-withcrew">Ship:withCrew()</h3>
<div id="ship-withcrew-can-be-called-multiple-times-to-add-different-persons" class="paragraph">
<p> <details><summary> 
Ship:withCrew() can be called multiple times to add different persons
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">person1</span> = personMock()
<span class="keyword">local</span> <span class="local-variable">person2</span> = personMock()
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()

Ship:withCrew(ship, <span class="map"><span class="delimiter">{</span><span class="key">captain</span> = person1<span class="delimiter">}</span></span>)
Ship:withCrew(ship, <span class="map"><span class="delimiter">{</span><span class="key">science</span> = person2<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(person1, ship:getCrewAtPosition(<span class="string"><span class="delimiter">&quot;</span><span class="content">captain</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_same(person2, ship:getCrewAtPosition(<span class="string"><span class="delimiter">&quot;</span><span class="content">science</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-withcrew-can-be-called-multiple-times-to-override-a-position" class="paragraph">
<p> <details><summary> 
Ship:withCrew() can be called multiple times to override a position
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">person1</span> = personMock()
<span class="keyword">local</span> <span class="local-variable">person2</span> = personMock()
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()

Ship:withCrew(ship, <span class="map"><span class="delimiter">{</span><span class="key">captain</span> = person1<span class="delimiter">}</span></span>)
Ship:withCrew(ship, <span class="map"><span class="delimiter">{</span><span class="key">captain</span> = person2<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(person2, ship:getCrewAtPosition(<span class="string"><span class="delimiter">&quot;</span><span class="content">captain</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-withcrew-should-create-a-crew" class="paragraph">
<p> <details><summary> 
Ship:withCrew() should create a crew
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()

Ship:withCrew(ship)

<span class="predefined">assert</span>.is_true(Ship:hasCrew(ship))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-withcrew-should-create-a-crew-with-a-certain-position" class="paragraph">
<p> <details><summary> 
Ship:withCrew() should create a crew with a certain position
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">person</span> = personMock()
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()

Ship:withCrew(ship, <span class="map"><span class="delimiter">{</span><span class="key">captain</span> = person<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_true(ship:hasCrewAtPosition(<span class="string"><span class="delimiter">&quot;</span><span class="content">captain</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_same(person, ship:getCrewAtPosition(<span class="string"><span class="delimiter">&quot;</span><span class="content">captain</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_false(ship:hasCrewAtPosition(<span class="string"><span class="delimiter">&quot;</span><span class="content">science</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-withcrew-should-fail-when-the-position-is-not-a-person" class="paragraph">
<p> <details><summary> 
Ship:withCrew() should fail when the position is not a person
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">person</span> = <span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span> () Ship:withCrew(ship, <span class="map"><span class="delimiter">{</span><span class="key">captain</span> = person<span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-withcrew-should-fail-when-the-position-is-not-a-string" class="paragraph">
<p> <details><summary> 
Ship:withCrew() should fail when the position is not a string
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">person</span> = personMock()
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span> () Ship:withCrew(ship, <span class="map"><span class="delimiter">{</span>person<span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="ship-withengineeringofficer">Ship:withEngineeringOfficer()</h3>
<div id="ship-withengineeringofficer-sets-the-engineering-officer" class="paragraph">
<p> <details><summary> 
Ship:withEngineeringOfficer() sets the engineering officer
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">person</span> = personMock()
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()

Ship:withEngineeringOfficer(ship, person)
<span class="predefined">assert</span>.is_true(ship:hasCrewAtPosition(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(ship:hasEngineeringOfficer())
<span class="predefined">assert</span>.is_same(person, ship:getCrewAtPosition(<span class="string"><span class="delimiter">&quot;</span><span class="content">engineering</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_same(person, ship:getEngineeringOfficer())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="ship-withevents">Ship:withEvents()</h3>
<div id="ship-withevents-config-ondockinitiation-does-not-fail-if-the-callback-errors" class="paragraph">
<p> <details><summary> 
Ship:withEvents() config.onDockInitiation does not fail if the callback errors
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withEvents(ship, <span class="map"><span class="delimiter">{</span>
    <span class="key">onDockInitiation</span> = <span class="keyword">function</span>()
        <span class="predefined">error</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Boom</span><span class="delimiter">&quot;</span></span>)
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
station:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
ship:setPosition(<span class="integer">2000</span>, <span class="integer">0</span>)
ship:orderDock(station)

<span class="predefined">assert</span>.not_has_error(<span class="keyword">function</span>()
    Cron.tick(<span class="integer">1</span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-withevents-config-ondockinitiation-fails-if-ondockinitiation-is-not-a-callback" class="paragraph">
<p> <details><summary> 
Ship:withEvents() config.onDockInitiation fails if onDockInitiation is not a callback
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Ship:withEvents(ship, <span class="map"><span class="delimiter">{</span> <span class="key">onDockInitiation</span> = <span class="integer">42</span><span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-withevents-config-ondockinitiation-is-called-when-ship-can-not-decide-between-two-stations" class="paragraph">
<p> <details><summary> 
Ship:withEvents() config.onDockInitiation is called when ship can not decide between two stations
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">station1</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">station2</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">calledArg1</span>, <span class="local-variable">calledArg2</span>
Ship:withEvents(ship, <span class="map"><span class="delimiter">{</span>
    <span class="key">onDockInitiation</span> = <span class="keyword">function</span>(arg1, arg2)
        <span class="key">called</span> = called + <span class="integer">1</span>
        <span class="key">calledArg1</span> = arg1
        <span class="key">calledArg2</span> = arg2
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
station1:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
ship:setPosition(<span class="integer">2000</span>, <span class="integer">0</span>)
station2:setPosition(<span class="integer">4000</span>, <span class="integer">0</span>)

ship:orderDock(station1)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)
<span class="predefined">assert</span>.is_same(ship, calledArg1)
<span class="predefined">assert</span>.is_same(station1, calledArg2)

ship:orderDock(station2)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, called)
<span class="predefined">assert</span>.is_same(ship, calledArg1)
<span class="predefined">assert</span>.is_same(station2, calledArg2)

ship:orderDock(station1)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, called)
<span class="predefined">assert</span>.is_same(ship, calledArg1)
<span class="predefined">assert</span>.is_same(station1, calledArg2)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-withevents-config-ondockinitiation-is-called-when-the-ship-approaches-a-station-with-the-intention-of-docking" class="paragraph">
<p> <details><summary> 
Ship:withEvents() config.onDockInitiation is called when the ship approaches a station with the intention of docking
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">calledArg1</span>, <span class="local-variable">calledArg2</span>
Ship:withEvents(ship, <span class="map"><span class="delimiter">{</span>
    <span class="key">onDockInitiation</span> = <span class="keyword">function</span>(arg1, arg2)
        <span class="key">called</span> = called + <span class="integer">1</span>
        <span class="key">calledArg1</span> = arg1
        <span class="key">calledArg2</span> = arg2
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
station:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
ship:setPosition(<span class="integer">10000</span>, <span class="integer">0</span>)
ship:orderDock(station)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)

ship:setPosition(<span class="integer">2000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)
<span class="predefined">assert</span>.is_same(ship, calledArg1)
<span class="predefined">assert</span>.is_same(station, calledArg2)

<span class="comment">-- it is not called multiple times</span>
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)

<span class="comment">-- it resets after a ship was docked at a station</span>
ship:setDockedAt(station)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)

ship:orderIdle()
ship:setDockedAt(<span class="predefined-constant">nil</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)

ship:orderDock(station)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-withevents-config-ondockinitiation-resets-when-ship-changes-orders" class="paragraph">
<p> <details><summary> 
Ship:withEvents() config.onDockInitiation resets when ship changes orders
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">calledArg1</span>, <span class="local-variable">calledArg2</span>
Ship:withEvents(ship, <span class="map"><span class="delimiter">{</span>
    <span class="key">onDockInitiation</span> = <span class="keyword">function</span>(arg1, arg2)
        <span class="key">called</span> = called + <span class="integer">1</span>
        <span class="key">calledArg1</span> = arg1
        <span class="key">calledArg2</span> = arg2
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
station:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
ship:setPosition(<span class="integer">10000</span>, <span class="integer">0</span>)
ship:orderDock(station)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)

ship:setPosition(<span class="integer">2000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)

ship:orderIdle()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)

ship:orderDock(station)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-withevents-config-ondocking-does-not-fail-if-the-callback-errors" class="paragraph">
<p> <details><summary> 
Ship:withEvents() config.onDocking does not fail if the callback errors
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withEvents(ship, <span class="map"><span class="delimiter">{</span>
    <span class="key">onDocking</span> = <span class="keyword">function</span>()
        <span class="predefined">error</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Boom</span><span class="delimiter">&quot;</span></span>)
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

ship:orderDock(station)
ship:setDockedAt(station)

<span class="predefined">assert</span>.not_has_error(<span class="keyword">function</span>()
    Cron.tick(<span class="integer">1</span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-withevents-config-ondocking-fails-if-ondocking-is-not-a-callback" class="paragraph">
<p> <details><summary> 
Ship:withEvents() config.onDocking fails if onDocking is not a callback
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Ship:withEvents(ship, <span class="map"><span class="delimiter">{</span> <span class="key">onDocking</span> = <span class="integer">42</span><span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-withevents-config-ondocking-is-called-when-ship-docks-multiple-stations" class="paragraph">
<p> <details><summary> 
Ship:withEvents() config.onDocking is called when ship docks multiple stations
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">station1</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">station2</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">calledArg1</span>, <span class="local-variable">calledArg2</span>
Ship:withEvents(ship, <span class="map"><span class="delimiter">{</span>
    <span class="key">onDocking</span> = <span class="keyword">function</span>(arg1, arg2)
        <span class="key">called</span> = called + <span class="integer">1</span>
        calledArg1, <span class="key">calledArg2</span> = arg1, arg2
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)

ship:orderDock(station1)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)

ship:setDockedAt(station1)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)
<span class="predefined">assert</span>.is_same(calledArg1, ship)
<span class="predefined">assert</span>.is_same(calledArg2, station1)

ship:orderDock(station2)
ship:setDockedAt(<span class="predefined-constant">nil</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)

ship:setDockedAt(station2)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, called)
<span class="predefined">assert</span>.is_same(calledArg1, ship)
<span class="predefined">assert</span>.is_same(calledArg2, station2)

ship:orderDock(station1)
ship:setDockedAt(<span class="predefined-constant">nil</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, called)

ship:setDockedAt(station1)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-withevents-config-ondocking-is-called-when-the-ship-docks-a-station" class="paragraph">
<p> <details><summary> 
Ship:withEvents() config.onDocking is called when the ship docks a station
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withEvents(ship, <span class="map"><span class="delimiter">{</span>
    <span class="key">onDocking</span> = <span class="keyword">function</span>()
        <span class="key">called</span> = called + <span class="integer">1</span>
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)

ship:orderDock(station)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)

ship:setDockedAt(station)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)

<span class="comment">-- it is only called once</span>
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)

ship:orderIdle()
ship:setDockedAt(<span class="predefined-constant">nil</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)

ship:orderDock(station)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)

<span class="comment">-- it triggers again when undocked in between</span>
ship:setDockedAt(station)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-withevents-config-onundocking-does-not-fail-if-the-callback-errors" class="paragraph">
<p> <details><summary> 
Ship:withEvents() config.onUndocking does not fail if the callback errors
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withEvents(ship, <span class="map"><span class="delimiter">{</span>
    <span class="key">onUndocking</span> = <span class="keyword">function</span>()
        <span class="predefined">error</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Boom</span><span class="delimiter">&quot;</span></span>)
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

ship:orderDock(station)
ship:setDockedAt(station)
Cron.tick(<span class="integer">1</span>)
ship:orderIdle()
ship:setDockedAt(<span class="predefined-constant">nil</span>)

<span class="predefined">assert</span>.not_has_error(<span class="keyword">function</span>()
    Cron.tick(<span class="integer">1</span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-withevents-config-onundocking-fails-if-onundocking-is-not-a-callback" class="paragraph">
<p> <details><summary> 
Ship:withEvents() config.onUndocking fails if onUndocking is not a callback
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Ship:withEvents(ship, <span class="map"><span class="delimiter">{</span> <span class="key">onUndocking</span> = <span class="integer">42</span><span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-withevents-config-onundocking-is-called-when-ship-undocks-multiple-stations" class="paragraph">
<p> <details><summary> 
Ship:withEvents() config.onUndocking is called when ship undocks multiple stations
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">station1</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">station2</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">calledArg1</span>, <span class="local-variable">calledArg2</span>
Ship:withEvents(ship, <span class="map"><span class="delimiter">{</span>
    <span class="key">onUndocking</span> = <span class="keyword">function</span>(arg1, arg2)
        <span class="key">called</span> = called + <span class="integer">1</span>
        calledArg1, <span class="key">calledArg2</span> = arg1, arg2
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)

ship:orderDock(station1)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)

ship:setDockedAt(station1)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)

ship:orderDock(station2)
ship:setDockedAt(<span class="predefined-constant">nil</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)
<span class="predefined">assert</span>.is_same(calledArg1, ship)
<span class="predefined">assert</span>.is_same(calledArg2, station1)

ship:setDockedAt(station2)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)

ship:orderDock(station1)
ship:setDockedAt(<span class="predefined-constant">nil</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, called)
<span class="predefined">assert</span>.is_same(calledArg1, ship)
<span class="predefined">assert</span>.is_same(calledArg2, station2)

ship:setDockedAt(station1)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, called)

ship:orderDock(station2)
ship:setDockedAt(<span class="predefined-constant">nil</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, called)
<span class="predefined">assert</span>.is_same(calledArg1, ship)
<span class="predefined">assert</span>.is_same(calledArg2, station1)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-withevents-config-onundocking-is-called-when-the-ship-undocks-a-station" class="paragraph">
<p> <details><summary> 
Ship:withEvents() config.onUndocking is called when the ship undocks a station
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withEvents(ship, <span class="map"><span class="delimiter">{</span>
    <span class="key">onUndocking</span> = <span class="keyword">function</span>()
        <span class="key">called</span> = called + <span class="integer">1</span>
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)

ship:orderDock(station)
ship:setDockedAt(station)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)

ship:orderIdle()
ship:setDockedAt(<span class="predefined-constant">nil</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)

<span class="comment">-- it is only called once</span>
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)

ship:orderDock(station)
ship:setDockedAt(station)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)

<span class="comment">-- it triggers again</span>
ship:orderIdle()
ship:setDockedAt(<span class="predefined-constant">nil</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-withevents-fails-if-a-number-is-given-instead-of-ship" class="paragraph">
<p> <details><summary> 
Ship:withEvents() fails if a number is given instead of ship
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Ship:withEvents(<span class="integer">42</span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-withevents-includes-events-from-shiptemplatebased" class="paragraph">
<p> <details><summary> 
Ship:withEvents() includes events from ShipTemplateBased
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="comment">-- just test onDestruction</span>
<span class="keyword">local</span> <span class="local-variable">called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
Ship:withEvents(ship, <span class="map"><span class="delimiter">{</span>
    <span class="key">onDestruction</span> = <span class="keyword">function</span>()
        <span class="key">called</span> = called + <span class="integer">1</span>
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)

ship:destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="ship-withfleet">Ship:withFleet()</h3>
<div id="ship-withfleet-fails-if-ship-already-has-a-fleet" class="paragraph">
<p> <details><summary> 
Ship:withFleet() fails if ship already has a fleet
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">fleet</span> = fleetMock(<span class="map"><span class="delimiter">{</span>ship<span class="delimiter">}</span></span>)
Ship:withFleet(ship, fleet)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Ship:withFleet(ship, fleet) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-withfleet-fails-when-no-fleet-is-given" class="paragraph">
<p> <details><summary> 
Ship:withFleet() fails when no fleet is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Ship:withFleet(ship, <span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-withfleet-fails-when-no-ship-is-given" class="paragraph">
<p> <details><summary> 
Ship:withFleet() fails when no ship is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">fleet</span> = fleetMock(<span class="map"><span class="delimiter">{</span>ship<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Ship:withFleet(<span class="integer">42</span>, fleet) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="ship-withfleet-should-create-a-ship-with-fleet" class="paragraph">
<p> <details><summary> 
Ship:withFleet() should create a ship with fleet
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">fleet</span> = fleetMock(<span class="map"><span class="delimiter">{</span>ship<span class="delimiter">}</span></span>)
Ship:withFleet(ship, fleet)

<span class="predefined">assert</span>.is_true(Ship:hasFleet(ship))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="ship-withfleet-getfleet">Ship:withFleet():getFleet()</h3>
<div id="ship-withfleet-getfleet-returns-the-fleet" class="paragraph">
<p> <details><summary> 
Ship:withFleet():getFleet() returns the fleet
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">fleet</span> = fleetMock(<span class="map"><span class="delimiter">{</span>ship<span class="delimiter">}</span></span>)
Ship:withFleet(ship, fleet)

<span class="predefined">assert</span>.is_same(fleet, ship:getFleet())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="ship-withfleet-getfleetleader">Ship:withFleet():getFleetLeader()</h3>
<div id="ship-withfleet-getfleetleader-returns-the-leader-of-the-fleet" class="paragraph">
<p> <details><summary> 
Ship:withFleet():getFleetLeader() returns the leader of the fleet
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">fleet</span> = fleetMock(<span class="map"><span class="delimiter">{</span>ship<span class="delimiter">}</span></span>)
fleet.getLeader = <span class="keyword">function</span>(self) <span class="keyword">return</span> ship <span class="keyword">end</span>

Ship:withFleet(ship, fleet)

<span class="predefined">assert</span>.is_same(ship, ship:getFleetLeader())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="ship-withfleet-isfleetleader">Ship:withFleet():isFleetLeader()</h3>
<div id="ship-withfleet-isfleetleader-returns-true-if-ship-is-the-fleet-leader" class="paragraph">
<p> <details><summary> 
Ship:withFleet():isFleetLeader() returns true if ship is the fleet leader
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">ship2</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">fleet</span> = fleetMock(<span class="map"><span class="delimiter">{</span>ship1, ship2<span class="delimiter">}</span></span>)
fleet.getLeader = <span class="keyword">function</span>(self) <span class="keyword">return</span> ship1 <span class="keyword">end</span>

Ship:withFleet(ship1, fleet)
Ship:withFleet(ship2, fleet)

<span class="predefined">assert</span>.is_true(ship1:isFleetLeader())
<span class="predefined">assert</span>.is_false(ship2:isFleetLeader())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="ship-withhelmsofficer">Ship:withHelmsOfficer()</h3>
<div id="ship-withhelmsofficer-sets-the-helms-officer" class="paragraph">
<p> <details><summary> 
Ship:withHelmsOfficer() sets the helms officer
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">person</span> = personMock()
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()

Ship:withHelmsOfficer(ship, person)
<span class="predefined">assert</span>.is_true(ship:hasCrewAtPosition(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(ship:hasHelmsOfficer())
<span class="predefined">assert</span>.is_same(person, ship:getCrewAtPosition(<span class="string"><span class="delimiter">&quot;</span><span class="content">helms</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_same(person, ship:getHelmsOfficer())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="ship-withrelayofficer">Ship:withRelayOfficer()</h3>
<div id="ship-withrelayofficer-sets-the-relay-officer" class="paragraph">
<p> <details><summary> 
Ship:withRelayOfficer() sets the relay officer
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">person</span> = personMock()
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()

Ship:withRelayOfficer(ship, person)
<span class="predefined">assert</span>.is_true(ship:hasCrewAtPosition(<span class="string"><span class="delimiter">&quot;</span><span class="content">relay</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(ship:hasRelayOfficer())
<span class="predefined">assert</span>.is_same(person, ship:getCrewAtPosition(<span class="string"><span class="delimiter">&quot;</span><span class="content">relay</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_same(person, ship:getRelayOfficer())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="ship-withscienceofficer">Ship:withScienceOfficer()</h3>
<div id="ship-withscienceofficer-sets-the-science-officer" class="paragraph">
<p> <details><summary> 
Ship:withScienceOfficer() sets the science officer
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">person</span> = personMock()
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()

Ship:withScienceOfficer(ship, person)
<span class="predefined">assert</span>.is_true(ship:hasCrewAtPosition(<span class="string"><span class="delimiter">&quot;</span><span class="content">science</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(ship:hasScienceOfficer())
<span class="predefined">assert</span>.is_same(person, ship:getCrewAtPosition(<span class="string"><span class="delimiter">&quot;</span><span class="content">science</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_same(person, ship:getScienceOfficer())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="ship-withweaponsofficer">Ship:withWeaponsOfficer()</h3>
<div id="ship-withweaponsofficer-sets-the-weapons-officer" class="paragraph">
<p> <details><summary> 
Ship:withWeaponsOfficer() sets the weapons officer
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">person</span> = personMock()
<span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()

Ship:withWeaponsOfficer(ship, person)
<span class="predefined">assert</span>.is_true(ship:hasCrewAtPosition(<span class="string"><span class="delimiter">&quot;</span><span class="content">weapons</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_true(ship:hasWeaponsOfficer())
<span class="predefined">assert</span>.is_same(person, ship:getCrewAtPosition(<span class="string"><span class="delimiter">&quot;</span><span class="content">weapons</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_same(person, ship:getWeaponsOfficer())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="shiptemplatebased">ShipTemplateBased</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="shiptemplatebased-withcomms">ShipTemplateBased:withComms()</h3>
<div id="shiptemplatebased-withcomms-can-set-a-hail-text" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms() can set a hail text
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">hail</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

ShipTemplateBased:withComms(station, <span class="map"><span class="delimiter">{</span><span class="key">hailText</span> = hail<span class="delimiter">}</span></span>)
<span class="predefined">assert</span>.is_same(hail, station:getComms(player):getWhatNpcSays(station, player))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withcomms-can-set-comms" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms() can set comms
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

ShipTemplateBased:withComms(station, <span class="map"><span class="delimiter">{</span><span class="key">comms</span> = <span class="map"><span class="inline-delimiter">{</span> commsScreenReplyMock(), commsScreenReplyMock(), commsScreenReplyMock()<span class="inline-delimiter">}</span></span><span class="delimiter">}</span></span>)
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, Util.size(station:getComms(player):getHowPlayerCanReact()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withcomms-causes-hascomms-to-be-true" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms() causes hasComms() to be true
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

ShipTemplateBased:withComms(station)
<span class="predefined">assert</span>.is_true(ShipTemplateBased:hasComms(station))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withcomms-fails-if-comms-is-a-number" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms() fails if comms is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() ShipTemplateBased:withComms(station, <span class="map"><span class="delimiter">{</span><span class="key">comms</span> = <span class="integer">42</span><span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withcomms-fails-if-first-argument-is-already-a-spaceobject-with-comms" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms() fails if first argument is already a SpaceObject with comms
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

ShipTemplateBased:withComms(station)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() ShipTemplateBased:withComms(station) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withcomms-fails-if-first-parameter-is-a-number" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms() fails if first parameter is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() ShipTemplateBased:withComms(<span class="integer">4</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withcomms-fails-if-one-of-the-comms-is-not-a-comms" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms() fails if one of the comms is not a comms
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() ShipTemplateBased:withComms(station, <span class="map"><span class="delimiter">{</span><span class="key">comms</span> = <span class="map"><span class="inline-delimiter">{</span> commsScreenReplyMock(), commsScreenReplyMock(), <span class="integer">42</span><span class="inline-delimiter">}</span></span><span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withcomms-fails-if-second-argument-is-not-a-table" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms() fails if second argument is not a table
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() ShipTemplateBased:withComms(station, <span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withcomms-fails-if-the-hailtext-is-a-number" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms() fails if the hailText is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() ShipTemplateBased:withComms(station, <span class="map"><span class="delimiter">{</span><span class="key">hailText</span> = <span class="integer">42</span><span class="delimiter">}</span></span>)<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withcomms-sets-a-comms-script" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms() sets a comms script
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">called</span> = <span class="predefined-constant">false</span>
station.setCommsScript = <span class="keyword">function</span>() called = <span class="predefined-constant">true</span> <span class="keyword">end</span>

ShipTemplateBased:withComms(station)
<span class="predefined">assert</span>.is_true(called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="shiptemplatebased-withcomms-addcomms">ShipTemplateBased:withComms():addComms()</h3>
<div id="shiptemplatebased-withcomms-addcomms-allows-to-be-called-with-a-reply" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms():addComms() allows to be called with a reply
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
ShipTemplateBased:withComms(station)
station:addComms(commsScreenReplyMock())

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, Util.size(station:getComms(player):getHowPlayerCanReact()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withcomms-addcomms-fails-if-a-number-is-given-as-id" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms():addComms() fails if a number is given as id
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
ShipTemplateBased:withComms(station)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() station:addComms(commsScreenReplyMock(), <span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withcomms-addcomms-fails-if-no-reply-is-given" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms():addComms() fails if no reply is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
ShipTemplateBased:withComms(station)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() station:addComms() <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withcomms-addcomms-fails-if-reply-is-a-number" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms():addComms() fails if reply is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
ShipTemplateBased:withComms(station)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() station:addComms(<span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withcomms-addcomms-generates-an-id-if-none-is-set" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms():addComms() generates an id if none is set
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
ShipTemplateBased:withComms(station)
<span class="keyword">local</span> <span class="local-variable">id</span> = station:addComms(commsScreenReplyMock())

<span class="predefined">assert</span>.not_nil(id)
<span class="predefined">assert</span>.is_true(isString(id))
<span class="predefined">assert</span>.not_same(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>, id)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withcomms-addcomms-uses-a-given-id" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms():addComms() uses a given id
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">id</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
ShipTemplateBased:withComms(station)

<span class="predefined">assert</span>.is_same(id, station:addComms(commsScreenReplyMock(), id))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="shiptemplatebased-withcomms-getcomms">ShipTemplateBased:withComms():getComms()</h3>
<div id="shiptemplatebased-withcomms-getcomms-does-not-allow-to-manipulate-internal-state" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms():getComms() does not allow to manipulate internal state
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
ShipTemplateBased:withComms(station, <span class="map"><span class="delimiter">{</span><span class="key">comms</span> = <span class="map"><span class="inline-delimiter">{</span> commsScreenReplyMock() <span class="inline-delimiter">}</span></span><span class="delimiter">}</span></span>)
<span class="keyword">local</span> <span class="local-variable">comms</span> = station:getComms(player)

table.insert(comms:getHowPlayerCanReact(), commsScreenReplyMock())

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, Util.size(station:getComms(player):getHowPlayerCanReact()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withcomms-getcomms-fails-if-it-is-called-with-a-number" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms():getComms() fails if it is called with a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
ShipTemplateBased:withComms(station)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() station:getComms(<span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withcomms-getcomms-fails-if-it-is-called-without-argument" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms():getComms() fails if it is called without argument
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
ShipTemplateBased:withComms(station)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() station:getComms() <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withcomms-getcomms-returns-all-replies-from-the-constructor-and-addcomms" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms():getComms() returns all replies from the constructor and addComms()
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">reply1</span> = commsScreenReplyMock()
<span class="keyword">local</span> <span class="local-variable">reply2</span> = commsScreenReplyMock()
<span class="keyword">local</span> <span class="local-variable">reply3</span> = commsScreenReplyMock()

<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
ShipTemplateBased:withComms(station, <span class="map"><span class="delimiter">{</span><span class="key">comms</span> = <span class="map"><span class="inline-delimiter">{</span> reply1 <span class="inline-delimiter">}</span></span><span class="delimiter">}</span></span>)
station:addComms(reply2)
station:addComms(reply3)

<span class="keyword">local</span> <span class="local-variable">comms</span> = station:getComms(player)
<span class="predefined">assert</span>.is_true(Comms:isScreen(comms))
<span class="predefined">assert</span>.contains_value(reply1, comms:getHowPlayerCanReact())
<span class="predefined">assert</span>.contains_value(reply2, comms:getHowPlayerCanReact())
<span class="predefined">assert</span>.contains_value(reply3, comms:getHowPlayerCanReact())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="shiptemplatebased-withcomms-overridecomms">ShipTemplateBased:withComms():overrideComms()</h3>
<div id="shiptemplatebased-withcomms-overridecomms-allows-to-override-comms-once" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms():overrideComms() allows to override comms once
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

ShipTemplateBased:withComms(station)
<span class="keyword">local</span> <span class="local-variable">screen</span> = commsScreenMock()

station:overrideComms(screen, <span class="predefined-constant">true</span>)
<span class="predefined">assert</span>.is_same(screen, station:getComms(player))
<span class="predefined">assert</span>.not_same(screen, station:getComms(player))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withcomms-overridecomms-allows-to-permanently-override-comms" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms():overrideComms() allows to permanently override comms
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

ShipTemplateBased:withComms(station)
<span class="keyword">local</span> <span class="local-variable">screen</span> = commsScreenMock()

station:overrideComms(screen)
<span class="predefined">assert</span>.is_same(screen:getWhatNpcSays(station, player), station:getComms(player):getWhatNpcSays(station, player))
<span class="predefined">assert</span>.is_same(screen:getHowPlayerCanReact(), station:getComms(player):getHowPlayerCanReact())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withcomms-overridecomms-allows-to-remove-override" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms():overrideComms() allows to remove override
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

ShipTemplateBased:withComms(station)
<span class="keyword">local</span> <span class="local-variable">screen</span> = commsScreenMock()

station:overrideComms(screen)
<span class="predefined">assert</span>.is_same(screen, station:getComms(player))
station:overrideComms(<span class="predefined-constant">nil</span>)
<span class="predefined">assert</span>.not_same(screen, station:getComms(player))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withcomms-overridecomms-fails-if-first-argument-is-not-a-screen" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms():overrideComms() fails if first argument is not a screen
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
ShipTemplateBased:withComms(station)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() station:overrideComms(<span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withcomms-overridecomms-fails-if-second-argument-is-not-boolean" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms():overrideComms() fails if second argument is not boolean
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
ShipTemplateBased:withComms(station)
<span class="keyword">local</span> <span class="local-variable">screen</span> = commsScreenMock()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() station:overrideComms(screen, <span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="shiptemplatebased-withcomms-removecomms">ShipTemplateBased:withComms():removeComms()</h3>
<div id="shiptemplatebased-withcomms-removecomms-allows-to-remove-a-comms-that-has-been-added-before" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms():removeComms() allows to remove a comms that has been added before
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">reply</span> = commsScreenReplyMock()
ShipTemplateBased:withComms(station)
<span class="keyword">local</span> <span class="local-variable">id</span> = station:addComms(reply)
station:addComms(commsScreenReplyMock())
station:addComms(commsScreenReplyMock())

station:removeComms(id)
<span class="predefined">assert</span>.not_contains_value(reply, station:getComms(player):getHowPlayerCanReact())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withcomms-removecomms-fails-if-a-number-is-given-instead-of-an-id" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms():removeComms() fails if a number is given instead of an id
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
ShipTemplateBased:withComms(station)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() station:removeComms(<span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withcomms-removecomms-fails-silently-if-an-invalid-id-is-given" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms():removeComms() fails silently if an invalid id is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
ShipTemplateBased:withComms(station)

station:removeComms(<span class="string"><span class="delimiter">&quot;</span><span class="content">does not exist</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>, station:getComms(player):getHowPlayerCanReact())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="shiptemplatebased-withcomms-sethailtext">ShipTemplateBased:withComms():setHailText()</h3>
<div id="shiptemplatebased-withcomms-sethailtext-calls-a-set-function-and-returns-a-string" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms():setHailText() calls a set function and returns a string
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">hail</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>
station:setHailText(<span class="keyword">function</span>(callStation, callPlayer)
    <span class="predefined">assert</span>.is_same(station, callStation)
    <span class="predefined">assert</span>.is_same(player, callPlayer)
    <span class="keyword">return</span> hail
<span class="keyword">end</span>)
<span class="predefined">assert</span>.is_same(hail, station:getComms(player):getWhatNpcSays(station, player))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withcomms-sethailtext-calls-a-set-function-and-returns-nil" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms():setHailText() calls a set function and returns nil
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">station:setHailText(<span class="keyword">function</span>() <span class="keyword">end</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>, station:getComms(player):getWhatNpcSays(station, player))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withcomms-sethailtext-calls-a-set-function-and-returns-nil-if-the-return-value-is-a-number" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms():setHailText() calls a set function and returns nil if the return value is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">station:setHailText(<span class="keyword">function</span>() <span class="keyword">return</span> <span class="integer">42</span> <span class="keyword">end</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>, station:getComms(player):getWhatNpcSays(station, player))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withcomms-sethailtext-return-nil-if-nil-was-set" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms():setHailText() return nil if nil was set
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">station:setHailText(<span class="predefined-constant">nil</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>, station:getComms(player):getWhatNpcSays(station, player))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withcomms-sethailtext-returns-a-set-string" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withComms():setHailText() returns a set string
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">hail</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>
station:setHailText(hail)
<span class="predefined">assert</span>.is_same(hail, station:getComms(player):getWhatNpcSays(station, player))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="shiptemplatebased-withcrew">ShipTemplateBased:withCrew()</h3>
<div id="shiptemplatebased-withcrew-can-be-called-multiple-times-to-add-different-persons" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withCrew() can be called multiple times to add different persons
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">person1</span> = personMock()
<span class="keyword">local</span> <span class="local-variable">person2</span> = personMock()
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

ShipTemplateBased:withCrew(station, <span class="map"><span class="delimiter">{</span><span class="key">commander</span> = person1<span class="delimiter">}</span></span>)
ShipTemplateBased:withCrew(station, <span class="map"><span class="delimiter">{</span><span class="key">relay</span> = person2<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(person1, station:getCrewAtPosition(<span class="string"><span class="delimiter">&quot;</span><span class="content">commander</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_same(person2, station:getCrewAtPosition(<span class="string"><span class="delimiter">&quot;</span><span class="content">relay</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withcrew-can-be-called-multiple-times-to-override-a-position" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withCrew() can be called multiple times to override a position
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">person1</span> = personMock()
<span class="keyword">local</span> <span class="local-variable">person2</span> = personMock()
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

ShipTemplateBased:withCrew(station, <span class="map"><span class="delimiter">{</span><span class="key">commander</span> = person1<span class="delimiter">}</span></span>)
ShipTemplateBased:withCrew(station, <span class="map"><span class="delimiter">{</span><span class="key">commander</span> = person2<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(person2, station:getCrewAtPosition(<span class="string"><span class="delimiter">&quot;</span><span class="content">commander</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withcrew-should-create-a-crew" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withCrew() should create a crew
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

ShipTemplateBased:withCrew(station)

<span class="predefined">assert</span>.is_true(ShipTemplateBased:hasCrew(station))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withcrew-should-fail-when-the-position-is-not-a-person" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withCrew() should fail when the position is not a person
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span> () ShipTemplateBased:withCrew(station, <span class="map"><span class="delimiter">{</span><span class="key">captain</span> = <span class="map"><span class="inline-delimiter">{</span><span class="inline-delimiter">}</span></span><span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withcrew-should-fail-when-the-position-is-not-a-string" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withCrew() should fail when the position is not a string
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">person</span> = personMock()
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span> () ShipTemplateBased:withCrew(station, <span class="map"><span class="delimiter">{</span>person<span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="shiptemplatebased-withevents">ShipTemplateBased:withEvents()</h3>
<div id="shiptemplatebased-withevents-config-onbeingattacked-does-not-fail-if-the-callback-errors" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withEvents() config.onBeingAttacked does not fail if the callback errors
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">enemy</span> = CpuShip()
station.areEnemiesInRange = <span class="keyword">function</span>(self, range)
    <span class="keyword">return</span> distance(self, enemy) &lt; range
<span class="keyword">end</span>
ShipTemplateBased:withEvents(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onBeingAttacked</span> = <span class="keyword">function</span>()
        <span class="predefined">error</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Boom</span><span class="delimiter">&quot;</span></span>)
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
station:setHullMax(<span class="integer">100</span>)
station:setHull(<span class="integer">100</span>)
station:setShieldsMax(<span class="integer">100</span>)
station:setShields(<span class="integer">100</span>)
station:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
enemy:setPosition(<span class="integer">2000</span>, <span class="integer">0</span>)

Cron.tick(<span class="integer">1</span>)
station:setShields(<span class="integer">90</span>)

<span class="predefined">assert</span>.not_has_error(<span class="keyword">function</span>()
    Cron.tick(<span class="integer">1</span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withevents-config-onbeingattacked-fails-if-onbeingattacked-is-not-a-callback" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withEvents() config.onBeingAttacked fails if onBeingAttacked is not a callback
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    ShipTemplateBased:withEvents(station, <span class="map"><span class="delimiter">{</span> <span class="key">onBeingAttacked</span> = <span class="integer">42</span><span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withevents-config-onbeingattacked-is-called-after-it-has-not-received-damage-for-2-minutes" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withEvents() config.onBeingAttacked is called after it has not received damage for 2 minutes
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">enemy</span> = CpuShip()
station.areEnemiesInRange = <span class="keyword">function</span>(self, range)
    <span class="keyword">return</span> distance(self, enemy) &lt; range
<span class="keyword">end</span>
ShipTemplateBased:withEvents(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onBeingAttacked</span> = <span class="keyword">function</span>()
        <span class="key">called</span> = called + <span class="integer">1</span>
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
station:setHullMax(<span class="integer">100</span>)
station:setHull(<span class="integer">100</span>)
station:setShieldsMax(<span class="integer">100</span>)
station:setShields(<span class="integer">100</span>)
station:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
enemy:setPosition(<span class="integer">2000</span>, <span class="integer">0</span>)

called = <span class="integer">0</span>
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)

station:setShields(<span class="integer">90</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)

<span class="keyword">for</span> i=<span class="integer">1</span>,<span class="integer">120</span> <span class="keyword">do</span> Cron.tick(<span class="integer">1</span>) <span class="keyword">end</span>

station:setShields(<span class="integer">80</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withevents-config-onbeingattacked-is-called-when-the-shiptemplatebased-looses-hull-and-enemy-is-close" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withEvents() config.onBeingAttacked is called when the shipTemplateBased looses hull and enemy is close
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">enemy</span> = CpuShip()
station.areEnemiesInRange = <span class="keyword">function</span>(self, range)
    <span class="keyword">return</span> distance(self, enemy) &lt; range
<span class="keyword">end</span>
ShipTemplateBased:withEvents(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onBeingAttacked</span> = <span class="keyword">function</span>()
        <span class="key">called</span> = called + <span class="integer">1</span>
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
station:setHullMax(<span class="integer">100</span>)
station:setHull(<span class="integer">100</span>)
station:setShieldsMax(<span class="integer">100</span>)
station:setShields(<span class="integer">100</span>)
station:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
enemy:setPosition(<span class="integer">2000</span>, <span class="integer">0</span>)

called = <span class="integer">0</span>
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)

station:setHull(<span class="integer">90</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)

station:setHull(<span class="integer">80</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withevents-config-onbeingattacked-is-called-when-the-shiptemplatebased-looses-shield-and-enemy-is-close" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withEvents() config.onBeingAttacked is called when the shipTemplateBased looses shield and enemy is close
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">enemy</span> = CpuShip()
station.areEnemiesInRange = <span class="keyword">function</span>(self, range)
    <span class="keyword">return</span> distance(self, enemy) &lt; range
<span class="keyword">end</span>
ShipTemplateBased:withEvents(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onBeingAttacked</span> = <span class="keyword">function</span>()
        <span class="key">called</span> = called + <span class="integer">1</span>
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
station:setHullMax(<span class="integer">100</span>)
station:setHull(<span class="integer">100</span>)
station:setShieldsMax(<span class="integer">100</span>)
station:setShields(<span class="integer">100</span>)
station:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
enemy:setPosition(<span class="integer">2000</span>, <span class="integer">0</span>)

called = <span class="integer">0</span>
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)

station:setShields(<span class="integer">90</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)

station:setShields(<span class="integer">80</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withevents-config-onbeingattacked-is-called-with-the-shiptemplatebased" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withEvents() config.onBeingAttacked is called with the shipTemplateBased
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">enemy</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">calledArg</span>
station.areEnemiesInRange = <span class="keyword">function</span>(self, range)
    <span class="keyword">return</span> distance(self, enemy) &lt; range
<span class="keyword">end</span>
ShipTemplateBased:withEvents(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onBeingAttacked</span> = <span class="keyword">function</span>(arg1)
        <span class="key">calledArg</span> = arg1
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
station:setHullMax(<span class="integer">100</span>)
station:setHull(<span class="integer">100</span>)
station:setShieldsMax(<span class="integer">100</span>)
station:setShields(<span class="integer">100</span>)
station:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
enemy:setPosition(<span class="integer">2000</span>, <span class="integer">0</span>)

Cron.tick(<span class="integer">1</span>)
station:setShields(<span class="integer">90</span>)
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_same(station, calledArg)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withevents-config-onbeingattacked-is-not-called-when-hull-or-shield-are-damaged-but-there-is-no-enemy-close" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withEvents() config.onBeingAttacked is not called when hull or shield are damaged, but there is no enemy close
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">enemy</span> = CpuShip()
station.areEnemiesInRange = <span class="keyword">function</span>(self, range)
    <span class="keyword">return</span> distance(self, enemy) &lt; range
<span class="keyword">end</span>
ShipTemplateBased:withEvents(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onBeingAttacked</span> = <span class="keyword">function</span>()
        <span class="key">called</span> = called + <span class="integer">1</span>
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
station:setHullMax(<span class="integer">100</span>)
station:setHull(<span class="integer">100</span>)
station:setShieldsMax(<span class="integer">100</span>)
station:setShields(<span class="integer">100</span>)
station:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
enemy:setPosition(<span class="integer">99999</span>, <span class="integer">0</span>)

called = <span class="integer">0</span>
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)

station:setHull(<span class="integer">90</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)

station:setShields(<span class="integer">90</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withevents-config-ondestruction-does-not-fail-if-the-callback-errors" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withEvents() config.onDestruction does not fail if the callback errors
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
ShipTemplateBased:withEvents(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onDestruction</span> = <span class="keyword">function</span>()
        <span class="predefined">error</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Boom</span><span class="delimiter">&quot;</span></span>)
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

station:destroy()
<span class="predefined">assert</span>.not_has_error(<span class="keyword">function</span>()
    Cron.tick(<span class="integer">1</span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withevents-config-ondestruction-fails-if-ondestruction-is-not-a-callback" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withEvents() config.onDestruction fails if onDestruction is not a callback
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    ShipTemplateBased:withEvents(station, <span class="map"><span class="delimiter">{</span> <span class="key">onDestruction</span> = <span class="integer">42</span><span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withevents-config-ondestruction-is-called-when-the-shiptemplatebased-is-destroyed" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withEvents() config.onDestruction is called when the shipTemplateBased is destroyed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
ShipTemplateBased:withEvents(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onDestruction</span> = <span class="keyword">function</span>()
        <span class="key">called</span> = called + <span class="integer">1</span>
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)

station:destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)

<span class="comment">-- it is only called once</span>
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withevents-config-ondestruction-is-called-with-the-destroyed-shiptemplatebased" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withEvents() config.onDestruction is called with the destroyed shipTemplateBased
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">calledArg</span>

ShipTemplateBased:withEvents(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onDestruction</span> = <span class="keyword">function</span>(arg)
        <span class="key">calledArg</span> = arg
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

station:destroy()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(station, calledArg)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withevents-config-onenemyclear-does-not-fail-if-the-callback-errors" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withEvents() config.onEnemyClear does not fail if the callback errors
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">enemy</span> = CpuShip()
station.areEnemiesInRange = <span class="keyword">function</span>(self, range)
    <span class="keyword">return</span> distance(self, enemy) &lt; range
<span class="keyword">end</span>
ShipTemplateBased:withEvents(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onEnemyClear</span> = <span class="keyword">function</span>()
        <span class="predefined">error</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Boom</span><span class="delimiter">&quot;</span></span>)
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
station:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
enemy:setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)

<span class="predefined">assert</span>.not_has_error(<span class="keyword">function</span>()
    Cron.tick(<span class="integer">1</span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withevents-config-onenemyclear-does-not-trigger-multiple-times-when-multiple-enemies-enter-and-leave" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withEvents() config.onEnemyClear does not trigger multiple times when multiple enemies enter and leave
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">enemy1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">enemy2</span> = CpuShip()
station.areEnemiesInRange = <span class="keyword">function</span>(self, range)
    <span class="keyword">return</span> distance(self, enemy1) &lt; range <span class="keyword">or</span> distance(self, enemy2) &lt; range
<span class="keyword">end</span>
ShipTemplateBased:withEvents(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onEnemyClear</span> = <span class="keyword">function</span>()
        <span class="key">called</span> = called + <span class="integer">1</span>
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

<span class="comment">-- don't trigger when enemies are outside scanner range</span>
station:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
enemy1:setPosition(<span class="integer">99999</span>, <span class="integer">0</span>)
enemy2:setPosition(<span class="integer">99999</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)

enemy1:setPosition(<span class="integer">20000</span>, <span class="integer">0</span>)
enemy2:setPosition(<span class="integer">20000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)

<span class="comment">-- do not trigger when one enemy leaves range</span>
enemy2:setPosition(<span class="integer">99999</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)

<span class="comment">-- but trigger if both leave the range</span>
enemy1:setPosition(<span class="integer">99999</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withevents-config-onenemyclear-does-only-trigger-when-an-enemy-moves-out-of-range" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withEvents() config.onEnemyClear does only trigger when an enemy moves out of range
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">enemy</span> = CpuShip()
station.areEnemiesInRange = <span class="keyword">function</span>(self, range)
    <span class="keyword">return</span> distance(self, enemy) &lt; range
<span class="keyword">end</span>
ShipTemplateBased:withEvents(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onEnemyClear</span> = <span class="keyword">function</span>()
        <span class="key">called</span> = called + <span class="integer">1</span>
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

<span class="comment">-- don't trigger when enemy is outside scanner range</span>
station:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
enemy:setPosition(<span class="integer">99999</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)

<span class="comment">-- do not call when enemy moves in range</span>
enemy:setPosition(<span class="integer">20000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)

<span class="comment">-- does not call as long as enemy stays in range</span>
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)

<span class="comment">-- calls when enemy leaves range</span>
enemy:setPosition(<span class="integer">99999</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)

<span class="comment">-- does not trigger when enemy stays out of range</span>
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)

<span class="comment">-- calls when enemy leaves range again</span>
enemy:setPosition(<span class="integer">20000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)
enemy:setPosition(<span class="integer">99999</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withevents-config-onenemyclear-fails-if-ondestruction-is-not-a-callback" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withEvents() config.onEnemyClear fails if onDestruction is not a callback
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    ShipTemplateBased:withEvents(station, <span class="map"><span class="delimiter">{</span> <span class="key">onEnemyClear</span> = <span class="integer">42</span><span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withevents-config-onenemyclear-is-called-with-the-shiptemplatebased" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withEvents() config.onEnemyClear is called with the shipTemplateBased
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">enemy</span> = CpuShip()
station.areEnemiesInRange = <span class="keyword">function</span>(self, range)
    <span class="keyword">return</span> distance(self, enemy) &lt; range
<span class="keyword">end</span>
<span class="keyword">local</span> <span class="local-variable">calledArg</span>

ShipTemplateBased:withEvents(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onEnemyClear</span> = <span class="keyword">function</span>(arg)
        <span class="key">calledArg</span> = arg
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

station:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
enemy:setPosition(<span class="integer">20000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
enemy:setPosition(<span class="integer">99999</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(station, calledArg)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withevents-config-onenemydetection-does-not-fail-if-the-callback-errors" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withEvents() config.onEnemyDetection does not fail if the callback errors
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">enemy</span> = CpuShip()
station.areEnemiesInRange = <span class="keyword">function</span>(self, range)
    <span class="keyword">return</span> distance(self, enemy) &lt; range
<span class="keyword">end</span>
ShipTemplateBased:withEvents(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onEnemyDetection</span> = <span class="keyword">function</span>()
        <span class="predefined">error</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Boom</span><span class="delimiter">&quot;</span></span>)
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)
station:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
enemy:setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)

<span class="predefined">assert</span>.not_has_error(<span class="keyword">function</span>()
    Cron.tick(<span class="integer">1</span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withevents-config-onenemydetection-does-not-trigger-multiple-times-when-multiple-enemies-enter-and-leave" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withEvents() config.onEnemyDetection does not trigger multiple times when multiple enemies enter and leave
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">enemy1</span> = CpuShip()
<span class="keyword">local</span> <span class="local-variable">enemy2</span> = CpuShip()
station.areEnemiesInRange = <span class="keyword">function</span>(self, range)
    <span class="keyword">return</span> distance(self, enemy1) &lt; range <span class="keyword">or</span> distance(self, enemy2) &lt; range
<span class="keyword">end</span>
ShipTemplateBased:withEvents(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onEnemyDetection</span> = <span class="keyword">function</span>()
        <span class="key">called</span> = called + <span class="integer">1</span>
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

<span class="comment">-- don't trigger when enemies are outside scanner range</span>
station:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
enemy1:setPosition(<span class="integer">99999</span>, <span class="integer">0</span>)
enemy2:setPosition(<span class="integer">99999</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)

enemy1:setPosition(<span class="integer">20000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)

<span class="comment">-- do not trigger when second enemy enters range</span>
enemy2:setPosition(<span class="integer">20000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)

<span class="comment">-- do not trigger when one enemy leaves and enters again</span>
enemy1:setPosition(<span class="integer">99999</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)
enemy1:setPosition(<span class="integer">20000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)

<span class="comment">-- trigger again when ships reenter</span>
enemy1:setPosition(<span class="integer">99999</span>, <span class="integer">0</span>)
enemy2:setPosition(<span class="integer">99999</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)

enemy1:setPosition(<span class="integer">20000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withevents-config-onenemydetection-does-only-trigger-when-an-enemy-moves-into-range" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withEvents() config.onEnemyDetection does only trigger when an enemy moves into range
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">called</span> = <span class="integer">0</span>
<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">enemy</span> = CpuShip()
station.areEnemiesInRange = <span class="keyword">function</span>(self, range)
    <span class="keyword">return</span> distance(self, enemy) &lt; range
<span class="keyword">end</span>
ShipTemplateBased:withEvents(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onEnemyDetection</span> = <span class="keyword">function</span>()
        <span class="key">called</span> = called + <span class="integer">1</span>
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

<span class="comment">-- don't trigger when enemy is outside scanner range</span>
station:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
enemy:setPosition(<span class="integer">99999</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, called)

<span class="comment">-- call when enemy moves in range</span>
enemy:setPosition(<span class="integer">20000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)

<span class="comment">-- does not call as long as enemy stays in range</span>
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)

<span class="comment">-- does not trigger when enemy leaves range</span>
enemy:setPosition(<span class="integer">99999</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, called)

<span class="comment">-- does trigger again when enemy reenters scanner range</span>
enemy:setPosition(<span class="integer">20000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, called)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withevents-config-onenemydetection-fails-if-ondestruction-is-not-a-callback" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withEvents() config.onEnemyDetection fails if onDestruction is not a callback
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    ShipTemplateBased:withEvents(station, <span class="map"><span class="delimiter">{</span> <span class="key">onEnemyDetection</span> = <span class="integer">42</span><span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withevents-config-onenemydetection-is-called-with-the-shiptemplatebased" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withEvents() config.onEnemyDetection is called with the shipTemplateBased
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">enemy</span> = CpuShip()
station.areEnemiesInRange = <span class="keyword">function</span>(self, range)
    <span class="keyword">return</span> distance(self, enemy) &lt; range
<span class="keyword">end</span>
<span class="keyword">local</span> <span class="local-variable">calledArg</span>

ShipTemplateBased:withEvents(station, <span class="map"><span class="delimiter">{</span>
    <span class="key">onEnemyDetection</span> = <span class="keyword">function</span>(arg)
        <span class="key">calledArg</span> = arg
    <span class="keyword">end</span>,
<span class="delimiter">}</span></span>)

station:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
enemy:setPosition(<span class="integer">20000</span>, <span class="integer">0</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(station, calledArg)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withevents-fails-if-a-number-is-given-instead-of-shiptemplatebased" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withEvents() fails if a number is given instead of shipTemplateBased
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    ShipTemplateBased:withEvents(<span class="integer">42</span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="shiptemplatebased-withmissionbroker">ShipTemplateBased:withMissionBroker()</h3>
<div id="shiptemplatebased-withmissionbroker-allows-to-set-missions" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withMissionBroker() allows to set missions
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

ShipTemplateBased:withMissionBroker(station, <span class="map"><span class="delimiter">{</span><span class="key">missions</span> = <span class="map"><span class="inline-delimiter">{</span>missionWithBrokerMock(), missionWithBrokerMock(), missionWithBrokerMock()<span class="inline-delimiter">}</span></span><span class="delimiter">}</span></span>)
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, Util.size(station:getMissions()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withmissionbroker-causes-hasmissionbroker-to-be-true" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withMissionBroker() causes hasMissionBroker() to be true
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
ShipTemplateBased:withMissionBroker(station)

<span class="predefined">assert</span>.is_true(ShipTemplateBased:hasMissionBroker(station))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withmissionbroker-fails-if-any-of-the-missions-is-not-a-mission-with-broker" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withMissionBroker() fails if any of the missions is not a mission with broker
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() ShipTemplateBased:withMissionBroker(station, <span class="map"><span class="delimiter">{</span><span class="key">missions</span> = <span class="map"><span class="inline-delimiter">{</span>missionMock<span class="inline-delimiter">}</span></span><span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withmissionbroker-fails-if-first-argument-is-already-a-spaceobject-with-broker" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withMissionBroker() fails if first argument is already a SpaceObject with broker
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
ShipTemplateBased:withMissionBroker(station)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() ShipTemplateBased:withMissionBroker(station) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withmissionbroker-fails-if-first-argument-is-not-a-spaceobject" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withMissionBroker() fails if first argument is not a SpaceObject
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() ShipTemplateBased:withMissionBroker(<span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withmissionbroker-fails-if-missions-is-a-number" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withMissionBroker() fails if missions is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() ShipTemplateBased:withMissionBroker(station, <span class="map"><span class="delimiter">{</span><span class="key">missions</span> = <span class="integer">42</span><span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withmissionbroker-fails-if-second-argument-is-not-a-table" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withMissionBroker() fails if second argument is not a table
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() ShipTemplateBased:withMissionBroker(station, <span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="shiptemplatebased-withmissionbroker-addmission">ShipTemplateBased:withMissionBroker():addMission()</h3>
<div id="shiptemplatebased-withmissionbroker-addmission-allows-to-add-missions" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withMissionBroker():addMission() allows to add missions
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
ShipTemplateBased:withMissionBroker(station)

station:addMission(missionWithBrokerMock())
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, Util.size(station:getMissions()))
station:addMission(missionWithBrokerMock())
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, Util.size(station:getMissions()))
station:addMission(missionWithBrokerMock())
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, Util.size(station:getMissions()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withmissionbroker-addmission-fails-if-the-argument-is-a-number" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withMissionBroker():addMission() fails if the argument is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
ShipTemplateBased:withMissionBroker(station)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() station:addMission(<span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withmissionbroker-addmission-fails-if-the-mission-is-not-a-brokermission" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withMissionBroker():addMission() fails if the mission is not a brokerMission
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
ShipTemplateBased:withMissionBroker(station)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() station:addMission(missionMock()) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="shiptemplatebased-withmissionbroker-getmissions">ShipTemplateBased:withMissionBroker():getMissions()</h3>
<div id="shiptemplatebased-withmissionbroker-getmissions-returns-an-empty-table-if-no-missions-where-added" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withMissionBroker():getMissions() returns an empty table if no missions where added
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
ShipTemplateBased:withMissionBroker(station)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, Util.size(station:getMissions()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withmissionbroker-getmissions-returns-any-missions-added-via-withmissionbroker-and-addmission" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withMissionBroker():getMissions() returns any missions added via withMissionBroker() and addMission()
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">mission1</span> = missionWithBrokerMock()
<span class="keyword">local</span> <span class="local-variable">mission2</span> = missionWithBrokerMock()
ShipTemplateBased:withMissionBroker(station, <span class="map"><span class="delimiter">{</span><span class="key">missions</span> = <span class="map"><span class="inline-delimiter">{</span>mission1<span class="inline-delimiter">}</span></span><span class="delimiter">}</span></span>)
station:addMission(mission2)

<span class="keyword">local</span> <span class="local-variable">mission1Found</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">mission2Found</span> = <span class="predefined-constant">false</span>

<span class="keyword">for</span> _, mission <span class="keyword">in</span> <span class="predefined">pairs</span>(station:getMissions()) <span class="keyword">do</span>
    <span class="keyword">if</span> mission == mission1 <span class="keyword">then</span> mission1Found = <span class="predefined-constant">true</span> <span class="keyword">end</span>
    <span class="keyword">if</span> mission == mission2 <span class="keyword">then</span> mission2Found = <span class="predefined-constant">true</span> <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="predefined">assert</span>.is_true(mission1Found)
<span class="predefined">assert</span>.is_true(mission2Found)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withmissionbroker-getmissions-should-not-allow-to-manipulate-the-mission-table" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withMissionBroker():getMissions() should not allow to manipulate the mission table
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">mission1</span> = missionWithBrokerMock()
<span class="keyword">local</span> <span class="local-variable">mission2</span> = missionWithBrokerMock()
ShipTemplateBased:withMissionBroker(station, <span class="map"><span class="delimiter">{</span><span class="key">missions</span> = <span class="map"><span class="inline-delimiter">{</span>mission1<span class="inline-delimiter">}</span></span><span class="delimiter">}</span></span>)

table.insert(station:getMissions(), mission2)

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, Util.size(station:getMissions()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="shiptemplatebased-withmissionbroker-hasmissions">ShipTemplateBased:withMissionBroker():hasMissions()</h3>
<div id="shiptemplatebased-withmissionbroker-hasmissions-returns-false-if-no-missions-where-added" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withMissionBroker():hasMissions() returns false if no missions where added
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
ShipTemplateBased:withMissionBroker(station)

<span class="predefined">assert</span>.is_false(station:hasMissions())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withmissionbroker-hasmissions-returns-true-if-a-mission-has-been-added-via-addmission" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withMissionBroker():hasMissions() returns true if a mission has been added via addMission()
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">mission</span> = missionWithBrokerMock()
ShipTemplateBased:withMissionBroker(station)
station:addMission(mission)

<span class="predefined">assert</span>.is_true(station:hasMissions())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withmissionbroker-hasmissions-returns-true-if-a-mission-has-been-added-via-withmissionbroker" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withMissionBroker():hasMissions() returns true if a mission has been added via withMissionBroker()
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">mission</span> = missionWithBrokerMock()
ShipTemplateBased:withMissionBroker(station, <span class="map"><span class="delimiter">{</span><span class="key">missions</span> = <span class="map"><span class="inline-delimiter">{</span>mission<span class="inline-delimiter">}</span></span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_true(station:hasMissions())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="shiptemplatebased-withmissionbroker-removemission">ShipTemplateBased:withMissionBroker():removeMission()</h3>
<div id="shiptemplatebased-withmissionbroker-removemission-allows-to-remove-a-mission-by-its-id" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withMissionBroker():removeMission() allows to remove a mission by its id
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">mission</span> = missionWithBrokerMock()
ShipTemplateBased:withMissionBroker(station, <span class="map"><span class="delimiter">{</span><span class="key">missions</span> = <span class="map"><span class="inline-delimiter">{</span>mission<span class="inline-delimiter">}</span></span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, Util.size(station:getMissions()))
station:removeMission(mission:getId())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, Util.size(station:getMissions()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withmissionbroker-removemission-allows-to-remove-a-mission-object" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withMissionBroker():removeMission() allows to remove a mission object
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">mission</span> = missionWithBrokerMock()
ShipTemplateBased:withMissionBroker(station, <span class="map"><span class="delimiter">{</span><span class="key">missions</span> = <span class="map"><span class="inline-delimiter">{</span>mission<span class="inline-delimiter">}</span></span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, Util.size(station:getMissions()))
station:removeMission(mission)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, Util.size(station:getMissions()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withmissionbroker-removemission-fails-if-the-argument-is-a-number" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withMissionBroker():removeMission() fails if the argument is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
ShipTemplateBased:withMissionBroker(station)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() station:removeMission(<span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withmissionbroker-removemission-fails-silently-if-the-mission-is-unknown" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withMissionBroker():removeMission() fails silently if the mission is unknown
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">mission1</span> = missionWithBrokerMock()
<span class="keyword">local</span> <span class="local-variable">mission2</span> = missionWithBrokerMock()
ShipTemplateBased:withMissionBroker(station, <span class="map"><span class="delimiter">{</span><span class="key">missions</span>=<span class="map"><span class="inline-delimiter">{</span>mission1<span class="inline-delimiter">}</span></span><span class="delimiter">}</span></span>)

station:removeMission(mission2)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, Util.size(station:getMissions()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="shiptemplatebased-withstoragerooms">ShipTemplateBased:withStorageRooms()</h3>
<div id="shiptemplatebased-withstoragerooms-canstoreproduct-should-return-false-if-the-product-was-not-configured" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withStorageRooms() canStoreProduct should return false if the product was not configured
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_false(station:canStoreProduct(Product:new(<span class="string"><span class="delimiter">&quot;</span><span class="content">Test Mock</span><span class="delimiter">&quot;</span></span>, <span class="map"><span class="delimiter">{</span><span class="key">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>)))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withstoragerooms-canstoreproduct-should-return-true-if-the-product-was-configured" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withStorageRooms() canStoreProduct should return true if the product was configured
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_true(station:canStoreProduct(product))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withstoragerooms-causes-hasstorage-to-be-true" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withStorageRooms() causes hasStorage() to be true
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_true(Ship:hasStorage(station))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withstoragerooms-it-keeps-constraints-on-the-storage-capacity-without-raising-an-error" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withStorageRooms() it keeps constraints on the storage capacity without raising an error
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">station:modifyProductStorage(product, <span class="integer">-9999</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, station:getProductStorage(product))

station:modifyProductStorage(product, <span class="integer">9999</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1000</span>, station:getProductStorage(product))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withstoragerooms-remembers-which-products-where-stored" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withStorageRooms() remembers which products where stored
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">station:modifyProductStorage(product, <span class="integer">100</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, station:getProductStorage(product))

station:modifyProductStorage(product, <span class="integer">42</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">142</span>, station:getProductStorage(product))

station:modifyProductStorage(product, <span class="integer">-100</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">42</span>, station:getProductStorage(product))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="shiptemplatebased-withupgradebroker">ShipTemplateBased:withUpgradeBroker()</h3>
<div id="shiptemplatebased-withupgradebroker-allows-to-set-upgrades" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withUpgradeBroker() allows to set upgrades
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

ShipTemplateBased:withUpgradeBroker(station, <span class="map"><span class="delimiter">{</span><span class="key">upgrades</span> = <span class="map"><span class="inline-delimiter">{</span>upgradeMock(), upgradeMock(), upgradeMock()<span class="inline-delimiter">}</span></span><span class="delimiter">}</span></span>)
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, Util.size(station:getUpgrades()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withupgradebroker-causes-hasupgradebroker-to-be-true" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withUpgradeBroker() causes hasUpgradeBroker() to be true
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
ShipTemplateBased:withUpgradeBroker(station)

<span class="predefined">assert</span>.is_true(ShipTemplateBased:hasUpgradeBroker(station))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withupgradebroker-fails-if-any-of-the-upgrades-is-not-a-upgrade-with-broker" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withUpgradeBroker() fails if any of the upgrades is not a upgrade with broker
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() ShipTemplateBased:withUpgradeBroker(station, <span class="map"><span class="delimiter">{</span><span class="key">upgrades</span> = <span class="map"><span class="inline-delimiter">{</span>upgradeMock<span class="inline-delimiter">}</span></span><span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withupgradebroker-fails-if-first-argument-is-already-a-spaceobject-with-broker" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withUpgradeBroker() fails if first argument is already a SpaceObject with broker
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
ShipTemplateBased:withUpgradeBroker(station)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() ShipTemplateBased:withUpgradeBroker(station) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withupgradebroker-fails-if-first-argument-is-not-a-spaceobject" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withUpgradeBroker() fails if first argument is not a SpaceObject
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() ShipTemplateBased:withUpgradeBroker(<span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withupgradebroker-fails-if-second-argument-is-not-a-table" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withUpgradeBroker() fails if second argument is not a table
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() ShipTemplateBased:withUpgradeBroker(station, <span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withupgradebroker-fails-if-upgrades-is-a-number" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withUpgradeBroker() fails if upgrades is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() ShipTemplateBased:withUpgradeBroker(station, <span class="map"><span class="delimiter">{</span><span class="key">upgrades</span> = <span class="integer">42</span><span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="shiptemplatebased-withupgradebroker-addupgrade">ShipTemplateBased:withUpgradeBroker():addUpgrade()</h3>
<div id="shiptemplatebased-withupgradebroker-addupgrade-allows-to-add-upgrades" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withUpgradeBroker():addUpgrade() allows to add upgrades
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
ShipTemplateBased:withUpgradeBroker(station)

station:addUpgrade(upgradeMock())
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, Util.size(station:getUpgrades()))
station:addUpgrade(upgradeMock())
<span class="predefined">assert</span>.is_same(<span class="integer">2</span>, Util.size(station:getUpgrades()))
station:addUpgrade(upgradeMock())
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, Util.size(station:getUpgrades()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withupgradebroker-addupgrade-fails-if-the-argument-is-a-number" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withUpgradeBroker():addUpgrade() fails if the argument is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
ShipTemplateBased:withUpgradeBroker(station)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() station:addUpgrade(<span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="shiptemplatebased-withupgradebroker-getupgrades">ShipTemplateBased:withUpgradeBroker():getUpgrades()</h3>
<div id="shiptemplatebased-withupgradebroker-getupgrades-returns-an-empty-table-if-no-upgrades-where-added" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withUpgradeBroker():getUpgrades() returns an empty table if no upgrades where added
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
ShipTemplateBased:withUpgradeBroker(station)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, Util.size(station:getUpgrades()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withupgradebroker-getupgrades-returns-any-upgrades-added-via-withupgradebroker-and-addupgrade" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withUpgradeBroker():getUpgrades() returns any upgrades added via withUpgradeBroker() and addUpgrade()
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">upgrade1</span> = upgradeMock()
<span class="keyword">local</span> <span class="local-variable">upgrade2</span> = upgradeMock()
ShipTemplateBased:withUpgradeBroker(station, <span class="map"><span class="delimiter">{</span><span class="key">upgrades</span> = <span class="map"><span class="inline-delimiter">{</span>upgrade1<span class="inline-delimiter">}</span></span><span class="delimiter">}</span></span>)
station:addUpgrade(upgrade2)

<span class="keyword">local</span> <span class="local-variable">upgrade1Found</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">upgrade2Found</span> = <span class="predefined-constant">false</span>

<span class="keyword">for</span> _, upgrade <span class="keyword">in</span> <span class="predefined">pairs</span>(station:getUpgrades()) <span class="keyword">do</span>
    <span class="keyword">if</span> upgrade == upgrade1 <span class="keyword">then</span> upgrade1Found = <span class="predefined-constant">true</span> <span class="keyword">end</span>
    <span class="keyword">if</span> upgrade == upgrade2 <span class="keyword">then</span> upgrade2Found = <span class="predefined-constant">true</span> <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="predefined">assert</span>.is_true(upgrade1Found)
<span class="predefined">assert</span>.is_true(upgrade2Found)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withupgradebroker-getupgrades-should-not-allow-to-manipulate-the-upgrade-table" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withUpgradeBroker():getUpgrades() should not allow to manipulate the upgrade table
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">upgrade1</span> = upgradeMock()
<span class="keyword">local</span> <span class="local-variable">upgrade2</span> = upgradeMock()
ShipTemplateBased:withUpgradeBroker(station, <span class="map"><span class="delimiter">{</span><span class="key">upgrades</span> = <span class="map"><span class="inline-delimiter">{</span>upgrade1<span class="inline-delimiter">}</span></span><span class="delimiter">}</span></span>)

table.insert(station:getUpgrades(), upgrade2)

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, Util.size(station:getUpgrades()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="shiptemplatebased-withupgradebroker-hasupgrade">ShipTemplateBased:withUpgradeBroker():hasUpgrade()</h3>
<div id="shiptemplatebased-withupgradebroker-hasupgrade-raises-an-error-on-invalid-arguments" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withUpgradeBroker():hasUpgrade() raises an error on invalid arguments
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock()
ShipTemplateBased:withUpgradeBroker(station, <span class="map"><span class="delimiter">{</span><span class="key">upgrades</span> = <span class="map"><span class="inline-delimiter">{</span>upgrade<span class="inline-delimiter">}</span></span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() station:hasUpgrade(<span class="integer">42</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() station:hasUpgrade(SpaceStation()) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() station:hasUpgrade(<span class="predefined-constant">nil</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withupgradebroker-hasupgrade-returns-false-if-no-upgrades-where-added" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withUpgradeBroker():hasUpgrade() returns false if no upgrades where added
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
ShipTemplateBased:withUpgradeBroker(station)
<span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock()

<span class="predefined">assert</span>.is_false(station:hasUpgrade(upgrade))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withupgradebroker-hasupgrade-returns-true-if-a-upgrade-has-been-added-via-addupgrade" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withUpgradeBroker():hasUpgrade() returns true if a upgrade has been added via addUpgrade()
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock()
ShipTemplateBased:withUpgradeBroker(station)
station:addUpgrade(upgrade)

<span class="predefined">assert</span>.is_true(station:hasUpgrade(upgrade))
<span class="predefined">assert</span>.is_true(station:hasUpgrade(upgrade:getId()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withupgradebroker-hasupgrade-returns-true-if-a-upgrade-has-been-added-via-withupgradebroker" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withUpgradeBroker():hasUpgrade() returns true if a upgrade has been added via withUpgradeBroker()
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock()
ShipTemplateBased:withUpgradeBroker(station, <span class="map"><span class="delimiter">{</span><span class="key">upgrades</span> = <span class="map"><span class="inline-delimiter">{</span>upgrade<span class="inline-delimiter">}</span></span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_true(station:hasUpgrade(upgrade))
<span class="predefined">assert</span>.is_true(station:hasUpgrade(upgrade:getId()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="shiptemplatebased-withupgradebroker-hasupgrades">ShipTemplateBased:withUpgradeBroker():hasUpgrades()</h3>
<div id="shiptemplatebased-withupgradebroker-hasupgrades-returns-false-if-no-upgrades-where-added" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withUpgradeBroker():hasUpgrades() returns false if no upgrades where added
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
ShipTemplateBased:withUpgradeBroker(station)

<span class="predefined">assert</span>.is_false(station:hasUpgrades())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withupgradebroker-hasupgrades-returns-true-if-a-upgrade-has-been-added-via-addupgrade" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withUpgradeBroker():hasUpgrades() returns true if a upgrade has been added via addUpgrade()
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock()
ShipTemplateBased:withUpgradeBroker(station)
station:addUpgrade(upgrade)

<span class="predefined">assert</span>.is_true(station:hasUpgrades())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withupgradebroker-hasupgrades-returns-true-if-a-upgrade-has-been-added-via-withupgradebroker" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withUpgradeBroker():hasUpgrades() returns true if a upgrade has been added via withUpgradeBroker()
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock()
ShipTemplateBased:withUpgradeBroker(station, <span class="map"><span class="delimiter">{</span><span class="key">upgrades</span> = <span class="map"><span class="inline-delimiter">{</span>upgrade<span class="inline-delimiter">}</span></span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_true(station:hasUpgrades())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="shiptemplatebased-withupgradebroker-removeupgrade">ShipTemplateBased:withUpgradeBroker():removeUpgrade()</h3>
<div id="shiptemplatebased-withupgradebroker-removeupgrade-allows-to-remove-a-upgrade-by-its-id" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withUpgradeBroker():removeUpgrade() allows to remove a upgrade by its id
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock()
ShipTemplateBased:withUpgradeBroker(station, <span class="map"><span class="delimiter">{</span><span class="key">upgrades</span> = <span class="map"><span class="inline-delimiter">{</span>upgrade<span class="inline-delimiter">}</span></span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, Util.size(station:getUpgrades()))
station:removeUpgrade(upgrade:getId())
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, Util.size(station:getUpgrades()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withupgradebroker-removeupgrade-allows-to-remove-a-upgrade-object" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withUpgradeBroker():removeUpgrade() allows to remove a upgrade object
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">upgrade</span> = upgradeMock()
ShipTemplateBased:withUpgradeBroker(station, <span class="map"><span class="delimiter">{</span><span class="key">upgrades</span> = <span class="map"><span class="inline-delimiter">{</span>upgrade<span class="inline-delimiter">}</span></span><span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, Util.size(station:getUpgrades()))
station:removeUpgrade(upgrade)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, Util.size(station:getUpgrades()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withupgradebroker-removeupgrade-fails-if-the-argument-is-a-number" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withUpgradeBroker():removeUpgrade() fails if the argument is a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
ShipTemplateBased:withUpgradeBroker(station)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() station:removeUpgrade(<span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="shiptemplatebased-withupgradebroker-removeupgrade-fails-silently-if-the-upgrade-is-unknown" class="paragraph">
<p> <details><summary> 
ShipTemplateBased:withUpgradeBroker():removeUpgrade() fails silently if the upgrade is unknown
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">upgrade1</span> = upgradeMock()
<span class="keyword">local</span> <span class="local-variable">upgrade2</span> = upgradeMock()
ShipTemplateBased:withUpgradeBroker(station, <span class="map"><span class="delimiter">{</span><span class="key">upgrades</span>=<span class="map"><span class="inline-delimiter">{</span>upgrade1<span class="inline-delimiter">}</span></span><span class="delimiter">}</span></span>)

station:removeUpgrade(upgrade2)
<span class="predefined">assert</span>.is_same(<span class="integer">1</span>, Util.size(station:getUpgrades()))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="station">Station</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="station-withmerchant">Station:withMerchant()</h3>
<div id="station-withmerchant-can-use-a-function-for-the-buying-price" class="paragraph">
<p> <details><summary> 
Station:withMerchant() can use a function for the buying price
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Station:withStorageRooms(station, <span class="map"><span class="delimiter">{</span>
    [product] = <span class="integer">1000</span>
<span class="delimiter">}</span></span>)
Station:withMerchant(station, <span class="map"><span class="delimiter">{</span>
    [product] = <span class="map"><span class="inline-delimiter">{</span> <span class="key">buyingPrice</span> = <span class="keyword">function</span>(self) <span class="keyword">return</span> <span class="integer">42</span> <span class="keyword">end</span> <span class="inline-delimiter">}</span></span>
<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(<span class="integer">42</span>, station:getProductBuyingPrice(product))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-can-use-a-function-for-the-selling-price" class="paragraph">
<p> <details><summary> 
Station:withMerchant() can use a function for the selling price
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Station:withStorageRooms(station, <span class="map"><span class="delimiter">{</span>
    [product] = <span class="integer">1000</span>
<span class="delimiter">}</span></span>)
Station:withMerchant(station, <span class="map"><span class="delimiter">{</span>
    [product] = <span class="map"><span class="inline-delimiter">{</span> <span class="key">sellingPrice</span> = <span class="keyword">function</span>(self) <span class="keyword">return</span> <span class="integer">42</span> <span class="keyword">end</span> <span class="inline-delimiter">}</span></span>
<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(<span class="integer">42</span>, station:getProductSellingPrice(product))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-does-not-buy-above-the-buyinglimit" class="paragraph">
<p> <details><summary> 
Station:withMerchant() does not buy above the buyingLimit
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Station:withStorageRooms(station, <span class="map"><span class="delimiter">{</span>
    [product] = <span class="integer">1000</span>
<span class="delimiter">}</span></span>)
Station:withMerchant(station, <span class="map"><span class="delimiter">{</span>
    [product] = <span class="map"><span class="inline-delimiter">{</span> <span class="key">buyingPrice</span> = <span class="integer">42</span>, <span class="key">buyingLimit</span> = <span class="integer">100</span> <span class="inline-delimiter">}</span></span>
<span class="delimiter">}</span></span>)

station:modifyProductStorage(product, <span class="integer">-9999</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, station:getMaxProductBuying(product))

station:modifyProductStorage(product, <span class="integer">30</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">70</span>, station:getMaxProductBuying(product))

station:modifyProductStorage(product, <span class="integer">670</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, station:getMaxProductBuying(product))

station:modifyProductStorage(product, <span class="integer">300</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, station:getMaxProductBuying(product))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-does-not-sell-below-the-sellinglimit" class="paragraph">
<p> <details><summary> 
Station:withMerchant() does not sell below the sellingLimit
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Station:withStorageRooms(station, <span class="map"><span class="delimiter">{</span>
    [product] = <span class="integer">1000</span>
<span class="delimiter">}</span></span>)
Station:withMerchant(station, <span class="map"><span class="delimiter">{</span>
    [product] = <span class="map"><span class="inline-delimiter">{</span> <span class="key">sellingPrice</span> = <span class="integer">42</span>, <span class="key">sellingLimit</span> = <span class="integer">100</span> <span class="inline-delimiter">}</span></span>
<span class="delimiter">}</span></span>)

station:modifyProductStorage(product, <span class="integer">-9999</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, station:getMaxProductSelling(product))

station:modifyProductStorage(product, <span class="integer">30</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, station:getMaxProductSelling(product))

station:modifyProductStorage(product, <span class="integer">670</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">600</span>, station:getMaxProductSelling(product))

station:modifyProductStorage(product, <span class="integer">300</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">900</span>, station:getMaxProductSelling(product))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-player-dependent-offers-getmaxproductbuying-filters-products" class="paragraph">
<p> <details><summary> 
Station:withMerchant() player-dependent offers getMaxProductBuying() filters products
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.not_nil(stationBuying:getMaxProductBuying(productForFriends, friendlyPlayer))
<span class="predefined">assert</span>.is_nil(stationBuying:getMaxProductBuying(productForFriends, neutralPlayer))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-player-dependent-offers-getmaxproductselling-filters-products" class="paragraph">
<p> <details><summary> 
Station:withMerchant() player-dependent offers getMaxProductSelling() filters products
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.not_nil(stationSelling:getMaxProductSelling(productForFriends, friendlyPlayer))
<span class="predefined">assert</span>.is_nil(stationSelling:getMaxProductSelling(productForFriends, neutralPlayer))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-player-dependent-offers-getproductbuyingprice-filters-products" class="paragraph">
<p> <details><summary> 
Station:withMerchant() player-dependent offers getProductBuyingPrice() filters products
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(<span class="integer">42</span>, stationBuying:getProductBuyingPrice(productForFriends, friendlyPlayer))
<span class="predefined">assert</span>.is_nil(stationBuying:getProductBuyingPrice(productForFriends, neutralPlayer))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-player-dependent-offers-getproductsellingprice-filters-products" class="paragraph">
<p> <details><summary> 
Station:withMerchant() player-dependent offers getProductSellingPrice() filters products
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(<span class="integer">42</span>, stationSelling:getProductSellingPrice(productForFriends, friendlyPlayer))
<span class="predefined">assert</span>.is_nil(stationSelling:getProductSellingPrice(productForFriends, neutralPlayer))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-player-dependent-offers-getproductsbought-filters-products" class="paragraph">
<p> <details><summary> 
Station:withMerchant() player-dependent offers getProductsBought() filters products
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.contains_value(productForFriends, stationBuying:getProductsBought(friendlyPlayer))
<span class="predefined">assert</span>.not_contains_value(productForFriends, stationBuying:getProductsBought(neutralPlayer))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-player-dependent-offers-getproductssold-filters-products" class="paragraph">
<p> <details><summary> 
Station:withMerchant() player-dependent offers getProductsSold() filters products
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.contains_value(productForFriends, stationSelling:getProductsSold(friendlyPlayer))
<span class="predefined">assert</span>.not_contains_value(productForFriends, stationSelling:getProductsSold(neutralPlayer))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-player-dependent-offers-isbuyingproduct-filters-products" class="paragraph">
<p> <details><summary> 
Station:withMerchant() player-dependent offers isBuyingProduct() filters products
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_true(stationBuying:isBuyingProduct(productForFriends, friendlyPlayer))
<span class="predefined">assert</span>.is_false(stationBuying:isBuyingProduct(productForFriends, neutralPlayer))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-player-dependent-offers-issellingproduct-filters-products" class="paragraph">
<p> <details><summary> 
Station:withMerchant() player-dependent offers isSellingProduct() filters products
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_true(stationSelling:isSellingProduct(productForFriends, friendlyPlayer))
<span class="predefined">assert</span>.is_false(stationSelling:isSellingProduct(productForFriends, neutralPlayer))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-throws-an-error-if-neither-buying-nor-selling-price-is-set" class="paragraph">
<p> <details><summary> 
Station:withMerchant() throws an error if neither buying nor selling price is set
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Station:withStorageRooms(station, <span class="map"><span class="delimiter">{</span>
    [product] = <span class="integer">1000</span>
<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Station:withMerchant(station, <span class="map"><span class="delimiter">{</span>
        [product] = <span class="map"><span class="inline-delimiter">{</span><span class="inline-delimiter">}</span></span>
    <span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-when-configuring-a-bought-and-sold-product-causes-hasmerchant-to-be-true" class="paragraph">
<p> <details><summary> 
Station:withMerchant() when configuring a bought and sold product causes hasMerchant() to be true
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_true(Station:hasMerchant(station))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-when-configuring-a-bought-and-sold-product-causes-isbuyingproduct-to-be-true" class="paragraph">
<p> <details><summary> 
Station:withMerchant() when configuring a bought and sold product causes isBuyingProduct() to be true
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_true(station:isBuyingProduct(product))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-when-configuring-a-bought-and-sold-product-causes-issellingproduct-to-be-true" class="paragraph">
<p> <details><summary> 
Station:withMerchant() when configuring a bought and sold product causes isSellingProduct() to be true
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_true(station:isSellingProduct(product))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-when-configuring-a-bought-and-sold-product-does-not-buy-above-the-maxstorage" class="paragraph">
<p> <details><summary> 
Station:withMerchant() when configuring a bought and sold product does not buy above the maxStorage
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">station:modifyProductStorage(product, <span class="integer">-9999</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1000</span>, station:getMaxProductBuying(product))

station:modifyProductStorage(product, <span class="integer">300</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">700</span>, station:getMaxProductBuying(product))

station:modifyProductStorage(product, <span class="integer">700</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, station:getMaxProductBuying(product))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-when-configuring-a-bought-and-sold-product-does-not-sell-below-0" class="paragraph">
<p> <details><summary> 
Station:withMerchant() when configuring a bought and sold product does not sell below 0
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">station:modifyProductStorage(product, <span class="integer">-9999</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, station:getMaxProductSelling(product))

station:modifyProductStorage(product, <span class="integer">300</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">300</span>, station:getMaxProductSelling(product))

station:modifyProductStorage(product, <span class="integer">700</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1000</span>, station:getMaxProductSelling(product))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-when-configuring-a-bought-and-sold-product-returns-a-list-of-bought-products" class="paragraph">
<p> <details><summary> 
Station:withMerchant() when configuring a bought and sold product returns a list of bought products
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span>[product:getId()] = product<span class="delimiter">}</span></span>, station:getProductsBought(product))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-when-configuring-a-bought-and-sold-product-returns-a-list-of-sold-products" class="paragraph">
<p> <details><summary> 
Station:withMerchant() when configuring a bought and sold product returns a list of sold products
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span>[product:getId()] = product<span class="delimiter">}</span></span>, station:getProductsSold(product))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-when-configuring-a-bought-and-sold-product-returns-the-correct-buying-price" class="paragraph">
<p> <details><summary> 
Station:withMerchant() when configuring a bought and sold product returns the correct buying price
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(<span class="integer">21</span>, station:getProductBuyingPrice(product))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-when-configuring-a-bought-and-sold-product-returns-the-correct-selling-price" class="paragraph">
<p> <details><summary> 
Station:withMerchant() when configuring a bought and sold product returns the correct selling price
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(<span class="integer">42</span>, station:getProductSellingPrice(product))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-when-configuring-a-bought-product-causes-hasmerchant-to-be-true" class="paragraph">
<p> <details><summary> 
Station:withMerchant() when configuring a bought product causes hasMerchant() to be true
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_true(Station:hasMerchant(station))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-when-configuring-a-bought-product-causes-isbuyingproduct-to-be-true" class="paragraph">
<p> <details><summary> 
Station:withMerchant() when configuring a bought product causes isBuyingProduct() to be true
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_true(station:isBuyingProduct(product))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-when-configuring-a-bought-product-causes-issellingproduct-to-be-false" class="paragraph">
<p> <details><summary> 
Station:withMerchant() when configuring a bought product causes isSellingProduct() to be false
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_false(station:isSellingProduct(product))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-when-configuring-a-bought-product-does-not-buy-above-the-maxstorage" class="paragraph">
<p> <details><summary> 
Station:withMerchant() when configuring a bought product does not buy above the maxStorage
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">station:modifyProductStorage(product, <span class="integer">-9999</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1000</span>, station:getMaxProductBuying(product))

station:modifyProductStorage(product, <span class="integer">300</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">700</span>, station:getMaxProductBuying(product))

station:modifyProductStorage(product, <span class="integer">700</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, station:getMaxProductBuying(product))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-when-configuring-a-bought-product-returns-a-list-of-bought-products" class="paragraph">
<p> <details><summary> 
Station:withMerchant() when configuring a bought product returns a list of bought products
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span>[product:getId()] = product<span class="delimiter">}</span></span>, station:getProductsBought(product))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-when-configuring-a-bought-product-returns-an-empty-list-of-sold-products" class="paragraph">
<p> <details><summary> 
Station:withMerchant() when configuring a bought product returns an empty list of sold products
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>, station:getProductsSold(product))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-when-configuring-a-bought-product-returns-nil-for-getmaxproductselling" class="paragraph">
<p> <details><summary> 
Station:withMerchant() when configuring a bought product returns nil for getMaxProductSelling
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_nil(station:getMaxProductSelling(product))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-when-configuring-a-bought-product-returns-no-sellingprice" class="paragraph">
<p> <details><summary> 
Station:withMerchant() when configuring a bought product returns no sellingPrice
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_nil(station:getProductSellingPrice(product))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-when-configuring-a-bought-product-returns-the-correct-buying-price" class="paragraph">
<p> <details><summary> 
Station:withMerchant() when configuring a bought product returns the correct buying price
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(<span class="integer">42</span>, station:getProductBuyingPrice(product))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-when-configuring-a-sold-product-causes-hasmerchant-to-be-true" class="paragraph">
<p> <details><summary> 
Station:withMerchant() when configuring a sold product causes hasMerchant() to be true
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_true(Station:hasMerchant(station))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-when-configuring-a-sold-product-causes-isbuyingproduct-to-be-false" class="paragraph">
<p> <details><summary> 
Station:withMerchant() when configuring a sold product causes isBuyingProduct() to be false
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_false(station:isBuyingProduct(product))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-when-configuring-a-sold-product-causes-issellingproduct-to-be-true" class="paragraph">
<p> <details><summary> 
Station:withMerchant() when configuring a sold product causes isSellingProduct() to be true
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_true(station:isSellingProduct(product))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-when-configuring-a-sold-product-does-not-sell-below-0" class="paragraph">
<p> <details><summary> 
Station:withMerchant() when configuring a sold product does not sell below 0
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">station:modifyProductStorage(product, <span class="integer">-9999</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, station:getMaxProductSelling(product))

station:modifyProductStorage(product, <span class="integer">300</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">300</span>, station:getMaxProductSelling(product))

station:modifyProductStorage(product, <span class="integer">700</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1000</span>, station:getMaxProductSelling(product))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-when-configuring-a-sold-product-returns-a-list-of-sold-products" class="paragraph">
<p> <details><summary> 
Station:withMerchant() when configuring a sold product returns a list of sold products
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span>[product:getId()] = product<span class="delimiter">}</span></span>, station:getProductsSold(product))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-when-configuring-a-sold-product-returns-an-empty-list-of-bought-products" class="paragraph">
<p> <details><summary> 
Station:withMerchant() when configuring a sold product returns an empty list of bought products
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>, station:getProductsBought(product))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-when-configuring-a-sold-product-returns-nil-for-getmaxproductbuying" class="paragraph">
<p> <details><summary> 
Station:withMerchant() when configuring a sold product returns nil for getMaxProductBuying
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_nil(station:getMaxProductBuying(product))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-when-configuring-a-sold-product-returns-no-buyingprice" class="paragraph">
<p> <details><summary> 
Station:withMerchant() when configuring a sold product returns no buyingPrice
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_nil(station:getProductBuyingPrice(product))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withmerchant-when-configuring-a-sold-product-returns-the-correct-selling-price" class="paragraph">
<p> <details><summary> 
Station:withMerchant() when configuring a sold product returns the correct selling price
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(<span class="integer">42</span>, station:getProductSellingPrice(product))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="station-withproduction">Station:withProduction()</h3>
<div id="station-withproduction-does-not-produce-if-any-of-the-consumed-products-is-not-available" class="paragraph">
<p> <details><summary> 
Station:withProduction() does not produce if any of the consumed products is not available
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Station:withStorageRooms(station, <span class="map"><span class="delimiter">{</span>
    [power] = <span class="integer">1000</span>,
    [ore] = <span class="integer">1000</span>,
    [glue] = <span class="integer">1000</span>,
    [herring] = <span class="integer">1000</span>,
<span class="delimiter">}</span></span>)
Station:withProduction(station, <span class="map"><span class="delimiter">{</span>
    <span class="map"><span class="inline-delimiter">{</span>
        <span class="key">productionTime</span> = <span class="integer">1</span>,
        <span class="key">produces</span> = <span class="map"><span class="inline-delimiter">{</span>
            <span class="map"><span class="inline-delimiter">{</span> <span class="key">product</span> = herring, <span class="key">amount</span> = <span class="integer">5</span> <span class="inline-delimiter">}</span></span>,
        <span class="inline-delimiter">}</span></span>,
        <span class="key">consumes</span> = <span class="map"><span class="inline-delimiter">{</span>
            <span class="map"><span class="inline-delimiter">{</span> <span class="key">product</span> = power, <span class="key">amount</span> = <span class="integer">10</span> <span class="inline-delimiter">}</span></span>,
            <span class="map"><span class="inline-delimiter">{</span> <span class="key">product</span> = ore, <span class="key">amount</span> = <span class="integer">10</span> <span class="inline-delimiter">}</span></span>,
            <span class="map"><span class="inline-delimiter">{</span> <span class="key">product</span> = glue, <span class="key">amount</span> = <span class="integer">10</span> <span class="inline-delimiter">}</span></span>,
        <span class="inline-delimiter">}</span></span>
    <span class="inline-delimiter">}</span></span>
<span class="delimiter">}</span></span>)
station:modifyProductStorage(power, <span class="integer">100</span>)
station:modifyProductStorage(ore, <span class="integer">5</span>)
station:modifyProductStorage(glue, <span class="integer">100</span>)

Cron.tick(<span class="integer">5</span>)
Cron.tick(<span class="integer">5</span>)
Cron.tick(<span class="integer">5</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, station:getProductStorage(power))
<span class="predefined">assert</span>.is_same(<span class="integer">5</span>, station:getProductStorage(ore))
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, station:getProductStorage(glue))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, station:getProductStorage(herring))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withproduction-does-not-produce-if-there-is-no-storage-space-for-products-left" class="paragraph">
<p> <details><summary> 
Station:withProduction() does not produce if there is no storage space for products left
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Station:withStorageRooms(station, <span class="map"><span class="delimiter">{</span>
    [power] = <span class="integer">1000</span>,
    [herring] = <span class="integer">1000</span>,
<span class="delimiter">}</span></span>)
Station:withProduction(station, <span class="map"><span class="delimiter">{</span>
    <span class="map"><span class="inline-delimiter">{</span>
        <span class="key">productionTime</span> = <span class="integer">1</span>,
        <span class="key">produces</span> = <span class="map"><span class="inline-delimiter">{</span>
            <span class="map"><span class="inline-delimiter">{</span> <span class="key">product</span> = herring, <span class="key">amount</span> = <span class="integer">5</span> <span class="inline-delimiter">}</span></span>,
        <span class="inline-delimiter">}</span></span>,
        <span class="key">consumes</span> = <span class="map"><span class="inline-delimiter">{</span>
            <span class="map"><span class="inline-delimiter">{</span> <span class="key">product</span> = power, <span class="key">amount</span> = <span class="integer">10</span> <span class="inline-delimiter">}</span></span>,
        <span class="inline-delimiter">}</span></span>
    <span class="inline-delimiter">}</span></span>
<span class="delimiter">}</span></span>)
station:modifyProductStorage(power, <span class="integer">1000</span>)
station:modifyProductStorage(herring, <span class="integer">1000</span>)

Cron.tick(<span class="integer">5</span>)
Cron.tick(<span class="integer">5</span>)
Cron.tick(<span class="integer">5</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">1000</span>, station:getProductStorage(power))
<span class="predefined">assert</span>.is_same(<span class="integer">1000</span>, station:getProductStorage(herring))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withproduction-does-produce-as-long-as-there-is-any-space-left" class="paragraph">
<p> <details><summary> 
Station:withProduction() does produce as long as there is any space left
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Station:withStorageRooms(station, <span class="map"><span class="delimiter">{</span>
    [power] = <span class="integer">1000</span>,
    [herring] = <span class="integer">1000</span>,
<span class="delimiter">}</span></span>)
Station:withProduction(station, <span class="map"><span class="delimiter">{</span>
    <span class="map"><span class="inline-delimiter">{</span>
        <span class="key">productionTime</span> = <span class="integer">1</span>,
        <span class="key">produces</span> = <span class="map"><span class="inline-delimiter">{</span>
            <span class="map"><span class="inline-delimiter">{</span> <span class="key">product</span> = herring, <span class="key">amount</span> = <span class="integer">5</span> <span class="inline-delimiter">}</span></span>,
        <span class="inline-delimiter">}</span></span>,
        <span class="key">consumes</span> = <span class="map"><span class="inline-delimiter">{</span>
            <span class="map"><span class="inline-delimiter">{</span> <span class="key">product</span> = power, <span class="key">amount</span> = <span class="integer">10</span> <span class="inline-delimiter">}</span></span>,
        <span class="inline-delimiter">}</span></span>
    <span class="inline-delimiter">}</span></span>
<span class="delimiter">}</span></span>)
station:modifyProductStorage(power, <span class="integer">1000</span>)
station:modifyProductStorage(herring, <span class="integer">999</span>)

Cron.tick(<span class="integer">5</span>)
Cron.tick(<span class="integer">5</span>)
Cron.tick(<span class="integer">5</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">990</span>, station:getProductStorage(power))
<span class="predefined">assert</span>.is_same(<span class="integer">1000</span>, station:getProductStorage(herring))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withproduction-produces-products-in-a-interval" class="paragraph">
<p> <details><summary> 
Station:withProduction() produces products in a interval
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Station:withStorageRooms(station, <span class="map"><span class="delimiter">{</span>
    [power] = <span class="integer">1000</span>,
    [herring] = <span class="integer">1000</span>,
<span class="delimiter">}</span></span>)
Station:withProduction(station, <span class="map"><span class="delimiter">{</span>
    <span class="map"><span class="inline-delimiter">{</span>
        <span class="key">productionTime</span> = <span class="integer">5</span>,
        <span class="key">produces</span> = <span class="map"><span class="inline-delimiter">{</span>
            <span class="map"><span class="inline-delimiter">{</span> <span class="key">product</span> = herring, <span class="key">amount</span> = <span class="integer">5</span> <span class="inline-delimiter">}</span></span>,
        <span class="inline-delimiter">}</span></span>,
        <span class="key">consumes</span> = <span class="map"><span class="inline-delimiter">{</span>
            <span class="map"><span class="inline-delimiter">{</span> <span class="key">product</span> = power, <span class="key">amount</span> = <span class="integer">5</span> <span class="inline-delimiter">}</span></span>,
        <span class="inline-delimiter">}</span></span>
    <span class="inline-delimiter">}</span></span>
<span class="delimiter">}</span></span>)
station:modifyProductStorage(power, <span class="integer">100</span>)

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">100</span>, station:getProductStorage(power))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, station:getProductStorage(herring))
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">95</span>, station:getProductStorage(power))
<span class="predefined">assert</span>.is_same(<span class="integer">5</span>, station:getProductStorage(herring))
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">95</span>, station:getProductStorage(power))
<span class="predefined">assert</span>.is_same(<span class="integer">5</span>, station:getProductStorage(herring))
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">90</span>, station:getProductStorage(power))
<span class="predefined">assert</span>.is_same(<span class="integer">10</span>, station:getProductStorage(herring))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withproduction-produces-with-callbacks" class="paragraph">
<p> <details><summary> 
Station:withProduction() produces with callbacks
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">wasProduced</span> = <span class="predefined-constant">false</span>
Station:withStorageRooms(station, <span class="map"><span class="delimiter">{</span>
    [power] = <span class="integer">1000</span>,
<span class="delimiter">}</span></span>)
Station:withProduction(station, <span class="map"><span class="delimiter">{</span>
    <span class="map"><span class="inline-delimiter">{</span>
        <span class="key">productionTime</span> = <span class="integer">5</span>,
        <span class="key">produces</span> = <span class="keyword">function</span>() <span class="key">wasProduced</span> = <span class="predefined-constant">true</span> <span class="keyword">end</span>,
        <span class="key">consumes</span> = <span class="map"><span class="inline-delimiter">{</span>
            <span class="map"><span class="inline-delimiter">{</span> <span class="key">product</span> = power, <span class="key">amount</span> = <span class="integer">10</span> <span class="inline-delimiter">}</span></span>,
        <span class="inline-delimiter">}</span></span>
    <span class="inline-delimiter">}</span></span>
<span class="delimiter">}</span></span>)
station:modifyProductStorage(power, <span class="integer">1000</span>)

Cron.tick(<span class="integer">5</span>)
<span class="predefined">assert</span>.is_true(wasProduced)
<span class="predefined">assert</span>.is_same(<span class="integer">990</span>, station:getProductStorage(power))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="station-withproduction-stops-producing-if-station-is-destroyed" class="paragraph">
<p> <details><summary> 
Station:withProduction() stops producing if station is destroyed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
<span class="keyword">local</span> <span class="local-variable">wasProduced</span> = <span class="predefined-constant">false</span>
Station:withStorageRooms(station, <span class="map"><span class="delimiter">{</span>
    [herring] = <span class="integer">1000</span>,
<span class="delimiter">}</span></span>)
Station:withProduction(station, <span class="map"><span class="delimiter">{</span>
    <span class="map"><span class="inline-delimiter">{</span>
        <span class="key">productionTime</span> = <span class="integer">1</span>,
        <span class="key">produces</span> = <span class="keyword">function</span>() <span class="key">wasProduced</span> = <span class="predefined-constant">true</span> <span class="keyword">end</span>,
        <span class="key">consumes</span> = <span class="map"><span class="inline-delimiter">{</span>
            <span class="map"><span class="inline-delimiter">{</span> <span class="key">product</span> = herring, <span class="key">amount</span> = <span class="integer">1</span> <span class="inline-delimiter">}</span></span>,
        <span class="inline-delimiter">}</span></span>
    <span class="inline-delimiter">}</span></span>
<span class="delimiter">}</span></span>)
station:modifyProductStorage(herring, <span class="integer">1000</span>)

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)

station:destroy()
wasProduced = <span class="predefined-constant">false</span>

Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)
Cron.tick(<span class="integer">1</span>)

<span class="predefined">assert</span>.is_false(wasProduced)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tools">Tools</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="tools-ensurecomms">Tools:ensureComms()</h3>
<div id="tools-ensurecomms-aborts-when-player-is-destroyed" class="paragraph">
<p> <details><summary> 
Tools:ensureComms() aborts when player is destroyed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Station:withComms(station)
station:setHailText(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">blocker</span> = SpaceStation()
Station:withComms(blocker)
blocker:setHailText(<span class="string"><span class="delimiter">&quot;</span><span class="content">Blocking the connection</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()

player:commandOpenTextComm(blocker)

Tools:ensureComms(station, player)
Cron.tick(<span class="integer">1</span>)
player:destroy()
player:commandCloseTextComm()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_true(player:isCommsInactive())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="tools-ensurecomms-aborts-when-sender-is-destroyed" class="paragraph">
<p> <details><summary> 
Tools:ensureComms() aborts when sender is destroyed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Station:withComms(station)
station:setHailText(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">blocker</span> = SpaceStation()
Station:withComms(blocker)
blocker:setHailText(<span class="string"><span class="delimiter">&quot;</span><span class="content">Blocking the connection</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()

player:commandOpenTextComm(blocker)

Tools:ensureComms(station, player)
Cron.tick(<span class="integer">1</span>)
station:destroy()
player:commandCloseTextComm()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_true(player:isCommsInactive())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="tools-ensurecomms-can-open-a-communication-channel" class="paragraph">
<p> <details><summary> 
Tools:ensureComms() can open a communication channel
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Station:withComms(station)
station:setHailText(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()

Tools:ensureComms(station, player)
<span class="predefined">assert</span>.same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>, player:getCurrentCommsText())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="tools-ensurecomms-can-send-a-plain-message" class="paragraph">
<p> <details><summary> 
Tools:ensureComms() can send a plain message
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Station:withComms(station)
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()

Tools:ensureComms(station, player, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>, player:getCurrentCommsText())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="tools-ensurecomms-fails-if-no-valid-player-is-given" class="paragraph">
<p> <details><summary> 
Tools:ensureComms() fails if no valid player is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Station:withComms(station)
station:setHailText(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Tools:ensureComms(station, <span class="predefined-constant">nil</span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Tools:ensureComms(station, <span class="integer">42</span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Tools:ensureComms(station, CpuShip())
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="tools-ensurecomms-fails-if-no-valid-station-is-given" class="paragraph">
<p> <details><summary> 
Tools:ensureComms() fails if no valid station is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Tools:ensureComms(<span class="predefined-constant">nil</span>, player)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Tools:ensureComms(<span class="integer">42</span>, player)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    <span class="comment">-- does not have comms</span>
    Tools:ensureComms(SpaceStation(), player)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="tools-ensurecomms-fails-if-third-parameter-is-invalid" class="paragraph">
<p> <details><summary> 
Tools:ensureComms() fails if third parameter is invalid
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Station:withComms(station)
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Tools:ensureComms(station, player, <span class="integer">42</span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Tools:ensureComms(station, player, <span class="keyword">function</span>() <span class="keyword">end</span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="tools-ensurecomms-is-send-as-soon-as-the-communication-channel-opens" class="paragraph">
<p> <details><summary> 
Tools:ensureComms() is send as soon as the communication channel opens
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Station:withComms(station)
station:setHailText(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">blocker</span> = SpaceStation()
Station:withComms(blocker)
blocker:setHailText(<span class="string"><span class="delimiter">&quot;</span><span class="content">Blocking the connection</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()

player:commandOpenTextComm(blocker)

Tools:ensureComms(station, player)
<span class="predefined">assert</span>.same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Blocking the connection</span><span class="delimiter">&quot;</span></span>, player:getCurrentCommsText())
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Blocking the connection</span><span class="delimiter">&quot;</span></span>, player:getCurrentCommsText())
player:commandCloseTextComm()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>, player:getCurrentCommsText())
player:commandCloseTextComm()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.is_true(player:isCommsInactive())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="tools-storycomms">Tools:storyComms()</h3>
<div id="tools-storycomms-ends-when-player-is-destroyed" class="paragraph">
<p> <details><summary> 
Tools:storyComms() ends when player is destroyed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">finally(<span class="keyword">function</span>() Tools:endStoryComms() <span class="keyword">end</span>)

<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Station:withComms(station)
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">comms</span> = Comms:newScreen(<span class="string"><span class="delimiter">&quot;</span><span class="content">screen one</span><span class="delimiter">&quot;</span></span>)
comms:addReply(Comms:newReply(<span class="string"><span class="delimiter">&quot;</span><span class="content">reply one</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>()
    Tools:endStoryComms()

    <span class="keyword">return</span> Comms:newScreen(<span class="string"><span class="delimiter">&quot;</span><span class="content">screen two</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>))

Tools:storyComms(station, player, comms)
<span class="predefined">assert</span>.same(<span class="string"><span class="delimiter">&quot;</span><span class="content">screen one</span><span class="delimiter">&quot;</span></span>, player:getCurrentCommsText())

<span class="comment">-- screen one pops up again if comms is closed</span>
player:commandCloseTextComm()
player:destroy()
Cron.tick(<span class="integer">1</span>)

<span class="comment">-- comms stays closed</span>
<span class="predefined">assert</span>.is_true(player:isCommsInactive())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="tools-storycomms-ends-when-station-is-destroyed" class="paragraph">
<p> <details><summary> 
Tools:storyComms() ends when station is destroyed
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">finally(<span class="keyword">function</span>() Tools:endStoryComms() <span class="keyword">end</span>)

<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Station:withComms(station)
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">comms</span> = Comms:newScreen(<span class="string"><span class="delimiter">&quot;</span><span class="content">screen one</span><span class="delimiter">&quot;</span></span>)
comms:addReply(Comms:newReply(<span class="string"><span class="delimiter">&quot;</span><span class="content">reply one</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>()
    Tools:endStoryComms()

    <span class="keyword">return</span> Comms:newScreen(<span class="string"><span class="delimiter">&quot;</span><span class="content">screen two</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>))

Tools:storyComms(station, player, comms)
<span class="predefined">assert</span>.same(<span class="string"><span class="delimiter">&quot;</span><span class="content">screen one</span><span class="delimiter">&quot;</span></span>, player:getCurrentCommsText())

<span class="comment">-- screen one pops up again if comms is closed</span>
player:commandCloseTextComm()
station:destroy()
Cron.tick(<span class="integer">1</span>)

<span class="comment">-- comms stays closed</span>
<span class="predefined">assert</span>.is_true(player:isCommsInactive())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="tools-storycomms-invalid-calls-fails-when-an-other-storycomms-is-currently-running" class="paragraph">
<p> <details><summary> 
Tools:storyComms() invalid calls fails when an other storyComms() is currently running
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">finally(<span class="keyword">function</span>() Tools:endStoryComms() <span class="keyword">end</span>)

Tools:storyComms(station, player, screen)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Tools:storyComms(station, player, screen) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="tools-storycomms-invalid-calls-fails-when-called-with-station-without-comms" class="paragraph">
<p> <details><summary> 
Tools:storyComms() invalid calls fails when called with station without comms
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Tools:storyComms(SpaceStation(), player, screen) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="tools-storycomms-invalid-calls-fails-when-called-without-player" class="paragraph">
<p> <details><summary> 
Tools:storyComms() invalid calls fails when called without player
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Tools:storyComms(station, <span class="predefined-constant">nil</span>, screen) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="tools-storycomms-invalid-calls-fails-when-called-without-screen" class="paragraph">
<p> <details><summary> 
Tools:storyComms() invalid calls fails when called without screen
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Tools:storyComms(station, player, <span class="predefined-constant">nil</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="tools-storycomms-invalid-calls-fails-when-called-without-station" class="paragraph">
<p> <details><summary> 
Tools:storyComms() invalid calls fails when called without station
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Tools:storyComms(<span class="predefined-constant">nil</span>, player, screen) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="tools-storycomms-pops-up-if-it-is-closed-before-dialog-finished" class="paragraph">
<p> <details><summary> 
Tools:storyComms() pops up if it is closed before dialog finished
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">finally(<span class="keyword">function</span>() Tools:endStoryComms() <span class="keyword">end</span>)

<span class="keyword">local</span> <span class="local-variable">station</span> = SpaceStation()
Station:withComms(station)
<span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship()
<span class="keyword">local</span> <span class="local-variable">comms</span> = Comms:newScreen(<span class="string"><span class="delimiter">&quot;</span><span class="content">screen one</span><span class="delimiter">&quot;</span></span>)
comms:addReply(Comms:newReply(<span class="string"><span class="delimiter">&quot;</span><span class="content">reply one</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>()
    <span class="keyword">local</span> <span class="local-variable">screen2</span> = Comms:newScreen(<span class="string"><span class="delimiter">&quot;</span><span class="content">screen two</span><span class="delimiter">&quot;</span></span>)
    screen2:addReply(Comms:newReply(<span class="string"><span class="delimiter">&quot;</span><span class="content">reply two</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>()
        Tools:endStoryComms()

        <span class="keyword">return</span> Comms:newScreen(<span class="string"><span class="delimiter">&quot;</span><span class="content">screen three</span><span class="delimiter">&quot;</span></span>)
    <span class="keyword">end</span>))

    <span class="keyword">return</span> screen2
<span class="keyword">end</span>))

Tools:storyComms(station, player, comms)
<span class="predefined">assert</span>.same(<span class="string"><span class="delimiter">&quot;</span><span class="content">screen one</span><span class="delimiter">&quot;</span></span>, player:getCurrentCommsText())

<span class="comment">-- screen one pops up again if comms is closed</span>
player:commandCloseTextComm()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.same(<span class="string"><span class="delimiter">&quot;</span><span class="content">screen one</span><span class="delimiter">&quot;</span></span>, player:getCurrentCommsText())

player:selectComms(<span class="string"><span class="delimiter">&quot;</span><span class="content">reply one</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.same(<span class="string"><span class="delimiter">&quot;</span><span class="content">screen two</span><span class="delimiter">&quot;</span></span>, player:getCurrentCommsText())
player:commandCloseTextComm()

<span class="comment">-- conversation starts at screen one again</span>
player:commandCloseTextComm()
Cron.tick(<span class="integer">1</span>)
<span class="predefined">assert</span>.same(<span class="string"><span class="delimiter">&quot;</span><span class="content">screen one</span><span class="delimiter">&quot;</span></span>, player:getCurrentCommsText())

player:selectComms(<span class="string"><span class="delimiter">&quot;</span><span class="content">reply one</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.same(<span class="string"><span class="delimiter">&quot;</span><span class="content">screen two</span><span class="delimiter">&quot;</span></span>, player:getCurrentCommsText())
player:selectComms(<span class="string"><span class="delimiter">&quot;</span><span class="content">reply two</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.same(<span class="string"><span class="delimiter">&quot;</span><span class="content">screen three</span><span class="delimiter">&quot;</span></span>, player:getCurrentCommsText())
player:commandCloseTextComm()
Cron.tick(<span class="integer">1</span>)

<span class="comment">-- comms stays closed</span>
<span class="predefined">assert</span>.is_true(player:isCommsInactive())</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="tools-storycomms-valid-call-can-be-created" class="paragraph">
<p> <details><summary> 
Tools:storyComms() valid call can be created
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">finally(<span class="keyword">function</span>() Tools:endStoryComms() <span class="keyword">end</span>)

Tools:storyComms(station, player, screen)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="tools-storycomms-valid-call-can-be-stopped-and-started-again" class="paragraph">
<p> <details><summary> 
Tools:storyComms() valid call can be stopped and started again
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">finally(<span class="keyword">function</span>() Tools:endStoryComms() <span class="keyword">end</span>)

Tools:endStoryComms()
Tools:storyComms(station, player, screen)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="translator">Translator</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="translator-inspect">Translator:inspect()</h3>
<div id="translator-inspect-fails-if-translator-is-not-a-translator" class="paragraph">
<p> <details><summary> 
Translator:inspect() fails if translator is not a Translator
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Translator:inspect(<span class="predefined-constant">nil</span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Translator:inspect(<span class="integer">42</span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Translator:inspect(<span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="translator-inspect-finds-excessive-translations" class="paragraph">
<p> <details><summary> 
Translator:inspect() finds excessive translations
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new()
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hallo Welt</span><span class="delimiter">&quot;</span></span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_bye</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Tschau</span><span class="delimiter">&quot;</span></span>)
translator:useLocale(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>)

<span class="keyword">local</span> <span class="local-variable">missingTranslations</span>, <span class="local-variable">excessiveTranslations</span> = Translator:inspect(translator)

<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>, missingTranslations)
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="string"><span class="delimiter">&quot;</span><span class="content">say_bye</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>, excessiveTranslations)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="translator-inspect-finds-missing-translations" class="paragraph">
<p> <details><summary> 
Translator:inspect() finds missing translations
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new(<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_bye</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Good Bye</span><span class="delimiter">&quot;</span></span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_bye</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Tschau</span><span class="delimiter">&quot;</span></span>)
translator:useLocale(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>)

<span class="keyword">local</span> <span class="local-variable">missingTranslations</span>, <span class="local-variable">excessiveTranslations</span> = Translator:inspect(translator)

<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>, missingTranslations)
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>, excessiveTranslations)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="translator-inspect-sorts-the-result-alphabethically-by-key" class="paragraph">
<p> <details><summary> 
Translator:inspect() sorts the result alphabethically by key
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new()
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_a</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">A</span><span class="delimiter">&quot;</span></span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_b</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">B</span><span class="delimiter">&quot;</span></span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_c</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">C</span><span class="delimiter">&quot;</span></span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_d</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">D</span><span class="delimiter">&quot;</span></span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_e</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">E</span><span class="delimiter">&quot;</span></span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_f</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">F</span><span class="delimiter">&quot;</span></span>)
translator:useLocale(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>)

<span class="keyword">local</span> <span class="local-variable">missingTranslations</span>, <span class="local-variable">excessiveTranslations</span> = Translator:inspect(translator)

<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="string"><span class="delimiter">&quot;</span><span class="content">say_a</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_b</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_c</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>, missingTranslations)
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="string"><span class="delimiter">&quot;</span><span class="content">say_d</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_e</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_f</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>, excessiveTranslations)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="translator-new">Translator:new()</h3>
<div id="translator-new-allows-to-set-the-default-locale" class="paragraph">
<p> <details><summary> 
Translator:new() allows to set the default locale
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hallo Welt</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hallo Welt</span><span class="delimiter">&quot;</span></span>, translator:translate(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>))
translator:useLocale(<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>, translator:translate(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>))
translator:useLocale(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hallo Welt</span><span class="delimiter">&quot;</span></span>, translator:translate(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="translator-new-fails-if-defaultlocale-is-not-a-string" class="paragraph">
<p> <details><summary> 
Translator:new() fails if defaultLocale is not a string
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Translator:new(<span class="integer">42</span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="translator-new-should-basically-work-with-a-different-locale" class="paragraph">
<p> <details><summary> 
Translator:new() should basically work with a different locale
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new()

<span class="predefined">assert</span>.is_true(Translator:isTranslator(translator))

translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hallo Welt</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>, translator:translate(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>))
translator:useLocale(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hallo Welt</span><span class="delimiter">&quot;</span></span>, translator:translate(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="translator-new-should-work-when-only-using-one-locale" class="paragraph">
<p> <details><summary> 
Translator:new() should work when only using one locale
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new()
<span class="predefined">assert</span>.is_true(Translator:isTranslator(translator))

translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>, translator:translate(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="translator-new-register">Translator:new():register()</h3>
<div id="translator-new-register-can-take-a-table-of-translations-should-work-with-a-different-locale" class="paragraph">
<p> <details><summary> 
Translator:new():register() can take a table of translations should work with a different locale
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new()

translator:register(<span class="map"><span class="delimiter">{</span>
    <span class="key">say_hello</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>,
    <span class="key">say_bye</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Goodbye</span><span class="delimiter">&quot;</span></span>,
<span class="delimiter">}</span></span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>, <span class="map"><span class="delimiter">{</span>
    <span class="key">say_hello</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hallo Welt</span><span class="delimiter">&quot;</span></span>,
    <span class="key">say_bye</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Tschau</span><span class="delimiter">&quot;</span></span>,
<span class="delimiter">}</span></span>)

translator:useLocale(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hallo Welt</span><span class="delimiter">&quot;</span></span>, translator:translate(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="translator-new-register-can-take-a-table-of-translations-should-work-with-the-default-locale" class="paragraph">
<p> <details><summary> 
Translator:new():register() can take a table of translations should work with the default locale
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new()

translator:register(<span class="map"><span class="delimiter">{</span>
    <span class="key">say_hello</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>,
    <span class="key">say_bye</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">Goodbye</span><span class="delimiter">&quot;</span></span>,
<span class="delimiter">}</span></span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>, translator:translate(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="translator-new-register-fails-if-key-is-missing" class="paragraph">
<p> <details><summary> 
Translator:new():register() fails if key is missing
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    translator:register()
<span class="keyword">end</span>)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">nil</span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="translator-new-register-fails-if-label-is-not-a-string-or-function" class="paragraph">
<p> <details><summary> 
Translator:new():register() fails if label is not a string or function
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="integer">42</span>)
<span class="keyword">end</span>)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">nil</span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="translator-new-register-fails-if-locale-is-not-a-string" class="paragraph">
<p> <details><summary> 
Translator:new():register() fails if locale is not a string
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    translator:register(<span class="integer">42</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    translator:register(<span class="predefined-constant">nil</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="translator-new-translate">Translator:new():translate()</h3>
<div id="translator-new-translate-can-use-a-function-as-translation" class="paragraph">
<p> <details><summary> 
Translator:new():translate() can use a function as translation
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new()
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>, translator:translate(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="translator-new-translate-gives-the-translator-and-all-given-arguments-to-translation-function" class="paragraph">
<p> <details><summary> 
Translator:new():translate() gives the translator and all given arguments to translation function
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new()
<span class="keyword">local</span> <span class="local-variable">t</span> = translator.translate

<span class="keyword">local</span> <span class="local-variable">arg1</span> = Util.randomUuid()
<span class="keyword">local</span> <span class="local-variable">arg2</span> = Util.randomUuid()
<span class="keyword">local</span> <span class="local-variable">arg3</span> = Util.randomUuid()
<span class="keyword">local</span> <span class="local-variable">givenArg1</span>, <span class="local-variable">givenArg2</span>, <span class="local-variable">givenArg3</span>

translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>(arg1, arg2, arg3)
    givenArg1 = arg1
    givenArg2 = arg2
    givenArg3 = arg3
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>
<span class="keyword">end</span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>, t(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, arg1, arg2, arg3))
<span class="predefined">assert</span>.is_same(arg1, givenArg1)
<span class="predefined">assert</span>.is_same(arg2, givenArg2)
<span class="predefined">assert</span>.is_same(arg3, givenArg3)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="translator-new-translate-gives-the-translator-and-all-given-arguments-to-translation-function" class="paragraph">
<p> <details><summary> 
Translator:new():translate() gives the translator and all given arguments to translation function
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new()
<span class="keyword">local</span> <span class="local-variable">arg1</span> = Util.randomUuid()
<span class="keyword">local</span> <span class="local-variable">arg2</span> = Util.randomUuid()
<span class="keyword">local</span> <span class="local-variable">arg3</span> = Util.randomUuid()
<span class="keyword">local</span> <span class="local-variable">givenArg1</span>, <span class="local-variable">givenArg2</span>, <span class="local-variable">givenArg3</span>

translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>(arg1, arg2, arg3)
    givenArg1 = arg1
    givenArg2 = arg2
    givenArg3 = arg3
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>
<span class="keyword">end</span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>, translator:translate(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, arg1, arg2, arg3))
<span class="predefined">assert</span>.is_same(arg1, givenArg1)
<span class="predefined">assert</span>.is_same(arg2, givenArg2)
<span class="predefined">assert</span>.is_same(arg3, givenArg3)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="translator-new-translate-returns-an-empty-string-if-a-translation-errors-and-all-fallbacks-error-too" class="paragraph">
<p> <details><summary> 
Translator:new():translate() returns an empty string if a translation errors and all fallbacks error too
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new()

translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="predefined">error</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Boom</span><span class="delimiter">&quot;</span></span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>, translator:translate(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="translator-new-translate-should-allow-to-use-short-hand" class="paragraph">
<p> <details><summary> 
Translator:new():translate() should allow to use short-hand
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new()
<span class="keyword">local</span> <span class="local-variable">t</span> = translator.translate

translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>, t(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="translator-new-translate-should-fail-if-key-does-not-exist-in-translation-or-defaultlocale" class="paragraph">
<p> <details><summary> 
Translator:new():translate() should fail if key does not exist in translation or defaultLocale
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new()

translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    translator:translate(<span class="string"><span class="delimiter">&quot;</span><span class="content">mistyped</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="translator-new-translate-should-fail-if-key-is-not-a-string" class="paragraph">
<p> <details><summary> 
Translator:new():translate() should fail if key is not a string
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new()

translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    translator:translate(<span class="integer">42</span>)
<span class="keyword">end</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Expected key to be a string, but got &lt;number&gt;42</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    translator:translate(<span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>)
<span class="keyword">end</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Expected key to be a string, but got &lt;table&gt;(size: 0)</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="translator-new-translate-transliterates-german-characters-into-ascii" class="paragraph">
<p> <details><summary> 
Translator:new():translate() transliterates german characters into ASCII
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new()
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">umlaut</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Falsches ben von Xylophonmusik qult jeden greren Zwerg</span><span class="delimiter">&quot;</span></span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">umlaut_func</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>()
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Falsches ben von Xylophonmusik qult jeden greren Zwerg</span><span class="delimiter">&quot;</span></span>
<span class="keyword">end</span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Falsches Ueben von Xylophonmusik quaelt jeden groesseren Zwerg</span><span class="delimiter">&quot;</span></span>, translator.translate(<span class="string"><span class="delimiter">&quot;</span><span class="content">umlaut</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Falsches Ueben von Xylophonmusik quaelt jeden groesseren Zwerg</span><span class="delimiter">&quot;</span></span>, translator.translate(<span class="string"><span class="delimiter">&quot;</span><span class="content">umlaut_func</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="translator-new-translate-tries-fallback-locales-if-function-does-not-return-a-string" class="paragraph">
<p> <details><summary> 
Translator:new():translate() tries fallback locales if function does not return a string
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new(<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>)
translator:useLocale(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="keyword">return</span> <span class="integer">42</span> <span class="keyword">end</span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>, translator:translate(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="translator-new-translate-tries-fallback-locales-if-function-errors" class="paragraph">
<p> <details><summary> 
Translator:new():translate() tries fallback locales if function errors
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="comment">-- this behavior should not be problematic because translations should not have side-effects</span>
<span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new(<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>)
translator:useLocale(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span> <span class="keyword">end</span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() <span class="keyword">return</span> <span class="predefined">error</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Boom</span><span class="delimiter">&quot;</span></span>) <span class="keyword">end</span>)

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>, translator:translate(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="translator-new-translate-uses-a-fallback-when-translation-is-not-available" class="paragraph">
<p> <details><summary> 
Translator:new():translate() uses a fallback when translation is not available
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new()

<span class="predefined">assert</span>.is_true(Translator:isTranslator(translator))

translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)

translator:useLocale(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>, translator:translate(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="translator-new-translate-uses-multiple-fallbacks-when-translation-is-not-available" class="paragraph">
<p> <details><summary> 
Translator:new():translate() uses multiple fallbacks when translation is not available
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new()
translator:useLocale(<span class="string"><span class="delimiter">&quot;</span><span class="content">sp</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>)

translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>, translator:translate(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>))
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hallo Welt</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hallo Welt</span><span class="delimiter">&quot;</span></span>, translator:translate(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>))
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">sp</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hola Mundo</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hola Mundo</span><span class="delimiter">&quot;</span></span>, translator:translate(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="translator-new-uselocale">Translator:new():useLocale()</h3>
<div id="translator-new-uselocale-fails-if-any-of-the-arguments-is-not-a-string" class="paragraph">
<p> <details><summary> 
Translator:new():useLocale() fails if any of the arguments is not a string
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new()

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    translator:useLocale(<span class="integer">42</span>)
<span class="keyword">end</span>)

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    translator:useLocale(<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>, <span class="integer">42</span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="translator-new-uselocale-uses-default-locale-if-no-argument-is-given" class="paragraph">
<p> <details><summary> 
Translator:new():useLocale() uses default locale if no argument is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new()
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)

translator:useLocale()

<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>, translator:translate(<span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="translator-printinspection">Translator:printInspection()</h3>
<div id="translator-printinspection-look-that-there-is-no-smoke" class="paragraph">
<p> <details><summary> 
Translator:printInspection() look that there is no smoke
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="comment">-- all good</span>
<span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new(<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hallo Welt</span><span class="delimiter">&quot;</span></span>)
translator:useLocale(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>)

Translator:printInspection(translator)

<span class="comment">-- only missing</span>
<span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new(<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_bye</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Good Bye</span><span class="delimiter">&quot;</span></span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_bye</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Tschau</span><span class="delimiter">&quot;</span></span>)
translator:useLocale(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>)

Translator:printInspection(translator)

<span class="comment">-- only excessive</span>
<span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new()
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_hello</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hallo Welt</span><span class="delimiter">&quot;</span></span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_bye</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Tschau</span><span class="delimiter">&quot;</span></span>)
translator:useLocale(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>)

Translator:printInspection(translator)

<span class="comment">-- mixed</span>
<span class="keyword">local</span> <span class="local-variable">translator</span> = Translator:new()
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_a</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">A</span><span class="delimiter">&quot;</span></span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_b</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">B</span><span class="delimiter">&quot;</span></span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_c</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">C</span><span class="delimiter">&quot;</span></span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_d</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">D</span><span class="delimiter">&quot;</span></span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_e</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">E</span><span class="delimiter">&quot;</span></span>)
translator:register(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">say_f</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">F</span><span class="delimiter">&quot;</span></span>)
translator:useLocale(<span class="string"><span class="delimiter">&quot;</span><span class="content">de</span><span class="delimiter">&quot;</span></span>)

Translator:printInspection(translator)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="util">Util</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="util-addvector">Util:addVector()</h3>
<div id="util-addvector-has-the-x-axis-for-0-degree" class="paragraph">
<p> <details><summary> 
Util:addVector() has the x axis for 0 degree
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">x</span>, <span class="local-variable">y</span> = Util.addVector(<span class="integer">1000</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">1000</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">2000</span>, math.floor(x))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, math.floor(y))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-addvector-it-works-counter-clockwise" class="paragraph">
<p> <details><summary> 
Util:addVector() it works counter clockwise
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">x</span>, <span class="local-variable">y</span> = Util.addVector(<span class="integer">1000</span>, <span class="integer">0</span>, <span class="integer">90</span>, <span class="integer">1000</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">1000</span>, math.floor(x))
<span class="predefined">assert</span>.is_same(<span class="integer">1000</span>, math.floor(y))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-addvector-it-works-with-spaceobject" class="paragraph">
<p> <details><summary> 
Util:addVector() it works with SpaceObject
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setPosition(<span class="integer">1337</span>, <span class="integer">42</span>)
<span class="keyword">local</span> <span class="local-variable">x</span>, <span class="local-variable">y</span> = Util.addVector(ship, <span class="integer">90</span>, <span class="integer">1000</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">1337</span>, math.floor(x))
<span class="predefined">assert</span>.is_same(<span class="integer">1042</span>, math.floor(y))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-addvector-it-works-with-degrees" class="paragraph">
<p> <details><summary> 
Util:addVector() it works with degrees
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">x</span>, <span class="local-variable">y</span> = Util.addVector(<span class="integer">1000</span>, <span class="integer">0</span>, <span class="integer">180</span>, <span class="integer">1000</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, math.floor(x))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, math.floor(y))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-addvector-returns-the-point-when-adding-a-vector-of-zero-length" class="paragraph">
<p> <details><summary> 
Util:addVector() returns the point when adding a vector of zero length
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">x</span>, <span class="local-variable">y</span> = Util.addVector(<span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">180</span>, <span class="integer">0</span>)
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">0</span>, <span class="integer">0</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>x, y<span class="delimiter">}</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="util-anglediff">Util:angleDiff()</h3>
<div id="util-anglediff-returns-correct-results" class="paragraph">
<p> <details><summary> 
Util:angleDiff() returns correct results
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(<span class="integer">20</span>, Util.angleDiff(<span class="integer">10</span>, <span class="integer">30</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">-20</span>, Util.angleDiff(<span class="integer">30</span>, <span class="integer">10</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">20</span>, Util.angleDiff(<span class="integer">350</span>, <span class="integer">10</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">-20</span>, Util.angleDiff(<span class="integer">10</span>, <span class="integer">350</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="util-anglefromvector">Util:angleFromVector()</h3>
<div id="util-anglefromvector-has-the-x-axis-for-0-degree" class="paragraph">
<p> <details><summary> 
Util:angleFromVector() has the x axis for 0 degree
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">angle</span>, <span class="local-variable">distance</span> = Util.angleFromVector(<span class="integer">1000</span>, <span class="integer">0</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, math.floor(angle))
<span class="predefined">assert</span>.is_same(<span class="integer">1000</span>, math.floor(distance))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-anglefromvector-it-works-counter-clockwise" class="paragraph">
<p> <details><summary> 
Util:angleFromVector() it works counter clockwise
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">angle</span>, <span class="local-variable">distance</span> = Util.angleFromVector(<span class="integer">0</span>, <span class="integer">1000</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">90</span>, math.floor(angle))
<span class="predefined">assert</span>.is_same(<span class="integer">1000</span>, math.floor(distance))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-anglefromvector-it-works-with-degrees" class="paragraph">
<p> <details><summary> 
Util:angleFromVector() it works with degrees
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">angle</span>, <span class="local-variable">distance</span> = Util.angleFromVector(<span class="integer">-1000</span>, <span class="integer">0</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">180</span>, math.floor(angle))
<span class="predefined">assert</span>.is_same(<span class="integer">1000</span>, math.floor(distance))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="util-appendtables">Util:appendTables()</h3>
<div id="util-appendtables-can-merge-three-tables" class="paragraph">
<p> <details><summary> 
Util:appendTables() can merge three tables
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">a</span> = <span class="map"><span class="delimiter">{</span><span class="integer">1</span>, <span class="integer">2</span><span class="delimiter">}</span></span>
<span class="keyword">local</span> <span class="local-variable">b</span> = <span class="map"><span class="delimiter">{</span><span class="integer">3</span>, <span class="integer">4</span><span class="delimiter">}</span></span>
<span class="keyword">local</span> <span class="local-variable">c</span> = <span class="map"><span class="delimiter">{</span><span class="integer">5</span>, <span class="integer">6</span><span class="delimiter">}</span></span>

<span class="keyword">local</span> <span class="local-variable">merged</span> = Util.appendTables(a, b, c)
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>, <span class="integer">4</span>, <span class="integer">5</span>, <span class="integer">6</span><span class="delimiter">}</span></span>, merged)
<span class="comment">-- ensure the original tables are not overridden</span>
<span class="predefined">assert</span>.not_same(a, merged)
<span class="predefined">assert</span>.not_same(b, merged)
<span class="predefined">assert</span>.not_same(c, merged)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-appendtables-does-not-remove-duplicates" class="paragraph">
<p> <details><summary> 
Util:appendTables() does not remove duplicates
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">a</span> = <span class="map"><span class="delimiter">{</span><span class="integer">1</span>, <span class="integer">3</span><span class="delimiter">}</span></span>
<span class="keyword">local</span> <span class="local-variable">b</span> = <span class="map"><span class="delimiter">{</span><span class="integer">3</span>, <span class="integer">7</span><span class="delimiter">}</span></span>

<span class="keyword">local</span> <span class="local-variable">merged</span> = Util.appendTables(a, b)
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">1</span>, <span class="integer">3</span>, <span class="integer">3</span>, <span class="integer">7</span><span class="delimiter">}</span></span>, merged)

<span class="comment">-- ensure the original tables are not overridden</span>
<span class="predefined">assert</span>.not_same(a, merged)
<span class="predefined">assert</span>.not_same(b, merged)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-appendtables-fails-if-the-first-argument-is-not-a-numeric-table" class="paragraph">
<p> <details><summary> 
Util:appendTables() fails if the first argument is not a numeric table
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Util.appendTables(<span class="integer">42</span>, <span class="map"><span class="delimiter">{</span><span class="integer">1</span><span class="delimiter">}</span></span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Util.appendTables(<span class="predefined-constant">nil</span>, <span class="map"><span class="delimiter">{</span><span class="integer">1</span><span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-appendtables-fails-if-the-second-argument-is-not-a-table" class="paragraph">
<p> <details><summary> 
Util:appendTables() fails if the second argument is not a table
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Util.appendTables(<span class="map"><span class="delimiter">{</span><span class="integer">1</span><span class="delimiter">}</span></span>, <span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-appendtables-returns-a-new-table-where-all-the-items-of-all-tables-are-present" class="paragraph">
<p> <details><summary> 
Util:appendTables() returns a new table where all the items of all tables are present
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">a</span> = <span class="map"><span class="delimiter">{</span><span class="integer">1</span>, <span class="integer">2</span><span class="delimiter">}</span></span>
<span class="keyword">local</span> <span class="local-variable">b</span> = <span class="map"><span class="delimiter">{</span><span class="integer">3</span>, <span class="integer">4</span><span class="delimiter">}</span></span>

<span class="keyword">local</span> <span class="local-variable">merged</span> = Util.appendTables(a, b)
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>, <span class="integer">4</span><span class="delimiter">}</span></span>, merged)

<span class="comment">-- ensure the original tables are not overridden</span>
<span class="predefined">assert</span>.not_same(a, merged)
<span class="predefined">assert</span>.not_same(b, merged)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="util-deepcopy">Util:deepCopy()</h3>
<div id="util-deepcopy-should-copy-primitive-types" class="paragraph">
<p> <details><summary> 
Util:deepCopy() should copy primitive types
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">thing</span> = <span class="map"><span class="delimiter">{</span>
    <span class="key">foo</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>,
    <span class="key">baz</span> = <span class="integer">42</span>
<span class="delimiter">}</span></span>
<span class="keyword">local</span> <span class="local-variable">copied</span> = Util.deepCopy(thing)

thing.foo = <span class="string"><span class="delimiter">&quot;</span><span class="content">fake</span><span class="delimiter">&quot;</span></span>
thing.baz = <span class="integer">12</span>
thing.blu = <span class="string"><span class="delimiter">&quot;</span><span class="content">some</span><span class="delimiter">&quot;</span></span>

<span class="predefined">assert</span>.equal(<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, copied.foo)
<span class="predefined">assert</span>.equal(<span class="integer">42</span>, copied.baz)
<span class="predefined">assert</span>.is_nil(copied.blu)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-deepcopy-should-not-copy-objects-from-empty-epsilon" class="paragraph">
<p> <details><summary> 
Util:deepCopy() should not copy objects from Empty Epsilon
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="comment">-- Copying them would cause the object to exists twice in memory.</span>
<span class="comment">-- This would cause an inconsistent state and might cause the game to crash</span>
<span class="comment">-- because of access to invalid memory segments.</span>

require <span class="string"><span class="delimiter">&quot;</span><span class="content">spec.mocks</span><span class="delimiter">&quot;</span></span>

<span class="keyword">local</span> <span class="local-variable">thing</span> = <span class="map"><span class="delimiter">{</span>
    <span class="key">foo</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>,
    <span class="key">station</span> = SpaceStation()
<span class="delimiter">}</span></span>
<span class="keyword">local</span> <span class="local-variable">copied</span> = Util.deepCopy(thing)

thing.station.foo = <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>

<span class="predefined">assert</span>.same(<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, copied.station.foo)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="util-distancetolinesegment">Util:distanceToLineSegment()</h3>
<div id="util-distancetolinesegment-can-use-objects-instead-of-positions" class="paragraph">
<p> <details><summary> 
Util:distanceToLineSegment() can use objects instead of positions
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">start</span> = CpuShip():setPosition(<span class="integer">300</span>, <span class="integer">0</span>)
<span class="keyword">local</span> <span class="local-variable">stop</span> = CpuShip():setPosition(<span class="integer">1300</span>, <span class="integer">0</span>)
<span class="keyword">local</span> <span class="local-variable">point</span> = CpuShip():setPosition(<span class="integer">1300</span>, <span class="integer">200</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">200</span>, Util.distanceToLineSegment(<span class="integer">300</span>, <span class="integer">0</span>, <span class="integer">1300</span>, <span class="integer">0</span>, <span class="integer">1300</span>, <span class="integer">200</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">200</span>, Util.distanceToLineSegment(start, <span class="integer">1300</span>, <span class="integer">0</span>, <span class="integer">1300</span>, <span class="integer">200</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">200</span>, Util.distanceToLineSegment(<span class="integer">300</span>, <span class="integer">0</span>, stop, <span class="integer">1300</span>, <span class="integer">200</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">200</span>, Util.distanceToLineSegment(<span class="integer">300</span>, <span class="integer">0</span>, <span class="integer">1300</span>, <span class="integer">0</span>, point))
<span class="predefined">assert</span>.is_same(<span class="integer">200</span>, Util.distanceToLineSegment(start, stop, <span class="integer">1300</span>, <span class="integer">200</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">200</span>, Util.distanceToLineSegment(start, <span class="integer">1300</span>, <span class="integer">0</span>, point))
<span class="predefined">assert</span>.is_same(<span class="integer">200</span>, Util.distanceToLineSegment(<span class="integer">300</span>, <span class="integer">0</span>, stop, point))
<span class="predefined">assert</span>.is_same(<span class="integer">200</span>, Util.distanceToLineSegment(start, stop, point))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-distancetolinesegment-fails-if-any-argument-is-not-a-number" class="paragraph">
<p> <details><summary> 
Util:distanceToLineSegment() fails if any argument is not a number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Util.distanceToLineSegment(<span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">1000</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Util.distanceToLineSegment(<span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">1000</span>, <span class="integer">0</span>, <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>, <span class="integer">0</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Util.distanceToLineSegment(<span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">1000</span>, <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>, <span class="integer">0</span>, <span class="integer">0</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Util.distanceToLineSegment(<span class="integer">0</span>, <span class="integer">0</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">fo</span><span class="delimiter">&quot;</span></span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Util.distanceToLineSegment(<span class="integer">0</span>, <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>, <span class="integer">1000</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Util.distanceToLineSegment(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>, <span class="integer">0</span>, <span class="integer">1000</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-distancetolinesegment-fails-if-start-and-end-are-identical" class="paragraph">
<p> <details><summary> 
Util:distanceToLineSegment() fails if start and end are identical
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Util.distanceToLineSegment(<span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>) <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Util.distanceToLineSegment(<span class="integer">100</span>, <span class="integer">0</span>, <span class="integer">100</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-distancetolinesegment-returns-0-if-point-is-on-the-line-segment" class="paragraph">
<p> <details><summary> 
Util:distanceToLineSegment() returns 0 if point is on the line segment
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(<span class="integer">0</span>, Util.distanceToLineSegment(<span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">1000</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, Util.distanceToLineSegment(<span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">1000</span>, <span class="integer">0</span>, <span class="integer">1000</span>, <span class="integer">0</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, Util.distanceToLineSegment(<span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">1000</span>, <span class="integer">0</span>, <span class="integer">500</span>, <span class="integer">0</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-distancetolinesegment-returns-distance-if-point-is-on-the-line-but-outside-the-segment" class="paragraph">
<p> <details><summary> 
Util:distanceToLineSegment() returns distance if point is on the line, but outside the segment
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(<span class="integer">1000</span>, Util.distanceToLineSegment(<span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">1000</span>, <span class="integer">0</span>, <span class="integer">2000</span>, <span class="integer">0</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">500</span>, Util.distanceToLineSegment(<span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">1000</span>, <span class="integer">0</span>, <span class="integer">-500</span>, <span class="integer">0</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-distancetolinesegment-returns-distance-of-a-point-from-a-line-segment-when-closest-point-is-on-the-line" class="paragraph">
<p> <details><summary> 
Util:distanceToLineSegment() returns distance of a point from a line segment (when closest point is on the line)
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(<span class="integer">200</span>, Util.distanceToLineSegment(
    <span class="integer">0</span>, <span class="integer">0</span>,
    <span class="integer">1000</span>, <span class="integer">0</span>,
    <span class="integer">500</span>, <span class="integer">200</span>
))
<span class="predefined">assert</span>.is_same(<span class="integer">200</span>, Util.distanceToLineSegment(
    <span class="integer">0</span>, <span class="integer">0</span>,
    <span class="integer">1000</span>, <span class="integer">0</span>,
    <span class="integer">500</span>, <span class="integer">-200</span>
))

<span class="comment">-- the same shifted to the right</span>
<span class="predefined">assert</span>.is_same(<span class="integer">200</span>, Util.distanceToLineSegment(
    <span class="integer">300</span>, <span class="integer">0</span>,
    <span class="integer">1300</span>, <span class="integer">0</span>,
    <span class="integer">800</span>, <span class="integer">200</span>
))
<span class="predefined">assert</span>.is_same(<span class="integer">200</span>, Util.distanceToLineSegment(
    <span class="integer">300</span>, <span class="integer">0</span>,
    <span class="integer">1300</span>, <span class="integer">0</span>,
    <span class="integer">800</span>, <span class="integer">-200</span>
))

<span class="comment">-- and now rotate the whole thing</span>
<span class="keyword">for</span> _, deg <span class="keyword">in</span> <span class="predefined">pairs</span>(<span class="map"><span class="delimiter">{</span><span class="integer">30</span>, <span class="integer">45</span>, <span class="integer">60</span>, <span class="integer">90</span>, <span class="integer">120</span>, <span class="integer">150</span><span class="delimiter">}</span></span>) <span class="keyword">do</span>
    deg = deg / <span class="integer">180</span> * math.pi
    <span class="keyword">local</span> <span class="local-variable">rotate</span> = <span class="keyword">function</span>(x, y)
        <span class="keyword">return</span> math.cos(deg) * x - math.sin(deg) * y, math.sin(deg) * x + math.cos(deg) * y
    <span class="keyword">end</span>

    <span class="keyword">local</span> <span class="local-variable">startX</span>, <span class="local-variable">startY</span> = rotate(<span class="integer">300</span>, <span class="integer">0</span>)
    <span class="keyword">local</span> <span class="local-variable">endX</span>, <span class="local-variable">endY</span> = rotate(<span class="integer">1300</span>, <span class="integer">0</span>)

    <span class="keyword">local</span> <span class="local-variable">x1</span>, <span class="local-variable">y1</span> = rotate(<span class="integer">800</span>, <span class="integer">200</span>)
    <span class="predefined">assert</span>.is_same(<span class="integer">200</span>, Util.round(Util.distanceToLineSegment(startX, startY, endX, endY, x1, y1)))

    <span class="keyword">local</span> <span class="local-variable">x2</span>, <span class="local-variable">y2</span> = rotate(<span class="integer">800</span>, <span class="integer">-200</span>)
    <span class="predefined">assert</span>.is_same(<span class="integer">200</span>, Util.round(Util.distanceToLineSegment(startX, startY, endX, endY, x2, y2)))
<span class="keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-distancetolinesegment-returns-distance-of-a-point-from-a-line-segment-when-closest-point-is-the-end" class="paragraph">
<p> <details><summary> 
Util:distanceToLineSegment() returns distance of a point from a line segment (when closest point is the end)
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(<span class="integer">200</span>, Util.distanceToLineSegment(<span class="integer">300</span>, <span class="integer">0</span>, <span class="integer">1300</span>, <span class="integer">0</span>, <span class="integer">1300</span>, <span class="integer">200</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">200</span>, Util.distanceToLineSegment(<span class="integer">300</span>, <span class="integer">0</span>, <span class="integer">1300</span>, <span class="integer">0</span>, <span class="integer">1300</span>, <span class="integer">-200</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-distancetolinesegment-returns-distance-of-a-point-from-a-line-segment-when-closest-point-is-the-start" class="paragraph">
<p> <details><summary> 
Util:distanceToLineSegment() returns distance of a point from a line segment (when closest point is the start)
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(<span class="integer">200</span>, Util.distanceToLineSegment(<span class="integer">300</span>, <span class="integer">0</span>, <span class="integer">1300</span>, <span class="integer">0</span>, <span class="integer">300</span>, <span class="integer">200</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">200</span>, Util.distanceToLineSegment(<span class="integer">300</span>, <span class="integer">0</span>, <span class="integer">1300</span>, <span class="integer">0</span>, <span class="integer">300</span>, <span class="integer">-200</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="util-heading">Util:heading()</h3>
<div id="util-heading-goes-clockwise" class="paragraph">
<p> <details><summary> 
Util:heading() goes clockwise
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">one</span>, <span class="local-variable">two</span> = CpuShip(), CpuShip()
one:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)

two:setPosition(<span class="integer">-1000</span>, <span class="integer">0</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">270</span>, Util.heading(one, two))

two:setPosition(<span class="integer">0</span>, <span class="integer">-1000</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, Util.heading(one, two))

two:setPosition(<span class="integer">1000</span>, <span class="integer">0</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">90</span>, Util.heading(one, two))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-heading-raises-an-error-if-used-incorrectly" class="paragraph">
<p> <details><summary> 
Util:heading() raises an error if used incorrectly
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Util.heading()
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Util.heading(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Util.heading(<span class="integer">12</span>, <span class="integer">13</span>, <span class="integer">14</span>)
<span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Util.heading(<span class="integer">12</span>, CpuShip())
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-heading-takes-positive-y-axis-as-180" class="paragraph">
<p> <details><summary> 
Util:heading() takes positive y axis as 180
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">one</span>, <span class="local-variable">two</span> = CpuShip(), CpuShip()
one:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
two:setPosition(<span class="integer">0</span>, <span class="integer">1000</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">180</span>, Util.heading(one, two))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-heading-works-with-coordinates-as-first-argument" class="paragraph">
<p> <details><summary> 
Util:heading() works with coordinates as first argument
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
ship:setPosition(<span class="integer">-1000</span>, <span class="integer">0</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">270</span>, Util.heading(<span class="integer">0</span>, <span class="integer">0</span>, ship))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-heading-works-with-coordinates-as-second-argument" class="paragraph">
<p> <details><summary> 
Util:heading() works with coordinates as second argument
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip()
ship:setPosition(<span class="integer">0</span>, <span class="integer">0</span>)
<span class="predefined">assert</span>.is_same(<span class="integer">270</span>, Util.heading(ship, <span class="integer">-1000</span>, <span class="integer">0</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-heading-works-with-coordinates-only" class="paragraph">
<p> <details><summary> 
Util:heading() works with coordinates only
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(<span class="integer">270</span>, Util.heading(<span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">-1000</span>, <span class="integer">0</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="util-isnumerictable">Util:isNumericTable()</h3>
<div id="util-isnumerictable-returns-false-on-table-that-contains-mixed-indices" class="paragraph">
<p> <details><summary> 
Util:isNumericTable() returns false on table that contains mixed indices
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_false(Util.isNumericTable(<span class="map"><span class="delimiter">{</span><span class="integer">42</span>, <span class="key">foo</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, <span class="integer">2</span>, <span class="integer">3</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, <span class="key">baz</span> = <span class="integer">42</span><span class="delimiter">}</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-isnumerictable-returns-false-on-table-that-only-contains-string-indices" class="paragraph">
<p> <details><summary> 
Util:isNumericTable() returns false on table that only contains string indices
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_false(Util.isNumericTable(<span class="map"><span class="delimiter">{</span><span class="key">one</span> = <span class="integer">1</span>, <span class="key">two</span> = <span class="integer">2</span>, <span class="key">three</span> = <span class="integer">3</span><span class="delimiter">}</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-isnumerictable-returns-true-on-empty-table" class="paragraph">
<p> <details><summary> 
Util:isNumericTable() returns true on empty table
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_true(Util.isNumericTable(<span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-isnumerictable-returns-true-on-table-that-only-contains-numerical-indices" class="paragraph">
<p> <details><summary> 
Util:isNumericTable() returns true on table that only contains numerical indices
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_true(Util.isNumericTable(<span class="map"><span class="delimiter">{</span><span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>, <span class="integer">4</span><span class="delimiter">}</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="util-keys">Util:keys()</h3>
<div id="util-keys-fails-if-no-table-is-given" class="paragraph">
<p> <details><summary> 
Util:keys() fails if no table is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Util.keys() <span class="keyword">end</span>)
<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Util.keys(<span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-keys-returns-the-keys-of-a-table-in-an-arbitrary-order" class="paragraph">
<p> <details><summary> 
Util:keys() returns the keys of a table in an arbitrary order
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">input</span> = <span class="map"><span class="delimiter">{</span>
    <span class="key">foo</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>,
    <span class="key">baz</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">blubb</span><span class="delimiter">&quot;</span></span>,
    <span class="key">number</span> = <span class="integer">42</span>,
<span class="delimiter">}</span></span>
<span class="keyword">local</span> <span class="local-variable">output</span> = Util.keys(input)

<span class="predefined">assert</span>.is_table(output)
<span class="predefined">assert</span>.is_same(<span class="integer">3</span>, Util.size(output))
<span class="predefined">assert</span>.contains_value(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, output)
<span class="predefined">assert</span>.contains_value(<span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span>, output)
<span class="predefined">assert</span>.contains_value(<span class="string"><span class="delimiter">&quot;</span><span class="content">number</span><span class="delimiter">&quot;</span></span>, output)
<span class="predefined">assert</span>.is_true(Util.isNumericTable(output))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="util-map">Util:map()</h3>
<div id="util-map-fails-when-first-argument-is-not-a-table" class="paragraph">
<p> <details><summary> 
Util:map() fails when first argument is not a table
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Util.map(<span class="integer">42</span>, <span class="keyword">function</span>() <span class="keyword">end</span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-map-fails-when-second-argument-is-not-a-function" class="paragraph">
<p> <details><summary> 
Util:map() fails when second argument is not a function
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Util.map(<span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>, <span class="integer">42</span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-map-makes-the-keys-available-in-the-function" class="paragraph">
<p> <details><summary> 
Util:map() makes the keys available in the function
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">input</span> = <span class="map"><span class="delimiter">{</span><span class="key">a</span>=<span class="integer">1</span>, <span class="key">b</span>=<span class="integer">2</span>, <span class="key">c</span>=<span class="integer">3</span><span class="delimiter">}</span></span>
<span class="keyword">local</span> <span class="local-variable">output</span> = Util.map(input, <span class="keyword">function</span>(value, key) <span class="keyword">return</span> key .. value <span class="keyword">end</span>)

<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="key">a</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">a1</span><span class="delimiter">&quot;</span></span>, <span class="key">b</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">b2</span><span class="delimiter">&quot;</span></span>, <span class="key">c</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">c3</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>, output)
<span class="predefined">assert</span>.not_same(input, output) <span class="comment">-- it should not change in-place</span></code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-map-maps-a-numberic-table" class="paragraph">
<p> <details><summary> 
Util:map() maps a numberic table
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">input</span> = <span class="map"><span class="delimiter">{</span><span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>, <span class="integer">4</span><span class="delimiter">}</span></span>
<span class="keyword">local</span> <span class="local-variable">output</span> = Util.map(input, <span class="keyword">function</span>(value) <span class="keyword">return</span> value+<span class="integer">1</span> <span class="keyword">end</span>)

<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">2</span>, <span class="integer">3</span>, <span class="integer">4</span>, <span class="integer">5</span><span class="delimiter">}</span></span>, output)
<span class="predefined">assert</span>.not_same(input, output) <span class="comment">-- it should not change in-place</span></code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-map-maps-values-and-retains-keys" class="paragraph">
<p> <details><summary> 
Util:map() maps values and retains keys
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">input</span> = <span class="map"><span class="delimiter">{</span><span class="key">a</span>=<span class="integer">1</span>, <span class="key">b</span>=<span class="integer">2</span>, <span class="key">c</span>=<span class="integer">3</span><span class="delimiter">}</span></span>
<span class="keyword">local</span> <span class="local-variable">output</span> = Util.map(input, <span class="keyword">function</span>(value) <span class="keyword">return</span> value+<span class="integer">1</span> <span class="keyword">end</span>)

<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="key">a</span>=<span class="integer">2</span>, <span class="key">b</span>=<span class="integer">3</span>, <span class="key">c</span>=<span class="integer">4</span><span class="delimiter">}</span></span>, output)
<span class="predefined">assert</span>.not_same(input, output) <span class="comment">-- it should not change in-place</span></code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="util-mergetables">Util:mergeTables()</h3>
<div id="util-mergetables-can-merge-three-tables" class="paragraph">
<p> <details><summary> 
Util:mergeTables() can merge three tables
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">a</span> = <span class="map"><span class="delimiter">{</span><span class="key">a</span> = <span class="integer">1</span>, <span class="key">b</span> = <span class="integer">2</span><span class="delimiter">}</span></span>
<span class="keyword">local</span> <span class="local-variable">b</span> = <span class="map"><span class="delimiter">{</span><span class="key">b</span> = <span class="integer">3</span>, <span class="key">c</span> = <span class="integer">4</span><span class="delimiter">}</span></span>
<span class="keyword">local</span> <span class="local-variable">c</span> = <span class="map"><span class="delimiter">{</span><span class="key">c</span> = <span class="integer">5</span>, <span class="key">d</span> = <span class="integer">6</span><span class="delimiter">}</span></span>

<span class="keyword">local</span> <span class="local-variable">merged</span> = Util.mergeTables(a, b, c)
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="key">a</span> = <span class="integer">1</span>, <span class="key">b</span> = <span class="integer">3</span>, <span class="key">c</span> = <span class="integer">5</span>, <span class="key">d</span> = <span class="integer">6</span><span class="delimiter">}</span></span>, merged)
<span class="comment">-- ensure the original tables are not overridden</span>
<span class="predefined">assert</span>.not_same(a, merged)
<span class="predefined">assert</span>.not_same(b, merged)
<span class="predefined">assert</span>.not_same(c, merged)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-mergetables-fails-if-the-first-argument-is-not-a-table" class="paragraph">
<p> <details><summary> 
Util:mergeTables() fails if the first argument is not a table
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Util.mergeTables(<span class="integer">42</span>, <span class="map"><span class="delimiter">{</span><span class="key">a</span> = <span class="integer">1</span><span class="delimiter">}</span></span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-mergetables-fails-if-the-second-argument-is-not-a-table" class="paragraph">
<p> <details><summary> 
Util:mergeTables() fails if the second argument is not a table
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Util.mergeTables(<span class="map"><span class="delimiter">{</span><span class="key">a</span> = <span class="integer">1</span><span class="delimiter">}</span></span>, <span class="integer">42</span>) <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-mergetables-returns-a-new-table-where-all-items-and-from-the-second-are-present" class="paragraph">
<p> <details><summary> 
Util:mergeTables() returns a new table where all items and from the second are present
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">a</span> = <span class="map"><span class="delimiter">{</span><span class="key">a</span> = <span class="integer">1</span>, <span class="key">b</span> = <span class="integer">2</span><span class="delimiter">}</span></span>
<span class="keyword">local</span> <span class="local-variable">b</span> = <span class="map"><span class="delimiter">{</span><span class="key">c</span> = <span class="integer">3</span>, <span class="key">d</span> = <span class="integer">4</span><span class="delimiter">}</span></span>

<span class="keyword">local</span> <span class="local-variable">merged</span> = Util.mergeTables(a, b)
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="key">a</span> = <span class="integer">1</span>, <span class="key">b</span> = <span class="integer">2</span>, <span class="key">c</span> = <span class="integer">3</span>, <span class="key">d</span> = <span class="integer">4</span><span class="delimiter">}</span></span>, merged)
<span class="comment">-- ensure the original tables are not overridden</span>
<span class="predefined">assert</span>.not_same(a, merged)
<span class="predefined">assert</span>.not_same(b, merged)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-mergetables-the-second-table-overrides-the-first-one" class="paragraph">
<p> <details><summary> 
Util:mergeTables() the second table overrides the first one
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">a</span> = <span class="map"><span class="delimiter">{</span><span class="key">a</span> = <span class="integer">1</span>, <span class="key">b</span> = <span class="integer">2</span><span class="delimiter">}</span></span>
<span class="keyword">local</span> <span class="local-variable">b</span> = <span class="map"><span class="delimiter">{</span><span class="key">b</span> = <span class="integer">3</span>, <span class="key">c</span> = <span class="integer">4</span><span class="delimiter">}</span></span>

<span class="keyword">local</span> <span class="local-variable">merged</span> = Util.mergeTables(a, b)
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="key">a</span> = <span class="integer">1</span>, <span class="key">b</span> = <span class="integer">3</span>, <span class="key">c</span> = <span class="integer">4</span><span class="delimiter">}</span></span>, merged)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="util-mkstring">Util:mkString()</h3>
<div id="util-mkstring-should-return-a-string-if-lastseparator-is-left-out" class="paragraph">
<p> <details><summary> 
Util:mkString() should return a string if lastSeparator is left out
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">table</span> = <span class="map"><span class="delimiter">{</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">one</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">two</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">three</span><span class="delimiter">&quot;</span></span> <span class="delimiter">}</span></span>

<span class="predefined">assert</span>.equal(Util.mkString(table, <span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">one, two, three</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-mkstring-with-lastseparator-parameter-should-fail-when-using-an-associative-table" class="paragraph">
<p> <details><summary> 
Util:mkString() with lastSeparator parameter should fail when using an associative table
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">table</span> = <span class="map"><span class="delimiter">{</span> <span class="key">a</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">one</span><span class="delimiter">&quot;</span></span>, <span class="key">c</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">two</span><span class="delimiter">&quot;</span></span>, <span class="key">b</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">three</span><span class="delimiter">&quot;</span></span> <span class="delimiter">}</span></span>

<span class="predefined">assert</span>.has_error(<span class="keyword">function</span>()
    Util.mkString(table, <span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content"> and </span><span class="delimiter">&quot;</span></span>)
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-mkstring-with-lastseparator-parameter-should-return-a-string-for-a-single-value" class="paragraph">
<p> <details><summary> 
Util:mkString() with lastSeparator parameter should return a string for a single value
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">table</span> = <span class="map"><span class="delimiter">{</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">one</span><span class="delimiter">&quot;</span></span> <span class="delimiter">}</span></span>

<span class="predefined">assert</span>.equal(Util.mkString(table, <span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content"> and </span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">one</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-mkstring-with-lastseparator-parameter-should-return-a-string-for-three-values" class="paragraph">
<p> <details><summary> 
Util:mkString() with lastSeparator parameter should return a string for three values
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">table</span> = <span class="map"><span class="delimiter">{</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">one</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">two</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">three</span><span class="delimiter">&quot;</span></span> <span class="delimiter">}</span></span>

<span class="predefined">assert</span>.equal(Util.mkString(table, <span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content"> and </span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">one, two and three</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-mkstring-with-lastseparator-parameter-should-return-a-string-for-two-values" class="paragraph">
<p> <details><summary> 
Util:mkString() with lastSeparator parameter should return a string for two values
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">table</span> = <span class="map"><span class="delimiter">{</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">one</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">two</span><span class="delimiter">&quot;</span></span> <span class="delimiter">}</span></span>

<span class="predefined">assert</span>.equal(Util.mkString(table, <span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content"> and </span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">one and two</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-mkstring-with-lastseparator-parameter-should-return-an-empty-string-if-table-is-empty" class="paragraph">
<p> <details><summary> 
Util:mkString() with lastSeparator parameter should return an empty string if table is empty
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">table</span> = <span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>

<span class="predefined">assert</span>.equal(Util.mkString(table, <span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content"> and </span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="util-onvector">Util:onVector()</h3>
<div id="util-onvector-returns-a-point-between-point-1-and-point-2" class="paragraph">
<p> <details><summary> 
Util:onVector() returns a point between point 1 and point 2
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">x</span>, <span class="local-variable">y</span> = Util.onVector(<span class="integer">1000</span>, <span class="integer">2000</span>, <span class="integer">3000</span>, <span class="integer">4000</span>, <span class="float">0.5</span>)
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">2000</span>, <span class="integer">3000</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>x, y<span class="delimiter">}</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-onvector-returns-point-1-when-ratio-is-0" class="paragraph">
<p> <details><summary> 
Util:onVector() returns point 1 when ratio is 0
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">x</span>, <span class="local-variable">y</span> = Util.onVector(<span class="integer">1000</span>, <span class="integer">2000</span>, <span class="integer">3000</span>, <span class="integer">4000</span>, <span class="integer">0</span>)
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">1000</span>, <span class="integer">2000</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>x, y<span class="delimiter">}</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-onvector-returns-point-2-when-ratio-is-1" class="paragraph">
<p> <details><summary> 
Util:onVector() returns point 2 when ratio is 1
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">x</span>, <span class="local-variable">y</span> = Util.onVector(<span class="integer">1000</span>, <span class="integer">2000</span>, <span class="integer">3000</span>, <span class="integer">4000</span>, <span class="integer">1</span>)
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">3000</span>, <span class="integer">4000</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>x, y<span class="delimiter">}</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-onvector-works-with-an-object-and-coordinates" class="paragraph">
<p> <details><summary> 
Util:onVector() works with an object and coordinates
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setPosition(<span class="integer">1000</span>, <span class="integer">2000</span>)
<span class="keyword">local</span> <span class="local-variable">x</span>, <span class="local-variable">y</span> = Util.onVector(ship, <span class="integer">3000</span>, <span class="integer">4000</span>, <span class="float">0.5</span>)
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">2000</span>, <span class="integer">3000</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>x, y<span class="delimiter">}</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-onvector-works-with-coordinate-and-an-object" class="paragraph">
<p> <details><summary> 
Util:onVector() works with coordinate and an object
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship</span> = CpuShip():setPosition(<span class="integer">3000</span>, <span class="integer">4000</span>)
<span class="keyword">local</span> <span class="local-variable">x</span>, <span class="local-variable">y</span> = Util.onVector(<span class="integer">1000</span>, <span class="integer">2000</span>, ship, <span class="float">0.5</span>)
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">2000</span>, <span class="integer">3000</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>x, y<span class="delimiter">}</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-onvector-works-with-two-objects" class="paragraph">
<p> <details><summary> 
Util:onVector() works with two objects
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">ship1</span> = CpuShip():setPosition(<span class="integer">1000</span>, <span class="integer">2000</span>)
<span class="keyword">local</span> <span class="local-variable">ship2</span> = CpuShip():setPosition(<span class="integer">3000</span>, <span class="integer">4000</span>)
<span class="keyword">local</span> <span class="local-variable">x</span>, <span class="local-variable">y</span> = Util.onVector(ship1, ship2, <span class="float">0.5</span>)
<span class="predefined">assert</span>.is_same(<span class="map"><span class="delimiter">{</span><span class="integer">2000</span>, <span class="integer">3000</span><span class="delimiter">}</span></span>, <span class="map"><span class="delimiter">{</span>x, y<span class="delimiter">}</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="util-random">Util:random()</h3>
<div id="util-random-allows-to-filter-elements" class="paragraph">
<p> <details><summary> 
Util:random() allows to filter elements
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">thing1</span> = <span class="map"><span class="delimiter">{</span> <span class="key">foo</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span> <span class="delimiter">}</span></span>
<span class="keyword">local</span> <span class="local-variable">thing2</span> = <span class="map"><span class="delimiter">{</span> <span class="key">baz</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span> <span class="delimiter">}</span></span>
<span class="keyword">local</span> <span class="local-variable">thing3</span> = <span class="map"><span class="delimiter">{</span> <span class="key">blu</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">bla</span><span class="delimiter">&quot;</span></span> <span class="delimiter">}</span></span>

<span class="keyword">local</span> <span class="local-variable">testDummy</span> = <span class="map"><span class="delimiter">{</span>thing1, thing2, thing3 <span class="delimiter">}</span></span>

<span class="keyword">local</span> <span class="local-variable">thing1Seen</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">thing2Seen</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">thing3Seen</span> = <span class="predefined-constant">false</span>

<span class="keyword">for</span> i=<span class="integer">1</span>,<span class="integer">16</span>,<span class="integer">1</span> <span class="keyword">do</span>
    <span class="keyword">local</span> <span class="local-variable">result</span> = Util.random(testDummy, <span class="keyword">function</span>(k, v)
        <span class="keyword">return</span> k ~= <span class="integer">3</span>
    <span class="keyword">end</span>)
    <span class="keyword">if</span> result == thing1 <span class="keyword">then</span> thing1Seen = <span class="predefined-constant">true</span> <span class="keyword">elseif</span> result == thing2 <span class="keyword">then</span> thing2Seen = <span class="predefined-constant">true</span> <span class="keyword">elseif</span> result == thing3 <span class="keyword">then</span> thing3Seen = <span class="predefined-constant">true</span> <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="predefined">assert</span>.is_true(thing1Seen)
<span class="predefined">assert</span>.is_true(thing2Seen)
<span class="predefined">assert</span>.is_false(thing3Seen)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-random-returns-all-items-from-the-list-at-random" class="paragraph">
<p> <details><summary> 
Util:random() returns all items from the list at random
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">thing1</span> = <span class="map"><span class="delimiter">{</span> <span class="key">foo</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span> <span class="delimiter">}</span></span>
<span class="keyword">local</span> <span class="local-variable">thing2</span> = <span class="map"><span class="delimiter">{</span> <span class="key">baz</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span> <span class="delimiter">}</span></span>

<span class="keyword">local</span> <span class="local-variable">testDummy</span> = <span class="map"><span class="delimiter">{</span>thing1, thing2 <span class="delimiter">}</span></span>

<span class="keyword">local</span> <span class="local-variable">thing1Seen</span> = <span class="predefined-constant">false</span>
<span class="keyword">local</span> <span class="local-variable">thing2Seen</span> = <span class="predefined-constant">false</span>

<span class="keyword">for</span> i=<span class="integer">1</span>,<span class="integer">16</span>,<span class="integer">1</span> <span class="keyword">do</span>
    <span class="keyword">local</span> <span class="local-variable">result</span> = Util.random(testDummy)
    <span class="keyword">if</span> result == thing1 <span class="keyword">then</span> thing1Seen = <span class="predefined-constant">true</span> <span class="keyword">elseif</span> result == thing2 <span class="keyword">then</span> thing2Seen = <span class="predefined-constant">true</span> <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="predefined">assert</span>.is_true(thing1Seen)
<span class="predefined">assert</span>.is_true(thing2Seen)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-random-returns-an-element-from-a-non-empty-list-with-index" class="paragraph">
<p> <details><summary> 
Util:random() returns an element from a non-empty list with index
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">thing</span> = <span class="map"><span class="delimiter">{</span> <span class="key">foo</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span> <span class="delimiter">}</span></span>

<span class="predefined">assert</span>.is.equal(Util.random(<span class="map"><span class="delimiter">{</span><span class="key">foo</span> = thing<span class="delimiter">}</span></span>), thing)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-random-returns-an-element-from-a-non-empty-list-with-numerical-index" class="paragraph">
<p> <details><summary> 
Util:random() returns an element from a non-empty list with numerical index
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">thing</span> = <span class="map"><span class="delimiter">{</span> <span class="key">foo</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span> <span class="delimiter">}</span></span>

<span class="predefined">assert</span>.is.equal(Util.random(<span class="map"><span class="delimiter">{</span>thing<span class="delimiter">}</span></span>), thing)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-random-returns-nil-if-list-is-empty" class="paragraph">
<p> <details><summary> 
Util:random() returns nil if list is empty
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_nil(Util.random(<span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-random-returns-nil-if-the-filter-does-not-leave-any-item" class="paragraph">
<p> <details><summary> 
Util:random() returns nil if the filter does not leave any item
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_nil(Util.random(<span class="map"><span class="delimiter">{</span><span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>, <span class="integer">4</span><span class="delimiter">}</span></span>, <span class="keyword">function</span>() <span class="keyword">return</span> <span class="predefined-constant">false</span> <span class="keyword">end</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="util-randomsort">Util:randomSort()</h3>
<div id="util-randomsort-fails-if-no-table-is-given" class="paragraph">
<p> <details><summary> 
Util:randomSort() fails if no table is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.has_error(<span class="keyword">function</span>() Util.randomSort() <span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-randomsort-randomly-sorts-a-named-list" class="paragraph">
<p> <details><summary> 
Util:randomSort() randomly sorts a named list
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">input</span> = <span class="map"><span class="delimiter">{</span><span class="key">a</span>=<span class="integer">1</span>, <span class="key">b</span>=<span class="integer">2</span>, <span class="key">c</span>=<span class="integer">3</span>, <span class="key">d</span>=<span class="integer">4</span>, <span class="key">e</span>=<span class="integer">5</span>, <span class="key">f</span>=<span class="integer">6</span>, <span class="key">g</span>=<span class="integer">7</span>, <span class="key">h</span>=<span class="integer">8</span>, <span class="key">i</span>=<span class="integer">9</span>, <span class="key">j</span>=<span class="integer">10</span>, <span class="key">k</span>=<span class="integer">11</span>, <span class="key">l</span>=<span class="integer">12</span>, <span class="key">m</span>=<span class="integer">13</span>, <span class="key">n</span>=<span class="integer">14</span>, <span class="key">o</span>=<span class="integer">15</span>, <span class="key">p</span>=<span class="integer">16</span><span class="delimiter">}</span></span>
<span class="keyword">local</span> <span class="local-variable">output</span> = Util.randomSort(input)

<span class="predefined">assert</span>.is_table(output)
<span class="predefined">assert</span>.is_same(<span class="integer">16</span>, Util.size(output))
<span class="predefined">assert</span>.contains_value(<span class="integer">8</span>, output)
<span class="predefined">assert</span>.is_true(Util.isNumericTable(output))
<span class="predefined">assert</span>.not_same(input, output)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-randomsort-randomly-sorts-a-numeric-list" class="paragraph">
<p> <details><summary> 
Util:randomSort() randomly sorts a numeric list
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">input</span> = <span class="map"><span class="delimiter">{</span><span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>, <span class="integer">4</span>, <span class="integer">5</span>, <span class="integer">6</span>, <span class="integer">7</span>, <span class="integer">8</span>, <span class="integer">9</span>, <span class="integer">10</span>, <span class="integer">11</span>, <span class="integer">12</span>, <span class="integer">13</span>, <span class="integer">14</span>, <span class="integer">15</span>, <span class="integer">16</span><span class="delimiter">}</span></span>
<span class="keyword">local</span> <span class="local-variable">output</span> = Util.randomSort(input)

<span class="predefined">assert</span>.is_table(output)
<span class="predefined">assert</span>.is_same(<span class="integer">16</span>, Util.size(output))
<span class="predefined">assert</span>.contains_value(<span class="integer">8</span>, output)
<span class="predefined">assert</span>.is_true(Util.isNumericTable(output))
<span class="predefined">assert</span>.not_same(input, output)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-randomsort-returns-different-results-each-time-in-a-numeric-list" class="paragraph">
<p> <details><summary> 
Util:randomSort() returns different results each time in a numeric list
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">input</span> = <span class="map"><span class="delimiter">{</span><span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>, <span class="integer">4</span>, <span class="integer">5</span>, <span class="integer">6</span>, <span class="integer">7</span>, <span class="integer">8</span>, <span class="integer">9</span>, <span class="integer">10</span>, <span class="integer">11</span>, <span class="integer">12</span>, <span class="integer">13</span>, <span class="integer">14</span>, <span class="integer">15</span>, <span class="integer">16</span><span class="delimiter">}</span></span>
<span class="keyword">local</span> <span class="local-variable">output1</span> = Util.randomSort(input)
<span class="keyword">local</span> <span class="local-variable">output2</span> = Util.randomSort(input)

<span class="predefined">assert</span>.not_same(output1, output2)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-randomsort-returns-different-results-each-time-in-a-numeric-list" class="paragraph">
<p> <details><summary> 
Util:randomSort() returns different results each time in a numeric list
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">input</span> = <span class="map"><span class="delimiter">{</span><span class="key">a</span>=<span class="integer">1</span>, <span class="key">b</span>=<span class="integer">2</span>, <span class="key">c</span>=<span class="integer">3</span>, <span class="key">d</span>=<span class="integer">4</span>, <span class="key">e</span>=<span class="integer">5</span>, <span class="key">f</span>=<span class="integer">6</span>, <span class="key">g</span>=<span class="integer">7</span>, <span class="key">h</span>=<span class="integer">8</span>, <span class="key">i</span>=<span class="integer">9</span>, <span class="key">j</span>=<span class="integer">10</span>, <span class="key">k</span>=<span class="integer">11</span>, <span class="key">l</span>=<span class="integer">12</span>, <span class="key">m</span>=<span class="integer">13</span>, <span class="key">n</span>=<span class="integer">14</span>, <span class="key">o</span>=<span class="integer">15</span>, <span class="key">p</span>=<span class="integer">16</span><span class="delimiter">}</span></span>
<span class="keyword">local</span> <span class="local-variable">output1</span> = Util.randomSort(input)
<span class="keyword">local</span> <span class="local-variable">output2</span> = Util.randomSort(input)

<span class="predefined">assert</span>.not_same(output1, output2)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="util-randomuuid">Util:randomUuid()</h3>
<div id="util-randomuuid-should-not-return-the-same-uuid-twice" class="paragraph">
<p> <details><summary> 
Util:randomUuid() should not return the same uuid twice
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">uuid</span> = Util.randomUuid()
<span class="keyword">local</span> <span class="local-variable">uuid2</span> = Util.randomUuid()
<span class="predefined">assert</span>.not_equal(uuid, uuid2)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-randomuuid-should-return-a-16-digit-hex" class="paragraph">
<p> <details><summary> 
Util:randomUuid() should return a 16 digit hex
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">uuid</span> = Util.randomUuid()
<span class="predefined">assert</span>.not_nil(uuid:match(<span class="string"><span class="delimiter">&quot;</span><span class="content">^([0-9a-f]+)$</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.equal(uuid:len(), <span class="integer">16</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="util-round">Util:round()</h3>
<div id="util-round-can-correctly-round-to-a-base-of-10" class="paragraph">
<p> <details><summary> 
Util:round() can correctly round to a base of 10
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(<span class="integer">0</span>, Util.round(<span class="integer">0</span>, <span class="integer">10</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, Util.round(<span class="integer">1</span>, <span class="integer">10</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, Util.round(<span class="integer">4</span>, <span class="integer">10</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, Util.round(<span class="float">4.9</span>, <span class="integer">10</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">10</span>, Util.round(<span class="float">5.1</span>, <span class="integer">10</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">10</span>, Util.round(<span class="integer">6</span>, <span class="integer">10</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">10</span>, Util.round(<span class="integer">9</span>, <span class="integer">10</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">10</span>, Util.round(<span class="integer">10</span>, <span class="integer">10</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-round-can-round-to-different-bases" class="paragraph">
<p> <details><summary> 
Util:round() can round to different bases
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(<span class="integer">40</span>, Util.round(<span class="integer">42</span>, <span class="integer">5</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">42</span>, Util.round(<span class="integer">42</span>, <span class="integer">7</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">40</span>, Util.round(<span class="integer">42</span>, <span class="integer">10</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-round-rounds-mathematically-correct-for-negative-numbers" class="paragraph">
<p> <details><summary> 
Util:round() rounds mathematically correct for negative numbers
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(<span class="integer">-42</span>, Util.round(<span class="integer">-42</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">-42</span>, Util.round(<span class="float">-42.1</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">-42</span>, Util.round(<span class="float">-42.4</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">-42</span>, Util.round(<span class="float">-42.49</span>))
<span class="comment">-- because of float magic do not test -42.5 directly</span>
<span class="predefined">assert</span>.is_same(<span class="integer">-43</span>, Util.round(<span class="float">-42.51</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">-43</span>, Util.round(<span class="float">-42.6</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">-43</span>, Util.round(<span class="float">-42.9</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-round-rounds-mathematically-correct-for-positive-numbers" class="paragraph">
<p> <details><summary> 
Util:round() rounds mathematically correct for positive numbers
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(<span class="integer">42</span>, Util.round(<span class="integer">42</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">42</span>, Util.round(<span class="float">42.1</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">42</span>, Util.round(<span class="float">42.4</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">42</span>, Util.round(<span class="float">42.49</span>))
<span class="comment">-- because of float magic do not test 42.5 directly</span>
<span class="predefined">assert</span>.is_same(<span class="integer">43</span>, Util.round(<span class="float">42.51</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">43</span>, Util.round(<span class="float">42.6</span>))
<span class="predefined">assert</span>.is_same(<span class="integer">43</span>, Util.round(<span class="float">42.9</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="util-size">Util:size()</h3>
<div id="util-size-correctly-determines-size-of-a-table-with-mixed-indices" class="paragraph">
<p> <details><summary> 
Util:size() correctly determines size of a table with mixed indices
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is.same(Util.size(<span class="map"><span class="delimiter">{</span>
    <span class="key">foo</span> = <span class="integer">42</span>,
    <span class="key">bar</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span>,
    <span class="key">baz</span> = <span class="map"><span class="inline-delimiter">{</span><span class="inline-delimiter">}</span></span>,
    <span class="integer">42</span>,
<span class="delimiter">}</span></span>), <span class="integer">4</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-size-correctly-determines-size-of-a-table-with-numerical-index" class="paragraph">
<p> <details><summary> 
Util:size() correctly determines size of a table with numerical index
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is.same(Util.size(<span class="map"><span class="delimiter">{</span><span class="integer">42</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>, <span class="map"><span class="inline-delimiter">{</span><span class="inline-delimiter">}</span></span><span class="delimiter">}</span></span>), <span class="integer">3</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-size-correctly-determines-size-of-a-table-with-object-index" class="paragraph">
<p> <details><summary> 
Util:size() correctly determines size of a table with object index
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is.same(Util.size(<span class="map"><span class="delimiter">{</span>
    <span class="key">foo</span> = <span class="integer">42</span>,
    <span class="key">bar</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span>,
    <span class="key">baz</span> = <span class="map"><span class="inline-delimiter">{</span><span class="inline-delimiter">}</span></span>
<span class="delimiter">}</span></span>), <span class="integer">3</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-size-correctly-determines-size-of-an-empty-table" class="paragraph">
<p> <details><summary> 
Util:size() correctly determines size of an empty table
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is.same(Util.size(<span class="map"><span class="delimiter">{</span><span class="delimiter">}</span></span>), <span class="integer">0</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="util-vectorfromangle">Util:vectorFromAngle()</h3>
<div id="util-vectorfromangle-has-the-x-axis-for-0-degree" class="paragraph">
<p> <details><summary> 
Util:vectorFromAngle() has the x axis for 0 degree
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">x</span>, <span class="local-variable">y</span> = Util.vectorFromAngle(<span class="integer">0</span>, <span class="integer">1000</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">1000</span>, math.floor(x))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, math.floor(y))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-vectorfromangle-it-works-counter-clockwise" class="paragraph">
<p> <details><summary> 
Util:vectorFromAngle() it works counter clockwise
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">x</span>, <span class="local-variable">y</span> = Util.vectorFromAngle(<span class="integer">90</span>, <span class="integer">1000</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, math.floor(x))
<span class="predefined">assert</span>.is_same(<span class="integer">1000</span>, math.floor(y))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="util-vectorfromangle-it-works-with-degrees" class="paragraph">
<p> <details><summary> 
Util:vectorFromAngle() it works with degrees
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">x</span>, <span class="local-variable">y</span> = Util.vectorFromAngle(<span class="integer">180</span>, <span class="integer">1000</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">-1000</span>, math.floor(x))
<span class="predefined">assert</span>.is_same(<span class="integer">0</span>, math.floor(y))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="other">Other</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="typeinspect">typeInspect()</h3>
<div id="typeinspect-prints-playerspaceship" class="paragraph">
<p> <details><summary> 
typeInspect() prints PlayerSpaceShip
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">player</span> = PlayerSpaceship():setCallSign(<span class="string"><span class="delimiter">&quot;</span><span class="content">Artemis</span><span class="delimiter">&quot;</span></span>)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;PlayerSpaceship&gt;</span><span class="char">\&quot;</span><span class="content">Artemis</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span>, typeInspect(player))

player:destroy()
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;PlayerSpaceship&gt;</span><span class="delimiter">&quot;</span></span>, typeInspect(player))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="typeinspect-prints-boolean" class="paragraph">
<p> <details><summary> 
typeInspect() prints boolean
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;bool&gt;true</span><span class="delimiter">&quot;</span></span>, typeInspect(<span class="predefined-constant">true</span>))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;bool&gt;false</span><span class="delimiter">&quot;</span></span>, typeInspect(<span class="predefined-constant">false</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="typeinspect-prints-function" class="paragraph">
<p> <details><summary> 
typeInspect() prints function
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;function&gt;</span><span class="delimiter">&quot;</span></span>, typeInspect(<span class="keyword">function</span>() <span class="keyword">end</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="typeinspect-prints-nil" class="paragraph">
<p> <details><summary> 
typeInspect() prints nil
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;nil&gt;</span><span class="delimiter">&quot;</span></span>, typeInspect(<span class="predefined-constant">nil</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="typeinspect-prints-number" class="paragraph">
<p> <details><summary> 
typeInspect() prints number
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;number&gt;42</span><span class="delimiter">&quot;</span></span>, typeInspect(<span class="integer">42</span>))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;number&gt;-123</span><span class="delimiter">&quot;</span></span>, typeInspect(<span class="integer">-123</span>))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;number&gt;12.3456</span><span class="delimiter">&quot;</span></span>, typeInspect(<span class="float">12.3456</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="typeinspect-prints-strings" class="paragraph">
<p> <details><summary> 
typeInspect() prints strings
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;string&gt;</span><span class="char">\&quot;</span><span class="content">foobar</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span>, typeInspect(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;string&gt;</span><span class="char">\&quot;</span><span class="content">This is a very long sting that...</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span>, typeInspect(<span class="string"><span class="delimiter">&quot;</span><span class="content">This is a very long sting that should be cut off in order to not be too long.</span><span class="delimiter">&quot;</span></span>))
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;string&gt;</span><span class="char">\&quot;</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span>, typeInspect(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="typeinspect-prints-tables-with-numeric-key" class="paragraph">
<p> <details><summary> 
typeInspect() prints tables with numeric key
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;table&gt;(size: 2)</span><span class="delimiter">&quot;</span></span>, typeInspect(<span class="map"><span class="delimiter">{</span><span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span><span class="delimiter">}</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="typeinspect-prints-tables-with-string-key" class="paragraph">
<p> <details><summary> 
typeInspect() prints tables with string key
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;table&gt;(size: 2)</span><span class="delimiter">&quot;</span></span>, typeInspect(<span class="map"><span class="delimiter">{</span><span class="key">foo</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, <span class="key">baz</span> = <span class="integer">42</span><span class="delimiter">}</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect2">
<h3 id="usercallback">userCallback()</h3>
<div id="usercallback-calls-the-callback-and-returns-the-args-if-no-error-occurs" class="paragraph">
<p> <details><summary> 
userCallback() calls the callback and returns the args if no error occurs
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua"><span class="keyword">local</span> <span class="local-variable">a</span>,<span class="local-variable">b</span>,<span class="local-variable">c</span> = userCallback(<span class="keyword">function</span>(arg1, arg2, arg3) <span class="keyword">return</span> arg1 * <span class="integer">7</span>, arg2 .. <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, <span class="keyword">not</span> arg3 <span class="keyword">end</span>, <span class="integer">6</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">true</span>)

<span class="predefined">assert</span>.is_same(<span class="integer">42</span>, a)
<span class="predefined">assert</span>.is_same(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>, b)
<span class="predefined">assert</span>.is_false(c)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="usercallback-logs-an-error-and-returns-nil-if-an-error-occurs" class="paragraph">
<p> <details><summary> 
userCallback() logs an error and returns nil if an error occurs
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">withLogCatcher(<span class="keyword">function</span>(logs)
    <span class="keyword">local</span> <span class="local-variable">result</span> = userCallback(<span class="keyword">function</span>() <span class="predefined">error</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fail</span><span class="delimiter">&quot;</span></span>) <span class="keyword">end</span>)
    <span class="predefined">assert</span>.is_nil(result)
    <span class="predefined">assert</span>.is_not_nil(logs:popLastError())
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="usercallback-logs-an-error-if-an-invalid-function-is-given" class="paragraph">
<p> <details><summary> 
userCallback() logs an error if an invalid function is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">withLogCatcher(<span class="keyword">function</span>(logs)
    <span class="keyword">local</span> <span class="local-variable">result</span> = userCallback(<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span>)
    <span class="predefined">assert</span>.is_nil(result)
    <span class="predefined">assert</span>.is_not_nil(logs:popLastError())
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div id="usercallback-returns-if-no-function-is-given" class="paragraph">
<p> <details><summary> 
userCallback() returns if no function is given
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="lua">withLogCatcher(<span class="keyword">function</span>(logs)
    <span class="keyword">local</span> <span class="local-variable">result</span> = userCallback(<span class="predefined-constant">nil</span>)
    <span class="predefined">assert</span>.is_nil(result)
    <span class="predefined">assert</span>.is_nil(logs:popLastError())
<span class="keyword">end</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version dev<br>
Last updated 2021-06-12 13:29:58 UTC
</div>
</div>
</body>
</html>